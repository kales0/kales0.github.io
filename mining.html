<!DOCTYPE html>
<!--
==========================================================================
RULES FOR AI ASSISTANT â€” READ BEFORE MAKING ANY CHANGES
==========================================================================

RULE MANAGEMENT:
  - Any game generation rule, coding rule, or convention outlined by the
    user must be added to this header block so it persists for future sessions
  - Always confirm with the user before adding or modifying rules in this header

VERSIONING:
  - Format: YY.M.edit (e.g. 26.2.67 = year 2026, February, edit 67)
  - Each output file increments the edit number by 1
  - Filename must match: mining_YY-M-edit.html (e.g. mining_26-2-67.html)
  - Internal GAME_VERSION constant must match the filename
  - New month resets edit to 1 (e.g. 26.2.99 â†’ 26.3.1)

STATIC DATA:
  - All biome configs (e.g. for rock biome, rock_1 through rock_9) contain baked static data
    for terrain (hills) and items (trees, rocks, sticks, minables) with
    precomputed UV colliders (cols) on every item
  - New configs are generated using the generationRules when requested by the user
  - Configs can be regenerated using the generator functions (generateRockConfig, etc.)
    but only when explicitly requested by the user. Never regenerate configs unprompted.

BIOME GENERATION RULES:
  - Rock biome: rocky terrain with scattered trees, rocks, and minable
    material clusters (currently crystal). Hills are taller at the back, shorter at the front.
    See generationRules object and ROCK BIOME HILL GENERATION RULES
    comment block within BIOMES.rock for specific ranges and values.
  - Forest biome: dense fir tree clusters on a single hill. Each config has
    1 hill (rectangular or triangular) against one edge, covering full width.
    Hills use shape:'rect' (wx/wz half-widths) or shape:'tri' (corner-based).
    Trees generated via generateForestShape(), then baked to static data.
    See generationRules within BIOMES.forest for specific ranges and values.

COORDINATE SYSTEM:
  - Regions use UV [0,1] mapped to local [-S, +S] via: x = -S + u * 2 * S
  - World offset: ox = gx * REGION_SIZE, oz = gz * REGION_SIZE
  - Ground shader adds uWorldOffset to local vertex positions
  - Trees/rocks/minables store world-space positions (already include ox/oz)
  - Hills blend across region boundaries via getBlendedHeight() (all biomes)

EDGE BLENDING:
  - EDGE_OVERLAP (0.15) extends ground mesh beyond UV [0,1]
  - edgeMask() in fragment shader uses discard for blocky noise blend

SHADER PRECISION:
  - Use precision mediump float as the default for fragment shaders (better
    mobile GPU performance for simple color/lighting/texture work)
  - Fragment shaders using hash/noise functions MUST use precision highp float
    — mediump (16-bit on some Android GPUs) breaks hash function precision,
    producing incorrect noise values and visual artifacts
  - Using highp is always acceptable — never downgrade from highp to mediump
    if there is any doubt about precision requirements

AI ASSISTANT BEHAVIOR:
  - Never guess or assume about the current state of the code. Always read
    the relevant code before making claims about what it does or doesn't do.
    If unsure, check first, then respond. No speculating about functionality.

WORLD EDGE MARGINS:
  - The isometric camera looks from (+X, +Y, +Z) toward the origin.
  - "Top-left world edge" = the -X edge of the grid (gx === -GRID_HALF).
    These regions' LEFT side faces the world boundary in the top-left
    screen direction. Regions: (-1,-1), (-1,0), (-1,1).
  - "Top-right world edge" = the -Z edge of the grid (gz === -GRID_HALF).
    These regions' TOP side faces the world boundary in the top-right
    screen direction. Regions: (-1,-1), (0,-1), (1,-1).
  - Only these two edges (top-left and top-right) get 0 margin at the
    world boundary, because they face away from the camera and there is
    nothing beyond them to overlap with visually.
  - The bottom-left (+Z max) and bottom-right (+X max) world edges keep
    normal margin behavior (they face toward the camera).

==========================================================================
-->
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mining Game</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #08080c; overflow: hidden; display: flex; align-items: center; justify-content: center; height: 100dvh; height: 100vh; }
canvas { display: block; }
#fsBtn {
  position: fixed; top: 14px; right: 14px; z-index: 10;
  width: 38px; height: 37px; border: 1px solid #3a3a40; border-radius: 6px;
  background: linear-gradient(180deg, #2a2a30 0%, #0a0a0f 100%);
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  padding: 0; margin: 0; line-height: 0;
}
#fsBtn svg, #colBtn svg, #statsToggle svg { display: block; }
#fsBtn svg { width: 18px; height: 18px; stroke: rgba(255,255,255,0.7); fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
#colBtn {
  position: fixed; top: 14px; right: 58px; z-index: 10;
  width: 38px; height: 37px; border: 1px solid #3a3a40; border-radius: 6px;
  background: linear-gradient(180deg, #2a2a30 0%, #0a0a0f 100%);
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  padding: 0; margin: 0; line-height: 0;
}
#colBtn svg { width: 18px; height: 18px; stroke: rgba(255,255,255,0.7); fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
#fsBtn, #colBtn, #wireBtn, #hillBtn, #statsToggle, #configDropdown, #biomeDropdown, #fpsCapBtn { outline: none; }
#colBtn.active { background: #1a1a3a; }
#wireBtn {
  position: fixed; top: 14px; right: 102px; z-index: 10;
  width: 38px; height: 37px; border: 1px solid #3a3a40; border-radius: 6px;
  background: linear-gradient(180deg, #2a2a30 0%, #0a0a0f 100%);
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  padding: 0; margin: 0; line-height: 0;
}
#wireBtn svg { width: 18px; height: 18px; stroke: rgba(255,255,255,0.7); fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
#wireBtn.active { background: #1a1a3a; }
#hillBtn {
  position: fixed; top: 14px; right: 146px; z-index: 10;
  width: 38px; height: 37px; border: 1px solid #3a3a40; border-radius: 6px;
  background: linear-gradient(180deg, #2a2a30 0%, #0a0a0f 100%);
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  padding: 0; margin: 0; line-height: 0;
}
#hillBtn svg { width: 18px; height: 18px; stroke: rgba(255,255,255,0.7); fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
#hillBtn.active { background: #1a1a3a; }
#biomeHud {
  position: fixed; top: 14px; right: 252px; z-index: 10;
  display: flex; align-items: center; gap: 8px;
  font: 12px/1 -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}
#biomeName {
  color: rgba(255,255,255,0.45); letter-spacing: 0.03em;
  text-transform: uppercase; font-size: 11px; font-weight: 500;
}
#biomeDropdown {
  position: relative; display: inline-block; cursor: pointer;
  background: linear-gradient(180deg, #2a2a30 0%, #0a0a0f 100%);
  border: 1px solid #3a3a40;
  border-radius: 5px; padding: 0 22px 0 8px;
  font: 11px/1 -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  color: rgba(255,255,255,0.5); transition: background 0.2s, border-color 0.2s;
  user-select: none; min-width: 56px; text-align: center;
  height: 37px; line-height: 37px;
}
#biomeOptions {
  display: none; position: absolute; top: calc(100% + 4px); left: -1px; right: -1px;
  background: rgba(20,20,30,0.95); border: 1px solid rgba(255,255,255,0.1);
  border-radius: 5px; overflow: hidden; z-index: 100;
  backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
}
#biomeOptions.open { display: block; }
.biome-opt {
  padding: 4px 10px; color: rgba(255,255,255,0.55); font-size: 11px;
  text-align: center; transition: background 0.15s; line-height: 1;
}
.biome-opt:hover { background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.8); }
.biome-opt.active { color: rgba(255,255,255,0.9); background: rgba(0,0,0,0.35); }
#configDropdown {
  position: relative; display: inline-block; cursor: pointer;
  background: linear-gradient(180deg, #2a2a30 0%, #0a0a0f 100%);
  border: 1px solid #3a3a40;
  border-radius: 5px; padding: 0 22px 0 8px;
  font: 11px/1 -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  color: rgba(255,255,255,0.5); transition: background 0.2s, border-color 0.2s;
  user-select: none; min-width: 28px; text-align: center;
  height: 37px; line-height: 37px;
}
#configOptions {
  display: none; position: absolute; top: calc(100% + 4px); left: -1px; right: -1px;
  background: rgba(20,20,30,0.95); border: 1px solid rgba(255,255,255,0.1);
  border-radius: 5px; overflow: hidden; z-index: 100;
  backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
}
#configOptions.open { display: block; }
.cfg-opt {
  padding: 4px 10px; color: rgba(255,255,255,0.55); font-size: 11px;
  text-align: center; transition: background 0.15s; line-height: 1;
}
.cfg-opt:hover { background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.8); }
.cfg-opt.active { color: rgba(255,255,255,0.9); background: rgba(0,0,0,0.35); }
@media (max-width: 600px) and (orientation: portrait) {
  #biomeHud {
    top: auto !important; bottom: 14px; right: auto !important;
    left: 50%; transform: translateX(-50%);
  }
  #biomeOptions, #configOptions {
    top: auto; bottom: calc(100% + 4px);
  }
  /* Top-right buttons: 2 per row, split from rightmost */
  #fsBtn { right: 14px; top: 14px; }
  #colBtn { right: 58px; top: 14px; }
  #wireBtn { right: 14px; top: 57px; }
  #hillBtn { right: 58px; top: 57px; }
  #fpsCapBtn { right: 14px !important; top: 100px !important; }
  body.claude-preview #biomeHud { bottom: 180px; left: auto; right: 14px !important; transform: none; }
}
@media (max-height: 500px) and (orientation: landscape) {
  #biomeHud {
    top: auto !important; bottom: 14px; right: 14px !important;
  }
  #biomeOptions, #configOptions {
    top: auto; bottom: calc(100% + 4px);
  }
  body.claude-preview #biomeHud { bottom: 80px; }
}
</style>
</head>
<body>
<script>
// Detect Claude preview iframe and add class for CSS adjustments
(function() {
  var isClaude = false;
  if (window.location.ancestorOrigins && window.location.ancestorOrigins.length > 0) {
    for (var i = 0; i < window.location.ancestorOrigins.length; i++) {
      if (window.location.ancestorOrigins[i].indexOf('claude.ai') !== -1) { isClaude = true; break; }
    }
  } else if (window.self !== window.top) {
    try { void window.top.location.href; } catch(e) { isClaude = true; }
  }
  if (isClaude) document.body.classList.add('claude-preview');
})();
</script>
<div id="statsWrap" style="position:fixed;top:10px;left:10px;z-index:10;display:flex;align-items:flex-start;gap:14px;transition:transform 0.3s ease;">
  <div id="stats" style="color:rgba(255,255,255,0.5);font:11px/1.6 monospace;pointer-events:none;white-space:pre;">144 FPS | 1.0ms (0.0-2.0)
5,824 Tris | 27 Draws (705)
Zoom 0 | 26.2.658</div>
  <button id="statsToggle" title="Hide stats" style="
    width:27px;height:37px;border:1px solid #3a3a40;border-radius:6px;
    background:linear-gradient(180deg, #2a2a30 0%, #0a0a0f 100%);
    cursor:pointer;display:flex;align-items:center;justify-content:center;
    transition:background 0.2s,border-color 0.2s;flex-shrink:0;padding:0;margin:4px 0 0 0;line-height:0;
  ">
    <svg id="statsArrow" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.7)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="15 18 9 12 15 6"></polyline>
    </svg>
  </button>
</div>
<div id="biomeHud">
  <div style="display:flex;flex-direction:column;gap:2px;">
    <div>
      <span style="color:rgba(255,255,255,0.3);font-size:11px;">Region:</span>
      <span id="regionCoords" style="color:rgba(255,255,255,0.45);font-size:11px;">0, 0</span>
    </div>
  </div>
  <div id="biomeDropdown">
    <div id="biomeSelected">Forest</div>
    <svg width="10" height="6" style="position:absolute;right:7px;top:50%;transform:translateY(-50%);pointer-events:none;" fill="none"><path d="M1 1l4 4 4-4" stroke="rgba(255,255,255,0.35)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>
    <div id="biomeOptions"><div class="biome-opt" data-biome="rock">Rock</div><div class="biome-opt active" data-biome="forest">Forest</div><div class="biome-opt" data-biome="desert">Desert</div></div>
  </div>
  <div id="configDropdown">
    <div id="configSelected">4</div>
    <svg width="10" height="6" style="position:absolute;right:7px;top:50%;transform:translateY(-50%);pointer-events:none;" fill="none"><path d="M1 1l4 4 4-4" stroke="rgba(255,255,255,0.35)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>
    <div id="configOptions"><div class="cfg-opt" data-idx="0">1</div><div class="cfg-opt" data-idx="1">2</div><div class="cfg-opt" data-idx="2">3</div><div class="cfg-opt active" data-idx="3">4</div><div class="cfg-opt" data-idx="4">5</div><div class="cfg-opt" data-idx="5">6</div><div class="cfg-opt" data-idx="6">7</div><div class="cfg-opt" data-idx="7">8</div><div class="cfg-opt" data-idx="8">9</div></div>
  </div>
</div>
<button id="colBtn" title="Toggle colliders">
  <svg viewBox="0 0 24 24">
    <circle cx="12" cy="12" r="9"></circle>
    <line x1="12" y1="3" x2="12" y2="21"></line>
    <line x1="3" y1="12" x2="21" y2="12"></line>
  </svg>
</button>
<button id="wireBtn" title="Toggle wireframe">
  <svg viewBox="0 0 24 24">
    <polygon points="12 3 3 21 21 21"></polygon>
    <line x1="12" y1="3" x2="12" y2="21"></line>
    <line x1="7.5" y1="12" x2="16.5" y2="12"></line>
  </svg>
</button>
<button id="hillBtn" title="Toggle hills">
  <svg viewBox="0 0 24 24">
    <polyline points="2 20 9 8 13 14 16 10 22 20"></polyline>
  </svg>
</button>
<button id="fpsCapBtn" title="FPS cap: off" style="
  position:fixed;top:14px;right:190px;z-index:10;
  width:38px;height:37px;border:1px solid #3a3a40;border-radius:6px;
  background:linear-gradient(180deg, #2a2a30 0%, #0a0a0f 100%);
  cursor:pointer;display:flex;align-items:center;justify-content:center;
  transition:background 0.2s,border-color 0.2s;padding:0;margin:0;
  font:11px/1 monospace;color:rgba(255,255,255,0.7);
"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.7)" stroke-width="2.5" stroke-linecap="round"><line x1="5" y1="19" x2="19" y2="5"></line></svg></button>
<button id="fsBtn" title="Toggle fullscreen">
  <svg id="fsIcon" viewBox="0 0 24 24">
    <polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline>
    <line x1="21" y1="3" x2="14" y2="10"></line><line x1="3" y1="21" x2="10" y2="14"></line>
  </svg>
</button>

<canvas id="gl" width="2486" height="1326" style="width: 1865px; height: 995px;"></canvas>
<script>
// ============================================================
// SCREEN DIRECTION REFERENCE (isometric camera at camRotY = PI/4)
//
// The camera looks from (+X, +Y, +Z) toward the origin.
// On screen, the four cardinal directions map to world coords as:
//
//   UP    (away from camera)  = equal parts -X and -Z  â†’ toward (-1, -1)
//   DOWN  (toward camera)     = equal parts +X and +Z  â†’ toward (+1, +1)
//   RIGHT (screen right)      = equal parts +X and -Z  â†’ toward (+1, -1)
//   LEFT  (screen left)       = equal parts -X and +Z  â†’ toward (-1, +1)
//
// So to move something "up" on screen, decrease both X and Z equally.
// To move something "right" on screen, increase X and decrease Z equally.
// ============================================================

// ============================================================
// VERSION TRACKING
// Format: YY.M.edit  (e.g. 26.2.1 = 2026, February, edit 1)
// Rule: Each edit increments the last digit. New month resets
// edit to 1 and increments month. E.g. 26.2.2 -> 26.3.1
// ============================================================
const GAME_VERSION = '26.2.658';
window._debugFlatTerrain = false;

const canvas = document.getElementById('gl');
const gl = canvas.getContext('webgl2');

function resize() {
  const dpr = window.devicePixelRatio || 1;
  canvas.width = window.innerWidth * dpr;
  canvas.height = window.innerHeight * dpr;
  canvas.style.width = window.innerWidth + 'px';
  canvas.style.height = window.innerHeight + 'px';
  gl.viewport(0, 0, canvas.width, canvas.height);
}
resize();
window.addEventListener('resize', resize);

// --- Shaders ---
const vsSource = `#version 300 es
  in vec3 aPos;
  in vec2 aUV;
  uniform mat4 uProj;
  uniform mat4 uView;
  uniform vec3 uWorldOffset;
  out vec2 vUV;
  out vec3 vWorldPos;
  void main() {
    vec3 pos = aPos + uWorldOffset;
    vUV = aUV;
    vWorldPos = pos;
    gl_Position = uProj * uView * vec4(pos, 1.0);
  }
`;

const fsSource = `#version 300 es
  precision highp float;
  out vec4 fragColor;
  in vec2 vUV;
  in vec3 vWorldPos;
  uniform vec3 uPlayerPos;
  uniform float uMineralOnly;
  uniform sampler2D uMineralMask;
  uniform sampler2D uMineralColorTex;
  uniform sampler2D uLocalTex;

  float hash(vec2 p) {
    p = fract(p * vec2(579.83, 264.37));
    p += dot(p, p + 91.14);
    return fract(p.x * p.y);
  }

  float pixelNoise(vec2 uv, float scale) {
    vec2 id = floor(uv * scale);
    return hash(id);
  }

  // Edge mask: inside UV 0-1 always solid. In overlap zone (outside 0-1),
  // blocky noise determines survival. A small solid zone at the boundary
  // prevents gaps between core and overlap. Beyond that, noise fades out.
  // All four directions use the same pattern. Two-pass rendering ensures symmetry.
  float edgeMask(vec2 uv, vec3 worldPos) {
    if (uv.x >= 0.0 && uv.x <= 1.0 && uv.y >= 0.0 && uv.y <= 1.0) return 1.0;

    float blockScale = 1.2;
    vec2 wc = worldPos.xz * blockScale;
    float ax = 1.0;
    float az = 1.0;
    float overlap = 0.15;
    float solidZone = 0.25; // fraction of overlap that stays solid (no noise)

    if (uv.x < 0.0) {
      float t = -uv.x / overlap;
      if (t > solidZone) {
        float nt = (t - solidZone) / (1.0 - solidZone); // remap to 0-1
        ax = step(nt, pixelNoise(wc, 1.0));
      }
    } else if (uv.x > 1.0) {
      float t = (uv.x - 1.0) / overlap;
      if (t > solidZone) {
        float nt = (t - solidZone) / (1.0 - solidZone);
        ax = step(nt, pixelNoise(wc, 1.0));
      }
    }

    if (uv.y < 0.0) {
      float t = -uv.y / overlap;
      if (t > solidZone) {
        float nt = (t - solidZone) / (1.0 - solidZone);
        az = step(nt, pixelNoise(wc + 33.3, 1.0));
      }
    } else if (uv.y > 1.0) {
      float t = (uv.y - 1.0) / overlap;
      if (t > solidZone) {
        float nt = (t - solidZone) / (1.0 - solidZone);
        az = step(nt, pixelNoise(wc + 33.3, 1.0));
      }
    }

    return ax * az;
  }

  void main() {
    vec2 uv = vUV;

    if (uMineralOnly > 0.5) {
      float mask = texture(uMineralMask, vUV).r;
      if (mask < 0.004) discard;
      vec2 mineralUV = vWorldPos.xz / 30.0;
      vec4 mineralCol = texture(uMineralColorTex, mineralUV);
      vec3 color = mineralCol.rgb;
      float emissive = mineralCol.a * 0.25;
      float dx = vWorldPos.x - uPlayerPos.x;
      float dz = vWorldPos.z - uPlayerPos.z;
      float dist = sqrt(dx * dx + dz * dz);
      float shadow = smoothstep(3.0, 12.0, dist);
      vec3 shadowed = color * mix(1.0, 0.55, shadow);
      float worldHalf = 15.0;
      float fadeStart = 3.0;
      float edgeDist = min(min(worldHalf - vWorldPos.x, worldHalf + vWorldPos.x),
                           min(worldHalf - vWorldPos.z, worldHalf + vWorldPos.z));
      float worldEdgeShadow = smoothstep(0.0, fadeStart, edgeDist);
      shadowed *= mix(0.625, 1.0, worldEdgeShadow);
      color = shadowed + color * emissive;
      fragColor = vec4(color, 1.0);
      return;
    }

    // Discard overlap pixels that don't survive the blocky noise mask
    float mask = edgeMask(uv, vWorldPos);
    if (mask < 0.5) discard;

    vec3 color = texture(uLocalTex, uv).rgb;

    // Region shadow
    float dx = vWorldPos.x - uPlayerPos.x;
    float dz = vWorldPos.z - uPlayerPos.z;
    float dist = sqrt(dx * dx + dz * dz);
    float shadow = smoothstep(3.0, 12.0, dist);
    color *= mix(1.0, 0.55, shadow);

    // Darken at world edges
    float worldHalf = 15.0;
    float fadeStart = 3.0;
    float edgeDist = min(min(worldHalf - vWorldPos.x, worldHalf + vWorldPos.x),
                         min(worldHalf - vWorldPos.z, worldHalf + vWorldPos.z));
    float worldEdgeShadow = smoothstep(0.0, fadeStart, edgeDist);
    color *= mix(0.625, 1.0, worldEdgeShadow);

    fragColor = vec4(color, 1.0);
  }
`;

function createShader(type, src) {
  const s = gl.createShader(type);
  gl.shaderSource(s, src);
  gl.compileShader(s);
  if (!gl.getShaderParameter(s, gl.COMPILE_STATUS)) {
    console.error(gl.getShaderInfoLog(s));
    gl.deleteShader(s);
    return null;
  }
  return s;
}

// ── InstanceBatch ──────────────────────────────────────────────────────
// Growable CPU+GPU instance buffer. Used for instanced rendering throughout
// the engine (debug wireframes, collider circles, and game object batches).
//
// Usage:
//   const batch = new InstanceBatch(7, 64);  // 7 floats/instance, 64 initial capacity
//   batch.ensure(count);                      // grow if needed (no-op if already big enough)
//   batch.data[offset] = value;               // pack directly
//   batch.upload(count);                       // send count instances to GPU
//   gl.bindVertexArray(vao);
//   gl.drawArraysInstanced(..., count);
//
function InstanceBatch(floatsPerInst, initialCapacity) {
  this.floats = floatsPerInst;
  this.data = new Float32Array((initialCapacity || 64) * floatsPerInst);
  this.buf = gl.createBuffer();
  gl.bindBuffer(gl.ARRAY_BUFFER, this.buf);
  gl.bufferData(gl.ARRAY_BUFFER, this.data.byteLength, gl.DYNAMIC_DRAW);
}
InstanceBatch.prototype.ensure = function(count) {
  const need = count * this.floats;
  if (need > this.data.length) {
    this.data = new Float32Array(count * 2 * this.floats);
  }
};
InstanceBatch.prototype.upload = function(count) {
  gl.bindBuffer(gl.ARRAY_BUFFER, this.buf);
  gl.bufferData(gl.ARRAY_BUFFER, this.data.subarray(0, count * this.floats), gl.DYNAMIC_DRAW);
};

const vs = createShader(gl.VERTEX_SHADER, vsSource);
const fs = createShader(gl.FRAGMENT_SHADER, fsSource);
const prog = gl.createProgram();
gl.attachShader(prog, vs);
gl.attachShader(prog, fs);
gl.linkProgram(prog);
gl.useProgram(prog);

const aPos = gl.getAttribLocation(prog, 'aPos');
const aUV = gl.getAttribLocation(prog, 'aUV');
const uProj = gl.getUniformLocation(prog, 'uProj');
const uView = gl.getUniformLocation(prog, 'uView');
const uWorldOffset = gl.getUniformLocation(prog, 'uWorldOffset');
const uPlayerPos = gl.getUniformLocation(prog, 'uPlayerPos');
const uMineralOnly = gl.getUniformLocation(prog, 'uMineralOnly');
const uMineralMask = gl.getUniformLocation(prog, 'uMineralMask');
const uMineralColorTex = gl.getUniformLocation(prog, 'uMineralColorTex');
const uLocalTex = gl.getUniformLocation(prog, 'uLocalTex');

// --- GPU-baked ground textures (512x512) ---
const GROUND_TEX_RES = 512;
let rockGroundTex = null;
let grassGroundTex = null;
let desertGroundTex = null;
const groundBakeVS = `
attribute vec2 aP;
varying vec2 vUV;
void main() { vUV = aP * 0.5 + 0.5; gl_Position = vec4(aP, 0.0, 1.0); }`;
const groundBakeFS = `
precision highp float;
varying vec2 vUV;
uniform float uMode;
float hash(vec2 p) { p = fract(p * vec2(123.34, 456.21)); p += dot(p, p + 45.32); return fract(p.x * p.y); }
float pixelNoise(vec2 uv, float scale) { return hash(floor(uv * scale)); }
float rockTexture(vec2 uv) {
  float n = 0.0;
  n += pixelNoise(uv, 8.0) * 0.4; n += pixelNoise(uv + 7.7, 16.0) * 0.25;
  n += pixelNoise(uv + 3.3, 32.0) * 0.2; n += pixelNoise(uv + 11.1, 64.0) * 0.15;
  return n;
}
vec3 rockGround(vec2 uv) {
  float rock = floor(rockTexture(uv) * 6.0) / 6.0;
  vec3 color = mix(vec3(0.22,0.20,0.19), vec3(0.30,0.27,0.24), rock);
  float hl = pixelNoise(uv + 5.5, 24.0); hl = step(0.82, hl);
  color = mix(color, vec3(0.38,0.34,0.30), hl * 0.5);
  float fleck = pixelNoise(uv + 99.9, 48.0);
  if (fleck > 0.93) { float ft = pixelNoise(uv + 44.4, 48.0);
    if (ft > 0.6) color = mix(color, vec3(0.45,0.38,0.25), 0.4);
    else if (ft > 0.3) color = mix(color, vec3(0.30,0.32,0.38), 0.4);
    else color = mix(color, vec3(0.35,0.25,0.30), 0.3);
  }
  // Scattered small dark squares
  float dk = pixelNoise(uv + 66.6, 40.0);
  color *= mix(1.0, 0.92, step(0.955, dk));
  return color;
}
vec3 grassGround(vec2 uv) {
  float n = pixelNoise(uv, 10.0)*0.5 + pixelNoise(uv+3.14, 18.0)*0.3 + pixelNoise(uv+7.77, 32.0)*0.2;
  n = floor(n * 5.0) / 5.0;
  vec3 color = mix(vec3(0.18,0.28,0.10), vec3(0.26,0.38,0.14), n);
  float hl = floor(pixelNoise(uv+22.2, 14.0)*4.0)/4.0;
  color = mix(color, vec3(0.34,0.44,0.18), step(0.7,hl)*0.5);
  color = mix(color, vec3(0.38,0.34,0.16), step(0.72, pixelNoise(uv+55.5,6.0))*0.6);
  float dm = step(0.78, pixelNoise(uv+88.8,8.0)) * step(0.4, pixelNoise(uv+33.3,20.0));
  color = mix(color, vec3(0.30,0.22,0.12), dm*0.7);
  color *= mix(1.0, 0.82, step(0.88, pixelNoise(uv+11.11,40.0)));
  return color;
}
vec3 desertGround(vec2 uv) {
  float n = pixelNoise(uv, 8.0)*0.4 + pixelNoise(uv+2.71, 16.0)*0.3 + pixelNoise(uv+5.55, 32.0)*0.2 + pixelNoise(uv+9.99, 64.0)*0.1;
  n = floor(n * 6.0) / 6.0;
  vec3 color = mix(vec3(0.62,0.50,0.32), vec3(0.72,0.60,0.40), n);
  float ripple = pixelNoise(vec2(uv.x*0.5, uv.y), 12.0);
  color = mix(color, vec3(0.68,0.56,0.36), step(0.72, ripple)*0.3);
  float peb = pixelNoise(uv + 77.7, 48.0);
  if (peb > 0.92) {
    float pt = pixelNoise(uv + 33.3, 48.0);
    if (pt > 0.5) color = mix(color, vec3(0.42,0.34,0.22), 0.5);
    else color = mix(color, vec3(0.50,0.42,0.30), 0.4);
  }
  float crack = pixelNoise(uv + 44.4, 6.0);
  if (crack > 0.8) {
    color = mix(color, vec3(0.52,0.40,0.26), 0.4);
    float edge = pixelNoise(uv + 22.2, 24.0);
    color = mix(color, vec3(0.38,0.30,0.20), step(0.7, edge)*0.3);
  }
  float sun = pixelNoise(uv + 88.8, 10.0);
  color = mix(color, vec3(0.78,0.68,0.50), step(0.85, sun)*0.35);
  color *= mix(1.0, 0.90, step(0.92, pixelNoise(uv+11.1, 40.0)));
  return color;
}
void main() {
  vec3 c;
  if (uMode < 0.5) c = rockGround(vUV);
  else if (uMode < 1.5) c = grassGround(vUV);
  else c = desertGround(vUV);
  gl_FragColor = vec4(c, 1.0);
}`;
(function() {
  const pVP = gl.getParameter(gl.VIEWPORT), pProg = gl.getParameter(gl.CURRENT_PROGRAM);
  const vs = gl.createShader(gl.VERTEX_SHADER); gl.shaderSource(vs, groundBakeVS); gl.compileShader(vs);
  const fs = gl.createShader(gl.FRAGMENT_SHADER); gl.shaderSource(fs, groundBakeFS); gl.compileShader(fs);
  if (!gl.getShaderParameter(fs, gl.COMPILE_STATUS)) console.error('Ground bake FS:', gl.getShaderInfoLog(fs));
  const p = gl.createProgram(); gl.attachShader(p, vs); gl.attachShader(p, fs); gl.linkProgram(p);
  const qb = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, qb);
  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,-1,1,-1,-1,1,1,1]), gl.STATIC_DRAW);
  const a = gl.getAttribLocation(p, 'aP'), m = gl.getUniformLocation(p, 'uMode');
  const fb = gl.createFramebuffer();
  function bake(mode) {
    const tex = gl.createTexture(); gl.bindTexture(gl.TEXTURE_2D, tex);
    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, GROUND_TEX_RES, GROUND_TEX_RES, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);
    gl.bindFramebuffer(gl.FRAMEBUFFER, fb);
    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, tex, 0);
    gl.viewport(0, 0, GROUND_TEX_RES, GROUND_TEX_RES); gl.useProgram(p);
    gl.enableVertexAttribArray(a); gl.bindBuffer(gl.ARRAY_BUFFER, qb);
    gl.vertexAttribPointer(a, 2, gl.FLOAT, false, 0, 0);
    gl.uniform1f(m, mode); gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
    gl.bindFramebuffer(gl.FRAMEBUFFER, null);
    return tex;
  }
  rockGroundTex = bake(0.0);
  grassGroundTex = bake(1.0);
  desertGroundTex = bake(2.0);
  gl.deleteShader(vs); gl.deleteShader(fs); gl.deleteProgram(p);
  gl.deleteBuffer(qb); gl.deleteFramebuffer(fb);
  gl.viewport(pVP[0], pVP[1], pVP[2], pVP[3]); gl.useProgram(pProg);
})();

// --- GPU-baked mineral color texture (512x512, world-space) ---
// Bakes mineralGround() color + uniform desaturation once at startup.
// Per-region masks are baked separately on CPU.
const MINERAL_TEX_RES = 512;
let mineralColorTex = null;
const mineralBakeVS = `
attribute vec2 aP;
varying vec2 vUV;
void main() { vUV = aP * 0.5 + 0.5; gl_Position = vec4(aP, 0.0, 1.0); }`;
const mineralBakeFS = `
precision highp float;
varying vec2 vUV;
float hash(vec2 p) { p = fract(p * vec2(123.34, 456.21)); p += dot(p, p + 45.32); return fract(p.x * p.y); }
float pixelNoise(vec2 uv, float scale) { return hash(floor(uv * scale)); }
void main() {
  vec2 worldXZ = vUV * 30.0;
  vec2 wc = worldXZ * 0.42;
  float base = pixelNoise(wc, 10.0);
  float mid = pixelNoise(wc + 5.5, 17.0);
  float n = base * 0.6 + mid * 0.4;
  n = floor(n * 5.0) / 5.0;
  vec3 color = mix(vec3(0.13,0.18,0.34), vec3(0.16,0.24,0.42), n);
  float hl = pixelNoise(wc + 17.7, 12.0);
  color = mix(color, vec3(0.13,0.21,0.44), step(0.72, hl) * 0.25);
  float fleck = pixelNoise(wc + 44.4, 18.0);
  float fleckMask = step(0.85, fleck);
  color = mix(color, vec3(0.14,0.23,0.48), fleckMask * 0.3);
  // Uniform desaturation + darken to match old combined bake
  float gr = color.r*0.3 + color.g*0.3 + color.b*0.4;
  color = mix(color, vec3(gr), 0.3);
  color *= 0.85;
  float emissive = 0.05 + fleckMask * 0.08;
  gl_FragColor = vec4(color, emissive * 4.0);
}`;
(function() {
  const pVP = gl.getParameter(gl.VIEWPORT), pProg = gl.getParameter(gl.CURRENT_PROGRAM);
  const vs = gl.createShader(gl.VERTEX_SHADER); gl.shaderSource(vs, mineralBakeVS); gl.compileShader(vs);
  const fs = gl.createShader(gl.FRAGMENT_SHADER); gl.shaderSource(fs, mineralBakeFS); gl.compileShader(fs);
  if (!gl.getShaderParameter(fs, gl.COMPILE_STATUS)) console.error('Mineral bake FS:', gl.getShaderInfoLog(fs));
  const p = gl.createProgram(); gl.attachShader(p, vs); gl.attachShader(p, fs); gl.linkProgram(p);
  const qb = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, qb);
  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,-1,1,-1,-1,1,1,1]), gl.STATIC_DRAW);
  const a = gl.getAttribLocation(p, 'aP');
  const fb = gl.createFramebuffer();
  mineralColorTex = gl.createTexture(); gl.bindTexture(gl.TEXTURE_2D, mineralColorTex);
  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, MINERAL_TEX_RES, MINERAL_TEX_RES, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);
  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);
  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);
  gl.bindFramebuffer(gl.FRAMEBUFFER, fb);
  gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, mineralColorTex, 0);
  gl.viewport(0, 0, MINERAL_TEX_RES, MINERAL_TEX_RES); gl.useProgram(p);
  gl.enableVertexAttribArray(a); gl.bindBuffer(gl.ARRAY_BUFFER, qb);
  gl.vertexAttribPointer(a, 2, gl.FLOAT, false, 0, 0);
  gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
  gl.bindFramebuffer(gl.FRAMEBUFFER, null);
  gl.deleteShader(vs); gl.deleteShader(fs); gl.deleteProgram(p);
  gl.deleteBuffer(qb); gl.deleteFramebuffer(fb);
  gl.viewport(pVP[0], pVP[1], pVP[2], pVP[3]); gl.useProgram(pProg);
})();
// ============================================================
// Simplex 2D noise (seeded) for procedural terrain generation
// ============================================================
const SimplexNoise = (() => {
  const F2 = 0.5 * (Math.sqrt(3) - 1);
  const G2 = (3 - Math.sqrt(3)) / 6;
  const grad2 = [[1,1],[-1,1],[1,-1],[-1,-1],[1,0],[-1,0],[0,1],[0,-1]];

  function create(seed) {
    // Build permutation table from seed
    const perm = new Uint8Array(512);
    const p = new Uint8Array(256);
    for (let i = 0; i < 256; i++) p[i] = i;
    // Fisher-Yates shuffle with seeded PRNG
    let s = seed | 0;
    function rng() { s = (s * 1664525 + 1013904223) & 0xFFFFFFFF; return (s >>> 0) / 4294967296; }
    for (let i = 255; i > 0; i--) {
      const j = Math.floor(rng() * (i + 1));
      const tmp = p[i]; p[i] = p[j]; p[j] = tmp;
    }
    for (let i = 0; i < 512; i++) perm[i] = p[i & 255];

    return function noise2D(x, y) {
      const s = (x + y) * F2;
      const i = Math.floor(x + s), j = Math.floor(y + s);
      const t = (i + j) * G2;
      const x0 = x - (i - t), y0 = y - (j - t);
      const i1 = x0 > y0 ? 1 : 0, j1 = x0 > y0 ? 0 : 1;
      const x1 = x0 - i1 + G2, y1 = y0 - j1 + G2;
      const x2 = x0 - 1 + 2 * G2, y2 = y0 - 1 + 2 * G2;
      const ii = i & 255, jj = j & 255;
      const gi0 = perm[ii + perm[jj]] & 7;
      const gi1 = perm[ii + i1 + perm[jj + j1]] & 7;
      const gi2 = perm[ii + 1 + perm[jj + 1]] & 7;
      let n0 = 0, n1 = 0, n2 = 0;
      let t0 = 0.5 - x0 * x0 - y0 * y0;
      if (t0 > 0) { t0 *= t0; n0 = t0 * t0 * (grad2[gi0][0] * x0 + grad2[gi0][1] * y0); }
      let t1 = 0.5 - x1 * x1 - y1 * y1;
      if (t1 > 0) { t1 *= t1; n1 = t1 * t1 * (grad2[gi1][0] * x1 + grad2[gi1][1] * y1); }
      let t2 = 0.5 - x2 * x2 - y2 * y2;
      if (t2 > 0) { t2 *= t2; n2 = t2 * t2 * (grad2[gi2][0] * x2 + grad2[gi2][1] * y2); }
      return 70 * (n0 + n1 + n2); // range approx -1 to 1
    };
  }
  return { create };
})();

// ============================================================
// Forest shape generator
// Uses simplex noise to create organic forest patches.
// Returns an array of {x, z} in [0,1] normalized coordinates.
//
// Parameters:
//   seed       - integer seed for deterministic generation
//   frequency  - noise scale (lower = larger patches, e.g. 2-5)
//   threshold  - noise cutoff for tree placement (e.g. 0.1 = dense, 0.3 = sparse patches)
//   density    - candidate grid resolution (higher = more potential trees, e.g. 30-60)
//   octaves    - fractal layers for shape complexity (1-3)
//   lacunarity - frequency multiplier per octave (default 2.0)
//   persistence- amplitude multiplier per octave (default 0.5)
//   margin     - border margin to avoid edge trees (default 0.03)
//   jitter     - random offset from grid points (0-1, default 0.8)
// ============================================================
// ============================================================
// Forest Hill Generator
// Generates exactly 1 hill per forest config: rectangular or triangular,
// pushed against 1 of the 4 edges, covering the full width of that edge.
//
// opts:
//   seed  - random seed (determines edge, shape, and dimensions)
//
// Returns array with exactly 1 hill object:
//   Rectangular: { shape:'rect', x, z, wx, wz, height }
//     - Center (x,z) on the chosen edge (e.g. x=0.5, z=0.0 for back)
//     - Edge-parallel half-width: 0.55-0.65 (covers full edge)
//     - Depth half-width: 0.35-0.50
//     - Height: 0.15-0.30
//   Triangular: { shape:'tri', x, z, wx, wz, dirX, dirZ, height }
//     - Corner at a region corner (e.g. 0,0 or 1,1)
//     - Extents from corner: 0.70-0.90
//     - dirX, dirZ: +1 or -1 (direction triangle extends)
//     - Height: 0.18-0.30
// ============================================================
function generateForestHill(opts) {
  const { seed = 42 } = opts || {};
  let s = (seed * 6271 + 3) | 0;
  function rng() { s = (s * 1664525 + 1013904223) & 0xFFFFFFFF; return (s >>> 0) / 4294967296; }

  // Pick edge: 0=back(z=0), 1=front(z=1), 2=left(x=0), 3=right(x=1)
  const edge = Math.floor(rng() * 4);
  // Pick shape: ~60% rectangular, ~40% triangular
  const isTriangle = rng() < 0.4;

  if (isTriangle) {
    // Triangle at the corner of the chosen edge
    const wx = 0.70 + rng() * 0.20;  // 0.70-0.90
    const wz = 0.70 + rng() * 0.20;
    const height = 0.35 + rng() * 0.15; // 0.35-0.50
    // Corner position and direction based on edge + random corner choice
    const corners = [
      { x: 0.0, z: 0.0, dirX: 1, dirZ: 1 },   // back-left
      { x: 1.0, z: 0.0, dirX: -1, dirZ: 1 },   // back-right
      { x: 0.0, z: 1.0, dirX: 1, dirZ: -1 },   // front-left
      { x: 1.0, z: 1.0, dirX: -1, dirZ: -1 },   // front-right
    ];
    // Pick a corner on the chosen edge
    const edgeCorners = [
      [0, 1], // back: back-left, back-right
      [2, 3], // front: front-left, front-right
      [0, 2], // left: back-left, front-left
      [1, 3], // right: back-right, front-right
    ];
    const ci = edgeCorners[edge][rng() < 0.5 ? 0 : 1];
    const c = corners[ci];
    return [{ shape: 'tri', x: c.x, z: c.z, wx, wz, dirX: c.dirX, dirZ: c.dirZ, height }];
  } else {
    // Rectangle against the chosen edge
    const height = 0.35 + rng() * 0.15; // 0.35-0.50
    if (edge === 0 || edge === 1) {
      // Back or front edge: wide in X, shallow in Z
      const wx = 0.55 + rng() * 0.10; // 0.55-0.65
      const wz = 0.35 + rng() * 0.15; // 0.35-0.50
      return [{ shape: 'rect', x: 0.50, z: edge === 0 ? 0.0 : 1.0, wx, wz, height }];
    } else {
      // Left or right edge: wide in Z, shallow in X
      const wx = 0.35 + rng() * 0.15; // 0.35-0.50
      const wz = 0.55 + rng() * 0.10; // 0.55-0.65
      return [{ shape: 'rect', x: edge === 2 ? 0.0 : 1.0, z: 0.50, wx, wz, height }];
    }
  }
}

// Check if a collider circle at (cx, cz) with radius r stays within [0,1] UV.
// Returns false if any part extends out of bounds (with float epsilon tolerance).
function collidersInBounds(circles) {
  const EPS = 1e-6;
  for (const [cx, cz, r] of circles) {
    if (cx - r < -EPS || cx + r > 1 + EPS || cz - r < -EPS || cz + r > 1 + EPS) return false;
  }
  return true;
}

function generateForestShape(opts) {
  const {
    seed = 42,
    frequency = 3.5,
    threshold = 0.15,
    density = 40,
    octaves = 2,
    lacunarity = 2.0,
    persistence = 0.5,
    jitter = 0.8,
  } = opts || {};

  const noise = SimplexNoise.create(seed);

  // Seeded PRNG for jitter
  let s = (seed * 7919 + 1) | 0;
  function rng() { s = (s * 1664525 + 1013904223) & 0xFFFFFFFF; return (s >>> 0) / 4294967296; }

  // Sample fractal noise at a point
  function fbm(x, y) {
    let val = 0, amp = 1, freq = frequency, totalAmp = 0;
    for (let o = 0; o < octaves; o++) {
      val += amp * noise(x * freq, y * freq);
      totalAmp += amp;
      freq *= lacunarity;
      amp *= persistence;
    }
    return val / totalAmp; // normalized to approx -1..1
  }

  const trees = [];
  const step = 1 / density;
  const variants = ['fir_cluster_3', 'fir_cluster_5'];

  function getVariant(x, z) {
    return variants[Math.floor((x * 7919 + z * 6271) * 1000) % variants.length];
  }

  for (let gx = 0; gx < density; gx++) {
    for (let gz = 0; gz < density; gz++) {
      // Base grid position with jitter
      const bx = (gx + 0.5) * step;
      const bz = (gz + 0.5) * step;
      const jx = bx + (rng() - 0.5) * step * jitter;
      const jz = bz + (rng() - 0.5) * step * jitter;

      // Clamp to [0,1]
      const x = Math.max(0, Math.min(1, jx));
      const z = Math.max(0, Math.min(1, jz));
      const v = getVariant(x, z);

      // Reject if any collider circle extends past [0,1]
      const cols = getCollidersUV(x, z, v);
      if (!collidersInBounds(cols)) continue;

      // Sample noise
      const n = fbm(x, z);

      // Place tree if above threshold
      if (n > threshold) {
        let tooClose = false;
        // Check ALL collider circles of new tree against ALL collider circles of existing trees
        for (const t of trees) {
          if (collidersOverlap(cols, t.cols, -COLLIDER_OVERLAP_FRAC)) {
            tooClose = true;
            break;
          }
        }
        if (!tooClose) trees.push({ x, z, v, cols });
      }
    }
  }

  return trees;
}

// ============================================================
// Forest Stick Generator
// Places forked sticks on the ground, avoiding tree colliders.
// Trees carry per-variant avoidance radii (collider reach from anchor + stick half).
// opts:
//   seed      - random seed
//   count     - number of sticks to attempt placing
//   trees     - array of {x, z, v} tree positions in UV space with variant name
//   margin    - border margin in UV (default 0.025)
// Returns array of { x, z, rotY, flip } in UV space [0,1]
// ============================================================
// Get collider circles [cx, cz, r] in UV space for any item at anchor (ax, az)
// variant: tree variant name, 'stick', or 'rock' (pass scale as 4th arg for rocks)
const STICK_COL_R_UV = 0.17 / 10;    // STICK_PASSTHROUGH_RADIUS / REGION_SIZE
const STICK_COL_OFFZ_UV = 0;          // mesh is centered on anchor, no offset needed
const ROCK_COL_BASE_UV = 0.15 / 10;  // ROCK_COLLISION_RADIUS_BASE / REGION_SIZE
function getCollidersUV(ax, az, variant, scale) {
  if (variant === 'stick') return [[ax, az + STICK_COL_OFFZ_UV, STICK_COL_R_UV]];
  if (variant === 'rock') return [[ax, az, ROCK_COL_BASE_UV * (scale || 1)]];
  const v = VARIANT_EXPAND[variant] || variant;
  const tv = v ? TREE_VARIANTS[v] : null;
  if (!tv) return [[ax, az, 0.01]];
  const groups = tv.colGroups || [{ colR: tv.colR, colOff: tv.colOff }];
  const RS = 10; // matches REGION_SIZE (defined later; can't forward-ref const)
  return groups.map(g => [ax + g.colOff[0] / RS, az + g.colOff[1] / RS, g.colR / RS]);
}

// Check if two sets of collider circles overlap
// buffer > 0 = extra spacing, buffer < 0 = allow penetration (as fraction of combined radii)
function collidersOverlap(colsA, colsB, buffer) {
  const buf = buffer || 0;
  for (const [ax, az, ar] of colsA) {
    for (const [bx, bz, br] of colsB) {
      const dx = ax - bx, dz = az - bz;
      const combined = ar + br;
      const minDist = buf < 0 ? combined * (1 + buf) : combined + buf;
      if (dx * dx + dz * dz < minDist * minDist) return true;
    }
  }
  return false;
}
// Forest trees allow 17.5% collider penetration
const COLLIDER_OVERLAP_FRAC = 0.175;
const STICK_AVOID_BUFFER = 0.003;
function generateForestSticks(opts) {
  const {
    seed = 42,
    count = 6,
    minCount = 4,
    trees = [],
  } = opts || {};

  let s = (seed * 6271 + 3) | 0;
  function rng() { s = (s * 1664525 + 1013904223) & 0xFFFFFFFF; return (s >>> 0) / 4294967296; }

  // Precompute tree colliders (use existing cols if available, otherwise compute)
  const treeCols = trees.map(t => t.cols);

  const sticks = [];
  const stickColsList = []; // parallel: colliders for each placed stick
  const nearbyDistSq = 0.12 * 0.12;
  const minRotDiff = Math.PI / 4;

  // Build grid of open positions (not blocked by tree colliders)
  const gridRes = 40;
  const gridStep = 1.0 / gridRes;
  const openSpots = [];
  for (let gi = 0; gi < gridRes; gi++) {
    for (let gj = 0; gj < gridRes; gj++) {
      const x = (gi + 0.5) * gridStep;
      const z = (gj + 0.5) * gridStep;
      const cols = getCollidersUV(x, z, 'stick');
      if (!collidersInBounds(cols)) continue;
      let blocked = false;
      for (const tc of treeCols) {
        if (collidersOverlap(cols, tc, STICK_AVOID_BUFFER)) { blocked = true; break; }
      }
      if (!blocked) openSpots.push({ x, z, cols });
    }
  }

  // Shuffle open spots
  for (let i = openSpots.length - 1; i > 0; i--) {
    const j = Math.floor(rng() * (i + 1));
    const tmp = openSpots[i]; openSpots[i] = openSpots[j]; openSpots[j] = tmp;
  }

  // If not enough open spots, relax tree avoidance buffer
  if (openSpots.length < minCount) {
    for (let shrink = 0.85; shrink >= 0.5 && openSpots.length < minCount; shrink -= 0.1) {
      for (let gi = 0; gi < gridRes; gi++) {
        for (let gj = 0; gj < gridRes; gj++) {
          const x = (gi + 0.5) * gridStep;
          const z = (gj + 0.5) * gridStep;
          let already = false;
          for (const sp of openSpots) {
            if (Math.abs(sp.x - x) < 0.001 && Math.abs(sp.z - z) < 0.001) { already = true; break; }
          }
          if (already) continue;
          const cols = getCollidersUV(x, z, 'stick');
          if (!collidersInBounds(cols)) continue;
          let blocked = false;
          for (const tc of treeCols) {
            if (collidersOverlap(cols, tc, STICK_AVOID_BUFFER * shrink)) { blocked = true; break; }
          }
          if (!blocked) openSpots.push({ x, z, cols });
        }
      }
    }
  }

  // Place sticks, checking collider-to-collider against placed sticks
  const target = Math.min(count, openSpots.length);
  for (let si = 0; si < openSpots.length && sticks.length < target; si++) {
    const spot = openSpots[si];

    let tooClose = false;
    for (const sc of stickColsList) {
      if (collidersOverlap(spot.cols, sc)) { tooClose = true; break; }
    }
    if (tooClose) continue;

    // Pick rotation that differs from nearby sticks (use collider centers for proximity)
    let rotY, rotOk = false;
    for (let rotAttempt = 0; rotAttempt < 8; rotAttempt++) {
      rotY = rng() * Math.PI * 2;
      rotOk = true;
      for (let j = 0; j < sticks.length; j++) {
        const dx = spot.cols[0][0] - stickColsList[j][0][0];
        const dz = spot.cols[0][1] - stickColsList[j][0][1];
        if (dx * dx + dz * dz < nearbyDistSq) {
          let diff = Math.abs(rotY - sticks[j].rotY) % Math.PI;
          if (diff > Math.PI / 2) diff = Math.PI - diff;
          if (diff < minRotDiff) { rotOk = false; break; }
        }
      }
      if (rotOk) break;
    }
    if (!rotOk) continue;

    const flip = rng() > 0.5 ? 1 : 0;
    const rx = Math.round(spot.x * 1000) / 1000;
    const rz = Math.round(spot.z * 1000) / 1000;
    const cols = getCollidersUV(rx, rz, 'stick');
    sticks.push({ x: rx, z: rz, rotY: Math.round(rotY * 100) / 100, flip, scale: 1.0, cols });
    stickColsList.push(cols);
  }

  // If still below minimum, try remaining spots (same overlap check)
  if (sticks.length < minCount) {
    for (let si = 0; si < openSpots.length && sticks.length < minCount; si++) {
      const spot = openSpots[si];
      let tooClose = false;
      for (const sc of stickColsList) {
        if (collidersOverlap(spot.cols, sc)) { tooClose = true; break; }
      }
      if (tooClose) continue;
      const rotY = rng() * Math.PI * 2;
      const flip = rng() > 0.5 ? 1 : 0;
      const rx = Math.round(spot.x * 1000) / 1000;
      const rz = Math.round(spot.z * 1000) / 1000;
      const cols = getCollidersUV(rx, rz, 'stick');
      sticks.push({ x: rx, z: rz, rotY: Math.round(rotY * 100) / 100, flip, scale: 1.0, cols });
      stickColsList.push(cols);
    }
  }

  return sticks;
}

// ============================================================
// Forest Config Generator (wrapper)
// Calls generateForestHill, generateForestShape, and
// generateForestSticks to produce a complete forest config.
// Randomizes sub-generator parameters within generationRules
// ranges using a master seed.
//
// Usage:
//   const config = generateForestConfig({ seed: 5001, id: 'forest_new' });
//   BIOMES.forest.configs.push(config);
// ============================================================
function generateForestConfig(opts) {
  const { seed = 42, id = 'forest_new' } = opts || {};
  // Master PRNG to derive sub-seeds and randomize parameters
  let s = (seed * 9173 + 7) | 0;
  function rng() { s = (s * 1664525 + 1013904223) & 0xFFFFFFFF; return (s >>> 0) / 4294967296; }
  function rngRange(min, max) { return min + rng() * (max - min); }
  function rngInt(min, max) { return Math.floor(rngRange(min, max + 0.999)); }

  // Derive unique sub-seeds
  const hillSeed = Math.floor(rng() * 100000);
  const shapeSeed = Math.floor(rng() * 100000);
  const stickSeed = Math.floor(rng() * 100000);

  // Generate hill
  const hills = generateForestHill({ seed: hillSeed });

  // Randomize shape parameters within generationRules ranges
  const trees = generateForestShape({
    seed: shapeSeed,
    frequency: rngRange(2.5, 4.5),
    threshold: rngRange(0.12, 0.22),
    density: rngInt(35, 45),
    octaves: rngInt(1, 3),
    jitter: rngRange(0.6, 0.9),
  });

  // Generate sticks (needs full variant names for avoidance radii)
  const stickCount = rngInt(4, 8);
  const sticks = generateForestSticks({
    seed: stickSeed,
    count: stickCount,
    trees: trees, // full variant names (fir_cluster_3 etc.)
  });

  // Shorten variant names for static config format
  const VARIANT_SHORT = {
    fir_cluster_3: 'c3', fir_cluster_5: 'c5',
  };
  const shortTrees = trees.map(t => ({
    x: Math.round(t.x * 1000) / 1000,
    z: Math.round(t.z * 1000) / 1000,
    v: VARIANT_SHORT[t.v] || t.v,
    cols: t.cols,
  }));

  return { id, seed, terrain: { hills }, items: { trees: shortTrees, rocks: [], sticks, minables: [] } };
}

// ============================================================
// Rock Config Generator
// Produces a complete rock biome config from a seed, using the
// generationRules defined on the rock biome. Output format
// matches the static configs (terrain.hills, items.{trees, rocks, sticks, minables}).
//
// Trees are {x, z} only â€” variant is assigned at build time via
// the hash in buildRegion (no 'v' property needed).
//
// Minable clusters include material:'crystal' and cubes with
// pre-scale values (cubeScaleFactor is applied at build time).
//
// Usage:
//   const config = generateRockConfig({ seed: 12345, id: 'rock_new' });
//   BIOMES.rock.configs.push(config);
// ============================================================
function generateRockConfig(opts) {
  const { seed = 42, id = 'rock_new' } = opts || {};
  let s = (seed * 6271 + 3) | 0;
  function rng() { s = (s * 1664525 + 1013904223) & 0xFFFFFFFF; return (s >>> 0) / 4294967296; }
  function rngRange(min, max) { return min + rng() * (max - min); }
  function rngInt(min, max) { return Math.floor(rngRange(min, max + 0.999)); }
  function round(v, d) { const m = Math.pow(10, d); return Math.round(v * m) / m; }

  // --- Hills ---
  const hillCount = rngInt(7, 13);
  const hills = [];
  for (let i = 0; i < hillCount; i++) {
    const x = round(rngRange(0.0, 1.0), 2);
    // Weighted z distribution: 45% back, 30% mid, 25% front
    const zRoll = rng();
    let z, heightBase;
    if (zRoll < 0.45) {
      z = rngRange(0.0, 0.40);
      heightBase = 0.40;
    } else if (zRoll < 0.75) {
      z = rngRange(0.35, 0.60);
      heightBase = 0.25;
    } else {
      z = rngRange(0.60, 1.0);
      heightBase = 0.12;
    }
    const radius = round(rngRange(0.18, 0.40), 2);
    const height = round(heightBase + rngRange(0.00, 0.30), 2);
    hills.push({ x, z: round(z, 2), radius, height });
  }

  // --- Trees (clustered placement) ---
  // Rock trees use dry/sparse/bare/scraggly: colR=0.055, colOff=[0,0]
  const rockTreeVariants = ['dry', 'sparse', 'bare', 'scraggly'];
  function pickRockTreeVariant() {
    return rockTreeVariants[Math.floor(rng() * rockTreeVariants.length)];
  }
  const clusterCount = rngInt(8, 12);
  const allTrees = [];
  for (let ci = 0; ci < clusterCount; ci++) {
    const cx = rngRange(0.0, 1.0);
    const cz = rngRange(0.0, 1.0);
    const treesInCluster = rngInt(4, 11);
    for (let ti = 0; ti < treesInCluster; ti++) {
      let tx, tz, placed = false;
      const tv = pickRockTreeVariant();
      for (let attempt = 0; attempt < 20; attempt++) {
        const angle = rng() * Math.PI * 2;
        const dist = rng() * 0.12;
        tx = cx + Math.cos(angle) * dist;
        tz = cz + Math.sin(angle) * dist;
        tx = Math.max(0.0, Math.min(1.0, tx));
        tz = Math.max(0.0, Math.min(1.0, tz));
        const cols = getCollidersUV(tx, tz, tv);
        if (!collidersInBounds(cols)) continue;
        let tooClose = false;
        for (const et of allTrees) {
          if (collidersOverlap(cols, et.cols)) { tooClose = true; break; }
        }
        if (!tooClose) { placed = true; break; }
      }
      if (placed) {
        const cols = getCollidersUV(round(tx, 3), round(tz, 3), tv);
        allTrees.push({ x: round(tx, 3), z: round(tz, 3), v: tv, cols });
      }
    }
    // Early exit if we have enough trees
    if (allTrees.length >= 76) break;
  }
  // Trim to totalRange max if overshot
  while (allTrees.length > 76) allTrees.pop();

  // --- Rocks ---
  const rockCount = rngInt(8, 14);
  const rocks = [];
  for (let ri = 0; ri < rockCount; ri++) {
    let rx, rz, rScale, placed = false;
    for (let attempt = 0; attempt < 30; attempt++) {
      rx = rngRange(0.0, 1.0);
      rz = rngRange(0.0, 1.0);
      rScale = round(rngRange(0.60, 1.00), 2);
      const cols = getCollidersUV(rx, rz, 'rock', rScale);
      if (!collidersInBounds(cols)) continue;
      let tooClose = false;
      for (const er of rocks) {
        if (collidersOverlap(cols, er.cols)) { tooClose = true; break; }
      }
      if (!tooClose) { placed = true; break; }
    }
    if (placed) {
      rocks.push({
        x: round(rx, 3),
        z: round(rz, 3),
        rotY: round(rngRange(0.0, 6.28), 1),
        scale: rScale,
        cols: getCollidersUV(round(rx, 3), round(rz, 3), 'rock', rScale),
      });
    }
  }

  // --- Minable clusters ---
  // Cluster visual extent: center ± 0.065 (cube dx/dz range) ± ~0.016 (half cube size in UV)
  // ≈ 0.08 UV radius per cluster. Enforce enough separation so clusters don't visually merge.
  // Edge margin ensures cluster center + max cube offset stays within [0,1] UV.
  const minableEdgeMargin = 0.09;
  const clusterMinDist = 0.22; // ~2x cluster visual radius
  const clusterMinDistSq = clusterMinDist * clusterMinDist;
  const clusterCountM = rngInt(2, 5);
  const minables = [];
  for (let mi = 0; mi < clusterCountM; mi++) {
    let mx, mz, placed = false;
    for (let attempt = 0; attempt < 40; attempt++) {
      mx = rngRange(minableEdgeMargin, 1.0 - minableEdgeMargin);
      mz = rngRange(minableEdgeMargin, 1.0 - minableEdgeMargin);
      let tooClose = false;
      for (const em of minables) {
        const dx = mx - em.x, dz = mz - em.z;
        if (dx * dx + dz * dz < clusterMinDistSq) { tooClose = true; break; }
      }
      if (!tooClose) { placed = true; break; }
    }
    if (!placed) continue;

    const cubeCount = rngInt(8, 15);
    const cubes = [];
    for (let ci = 0; ci < cubeCount; ci++) {
      cubes.push({
        dx: round(rngRange(-0.065, 0.065), 3),
        dz: round(rngRange(-0.065, 0.065), 3),
        sx: round(rngRange(0.10, 0.32), 2),
        sy: round(rngRange(0.12, 0.28), 2),
        sz: round(rngRange(0.10, 0.24), 2),
        rotY: round(rngRange(0.0, 6.28), 1),
        rotZ: round(rngRange(-0.28, 0.28), 2),
      });
    }
    // Compute cluster colliders in UV space via k-means grouping.
    // Stored as {dx, dz, r} offsets from cluster center; buildRegion converts to world space.
    const cubeScaleUV = 0.7 / 10; // cubeScaleFactor / REGION_SIZE
    const numK = Math.min(4, cubes.length);
    let kCenters = [];
    for (let ki = 0; ki < numK; ki++) {
      const c = cubes[Math.floor(ki * cubes.length / numK)];
      kCenters.push({ dx: c.dx, dz: c.dz });
    }
    for (let iter = 0; iter < 8; iter++) {
      const kGroups = kCenters.map(() => []);
      for (const c of cubes) {
        let best = 0, bestD = Infinity;
        for (let k = 0; k < kCenters.length; k++) {
          const ddx = c.dx - kCenters[k].dx, ddz = c.dz - kCenters[k].dz;
          if (ddx * ddx + ddz * ddz < bestD) { bestD = ddx * ddx + ddz * ddz; best = k; }
        }
        kGroups[best].push(c);
      }
      for (let k = 0; k < kCenters.length; k++) {
        if (kGroups[k].length === 0) continue;
        let sdx = 0, sdz = 0;
        for (const c of kGroups[k]) { sdx += c.dx; sdz += c.dz; }
        kCenters[k].dx = sdx / kGroups[k].length;
        kCenters[k].dz = sdz / kGroups[k].length;
      }
    }
    const kGroups = kCenters.map(() => []);
    for (const c of cubes) {
      let best = 0, bestD = Infinity;
      for (let k = 0; k < kCenters.length; k++) {
        const ddx = c.dx - kCenters[k].dx, ddz = c.dz - kCenters[k].dz;
        if (ddx * ddx + ddz * ddz < bestD) { bestD = ddx * ddx + ddz * ddz; best = k; }
      }
      kGroups[best].push(c);
    }
    const colliders = [];
    for (let k = 0; k < kCenters.length; k++) {
      if (kGroups[k].length === 0) continue;
      if (kGroups[k].length === 1) {
        const c = kGroups[k][0];
        const r = Math.max(c.sx, c.sz) * cubeScaleUV;
        colliders.push({ dx: round(kCenters[k].dx, 3), dz: round(kCenters[k].dz, 3), r: round(r, 4) });
      } else {
        let maxR = 0;
        for (const c of kGroups[k]) {
          const ddx = c.dx - kCenters[k].dx, ddz = c.dz - kCenters[k].dz;
          const r = Math.sqrt(ddx * ddx + ddz * ddz) + Math.max(c.sx, c.sz) * cubeScaleUV * 0.5;
          if (r > maxR) maxR = r;
        }
        colliders.push({ dx: round(kCenters[k].dx, 3), dz: round(kCenters[k].dz, 3), r: round(Math.max(maxR * 0.75, 0.004), 4) });
      }
    }
    for (const c of cubes) {
      let covered = false;
      for (const col of colliders) {
        const ddx = c.dx - col.dx, ddz = c.dz - col.dz;
        if (Math.sqrt(ddx * ddx + ddz * ddz) <= col.r + 0.001) { covered = true; break; }
      }
      if (!covered) {
        const r = Math.max(c.sx, c.sz) * cubeScaleUV;
        colliders.push({ dx: round(c.dx, 3), dz: round(c.dz, 3), r: round(r, 4) });
      }
    }
    // Nudge cluster center if any collider extends outside [0,1] UV
    let nudgeX = 0, nudgeZ = 0;
    for (const col of colliders) {
      const absX = mx + col.dx, absZ = mz + col.dz;
      if (absX - col.r < 0) nudgeX = Math.max(nudgeX, col.r - absX);
      if (absX + col.r > 1) nudgeX = Math.min(nudgeX, 1 - col.r - absX);
      if (absZ - col.r < 0) nudgeZ = Math.max(nudgeZ, col.r - absZ);
      if (absZ + col.r > 1) nudgeZ = Math.min(nudgeZ, 1 - col.r - absZ);
    }
    if (nudgeX !== 0 || nudgeZ !== 0) {
      mx = mx + nudgeX;
      mz = mz + nudgeZ;
    }
    minables.push({ material: 'crystal', x: round(mx, 3), z: round(mz, 3), cubes, colliders });
  }

  return { id, seed, terrain: { hills }, items: { trees: allTrees, rocks, sticks: [], minables } };
}

// ============================================================
// Desert Config Generator
// Produces a complete desert biome config from a seed.
// Deserts are flat (no hills) with scattered cacti, dead bushes,
// and a few rocks. No minables â€” no desert-specific minable
// material exists yet.
//
// Trees use short variant aliases: sg, br, pp, db
// weighted 40/25/20/15 per generationRules.
//
// Usage:
//   const config = generateDesertConfig({ seed: 9001, id: 'desert_new' });
//   BIOMES.desert.configs.push(config);
// ============================================================
function generateDesertConfig(opts) {
  const { seed = 42, id = 'desert_new' } = opts || {};
  let s = (seed * 6271 + 3) | 0;
  function rng() { s = (s * 1664525 + 1013904223) & 0xFFFFFFFF; return (s >>> 0) / 4294967296; }
  function rngRange(min, max) { return min + rng() * (max - min); }
  function rngInt(min, max) { return Math.floor(rngRange(min, max + 0.999)); }
  function round(v, d) { const m = Math.pow(10, d); return Math.round(v * m) / m; }

  // --- No hills (flat desert) ---
  const hills = [];

  // --- Trees (weighted variant selection, scattered placement) ---
  const treeCount = rngInt(14, 22);
  const trees = [];
  // Weighted variant selection: sg 40%, br 25%, pp 20%, db 15%
  function pickVariant() {
    const r = rng();
    if (r < 0.40) return 'sg';
    if (r < 0.65) return 'br';
    if (r < 0.85) return 'pp';
    return 'db';
  }
  for (let ti = 0; ti < treeCount; ti++) {
    let tx, tz, tv, placed = false;
    for (let attempt = 0; attempt < 30; attempt++) {
      tx = rngRange(0.0, 1.0);
      tz = rngRange(0.0, 1.0);
      tv = pickVariant();
      const cols = getCollidersUV(tx, tz, tv);
      if (!collidersInBounds(cols)) continue;
      let tooClose = false;
      for (const et of trees) {
        if (collidersOverlap(cols, et.cols)) { tooClose = true; break; }
      }
      if (!tooClose) { placed = true; break; }
    }
    if (placed) {
      const cols = getCollidersUV(round(tx, 3), round(tz, 3), tv);
      trees.push({ x: round(tx, 3), z: round(tz, 3), v: tv, cols });
    }
  }

  // --- Rocks ---
  const rockCount = rngInt(4, 8);
  const rocks = [];
  for (let ri = 0; ri < rockCount; ri++) {
    let rx, rz, rScale, placed = false;
    for (let attempt = 0; attempt < 30; attempt++) {
      rx = rngRange(0.0, 1.0);
      rz = rngRange(0.0, 1.0);
      rScale = round(rngRange(0.50, 0.85), 2);
      const cols = getCollidersUV(rx, rz, 'rock', rScale);
      if (!collidersInBounds(cols)) continue;
      let tooClose = false;
      for (const er of rocks) {
        if (collidersOverlap(cols, er.cols)) { tooClose = true; break; }
      }
      if (!tooClose) { placed = true; break; }
    }
    if (placed) {
      rocks.push({
        x: round(rx, 3),
        z: round(rz, 3),
        rotY: round(rngRange(0.0, 6.28), 1),
        scale: rScale,
        cols: getCollidersUV(round(rx, 3), round(rz, 3), 'rock', rScale),
      });
    }
  }

  // --- No minables yet (no desert-specific minable material defined) ---

  return { id, seed, terrain: { hills }, items: { trees, rocks, sticks: [], minables: [] } };
}

// ============================================================
// Biome Definitions
// Each biome has: terrain (hills, ground shader palette), and
// one or more configurations of trees, rocks, and minables.
// ============================================================

// ==========================================================
// MINABLE MATERIALS REGISTRY
// ==========================================================
// "Minable" is a gameplay concept â€” something the player can mine.
// Each material fully defines its own rendering. Different materials
// can look and behave completely differently â€” different meshes,
// colors, effects, ground treatments. Nothing is assumed shared.
//
// A biome region can contain clusters of different materials.
// Each cluster in a config specifies its material key.
//
// Rendering is material-driven: the render loop reads properties
// from this registry. To add a new material, define it here and
// add any material-specific rendering paths to the render loop.
//
const MINABLE_MATERIALS = {
  crystal: {
    name: 'Crystal',
    mesh: 'cube',                          // mesh key (currently only 'cube')
    color: [0.18, 0.38, 0.65],            // base RGB for 3D geometry
    emissiveBase: 0.15,                    // constant emissive
    emissiveWave: 0.15,                    // wave-proximity emissive boost
    shininess: 1.2,                        // specular (scaled by wave proximity)
    glow: { enabled: true, color: [0.08, 0.18, 0.65] },  // additive glow billboards
    crystalGroundOverlay: true,            // crystal-specific blue ground texture
  },
  // Future materials define their own properties. Examples:
  // amber: { name: 'Amber', mesh: 'cube', color: [...], emissiveBase: 0.08, ... }
  // fossils might use a custom mesh, no glow, no ground effect, etc.
};
const _minableMatNames = Object.keys(MINABLE_MATERIALS);

const BIOMES = {
  rock: {
    name: 'Rock Biome',
    borderMargin: 0.03, // UV margin on edges adjacent to a different biome
    // --------------------------------------------------------
    // Generation rules used to produce each static config.
    // Apply these with a seeded PRNG to create new configs.
    // The static data below was generated from these rules
    // and should not be regenerated â€” only new configs use them.
    // --------------------------------------------------------
    generationRules: {
      hills: {
        count: { min: 7, max: 13 },
        x: { min: 0.0, max: 1.0 },
        z: { distribution: 'weighted', // 45% back, 30% mid, 25% front
          back:  { range: [0.05, 0.40], weight: 0.45 },
          mid:   { range: [0.35, 0.60], weight: 0.30 },
          front: { range: [0.60, 0.90], weight: 0.25 },
        },
        radius: { min: 0.18, max: 0.40 },
        height: { // base determined by z-zone, then random addition
          backBase: 0.40, midBase: 0.25, frontBase: 0.12,
          randomAdd: { min: 0.0, max: 0.30 },
        },
      },
      trees: {
        clusterCount: { min: 8, max: 12 },
        treesPerCluster: { min: 4, max: 11 },
        totalRange: { min: 46, max: 76 }, // observed across configs
        clusterCenter: { x: [0.0, 1.0], z: [0.0, 1.0] },
        intraClusterSpacing: { min: 0.025, max: 0.060 },
        clusterRadius: 0.12, // max distance from cluster center to member
      },
      rocks: {
        count: { min: 8, max: 14 },
        x: { min: 0.0, max: 1.0 },
        z: { min: 0.0, max: 1.0 },
        scale: { min: 0.60, max: 1.00 },
        rotY: { min: 0.0, max: 6.28 }, // full rotation
      },
      minables: {
        clusterCount: { min: 2, max: 5 },
        cubesPerCluster: { min: 8, max: 15 },
        clusterCenter: { x: [0.10, 0.90], z: [0.10, 0.90] },
        cube: {
          dx: { min: -0.065, max: 0.065 },
          dz: { min: -0.065, max: 0.065 },
          sx: { min: 0.10, max: 0.32 },
          sy: { min: 0.12, max: 0.28 },
          sz: { min: 0.10, max: 0.24 },
          rotY: { min: 0.0, max: 6.28 },
          rotZ: { min: -0.28, max: 0.28 },
        },
        cubeScaleFactor: 0.7, // applied at build time to sx/sy/sz
        glowSizeMultiplier: 1.8, // max(sx,sy,sz) * scaleFactor * this
      },
    },
    // Tree sprite variants for this biome
    treeVariants: ['dry', 'sparse', 'bare', 'scraggly'],
    // Configurations: different arrangements of trees/rocks/minables
    configs: [
        {
          id: 'rock_1',
          seed: 101,
          terrain: {
            hills: [
              {x:0.69,z:0.35,radius:0.35,height:0.47},
              {x:0.99,z:0.18,radius:0.39,height:0.65},
              {x:0.96,z:0.17,radius:0.22,height:0.43},
              {x:0.6,z:0.94,radius:0.29,height:0.14},
              {x:0.69,z:0.05,radius:0.33,height:0.68},
              {x:0.12,z:0.12,radius:0.32,height:0.49},
              {x:0.46,z:0.24,radius:0.25,height:0.66},
              {x:0.3,z:0.55,radius:0.36,height:0.42},
              {x:0.53,z:1,radius:0.39,height:0.31},
              {x:0.84,z:0.09,radius:0.23,height:0.63},
              {x:0.66,z:0.67,radius:0.27,height:0.27}
            ]
          },
          items: {
            trees: [
              {
                x: 0.626,
                z: 0.113,
                v: 'scraggly',
                cols: [
                  [0.626, 0.113, 0.0055]
                ]
              },
              {
                x: 0.584,
                z: 0.136,
                v: 'bare',
                cols: [
                  [0.584, 0.136, 0.0055]
                ]
              },
              {
                x: 0.581,
                z: 0.078,
                v: 'dry',
                cols: [
                  [0.581, 0.078, 0.0055]
                ]
              },
              {
                x: 0.539,
                z: 0.053,
                v: 'sparse',
                cols: [
                  [0.539, 0.053, 0.0055]
                ]
              },
              {
                x: 0.588,
                z: 0.166,
                v: 'dry',
                cols: [
                  [0.588, 0.166, 0.0055]
                ]
              },
              {
                x: 0.837,
                z: 0.607,
                v: 'bare',
                cols: [
                  [0.837, 0.607, 0.0055]
                ]
              },
              {
                x: 0.751,
                z: 0.587,
                v: 'scraggly',
                cols: [
                  [0.751, 0.587, 0.0055]
                ]
              },
              {
                x: 0.751,
                z: 0.609,
                v: 'bare',
                cols: [
                  [0.751, 0.609, 0.0055]
                ]
              },
              {
                x: 0.754,
                z: 0.673,
                v: 'scraggly',
                cols: [
                  [0.754, 0.673, 0.0055]
                ]
              },
              {
                x: 0.757,
                z: 0.524,
                v: 'scraggly',
                cols: [
                  [0.757, 0.524, 0.0055]
                ]
              },
              {
                x: 0.707,
                z: 0.634,
                v: 'bare',
                cols: [
                  [0.707, 0.634, 0.0055]
                ]
              },
              {
                x: 0.79,
                z: 0.576,
                v: 'sparse',
                cols: [
                  [0.79, 0.576, 0.0055]
                ]
              },
              {
                x: 0.756,
                z: 0.661,
                v: 'sparse',
                cols: [
                  [0.756, 0.661, 0.0055]
                ]
              },
              {
                x: 0.75,
                z: 0.636,
                v: 'scraggly',
                cols: [
                  [0.75, 0.636, 0.0055]
                ]
              },
              {
                x: 0.302,
                z: 0.066,
                v: 'scraggly',
                cols: [
                  [0.302, 0.066, 0.0055]
                ]
              },
              {
                x: 0.3,
                z: 0.079,
                v: 'sparse',
                cols: [
                  [0.3, 0.079, 0.0055]
                ]
              },
              {
                x: 0.321,
                z: 0.072,
                v: 'sparse',
                cols: [
                  [0.321, 0.072, 0.0055]
                ]
              },
              {
                x: 0.267,
                z: 0.009,
                v: 'sparse',
                cols: [
                  [0.267, 0.009, 0.0055]
                ]
              },
              {
                x: 0.334,
                z: 0.053,
                v: 'bare',
                cols: [
                  [0.334, 0.053, 0.0055]
                ]
              },
              {
                x: 0.324,
                z: 0.023,
                v: 'bare',
                cols: [
                  [0.324, 0.023, 0.0055]
                ]
              },
              {
                x: 0.412,
                z: 0.014,
                v: 'bare',
                cols: [
                  [0.412, 0.014, 0.0055]
                ]
              },
              {
                x: 0.71,
                z: 0.822,
                v: 'dry',
                cols: [
                  [0.71, 0.822, 0.0055]
                ]
              },
              {
                x: 0.685,
                z: 0.736,
                v: 'scraggly',
                cols: [
                  [0.685, 0.736, 0.0055]
                ]
              },
              {
                x: 0.589,
                z: 0.926,
                v: 'sparse',
                cols: [
                  [0.589, 0.926, 0.0055]
                ]
              },
              {
                x: 0.658,
                z: 0.921,
                v: 'scraggly',
                cols: [
                  [0.658, 0.921, 0.0055]
                ]
              },
              {
                x: 0.648,
                z: 0.842,
                v: 'sparse',
                cols: [
                  [0.648, 0.842, 0.0055]
                ]
              },
              {
                x: 0.665,
                z: 0.941,
                v: 'bare',
                cols: [
                  [0.665, 0.941, 0.0055]
                ]
              },
              {
                x: 0.673,
                z: 0.838,
                v: 'scraggly',
                cols: [
                  [0.673, 0.838, 0.0055]
                ]
              },
              {
                x: 0.064,
                z: 0.325,
                v: 'bare',
                cols: [
                  [0.064, 0.325, 0.0055]
                ]
              },
              {
                x: 0.093,
                z: 0.271,
                v: 'dry',
                cols: [
                  [0.093, 0.271, 0.0055]
                ]
              },
              {
                x: 0.186,
                z: 0.217,
                v: 'sparse',
                cols: [
                  [0.186, 0.217, 0.0055]
                ]
              },
              {
                x: 0.121,
                z: 0.319,
                v: 'sparse',
                cols: [
                  [0.121, 0.319, 0.0055]
                ]
              },
              {
                x: 0.077,
                z: 0.295,
                v: 'scraggly',
                cols: [
                  [0.077, 0.295, 0.0055]
                ]
              },
              {
                x: 0.13,
                z: 0.345,
                v: 'dry',
                cols: [
                  [0.13, 0.345, 0.0055]
                ]
              },
              {
                x: 0.281,
                z: 0.745,
                v: 'sparse',
                cols: [
                  [0.281, 0.745, 0.0055]
                ]
              },
              {
                x: 0.299,
                z: 0.679,
                v: 'scraggly',
                cols: [
                  [0.299, 0.679, 0.0055]
                ]
              },
              {
                x: 0.295,
                z: 0.728,
                v: 'bare',
                cols: [
                  [0.295, 0.728, 0.0055]
                ]
              },
              {
                x: 0.431,
                z: 0.751,
                v: 'scraggly',
                cols: [
                  [0.431, 0.751, 0.0055]
                ]
              },
              {
                x: 0.271,
                z: 0.713,
                v: 'dry',
                cols: [
                  [0.271, 0.713, 0.0055]
                ]
              },
              {
                x: 0.348,
                z: 0.716,
                v: 'dry',
                cols: [
                  [0.348, 0.716, 0.0055]
                ]
              },
              {
                x: 0.408,
                z: 0.724,
                v: 'sparse',
                cols: [
                  [0.408, 0.724, 0.0055]
                ]
              },
              {
                x: 0.119,
                z: 0.481,
                v: 'sparse',
                cols: [
                  [0.119, 0.481, 0.0055]
                ]
              },
              {
                x: 0.176,
                z: 0.386,
                v: 'bare',
                cols: [
                  [0.176, 0.386, 0.0055]
                ]
              },
              {
                x: 0.204,
                z: 0.423,
                v: 'scraggly',
                cols: [
                  [0.204, 0.423, 0.0055]
                ]
              },
              {
                x: 0.146,
                z: 0.441,
                v: 'sparse',
                cols: [
                  [0.146, 0.441, 0.0055]
                ]
              },
              {
                x: 0.078,
                z: 0.362,
                v: 'sparse',
                cols: [
                  [0.078, 0.362, 0.0055]
                ]
              },
              {
                x: 0.218,
                z: 0.362,
                v: 'bare',
                cols: [
                  [0.218, 0.362, 0.0055]
                ]
              },
              {
                x: 0.147,
                z: 0.388,
                v: 'scraggly',
                cols: [
                  [0.147, 0.388, 0.0055]
                ]
              },
              {
                x: 0.255,
                z: 0.43,
                v: 'sparse',
                cols: [
                  [0.255, 0.43, 0.0055]
                ]
              },
              {
                x: 0.222,
                z: 0.466,
                v: 'dry',
                cols: [
                  [0.222, 0.466, 0.0055]
                ]
              },
              {
                x: 0.292,
                z: 0.478,
                v: 'scraggly',
                cols: [
                  [0.292, 0.478, 0.0055]
                ]
              },
              {
                x: 0.288,
                z: 0.419,
                v: 'scraggly',
                cols: [
                  [0.288, 0.419, 0.0055]
                ]
              },
              {
                x: 0.284,
                z: 0.538,
                v: 'bare',
                cols: [
                  [0.284, 0.538, 0.0055]
                ]
              },
              {
                x: 0.246,
                z: 0.389,
                v: 'scraggly',
                cols: [
                  [0.246, 0.389, 0.0055]
                ]
              },
              {
                x: 0.518,
                z: 0.851,
                v: 'scraggly',
                cols: [
                  [0.518, 0.851, 0.0055]
                ]
              },
              {
                x: 0.4,
                z: 0.971,
                v: 'dry',
                cols: [
                  [0.4, 0.971, 0.0055]
                ]
              },
              {
                x: 0.546,
                z: 0.877,
                v: 'scraggly',
                cols: [
                  [0.546, 0.877, 0.0055]
                ]
              },
              {
                x: 0.373,
                z: 0.992,
                v: 'scraggly',
                cols: [
                  [0.373, 0.992, 0.0055]
                ]
              },
              {
                x: 0.455,
                z: 0.95,
                v: 'sparse',
                cols: [
                  [0.455, 0.95, 0.0055]
                ]
              },
              {
                x: 0.429,
                z: 0.919,
                v: 'scraggly',
                cols: [
                  [0.429, 0.919, 0.0055]
                ]
              },
              {
                x: 0.452,
                z: 0.939,
                v: 'dry',
                cols: [
                  [0.452, 0.939, 0.0055]
                ]
              },
              {
                x: 0.299,
                z: 0.209,
                v: 'scraggly',
                cols: [
                  [0.299, 0.209, 0.0055]
                ]
              },
              {
                x: 0.234,
                z: 0.164,
                v: 'sparse',
                cols: [
                  [0.234, 0.164, 0.0055]
                ]
              },
              {
                x: 0.231,
                z: 0.255,
                v: 'bare',
                cols: [
                  [0.231, 0.255, 0.0055]
                ]
              },
              {
                x: 0.309,
                z: 0.167,
                v: 'dry',
                cols: [
                  [0.309, 0.167, 0.0055]
                ]
              },
              {
                x: 0.271,
                z: 0.076,
                v: 'scraggly',
                cols: [
                  [0.271, 0.076, 0.0055]
                ]
              },
              {
                x: 0.256,
                z: 0.963,
                v: 'dry',
                cols: [
                  [0.256, 0.963, 0.0055]
                ]
              },
              {
                x: 0.182,
                z: 0.977,
                v: 'bare',
                cols: [
                  [0.182, 0.977, 0.0055]
                ]
              },
              {
                x: 0.175,
                z: 0.949,
                v: 'bare',
                cols: [
                  [0.175, 0.949, 0.0055]
                ]
              },
              {
                x: 0.2,
                z: 0.889,
                v: 'scraggly',
                cols: [
                  [0.2, 0.889, 0.0055]
                ]
              },
              {
                x: 0.08,
                z: 0.988,
                v: 'bare',
                cols: [
                  [0.08, 0.988, 0.0055]
                ]
              },
              {
                x: 0.211,
                z: 0.948,
                v: 'dry',
                cols: [
                  [0.211, 0.948, 0.0055]
                ]
              },
              {
                x: 0.17,
                z: 0.911,
                v: 'sparse',
                cols: [
                  [0.17, 0.911, 0.0055]
                ]
              }
            ],
            rocks: [
              {
                x: 0.824,
                z: 0.466,
                rotY: 2.4,
                scale: 0.66,
                cols: [
                  [0.824, 0.466, 0.0099]
                ]
              },
              {
                x: 0.256,
                z: 0.707,
                rotY: 0,
                scale: 0.64,
                cols: [
                  [0.256, 0.707, 0.0096]
                ]
              },
              {
                x: 0.222,
                z: 0.231,
                rotY: 3.7,
                scale: 0.61,
                cols: [
                  [0.222, 0.231, 0.0092]
                ]
              },
              {
                x: 0.459,
                z: 0.124,
                rotY: 4.1,
                scale: 0.74,
                cols: [
                  [0.459, 0.124, 0.0111]
                ]
              },
              {
                x: 0.349,
                z: 0.366,
                rotY: 6,
                scale: 0.83,
                cols: [
                  [0.349, 0.366, 0.0124]
                ]
              },
              {
                x: 0.781,
                z: 0.508,
                rotY: 4.6,
                scale: 0.79,
                cols: [
                  [0.781, 0.508, 0.0118]
                ]
              },
              {
                x: 0.031,
                z: 0.855,
                rotY: 4.2,
                scale: 0.76,
                cols: [
                  [0.031, 0.855, 0.0114]
                ]
              },
              {
                x: 0.525,
                z: 0.75,
                rotY: 0.7,
                scale: 0.82,
                cols: [
                  [0.525, 0.75, 0.0123]
                ]
              },
              {
                x: 0.632,
                z: 0.77,
                rotY: 4.6,
                scale: 0.76,
                cols: [
                  [0.632, 0.77, 0.0114]
                ]
              },
              {
                x: 0.888,
                z: 0.916,
                rotY: 3.2,
                scale: 0.89,
                cols: [
                  [0.888, 0.916, 0.0133]
                ]
              }
            ],
            sticks: [],
            minables: [
              {
                material: 'crystal',
                x: 0.207,
                z: 0.31,
                cubes: [
                  {dx:-0.005,dz:0.035,sx:0.28,sy:0.17,sz:0.12,rotY:4,rotZ:-0.2},
                  {dx:0.028,dz:0.037,sx:0.12,sy:0.27,sz:0.19,rotY:4.6,rotZ:-0.23},
                  {dx:-0.039,dz:-0.016,sx:0.32,sy:0.27,sz:0.14,rotY:4.9,rotZ:-0.03},
                  {dx:0.027,dz:0.005,sx:0.14,sy:0.2,sz:0.15,rotY:4.2,rotZ:-0.26},
                  {dx:0.048,dz:-0.023,sx:0.27,sy:0.26,sz:0.2,rotY:2.5,rotZ:0.14},
                  {dx:0.007,dz:-0.008,sx:0.15,sy:0.14,sz:0.23,rotY:5.5,rotZ:0.12},
                  {dx:0,dz:0.041,sx:0.31,sy:0.28,sz:0.11,rotY:4.1,rotZ:-0.26},
                  {dx:0.032,dz:-0.004,sx:0.16,sy:0.16,sz:0.22,rotY:4.4,rotZ:0.14},
                  {dx:0.039,dz:-0.051,sx:0.23,sy:0.17,sz:0.11,rotY:2.7,rotZ:-0.08},
                  {dx:-0.047,dz:-0.003,sx:0.22,sy:0.2,sz:0.17,rotY:2.9,rotZ:-0.02},
                  {dx:-0.055,dz:-0.006,sx:0.12,sy:0.26,sz:0.14,rotY:2.9,rotZ:-0.21},
                  {dx:-0.044,dz:0.003,sx:0.12,sy:0.2,sz:0.15,rotY:1.9,rotZ:-0.11},
                  {dx:0.058,dz:0.042,sx:0.2,sy:0.2,sz:0.19,rotY:4,rotZ:0.13},
                  {dx:-0.027,dz:-0.051,sx:0.22,sy:0.24,sz:0.22,rotY:4.2,rotZ:-0.01}
                ],
                colliders: [
                  {dx:-0.002,dz:0.038,r:0.0111},
                  {dx:0.03,dz:0.014,r:0.0345},
                  {dx:0.044,dz:-0.037,r:0.0181},
                  {dx:-0.042,dz:-0.015,r:0.0354},
                  {dx:0.058,dz:0.042,r:0.014},
                  {dx:-0.027,dz:-0.051,r:0.0154}
                ]
              },
              {
                material: 'crystal',
                x: 0.48,
                z: 0.213,
                cubes: [
                  {dx:0.013,dz:-0.055,sx:0.11,sy:0.19,sz:0.13,rotY:1.3,rotZ:-0.28},
                  {dx:0.056,dz:0.026,sx:0.32,sy:0.26,sz:0.2,rotY:4.1,rotZ:-0.23},
                  {dx:0.003,dz:0.065,sx:0.11,sy:0.24,sz:0.17,rotY:4.8,rotZ:-0.02},
                  {dx:0.063,dz:-0.012,sx:0.24,sy:0.16,sz:0.18,rotY:4.6,rotZ:0.09},
                  {dx:-0.054,dz:-0.017,sx:0.13,sy:0.14,sz:0.22,rotY:3.2,rotZ:0.11},
                  {dx:-0.061,dz:0.041,sx:0.25,sy:0.15,sz:0.14,rotY:0.9,rotZ:0.17},
                  {dx:0.031,dz:0.019,sx:0.12,sy:0.16,sz:0.14,rotY:4.9,rotZ:-0.27},
                  {dx:0.063,dz:-0.051,sx:0.11,sy:0.18,sz:0.22,rotY:2,rotZ:-0.06},
                  {dx:0.001,dz:-0.017,sx:0.11,sy:0.17,sz:0.1,rotY:5.7,rotZ:-0.21}
                ],
                colliders: [
                  {dx:0.026,dz:-0.041,r:0.0348},
                  {dx:0.003,dz:0.065,r:0.0119},
                  {dx:-0.057,dz:0.012,r:0.0285},
                  {dx:0.05,dz:0.011,r:0.0261},
                  {dx:0.063,dz:-0.051,r:0.0154}
                ]
              },
              {
                material: 'crystal',
                x: 0.847,
                z: 0.481,
                cubes: [
                  {dx:-0.015,dz:0.052,sx:0.25,sy:0.25,sz:0.12,rotY:3.1,rotZ:-0.03},
                  {dx:-0.048,dz:-0.054,sx:0.23,sy:0.27,sz:0.15,rotY:5.8,rotZ:-0.08},
                  {dx:-0.049,dz:0.045,sx:0.21,sy:0.16,sz:0.16,rotY:3.9,rotZ:-0.27},
                  {dx:0.008,dz:0.04,sx:0.21,sy:0.24,sz:0.24,rotY:4,rotZ:-0.27},
                  {dx:-0.002,dz:0.031,sx:0.22,sy:0.16,sz:0.13,rotY:0.9,rotZ:-0.16},
                  {dx:-0.023,dz:-0.025,sx:0.31,sy:0.13,sz:0.11,rotY:5.1,rotZ:-0.02},
                  {dx:-0.041,dz:-0.042,sx:0.19,sy:0.22,sz:0.2,rotY:3.1,rotZ:-0.2},
                  {dx:-0.031,dz:0.02,sx:0.1,sy:0.26,sz:0.17,rotY:0.4,rotZ:-0.13},
                  {dx:-0.036,dz:0.018,sx:0.31,sy:0.23,sz:0.16,rotY:3.6,rotZ:-0.21}
                ],
                colliders: [
                  {dx:-0.015,dz:0.052,r:0.0175},
                  {dx:-0.039,dz:0.028,r:0.0206},
                  {dx:0.003,dz:0.036,r:0.0113},
                  {dx:-0.037,dz:-0.04,r:0.0239}
                ]
              }
            ]
          }
        },
        {
          id: 'rock_2',
          seed: 201,
          terrain: {
            hills: [
              {x:0.02,z:0.93,radius:0.35,height:0.34},
              {x:0.32,z:0.53,radius:0.38,height:0.3},
              {x:0.67,z:0.7,radius:0.37,height:0.25},
              {x:0.61,z:0.61,radius:0.33,height:0.33},
              {x:0.66,z:0.04,radius:0.35,height:0.6},
              {x:0.08,z:0.66,radius:0.2,height:0.3},
              {x:0.66,z:0.42,radius:0.3,height:0.49},
              {x:0.85,z:0.55,radius:0.36,height:0.31},
              {x:0.44,z:0.1,radius:0.34,height:0.61},
              {x:0.88,z:0.14,radius:0.26,height:0.64},
              {x:0.61,z:0.58,radius:0.21,height:0.5},
              {x:0.6,z:0.44,radius:0.25,height:0.33}
            ]
          },
          items: {
            trees: [
              {
                x: 0.173,
                z: 0.087,
                v: 'dry',
                cols: [
                  [0.173, 0.087, 0.0055]
                ]
              },
              {
                x: 0.128,
                z: 0.035,
                v: 'scraggly',
                cols: [
                  [0.128, 0.035, 0.0055]
                ]
              },
              {
                x: 0.276,
                z: 0.064,
                v: 'dry',
                cols: [
                  [0.276, 0.064, 0.0055]
                ]
              },
              {
                x: 0.261,
                z: 0.078,
                v: 'bare',
                cols: [
                  [0.261, 0.078, 0.0055]
                ]
              },
              {
                x: 0.214,
                z: 0.038,
                v: 'bare',
                cols: [
                  [0.214, 0.038, 0.0055]
                ]
              },
              {
                x: 0.131,
                z: 0.118,
                v: 'dry',
                cols: [
                  [0.131, 0.118, 0.0055]
                ]
              },
              {
                x: 0.092,
                z: 0.157,
                v: 'scraggly',
                cols: [
                  [0.092, 0.157, 0.0055]
                ]
              },
              {
                x: 0.039,
                z: 0.119,
                v: 'bare',
                cols: [
                  [0.039, 0.119, 0.0055]
                ]
              },
              {
                x: 0.031,
                z: 0.143,
                v: 'scraggly',
                cols: [
                  [0.031, 0.143, 0.0055]
                ]
              },
              {
                x: 0.08,
                z: 0.131,
                v: 'dry',
                cols: [
                  [0.08, 0.131, 0.0055]
                ]
              },
              {
                x: 0.102,
                z: 0.258,
                v: 'dry',
                cols: [
                  [0.102, 0.258, 0.0055]
                ]
              },
              {
                x: 0.043,
                z: 0.207,
                v: 'bare',
                cols: [
                  [0.043, 0.207, 0.0055]
                ]
              },
              {
                x: 0.026,
                z: 0.221,
                v: 'sparse',
                cols: [
                  [0.026, 0.221, 0.0055]
                ]
              },
              {
                x: 0.736,
                z: 0.347,
                v: 'dry',
                cols: [
                  [0.736, 0.347, 0.0055]
                ]
              },
              {
                x: 0.724,
                z: 0.47,
                v: 'dry',
                cols: [
                  [0.724, 0.47, 0.0055]
                ]
              },
              {
                x: 0.642,
                z: 0.432,
                v: 'scraggly',
                cols: [
                  [0.642, 0.432, 0.0055]
                ]
              },
              {
                x: 0.591,
                z: 0.376,
                v: 'dry',
                cols: [
                  [0.591, 0.376, 0.0055]
                ]
              },
              {
                x: 0.646,
                z: 0.416,
                v: 'dry',
                cols: [
                  [0.646, 0.416, 0.0055]
                ]
              },
              {
                x: 0.721,
                z: 0.505,
                v: 'sparse',
                cols: [
                  [0.721, 0.505, 0.0055]
                ]
              },
              {
                x: 0.792,
                z: 0.363,
                v: 'dry',
                cols: [
                  [0.792, 0.363, 0.0055]
                ]
              },
              {
                x: 0.854,
                z: 0.687,
                v: 'dry',
                cols: [
                  [0.854, 0.687, 0.0055]
                ]
              },
              {
                x: 0.787,
                z: 0.738,
                v: 'dry',
                cols: [
                  [0.787, 0.738, 0.0055]
                ]
              },
              {
                x: 0.901,
                z: 0.611,
                v: 'scraggly',
                cols: [
                  [0.901, 0.611, 0.0055]
                ]
              },
              {
                x: 0.747,
                z: 0.67,
                v: 'sparse',
                cols: [
                  [0.747, 0.67, 0.0055]
                ]
              },
              {
                x: 0.839,
                z: 0.667,
                v: 'bare',
                cols: [
                  [0.839, 0.667, 0.0055]
                ]
              },
              {
                x: 0.835,
                z: 0.598,
                v: 'sparse',
                cols: [
                  [0.835, 0.598, 0.0055]
                ]
              },
              {
                x: 0.773,
                z: 0.603,
                v: 'scraggly',
                cols: [
                  [0.773, 0.603, 0.0055]
                ]
              },
              {
                x: 0.87,
                z: 0.571,
                v: 'dry',
                cols: [
                  [0.87, 0.571, 0.0055]
                ]
              },
              {
                x: 0.893,
                z: 0.576,
                v: 'dry',
                cols: [
                  [0.893, 0.576, 0.0055]
                ]
              },
              {
                x: 0.978,
                z: 0.803,
                v: 'dry',
                cols: [
                  [0.978, 0.803, 0.0055]
                ]
              },
              {
                x: 0.932,
                z: 0.889,
                v: 'sparse',
                cols: [
                  [0.932, 0.889, 0.0055]
                ]
              },
              {
                x: 0.933,
                z: 0.751,
                v: 'scraggly',
                cols: [
                  [0.933, 0.751, 0.0055]
                ]
              },
              {
                x: 0.96,
                z: 0.794,
                v: 'dry',
                cols: [
                  [0.96, 0.794, 0.0055]
                ]
              },
              {
                x: 0.85,
                z: 0.832,
                v: 'scraggly',
                cols: [
                  [0.85, 0.832, 0.0055]
                ]
              },
              {
                x: 0.845,
                z: 0.853,
                v: 'scraggly',
                cols: [
                  [0.845, 0.853, 0.0055]
                ]
              },
              {
                x: 0.929,
                z: 0.844,
                v: 'sparse',
                cols: [
                  [0.929, 0.844, 0.0055]
                ]
              },
              {
                x: 0.824,
                z: 0.745,
                v: 'sparse',
                cols: [
                  [0.824, 0.745, 0.0055]
                ]
              },
              {
                x: 0.946,
                z: 0.771,
                v: 'scraggly',
                cols: [
                  [0.946, 0.771, 0.0055]
                ]
              },
              {
                x: 0.942,
                z: 0.811,
                v: 'dry',
                cols: [
                  [0.942, 0.811, 0.0055]
                ]
              },
              {
                x: 0.883,
                z: 0.808,
                v: 'scraggly',
                cols: [
                  [0.883, 0.808, 0.0055]
                ]
              },
              {
                x: 0.415,
                z: 0.275,
                v: 'bare',
                cols: [
                  [0.415, 0.275, 0.0055]
                ]
              },
              {
                x: 0.442,
                z: 0.191,
                v: 'bare',
                cols: [
                  [0.442, 0.191, 0.0055]
                ]
              },
              {
                x: 0.371,
                z: 0.261,
                v: 'dry',
                cols: [
                  [0.371, 0.261, 0.0055]
                ]
              },
              {
                x: 0.392,
                z: 0.201,
                v: 'scraggly',
                cols: [
                  [0.392, 0.201, 0.0055]
                ]
              },
              {
                x: 0.422,
                z: 0.303,
                v: 'scraggly',
                cols: [
                  [0.422, 0.303, 0.0055]
                ]
              },
              {
                x: 0.454,
                z: 0.204,
                v: 'sparse',
                cols: [
                  [0.454, 0.204, 0.0055]
                ]
              },
              {
                x: 0.354,
                z: 0.286,
                v: 'bare',
                cols: [
                  [0.354, 0.286, 0.0055]
                ]
              },
              {
                x: 0.462,
                z: 0.292,
                v: 'bare',
                cols: [
                  [0.462, 0.292, 0.0055]
                ]
              },
              {
                x: 0.381,
                z: 0.214,
                v: 'scraggly',
                cols: [
                  [0.381, 0.214, 0.0055]
                ]
              },
              {
                x: 0.383,
                z: 0.278,
                v: 'scraggly',
                cols: [
                  [0.383, 0.278, 0.0055]
                ]
              },
              {
                x: 0.33,
                z: 0.123,
                v: 'scraggly',
                cols: [
                  [0.33, 0.123, 0.0055]
                ]
              },
              {
                x: 0.38,
                z: 0.124,
                v: 'scraggly',
                cols: [
                  [0.38, 0.124, 0.0055]
                ]
              },
              {
                x: 0.281,
                z: 0.218,
                v: 'dry',
                cols: [
                  [0.281, 0.218, 0.0055]
                ]
              },
              {
                x: 0.344,
                z: 0.079,
                v: 'bare',
                cols: [
                  [0.344, 0.079, 0.0055]
                ]
              },
              {
                x: 0.282,
                z: 0.131,
                v: 'scraggly',
                cols: [
                  [0.282, 0.131, 0.0055]
                ]
              },
              {
                x: 0.284,
                z: 0.158,
                v: 'bare',
                cols: [
                  [0.284, 0.158, 0.0055]
                ]
              },
              {
                x: 0.262,
                z: 0.243,
                v: 'scraggly',
                cols: [
                  [0.262, 0.243, 0.0055]
                ]
              },
              {
                x: 0.959,
                z: 0.882,
                v: 'bare',
                cols: [
                  [0.959, 0.882, 0.0055]
                ]
              },
              {
                x: 0.964,
                z: 0.86,
                v: 'scraggly',
                cols: [
                  [0.964, 0.86, 0.0055]
                ]
              },
              {
                x: 0.893,
                z: 0.851,
                v: 'dry',
                cols: [
                  [0.893, 0.851, 0.0055]
                ]
              },
              {
                x: 0.884,
                z: 0.832,
                v: 'sparse',
                cols: [
                  [0.884, 0.832, 0.0055]
                ]
              },
              {
                x: 0.876,
                z: 0.85,
                v: 'scraggly',
                cols: [
                  [0.876, 0.85, 0.0055]
                ]
              },
              {
                x: 0.95,
                z: 0.902,
                v: 'dry',
                cols: [
                  [0.95, 0.902, 0.0055]
                ]
              }
            ],
            rocks: [
              {
                x: 0.085,
                z: 0.357,
                rotY: 3.4,
                scale: 0.72,
                cols: [
                  [0.085, 0.357, 0.0108]
                ]
              },
              {
                x: 0.538,
                z: 0.314,
                rotY: 1.9,
                scale: 0.85,
                cols: [
                  [0.538, 0.314, 0.0127]
                ]
              },
              {
                x: 0.613,
                z: 0.791,
                rotY: 4.5,
                scale: 0.69,
                cols: [
                  [0.613, 0.791, 0.0103]
                ]
              },
              {
                x: 0.291,
                z: 0.954,
                rotY: 2.9,
                scale: 0.96,
                cols: [
                  [0.291, 0.954, 0.0144]
                ]
              },
              {
                x: 0.686,
                z: 0.199,
                rotY: 3.8,
                scale: 0.97,
                cols: [
                  [0.686, 0.199, 0.0145]
                ]
              },
              {
                x: 0.498,
                z: 0.234,
                rotY: 2,
                scale: 0.62,
                cols: [
                  [0.498, 0.234, 0.0093]
                ]
              },
              {
                x: 0.073,
                z: 0.649,
                rotY: 4.5,
                scale: 0.61,
                cols: [
                  [0.073, 0.649, 0.0092]
                ]
              },
              {
                x: 0.292,
                z: 0.605,
                rotY: 5.2,
                scale: 0.84,
                cols: [
                  [0.292, 0.605, 0.0126]
                ]
              },
              {
                x: 0.722,
                z: 0.545,
                rotY: 3,
                scale: 0.61,
                cols: [
                  [0.722, 0.545, 0.0092]
                ]
              },
              {
                x: 0.739,
                z: 0.063,
                rotY: 4.3,
                scale: 0.68,
                cols: [
                  [0.739, 0.063, 0.0102]
                ]
              },
              {
                x: 0.587,
                z: 0.314,
                rotY: 4.5,
                scale: 0.75,
                cols: [
                  [0.587, 0.314, 0.0112]
                ]
              },
              {
                x: 0.559,
                z: 0.621,
                rotY: 5.4,
                scale: 0.95,
                cols: [
                  [0.559, 0.621, 0.0142]
                ]
              }
            ],
            sticks: [],
            minables: [
              {
                material: 'crystal',
                x: 0.219,
                z: 0.265,
                cubes: [
                  {dx:-0.043,dz:0.045,sx:0.28,sy:0.22,sz:0.23,rotY:5.4,rotZ:0.22},
                  {dx:0.063,dz:-0.059,sx:0.2,sy:0.16,sz:0.15,rotY:0.6,rotZ:0.11},
                  {dx:-0.006,dz:-0.034,sx:0.18,sy:0.27,sz:0.24,rotY:4.2,rotZ:0.13},
                  {dx:-0.023,dz:0.041,sx:0.19,sy:0.13,sz:0.14,rotY:3.8,rotZ:-0.14},
                  {dx:-0.058,dz:0.041,sx:0.27,sy:0.24,sz:0.23,rotY:6.2,rotZ:0.24},
                  {dx:-0.033,dz:0.043,sx:0.26,sy:0.27,sz:0.24,rotY:3.1,rotZ:-0.05},
                  {dx:0.04,dz:-0.047,sx:0.17,sy:0.15,sz:0.13,rotY:3.2,rotZ:0.12},
                  {dx:-0.043,dz:0.062,sx:0.16,sy:0.21,sz:0.12,rotY:2.4,rotZ:0.02},
                  {dx:-0.028,dz:0.045,sx:0.25,sy:0.26,sz:0.13,rotY:3.3,rotZ:-0.05},
                  {dx:0.023,dz:-0.039,sx:0.12,sy:0.15,sz:0.2,rotY:1,rotZ:0.13},
                  {dx:-0.013,dz:-0.056,sx:0.23,sy:0.24,sz:0.21,rotY:0.7,rotZ:-0.24},
                  {dx:0.039,dz:0.017,sx:0.11,sy:0.25,sz:0.23,rotY:1.4,rotZ:0.27},
                  {dx:0.043,dz:0.06,sx:0.14,sy:0.2,sz:0.12,rotY:1.7,rotZ:-0.17}
                ],
                colliders: [
                  {dx:-0.038,dz:0.046,r:0.0226},
                  {dx:0.041,dz:0.039,r:0.0222},
                  {dx:0.052,dz:-0.053,r:0.015},
                  {dx:0.001,dz:-0.043,r:0.0218}
                ]
              },
              {
                material: 'crystal',
                x: 0.793,
                z: 0.476,
                cubes: [
                  {dx:-0.002,dz:0.011,sx:0.15,sy:0.18,sz:0.14,rotY:5.3,rotZ:-0.09},
                  {dx:-0.004,dz:0.024,sx:0.14,sy:0.21,sz:0.21,rotY:1.8,rotZ:-0.24},
                  {dx:0.015,dz:0.061,sx:0.27,sy:0.26,sz:0.19,rotY:5.7,rotZ:0.1},
                  {dx:0.019,dz:-0.044,sx:0.15,sy:0.19,sz:0.15,rotY:4.7,rotZ:0.24},
                  {dx:0.016,dz:-0.039,sx:0.24,sy:0.13,sz:0.13,rotY:4.7,rotZ:-0.22},
                  {dx:0.03,dz:0.052,sx:0.11,sy:0.26,sz:0.17,rotY:2.7,rotZ:0.24},
                  {dx:-0.057,dz:-0.013,sx:0.26,sy:0.24,sz:0.21,rotY:3.6,rotZ:-0.1},
                  {dx:0.061,dz:0.05,sx:0.28,sy:0.16,sz:0.17,rotY:2.5,rotZ:-0.19},
                  {dx:0.029,dz:0.039,sx:0.25,sy:0.18,sz:0.23,rotY:5.1,rotZ:-0.25}
                ],
                colliders: [
                  {dx:-0.003,dz:0.018,r:0.0104},
                  {dx:0.034,dz:0.05,r:0.0278},
                  {dx:0.018,dz:-0.041,r:0.0085},
                  {dx:-0.057,dz:-0.013,r:0.0182}
                ]
              },
              {
                material: 'crystal',
                x: 0.57,
                z: 0.679,
                cubes: [
                  {dx:0.026,dz:0.054,sx:0.18,sy:0.19,sz:0.17,rotY:3.7,rotZ:0.27},
                  {dx:-0.005,dz:-0.056,sx:0.25,sy:0.13,sz:0.1,rotY:4.9,rotZ:0.07},
                  {dx:-0.046,dz:0.059,sx:0.27,sy:0.15,sz:0.15,rotY:1.1,rotZ:0.08},
                  {dx:-0.05,dz:0.034,sx:0.23,sy:0.2,sz:0.16,rotY:4.4,rotZ:0.21},
                  {dx:-0.003,dz:0.016,sx:0.28,sy:0.2,sz:0.14,rotY:3.7,rotZ:-0.03},
                  {dx:0.046,dz:0.043,sx:0.1,sy:0.21,sz:0.13,rotY:4.4,rotZ:-0.03},
                  {dx:-0.018,dz:-0.04,sx:0.16,sy:0.15,sz:0.21,rotY:3,rotZ:-0.23},
                  {dx:0.021,dz:-0.051,sx:0.24,sy:0.14,sz:0.14,rotY:0.9,rotZ:0.03},
                  {dx:-0.036,dz:0.046,sx:0.13,sy:0.14,sz:0.22,rotY:3.4,rotZ:0.26},
                  {dx:0.025,dz:-0.05,sx:0.21,sy:0.26,sz:0.15,rotY:4.7,rotZ:0.15},
                  {dx:-0.005,dz:-0.032,sx:0.2,sy:0.17,sz:0.14,rotY:3.6,rotZ:0.09},
                  {dx:-0.047,dz:-0.05,sx:0.16,sy:0.27,sz:0.16,rotY:3.7,rotZ:0.2},
                  {dx:-0.04,dz:0.048,sx:0.17,sy:0.24,sz:0.16,rotY:3.5,rotZ:-0.02},
                  {dx:-0.022,dz:-0.004,sx:0.14,sy:0.21,sz:0.17,rotY:4.8,rotZ:0.01},
                  {dx:0.004,dz:0.021,sx:0.25,sy:0.28,sz:0.17,rotY:1.7,rotZ:0.08}
                ],
                colliders: [
                  {dx:0.018,dz:0.034,r:0.028},
                  {dx:-0.043,dz:0.047,r:0.0169},
                  {dx:0.009,dz:-0.047,r:0.0208},
                  {dx:-0.029,dz:-0.031,r:0.0256},
                  {dx:0.046,dz:0.043,r:0.0091},
                  {dx:-0.022,dz:-0.004,r:0.0119}
                ]
              },
              {
                material: 'crystal',
                x: 0.637,
                z: 0.113,
                cubes: [
                  {dx:-0.003,dz:-0.045,sx:0.12,sy:0.27,sz:0.11,rotY:1.4,rotZ:0.25},
                  {dx:-0.026,dz:-0.038,sx:0.13,sy:0.14,sz:0.22,rotY:5.4,rotZ:-0.27},
                  {dx:-0.016,dz:-0.002,sx:0.3,sy:0.2,sz:0.21,rotY:4.1,rotZ:0.08},
                  {dx:0.049,dz:-0.033,sx:0.17,sy:0.16,sz:0.17,rotY:6.2,rotZ:-0.08},
                  {dx:0.063,dz:0.009,sx:0.16,sy:0.15,sz:0.1,rotY:6.2,rotZ:0.1},
                  {dx:0.064,dz:-0.044,sx:0.16,sy:0.18,sz:0.15,rotY:4.1,rotZ:0.28},
                  {dx:0.033,dz:0.028,sx:0.27,sy:0.21,sz:0.12,rotY:0.3,rotZ:0.06},
                  {dx:0.008,dz:0.025,sx:0.28,sy:0.15,sz:0.13,rotY:0.1,rotZ:-0.25}
                ],
                colliders: [
                  {dx:-0.014,dz:-0.041,r:0.0148},
                  {dx:-0.016,dz:-0.002,r:0.021},
                  {dx:0.059,dz:-0.023,r:0.0282},
                  {dx:0.021,dz:0.027,r:0.0168},
                  {dx:0.063,dz:0.009,r:0.0112}
                ]
              },
              {
                material: 'crystal',
                x: 0.39,
                z: 0.845,
                cubes: [
                  {dx:0.013,dz:0.005,sx:0.22,sy:0.25,sz:0.12,rotY:0.7,rotZ:-0.06},
                  {dx:-0.038,dz:0.057,sx:0.24,sy:0.21,sz:0.21,rotY:3.3,rotZ:0.07},
                  {dx:-0.065,dz:0.008,sx:0.25,sy:0.15,sz:0.14,rotY:4.3,rotZ:0.05},
                  {dx:0.054,dz:0.004,sx:0.31,sy:0.27,sz:0.21,rotY:1.1,rotZ:-0.02},
                  {dx:-0.038,dz:-0.042,sx:0.26,sy:0.23,sz:0.1,rotY:1.4,rotZ:0.06},
                  {dx:0.015,dz:0.042,sx:0.22,sy:0.27,sz:0.21,rotY:0.8,rotZ:0.04},
                  {dx:0.052,dz:-0.047,sx:0.31,sy:0.16,sz:0.22,rotY:3.5,rotZ:-0.18},
                  {dx:0.065,dz:-0.057,sx:0.21,sy:0.18,sz:0.11,rotY:2.8,rotZ:-0.08},
                  {dx:0.013,dz:-0.037,sx:0.17,sy:0.17,sz:0.2,rotY:1.1,rotZ:0.07}
                ],
                colliders: [
                  {dx:0.027,dz:0.017,r:0.0304},
                  {dx:-0.052,dz:0.033,r:0.0275},
                  {dx:-0.038,dz:-0.042,r:0.0182},
                  {dx:0.043,dz:-0.047,r:0.0292},
                  {dx:0.013,dz:-0.037,r:0.014}
                ]
              }
            ]
          }
        },
        {
          id: 'rock_3',
          seed: 301,
          terrain: {
            hills: [
              {x:0.35,z:0.32,radius:0.35,height:0.46},
              {x:0.64,z:0.39,radius:0.37,height:0.56},
              {x:0.38,z:0.37,radius:0.29,height:0.47},
              {x:0.62,z:0.07,radius:0.38,height:0.5},
              {x:0.62,z:0.03,radius:0.38,height:0.52},
              {x:0.04,z:0.99,radius:0.31,height:0.4},
              {x:0.86,z:0.6,radius:0.35,height:0.34},
              {x:0.4,z:0.55,radius:0.36,height:0.5},
              {x:0.35,z:0.81,radius:0.29,height:0.35},
              {x:0.92,z:0.2,radius:0.3,height:0.65},
              {x:0.56,z:0.26,radius:0.36,height:0.45},
              {x:0.45,z:0.87,radius:0.26,height:0.32}
            ]
          },
          items: {
            trees: [
              {
                x: 0.541,
                z: 0.457,
                v: 'bare',
                cols: [
                  [0.541, 0.457, 0.0055]
                ]
              },
              {
                x: 0.594,
                z: 0.519,
                v: 'dry',
                cols: [
                  [0.594, 0.519, 0.0055]
                ]
              },
              {
                x: 0.596,
                z: 0.457,
                v: 'scraggly',
                cols: [
                  [0.596, 0.457, 0.0055]
                ]
              },
              {
                x: 0.641,
                z: 0.492,
                v: 'bare',
                cols: [
                  [0.641, 0.492, 0.0055]
                ]
              },
              {
                x: 0.691,
                z: 0.453,
                v: 'dry',
                cols: [
                  [0.691, 0.453, 0.0055]
                ]
              },
              {
                x: 0.579,
                z: 0.537,
                v: 'bare',
                cols: [
                  [0.579, 0.537, 0.0055]
                ]
              },
              {
                x: 0.006,
                z: 0.85,
                v: 'bare',
                cols: [
                  [0.006, 0.85, 0.0055]
                ]
              },
              {
                x: 0.068,
                z: 0.803,
                v: 'scraggly',
                cols: [
                  [0.068, 0.803, 0.0055]
                ]
              },
              {
                x: 0.048,
                z: 0.8,
                v: 'sparse',
                cols: [
                  [0.048, 0.8, 0.0055]
                ]
              },
              {
                x: 0.074,
                z: 0.786,
                v: 'dry',
                cols: [
                  [0.074, 0.786, 0.0055]
                ]
              },
              {
                x: 0.039,
                z: 0.785,
                v: 'bare',
                cols: [
                  [0.039, 0.785, 0.0055]
                ]
              },
              {
                x: 0.034,
                z: 0.722,
                v: 'bare',
                cols: [
                  [0.034, 0.722, 0.0055]
                ]
              },
              {
                x: 0.067,
                z: 0.758,
                v: 'sparse',
                cols: [
                  [0.067, 0.758, 0.0055]
                ]
              },
              {
                x: 0.61,
                z: 0.292,
                v: 'sparse',
                cols: [
                  [0.61, 0.292, 0.0055]
                ]
              },
              {
                x: 0.608,
                z: 0.32,
                v: 'sparse',
                cols: [
                  [0.608, 0.32, 0.0055]
                ]
              },
              {
                x: 0.647,
                z: 0.269,
                v: 'bare',
                cols: [
                  [0.647, 0.269, 0.0055]
                ]
              },
              {
                x: 0.631,
                z: 0.26,
                v: 'scraggly',
                cols: [
                  [0.631, 0.26, 0.0055]
                ]
              },
              {
                x: 0.666,
                z: 0.251,
                v: 'scraggly',
                cols: [
                  [0.666, 0.251, 0.0055]
                ]
              },
              {
                x: 0.814,
                z: 0.502,
                v: 'bare',
                cols: [
                  [0.814, 0.502, 0.0055]
                ]
              },
              {
                x: 0.652,
                z: 0.557,
                v: 'dry',
                cols: [
                  [0.652, 0.557, 0.0055]
                ]
              },
              {
                x: 0.733,
                z: 0.57,
                v: 'sparse',
                cols: [
                  [0.733, 0.57, 0.0055]
                ]
              },
              {
                x: 0.748,
                z: 0.449,
                v: 'scraggly',
                cols: [
                  [0.748, 0.449, 0.0055]
                ]
              },
              {
                x: 0.723,
                z: 0.63,
                v: 'sparse',
                cols: [
                  [0.723, 0.63, 0.0055]
                ]
              },
              {
                x: 0.763,
                z: 0.616,
                v: 'bare',
                cols: [
                  [0.763, 0.616, 0.0055]
                ]
              },
              {
                x: 0.799,
                z: 0.455,
                v: 'dry',
                cols: [
                  [0.799, 0.455, 0.0055]
                ]
              },
              {
                x: 0.077,
                z: 0.092,
                v: 'scraggly',
                cols: [
                  [0.077, 0.092, 0.0055]
                ]
              },
              {
                x: 0.045,
                z: 0.16,
                v: 'sparse',
                cols: [
                  [0.045, 0.16, 0.0055]
                ]
              },
              {
                x: 0.017,
                z: 0.087,
                v: 'sparse',
                cols: [
                  [0.017, 0.087, 0.0055]
                ]
              },
              {
                x: 0.055,
                z: 0.082,
                v: 'sparse',
                cols: [
                  [0.055, 0.082, 0.0055]
                ]
              },
              {
                x: 0.089,
                z: 0.16,
                v: 'dry',
                cols: [
                  [0.089, 0.16, 0.0055]
                ]
              },
              {
                x: 0.093,
                z: 0.14,
                v: 'sparse',
                cols: [
                  [0.093, 0.14, 0.0055]
                ]
              },
              {
                x: 0.783,
                z: 0.305,
                v: 'sparse',
                cols: [
                  [0.783, 0.305, 0.0055]
                ]
              },
              {
                x: 0.872,
                z: 0.319,
                v: 'dry',
                cols: [
                  [0.872, 0.319, 0.0055]
                ]
              },
              {
                x: 0.666,
                z: 0.275,
                v: 'dry',
                cols: [
                  [0.666, 0.275, 0.0055]
                ]
              },
              {
                x: 0.776,
                z: 0.368,
                v: 'scraggly',
                cols: [
                  [0.776, 0.368, 0.0055]
                ]
              },
              {
                x: 0.601,
                z: 0.912,
                v: 'bare',
                cols: [
                  [0.601, 0.912, 0.0055]
                ]
              },
              {
                x: 0.573,
                z: 0.823,
                v: 'scraggly',
                cols: [
                  [0.573, 0.823, 0.0055]
                ]
              },
              {
                x: 0.543,
                z: 0.879,
                v: 'bare',
                cols: [
                  [0.543, 0.879, 0.0055]
                ]
              },
              {
                x: 0.557,
                z: 0.897,
                v: 'sparse',
                cols: [
                  [0.557, 0.897, 0.0055]
                ]
              },
              {
                x: 0.667,
                z: 0.876,
                v: 'bare',
                cols: [
                  [0.667, 0.876, 0.0055]
                ]
              },
              {
                x: 0.661,
                z: 0.902,
                v: 'bare',
                cols: [
                  [0.661, 0.902, 0.0055]
                ]
              },
              {
                x: 0.716,
                z: 0.93,
                v: 'sparse',
                cols: [
                  [0.716, 0.93, 0.0055]
                ]
              },
              {
                x: 0.639,
                z: 0.971,
                v: 'dry',
                cols: [
                  [0.639, 0.971, 0.0055]
                ]
              },
              {
                x: 0.636,
                z: 0.986,
                v: 'dry',
                cols: [
                  [0.636, 0.986, 0.0055]
                ]
              },
              {
                x: 0.653,
                z: 0.935,
                v: 'sparse',
                cols: [
                  [0.653, 0.935, 0.0055]
                ]
              },
              {
                x: 0.613,
                z: 0.923,
                v: 'sparse',
                cols: [
                  [0.613, 0.923, 0.0055]
                ]
              },
              {
                x: 0.271,
                z: 0.573,
                v: 'dry',
                cols: [
                  [0.271, 0.573, 0.0055]
                ]
              },
              {
                x: 0.229,
                z: 0.697,
                v: 'bare',
                cols: [
                  [0.229, 0.697, 0.0055]
                ]
              },
              {
                x: 0.222,
                z: 0.671,
                v: 'bare',
                cols: [
                  [0.222, 0.671, 0.0055]
                ]
              },
              {
                x: 0.299,
                z: 0.623,
                v: 'bare',
                cols: [
                  [0.299, 0.623, 0.0055]
                ]
              },
              {
                x: 0.277,
                z: 0.63,
                v: 'dry',
                cols: [
                  [0.277, 0.63, 0.0055]
                ]
              },
              {
                x: 0.224,
                z: 0.578,
                v: 'sparse',
                cols: [
                  [0.224, 0.578, 0.0055]
                ]
              },
              {
                x: 0.249,
                z: 0.645,
                v: 'scraggly',
                cols: [
                  [0.249, 0.645, 0.0055]
                ]
              },
              {
                x: 0.156,
                z: 0.572,
                v: 'bare',
                cols: [
                  [0.156, 0.572, 0.0055]
                ]
              },
              {
                x: 0.225,
                z: 0.505,
                v: 'sparse',
                cols: [
                  [0.225, 0.505, 0.0055]
                ]
              },
              {
                x: 0.265,
                z: 0.584,
                v: 'dry',
                cols: [
                  [0.265, 0.584, 0.0055]
                ]
              },
              {
                x: 0.45,
                z: 0.098,
                v: 'sparse',
                cols: [
                  [0.45, 0.098, 0.0055]
                ]
              },
              {
                x: 0.465,
                z: 0.083,
                v: 'bare',
                cols: [
                  [0.465, 0.083, 0.0055]
                ]
              },
              {
                x: 0.445,
                z: 0.085,
                v: 'sparse',
                cols: [
                  [0.445, 0.085, 0.0055]
                ]
              },
              {
                x: 0.509,
                z: 0.187,
                v: 'sparse',
                cols: [
                  [0.509, 0.187, 0.0055]
                ]
              },
              {
                x: 0.467,
                z: 0.207,
                v: 'bare',
                cols: [
                  [0.467, 0.207, 0.0055]
                ]
              },
              {
                x: 0.247,
                z: 0.02,
                v: 'scraggly',
                cols: [
                  [0.247, 0.02, 0.0055]
                ]
              },
              {
                x: 0.217,
                z: 0.125,
                v: 'bare',
                cols: [
                  [0.217, 0.125, 0.0055]
                ]
              },
              {
                x: 0.201,
                z: 0.123,
                v: 'scraggly',
                cols: [
                  [0.201, 0.123, 0.0055]
                ]
              },
              {
                x: 0.233,
                z: 0.103,
                v: 'scraggly',
                cols: [
                  [0.233, 0.103, 0.0055]
                ]
              },
              {
                x: 0.263,
                z: 0.174,
                v: 'sparse',
                cols: [
                  [0.263, 0.174, 0.0055]
                ]
              },
              {
                x: 0.163,
                z: 0.11,
                v: 'scraggly',
                cols: [
                  [0.163, 0.11, 0.0055]
                ]
              },
              {
                x: 0.186,
                z: 0.116,
                v: 'dry',
                cols: [
                  [0.186, 0.116, 0.0055]
                ]
              },
              {
                x: 0.189,
                z: 0.129,
                v: 'sparse',
                cols: [
                  [0.189, 0.129, 0.0055]
                ]
              },
              {
                x: 0.223,
                z: 0.086,
                v: 'dry',
                cols: [
                  [0.223, 0.086, 0.0055]
                ]
              },
              {
                x: 0.028,
                z: 0.665,
                v: 'sparse',
                cols: [
                  [0.028, 0.665, 0.0055]
                ]
              },
              {
                x: 0.049,
                z: 0.725,
                v: 'bare',
                cols: [
                  [0.049, 0.725, 0.0055]
                ]
              },
              {
                x: 0.006,
                z: 0.749,
                v: 'bare',
                cols: [
                  [0.006, 0.749, 0.0055]
                ]
              },
              {
                x: 0.073,
                z: 0.775,
                v: 'sparse',
                cols: [
                  [0.073, 0.775, 0.0055]
                ]
              }
            ],
            rocks: [
              {
                x: 0.712,
                z: 0.53,
                rotY: 2.9,
                scale: 0.74,
                cols: [
                  [0.712, 0.53, 0.0111]
                ]
              },
              {
                x: 0.638,
                z: 0.697,
                rotY: 2.6,
                scale: 0.69,
                cols: [
                  [0.638, 0.697, 0.0103]
                ]
              },
              {
                x: 0.754,
                z: 0.878,
                rotY: 1.8,
                scale: 0.96,
                cols: [
                  [0.754, 0.878, 0.0144]
                ]
              },
              {
                x: 0.259,
                z: 0.336,
                rotY: 0.3,
                scale: 0.61,
                cols: [
                  [0.259, 0.336, 0.0092]
                ]
              },
              {
                x: 0.827,
                z: 0.378,
                rotY: 5.8,
                scale: 0.94,
                cols: [
                  [0.827, 0.378, 0.0141]
                ]
              },
              {
                x: 0.544,
                z: 0.59,
                rotY: 4.1,
                scale: 0.89,
                cols: [
                  [0.544, 0.59, 0.0133]
                ]
              },
              {
                x: 0.29,
                z: 0.221,
                rotY: 1.2,
                scale: 0.73,
                cols: [
                  [0.29, 0.221, 0.0109]
                ]
              },
              {
                x: 0.491,
                z: 0.535,
                rotY: 4,
                scale: 0.92,
                cols: [
                  [0.491, 0.535, 0.0138]
                ]
              },
              {
                x: 0.552,
                z: 0.56,
                rotY: 0.8,
                scale: 0.69,
                cols: [
                  [0.552, 0.56, 0.0103]
                ]
              },
              {
                x: 0.149,
                z: 0.209,
                rotY: 0.5,
                scale: 0.81,
                cols: [
                  [0.149, 0.209, 0.0122]
                ]
              },
              {
                x: 0.891,
                z: 0.181,
                rotY: 2.9,
                scale: 0.96,
                cols: [
                  [0.891, 0.181, 0.0144]
                ]
              },
              {
                x: 0.471,
                z: 0.234,
                rotY: 2.3,
                scale: 0.62,
                cols: [
                  [0.471, 0.234, 0.0093]
                ]
              },
              {
                x: 0.265,
                z: 0.798,
                rotY: 5.8,
                scale: 1,
                cols: [
                  [0.265, 0.798, 0.015]
                ]
              }
            ],
            sticks: [],
            minables: [
              {
                material: 'crystal',
                x: 0.618,
                z: 0.321,
                cubes: [
                  {dx:0.034,dz:0.056,sx:0.24,sy:0.23,sz:0.15,rotY:1.5,rotZ:0.15},
                  {dx:-0.06,dz:-0.012,sx:0.18,sy:0.25,sz:0.1,rotY:6.1,rotZ:-0.25},
                  {dx:0.031,dz:0.014,sx:0.13,sy:0.25,sz:0.11,rotY:1.2,rotZ:0.11},
                  {dx:0.013,dz:0.02,sx:0.14,sy:0.25,sz:0.13,rotY:3.1,rotZ:-0.18},
                  {dx:-0.06,dz:-0.063,sx:0.19,sy:0.22,sz:0.15,rotY:0.9,rotZ:0.12},
                  {dx:0.063,dz:-0.055,sx:0.3,sy:0.27,sz:0.15,rotY:5.2,rotZ:0.18},
                  {dx:0.014,dz:-0.029,sx:0.31,sy:0.14,sz:0.19,rotY:0.5,rotZ:0.17},
                  {dx:0.052,dz:0.018,sx:0.15,sy:0.18,sz:0.12,rotY:0.5,rotZ:-0.1},
                  {dx:-0.003,dz:-0.036,sx:0.27,sy:0.23,sz:0.11,rotY:3.7,rotZ:-0.1}
                ],
                colliders: [
                  {dx:0.034,dz:0.056,r:0.0168},
                  {dx:0.032,dz:0.017,r:0.0189},
                  {dx:-0.06,dz:-0.037,r:0.0241},
                  {dx:0.025,dz:-0.04,r:0.0387},
                  {dx:-0.06,dz:-0.063,r:0.0133},
                  {dx:0.063,dz:-0.055,r:0.021},
                  {dx:0.052,dz:0.018,r:0.0105}
                ]
              },
              {
                material: 'crystal',
                x: 0.341,
                z: 0.699,
                cubes: [
                  {dx:0.026,dz:-0.021,sx:0.12,sy:0.17,sz:0.16,rotY:3.9,rotZ:-0.12},
                  {dx:-0.014,dz:-0.046,sx:0.18,sy:0.14,sz:0.16,rotY:0.1,rotZ:0.15},
                  {dx:-0.008,dz:-0.055,sx:0.23,sy:0.23,sz:0.14,rotY:3.6,rotZ:-0.28},
                  {dx:-0.025,dz:0.04,sx:0.24,sy:0.15,sz:0.2,rotY:2.3,rotZ:0.16},
                  {dx:0.006,dz:0.018,sx:0.14,sy:0.17,sz:0.23,rotY:0.1,rotZ:0.25},
                  {dx:-0.014,dz:-0.003,sx:0.19,sy:0.25,sz:0.23,rotY:3.9,rotZ:-0.21},
                  {dx:-0.001,dz:0.062,sx:0.12,sy:0.13,sz:0.11,rotY:5.7,rotZ:-0.28},
                  {dx:0.046,dz:0.003,sx:0.23,sy:0.26,sz:0.22,rotY:0.6,rotZ:-0.04},
                  {dx:0.007,dz:-0.061,sx:0.22,sy:0.2,sz:0.15,rotY:5.2,rotZ:-0.06},
                  {dx:-0.051,dz:0.04,sx:0.13,sy:0.21,sz:0.22,rotY:0.9,rotZ:0.2},
                  {dx:0.004,dz:-0.008,sx:0.21,sy:0.24,sz:0.22,rotY:1.5,rotZ:0.08},
                  {dx:-0.063,dz:-0.049,sx:0.19,sy:0.25,sz:0.24,rotY:0,rotZ:0.23},
                  {dx:-0.027,dz:-0.048,sx:0.2,sy:0.2,sz:0.19,rotY:1.7,rotZ:0.02}
                ],
                colliders: [
                  {dx:0.003,dz:-0.03,r:0.0469},
                  {dx:-0.023,dz:0.033,r:0.0306},
                  {dx:-0.001,dz:0.062,r:0.0084},
                  {dx:-0.063,dz:-0.049,r:0.0168},
                  {dx:0.006,dz:0.018,r:0.0161},
                  {dx:0.046,dz:0.003,r:0.0161}
                ]
              },
              {
                material: 'crystal',
                x: 0.804,
                z: 0.584,
                cubes: [
                  {dx:0.013,dz:0.034,sx:0.13,sy:0.21,sz:0.24,rotY:5.8,rotZ:-0.11},
                  {dx:-0.007,dz:-0.031,sx:0.26,sy:0.26,sz:0.23,rotY:6.1,rotZ:-0.19},
                  {dx:0.008,dz:-0.041,sx:0.32,sy:0.26,sz:0.19,rotY:0.1,rotZ:-0.18},
                  {dx:0.038,dz:-0.026,sx:0.21,sy:0.13,sz:0.14,rotY:5,rotZ:-0.04},
                  {dx:0.009,dz:-0.034,sx:0.21,sy:0.24,sz:0.23,rotY:3.9,rotZ:0.28},
                  {dx:0.062,dz:0,sx:0.21,sy:0.21,sz:0.2,rotY:0.9,rotZ:0},
                  {dx:0.047,dz:-0.002,sx:0.13,sy:0.28,sz:0.24,rotY:4.1,rotZ:-0.28},
                  {dx:-0.039,dz:0.027,sx:0.25,sy:0.22,sz:0.16,rotY:4.1,rotZ:-0.18}
                ],
                colliders: [
                  {dx:-0.013,dz:0.031,r:0.0262},
                  {dx:0.009,dz:-0.038,r:0.0111},
                  {dx:-0.007,dz:-0.031,r:0.0182},
                  {dx:0.049,dz:-0.009,r:0.0205}
                ]
              },
              {
                material: 'crystal',
                x: 0.394,
                z: 0.262,
                cubes: [
                  {dx:0.02,dz:0.016,sx:0.2,sy:0.18,sz:0.14,rotY:2.2,rotZ:0.26},
                  {dx:-0.016,dz:0.037,sx:0.26,sy:0.18,sz:0.11,rotY:4.4,rotZ:0.23},
                  {dx:-0.016,dz:0.059,sx:0.19,sy:0.25,sz:0.17,rotY:0.9,rotZ:0.24},
                  {dx:0.009,dz:0.027,sx:0.3,sy:0.14,sz:0.21,rotY:3.2,rotZ:0.02},
                  {dx:-0.013,dz:0.048,sx:0.16,sy:0.28,sz:0.12,rotY:2,rotZ:-0.24},
                  {dx:-0.027,dz:0.063,sx:0.16,sy:0.13,sz:0.13,rotY:4.2,rotZ:0.24},
                  {dx:-0.034,dz:-0.025,sx:0.21,sy:0.18,sz:0.13,rotY:3.8,rotZ:-0.19},
                  {dx:0.005,dz:-0.009,sx:0.2,sy:0.21,sz:0.19,rotY:2,rotZ:-0.13},
                  {dx:-0.019,dz:0.027,sx:0.18,sy:0.16,sz:0.21,rotY:6.3,rotZ:-0.12},
                  {dx:-0.039,dz:0.059,sx:0.13,sy:0.25,sz:0.12,rotY:1.8,rotZ:0.16},
                  {dx:-0.016,dz:-0.001,sx:0.2,sy:0.13,sz:0.11,rotY:2.6,rotZ:-0.06},
                  {dx:-0.057,dz:0.045,sx:0.16,sy:0.19,sz:0.23,rotY:1.6,rotZ:-0.08},
                  {dx:0.035,dz:-0.058,sx:0.19,sy:0.15,sz:0.22,rotY:0.5,rotZ:0.06}
                ],
                colliders: [
                  {dx:0.02,dz:-0.033,r:0.0273},
                  {dx:-0.004,dz:0.031,r:0.0263},
                  {dx:-0.025,dz:-0.013,r:0.0168},
                  {dx:-0.035,dz:0.056,r:0.0248},
                  {dx:0.02,dz:0.016,r:0.014},
                  {dx:0.005,dz:-0.009,r:0.014},
                  {dx:0.035,dz:-0.058,r:0.0154}
                ]
              }
            ]
          }
        },
        {
          id: 'rock_4',
          seed: 401,
          terrain: {
            hills: [
              {x:0.68,z:0.9,radius:0.35,height:0.33},
              {x:0.96,z:0.41,radius:0.36,height:0.52},
              {x:0.1,z:0.37,radius:0.22,height:0.42},
              {x:0.62,z:0.14,radius:0.2,height:0.7},
              {x:0.59,z:0.02,radius:0.18,height:0.44},
              {x:1,z:0.55,radius:0.2,height:0.33},
              {x:0.06,z:0.28,radius:0.18,height:0.6},
              {x:0.95,z:0.54,radius:0.37,height:0.38},
              {x:0.26,z:0.32,radius:0.25,height:0.65},
              {x:0.96,z:0.25,radius:0.33,height:0.66},
              {x:0.51,z:0.76,radius:0.3,height:0.27},
              {x:0.3,z:0.38,radius:0.28,height:0.43}
            ]
          },
          items: {
            trees: [
              {
                x: 0.059,
                z: 0.981,
                v: 'dry',
                cols: [
                  [0.059, 0.981, 0.0055]
                ]
              },
              {
                x: 0.084,
                z: 0.938,
                v: 'bare',
                cols: [
                  [0.084, 0.938, 0.0055]
                ]
              },
              {
                x: 0.05,
                z: 0.952,
                v: 'bare',
                cols: [
                  [0.05, 0.952, 0.0055]
                ]
              },
              {
                x: 0.109,
                z: 0.863,
                v: 'bare',
                cols: [
                  [0.109, 0.863, 0.0055]
                ]
              },
              {
                x: 0.037,
                z: 0.972,
                v: 'sparse',
                cols: [
                  [0.037, 0.972, 0.0055]
                ]
              },
              {
                x: 0.063,
                z: 0.948,
                v: 'scraggly',
                cols: [
                  [0.063, 0.948, 0.0055]
                ]
              },
              {
                x: 0.042,
                z: 0.928,
                v: 'dry',
                cols: [
                  [0.042, 0.928, 0.0055]
                ]
              },
              {
                x: 0.287,
                z: 0.42,
                v: 'sparse',
                cols: [
                  [0.287, 0.42, 0.0055]
                ]
              },
              {
                x: 0.399,
                z: 0.468,
                v: 'scraggly',
                cols: [
                  [0.399, 0.468, 0.0055]
                ]
              },
              {
                x: 0.218,
                z: 0.42,
                v: 'sparse',
                cols: [
                  [0.218, 0.42, 0.0055]
                ]
              },
              {
                x: 0.317,
                z: 0.489,
                v: 'bare',
                cols: [
                  [0.317, 0.489, 0.0055]
                ]
              },
              {
                x: 0.31,
                z: 0.449,
                v: 'bare',
                cols: [
                  [0.31, 0.449, 0.0055]
                ]
              },
              {
                x: 0.3,
                z: 0.42,
                v: 'dry',
                cols: [
                  [0.3, 0.42, 0.0055]
                ]
              },
              {
                x: 0.313,
                z: 0.568,
                v: 'scraggly',
                cols: [
                  [0.313, 0.568, 0.0055]
                ]
              },
              {
                x: 0.346,
                z: 0.521,
                v: 'scraggly',
                cols: [
                  [0.346, 0.521, 0.0055]
                ]
              },
              {
                x: 0.248,
                z: 0.576,
                v: 'dry',
                cols: [
                  [0.248, 0.576, 0.0055]
                ]
              },
              {
                x: 0.96,
                z: 0.367,
                v: 'bare',
                cols: [
                  [0.96, 0.367, 0.0055]
                ]
              },
              {
                x: 0.92,
                z: 0.298,
                v: 'sparse',
                cols: [
                  [0.92, 0.298, 0.0055]
                ]
              },
              {
                x: 0.936,
                z: 0.257,
                v: 'bare',
                cols: [
                  [0.936, 0.257, 0.0055]
                ]
              },
              {
                x: 0.928,
                z: 0.318,
                v: 'bare',
                cols: [
                  [0.928, 0.318, 0.0055]
                ]
              },
              {
                x: 0.907,
                z: 0.433,
                v: 'dry',
                cols: [
                  [0.907, 0.433, 0.0055]
                ]
              },
              {
                x: 0.951,
                z: 0.507,
                v: 'scraggly',
                cols: [
                  [0.951, 0.507, 0.0055]
                ]
              },
              {
                x: 0.985,
                z: 0.423,
                v: 'bare',
                cols: [
                  [0.985, 0.423, 0.0055]
                ]
              },
              {
                x: 0.984,
                z: 0.453,
                v: 'scraggly',
                cols: [
                  [0.984, 0.453, 0.0055]
                ]
              },
              {
                x: 0.942,
                z: 0.446,
                v: 'scraggly',
                cols: [
                  [0.942, 0.446, 0.0055]
                ]
              },
              {
                x: 0.923,
                z: 0.514,
                v: 'bare',
                cols: [
                  [0.923, 0.514, 0.0055]
                ]
              },
              {
                x: 0.971,
                z: 0.569,
                v: 'bare',
                cols: [
                  [0.971, 0.569, 0.0055]
                ]
              },
              {
                x: 0.975,
                z: 0.437,
                v: 'bare',
                cols: [
                  [0.975, 0.437, 0.0055]
                ]
              },
              {
                x: 0.971,
                z: 0.422,
                v: 'scraggly',
                cols: [
                  [0.971, 0.422, 0.0055]
                ]
              },
              {
                x: 0.285,
                z: 0.228,
                v: 'scraggly',
                cols: [
                  [0.285, 0.228, 0.0055]
                ]
              },
              {
                x: 0.411,
                z: 0.188,
                v: 'dry',
                cols: [
                  [0.411, 0.188, 0.0055]
                ]
              },
              {
                x: 0.438,
                z: 0.185,
                v: 'sparse',
                cols: [
                  [0.438, 0.185, 0.0055]
                ]
              },
              {
                x: 0.421,
                z: 0.367,
                v: 'sparse',
                cols: [
                  [0.421, 0.367, 0.0055]
                ]
              },
              {
                x: 0.466,
                z: 0.271,
                v: 'sparse',
                cols: [
                  [0.466, 0.271, 0.0055]
                ]
              },
              {
                x: 0.393,
                z: 0.331,
                v: 'dry',
                cols: [
                  [0.393, 0.331, 0.0055]
                ]
              },
              {
                x: 0.282,
                z: 0.29,
                v: 'scraggly',
                cols: [
                  [0.282, 0.29, 0.0055]
                ]
              },
              {
                x: 0.448,
                z: 0.351,
                v: 'dry',
                cols: [
                  [0.448, 0.351, 0.0055]
                ]
              },
              {
                x: 0.633,
                z: 0.869,
                v: 'scraggly',
                cols: [
                  [0.633, 0.869, 0.0055]
                ]
              },
              {
                x: 0.717,
                z: 0.838,
                v: 'scraggly',
                cols: [
                  [0.717, 0.838, 0.0055]
                ]
              },
              {
                x: 0.766,
                z: 0.792,
                v: 'dry',
                cols: [
                  [0.766, 0.792, 0.0055]
                ]
              },
              {
                x: 0.661,
                z: 0.824,
                v: 'dry',
                cols: [
                  [0.661, 0.824, 0.0055]
                ]
              },
              {
                x: 0.784,
                z: 0.026,
                v: 'bare',
                cols: [
                  [0.784, 0.026, 0.0055]
                ]
              },
              {
                x: 0.739,
                z: 0.115,
                v: 'sparse',
                cols: [
                  [0.739, 0.115, 0.0055]
                ]
              },
              {
                x: 0.709,
                z: 0.023,
                v: 'bare',
                cols: [
                  [0.709, 0.023, 0.0055]
                ]
              },
              {
                x: 0.689,
                z: 0.019,
                v: 'scraggly',
                cols: [
                  [0.689, 0.019, 0.0055]
                ]
              },
              {
                x: 0.72,
                z: 0.008,
                v: 'sparse',
                cols: [
                  [0.72, 0.008, 0.0055]
                ]
              },
              {
                x: 0.721,
                z: 0.019,
                v: 'bare',
                cols: [
                  [0.721, 0.019, 0.0055]
                ]
              },
              {
                x: 0.628,
                z: 0.03,
                v: 'bare',
                cols: [
                  [0.628, 0.03, 0.0055]
                ]
              },
              {
                x: 0.666,
                z: 0.09,
                v: 'sparse',
                cols: [
                  [0.666, 0.09, 0.0055]
                ]
              },
              {
                x: 0.824,
                z: 0.014,
                v: 'sparse',
                cols: [
                  [0.824, 0.014, 0.0055]
                ]
              },
              {
                x: 0.781,
                z: 0.09,
                v: 'sparse',
                cols: [
                  [0.781, 0.09, 0.0055]
                ]
              },
              {
                x: 0.145,
                z: 0.008,
                v: 'sparse',
                cols: [
                  [0.145, 0.008, 0.0055]
                ]
              },
              {
                x: 0.244,
                z: 0.079,
                v: 'dry',
                cols: [
                  [0.244, 0.079, 0.0055]
                ]
              },
              {
                x: 0.301,
                z: 0.068,
                v: 'bare',
                cols: [
                  [0.301, 0.068, 0.0055]
                ]
              },
              {
                x: 0.213,
                z: 0.046,
                v: 'scraggly',
                cols: [
                  [0.213, 0.046, 0.0055]
                ]
              },
              {
                x: 0.251,
                z: 0.047,
                v: 'sparse',
                cols: [
                  [0.251, 0.047, 0.0055]
                ]
              },
              {
                x: 0.191,
                z: 0.035,
                v: 'scraggly',
                cols: [
                  [0.191, 0.035, 0.0055]
                ]
              },
              {
                x: 0.234,
                z: 0.009,
                v: 'sparse',
                cols: [
                  [0.234, 0.009, 0.0055]
                ]
              },
              {
                x: 0.253,
                z: 0.028,
                v: 'sparse',
                cols: [
                  [0.253, 0.028, 0.0055]
                ]
              },
              {
                x: 0.225,
                z: 0.025,
                v: 'dry',
                cols: [
                  [0.225, 0.025, 0.0055]
                ]
              },
              {
                x: 0.192,
                z: 0.052,
                v: 'scraggly',
                cols: [
                  [0.192, 0.052, 0.0055]
                ]
              },
              {
                x: 0.393,
                z: 0.297,
                v: 'sparse',
                cols: [
                  [0.393, 0.297, 0.0055]
                ]
              },
              {
                x: 0.344,
                z: 0.432,
                v: 'dry',
                cols: [
                  [0.344, 0.432, 0.0055]
                ]
              },
              {
                x: 0.415,
                z: 0.386,
                v: 'dry',
                cols: [
                  [0.415, 0.386, 0.0055]
                ]
              },
              {
                x: 0.387,
                z: 0.392,
                v: 'scraggly',
                cols: [
                  [0.387, 0.392, 0.0055]
                ]
              },
              {
                x: 0.333,
                z: 0.476,
                v: 'scraggly',
                cols: [
                  [0.333, 0.476, 0.0055]
                ]
              },
              {
                x: 0.87,
                z: 0.25,
                v: 'bare',
                cols: [
                  [0.87, 0.25, 0.0055]
                ]
              },
              {
                x: 0.94,
                z: 0.232,
                v: 'dry',
                cols: [
                  [0.94, 0.232, 0.0055]
                ]
              },
              {
                x: 0.991,
                z: 0.091,
                v: 'sparse',
                cols: [
                  [0.991, 0.091, 0.0055]
                ]
              },
              {
                x: 0.963,
                z: 0.183,
                v: 'bare',
                cols: [
                  [0.963, 0.183, 0.0055]
                ]
              },
              {
                x: 0.878,
                z: 0.201,
                v: 'sparse',
                cols: [
                  [0.878, 0.201, 0.0055]
                ]
              },
              {
                x: 0.955,
                z: 0.208,
                v: 'dry',
                cols: [
                  [0.955, 0.208, 0.0055]
                ]
              },
              {
                x: 0.924,
                z: 0.175,
                v: 'sparse',
                cols: [
                  [0.924, 0.175, 0.0055]
                ]
              },
              {
                x: 0.96,
                z: 0.163,
                v: 'bare',
                cols: [
                  [0.96, 0.163, 0.0055]
                ]
              },
              {
                x: 0.803,
                z: 0.908,
                v: 'sparse',
                cols: [
                  [0.803, 0.908, 0.0055]
                ]
              },
              {
                x: 0.846,
                z: 0.951,
                v: 'dry',
                cols: [
                  [0.846, 0.951, 0.0055]
                ]
              }
            ],
            rocks: [
              {
                x: 0.329,
                z: 0.569,
                rotY: 1.4,
                scale: 0.86,
                cols: [
                  [0.329, 0.569, 0.0129]
                ]
              },
              {
                x: 0.479,
                z: 0.226,
                rotY: 5.2,
                scale: 0.92,
                cols: [
                  [0.479, 0.226, 0.0138]
                ]
              },
              {
                x: 0.957,
                z: 0.789,
                rotY: 5.1,
                scale: 0.81,
                cols: [
                  [0.957, 0.789, 0.0122]
                ]
              },
              {
                x: 0.847,
                z: 0.739,
                rotY: 3.5,
                scale: 0.92,
                cols: [
                  [0.847, 0.739, 0.0138]
                ]
              },
              {
                x: 0.079,
                z: 0.425,
                rotY: 6,
                scale: 0.68,
                cols: [
                  [0.079, 0.425, 0.0102]
                ]
              },
              {
                x: 0.905,
                z: 0.267,
                rotY: 4,
                scale: 0.82,
                cols: [
                  [0.905, 0.267, 0.0123]
                ]
              },
              {
                x: 0.052,
                z: 0.423,
                rotY: 5.1,
                scale: 0.92,
                cols: [
                  [0.052, 0.423, 0.0138]
                ]
              },
              {
                x: 0.55,
                z: 0.507,
                rotY: 4.7,
                scale: 0.79,
                cols: [
                  [0.55, 0.507, 0.0118]
                ]
              },
              {
                x: 0.275,
                z: 0.554,
                rotY: 5.1,
                scale: 0.77,
                cols: [
                  [0.275, 0.554, 0.0115]
                ]
              },
              {
                x: 0.161,
                z: 0.431,
                rotY: 1.6,
                scale: 0.89,
                cols: [
                  [0.161, 0.431, 0.0133]
                ]
              },
              {
                x: 0.67,
                z: 0.77,
                rotY: 5,
                scale: 0.65,
                cols: [
                  [0.67, 0.77, 0.0097]
                ]
              },
              {
                x: 0.301,
                z: 0.818,
                rotY: 4.5,
                scale: 0.85,
                cols: [
                  [0.301, 0.818, 0.0127]
                ]
              },
              {
                x: 0.891,
                z: 0.022,
                rotY: 0.7,
                scale: 0.79,
                cols: [
                  [0.891, 0.022, 0.0118]
                ]
              },
              {
                x: 0.448,
                z: 0.201,
                rotY: 1.7,
                scale: 0.96,
                cols: [
                  [0.448, 0.201, 0.0144]
                ]
              }
            ],
            sticks: [],
            minables: [
              {
                material: 'crystal',
                x: 0.168,
                z: 0.203,
                cubes: [
                  {dx:0.046,dz:0.051,sx:0.28,sy:0.21,sz:0.23,rotY:3.4,rotZ:0.24},
                  {dx:0.001,dz:0.056,sx:0.31,sy:0.25,sz:0.23,rotY:5.2,rotZ:-0.1},
                  {dx:0.062,dz:-0.009,sx:0.21,sy:0.18,sz:0.1,rotY:5.2,rotZ:0.17},
                  {dx:-0.043,dz:-0.028,sx:0.3,sy:0.15,sz:0.15,rotY:3.4,rotZ:0.09},
                  {dx:-0.058,dz:0.057,sx:0.3,sy:0.25,sz:0.18,rotY:0.2,rotZ:-0.24},
                  {dx:-0.052,dz:0.005,sx:0.22,sy:0.23,sz:0.14,rotY:5.6,rotZ:-0.18},
                  {dx:-0.044,dz:-0.013,sx:0.12,sy:0.28,sz:0.17,rotY:1.8,rotZ:-0.03},
                  {dx:0.048,dz:-0.059,sx:0.16,sy:0.24,sz:0.22,rotY:1.9,rotZ:-0.22},
                  {dx:-0.053,dz:0.033,sx:0.12,sy:0.12,sz:0.12,rotY:5.3,rotZ:-0.09},
                  {dx:0.028,dz:0.06,sx:0.14,sy:0.22,sz:0.21,rotY:4.6,rotZ:-0.11},
                  {dx:-0.037,dz:0.013,sx:0.12,sy:0.14,sz:0.19,rotY:3.6,rotZ:0.02},
                  {dx:-0.059,dz:-0.006,sx:0.31,sy:0.15,sz:0.12,rotY:4.8,rotZ:0.25},
                  {dx:-0.003,dz:-0.011,sx:0.23,sy:0.12,sz:0.18,rotY:4.5,rotZ:0.19},
                  {dx:0.021,dz:-0.063,sx:0.11,sy:0.27,sz:0.24,rotY:4.6,rotZ:0.18}
                ],
                colliders: [
                  {dx:0.025,dz:0.056,r:0.0261},
                  {dx:-0.037,dz:-0.014,r:0.0319},
                  {dx:0.044,dz:-0.044,r:0.0349},
                  {dx:-0.05,dz:0.027,r:0.0312},
                  {dx:0.062,dz:-0.009,r:0.0147},
                  {dx:-0.003,dz:-0.011,r:0.0161}
                ]
              },
              {
                material: 'crystal',
                x: 0.767,
                z: 0.451,
                cubes: [
                  {dx:-0.064,dz:0.017,sx:0.12,sy:0.23,sz:0.2,rotY:3.3,rotZ:-0.17},
                  {dx:-0.002,dz:-0.001,sx:0.21,sy:0.25,sz:0.14,rotY:2.9,rotZ:-0.03},
                  {dx:-0.021,dz:0.016,sx:0.31,sy:0.27,sz:0.22,rotY:5.4,rotZ:-0.12},
                  {dx:-0.005,dz:-0.029,sx:0.1,sy:0.26,sz:0.1,rotY:1,rotZ:0.27},
                  {dx:0.007,dz:0.057,sx:0.23,sy:0.15,sz:0.12,rotY:3.7,rotZ:-0.04},
                  {dx:-0.025,dz:-0.011,sx:0.25,sy:0.21,sz:0.12,rotY:4.3,rotZ:-0.05},
                  {dx:-0.044,dz:0.06,sx:0.17,sy:0.26,sz:0.23,rotY:1.1,rotZ:-0.11},
                  {dx:-0.001,dz:0.053,sx:0.27,sy:0.26,sz:0.17,rotY:3.8,rotZ:0.18},
                  {dx:-0.06,dz:-0.004,sx:0.12,sy:0.26,sz:0.11,rotY:6,rotZ:-0.13},
                  {dx:0.027,dz:0.026,sx:0.12,sy:0.25,sz:0.14,rotY:3.7,rotZ:0.18},
                  {dx:0.046,dz:0.045,sx:0.27,sy:0.23,sz:0.13,rotY:1,rotZ:0.18},
                  {dx:0.044,dz:-0.007,sx:0.2,sy:0.22,sz:0.19,rotY:5.8,rotZ:0.18}
                ],
                colliders: [
                  {dx:-0.048,dz:0.01,r:0.0292},
                  {dx:-0.011,dz:-0.014,r:0.0175},
                  {dx:-0.044,dz:0.06,r:0.0161},
                  {dx:0.025,dz:0.035,r:0.0398},
                  {dx:0.044,dz:-0.007,r:0.014}
                ]
              },
              {
                material: 'crystal',
                x: 0.479,
                z: 0.309,
                cubes: [
                  {dx:0.049,dz:0,sx:0.14,sy:0.13,sz:0.23,rotY:4.1,rotZ:-0.02},
                  {dx:0.016,dz:-0.002,sx:0.13,sy:0.13,sz:0.12,rotY:0.8,rotZ:-0.06},
                  {dx:0.043,dz:-0.058,sx:0.31,sy:0.23,sz:0.17,rotY:3.1,rotZ:0.28},
                  {dx:-0.033,dz:-0.039,sx:0.3,sy:0.19,sz:0.13,rotY:6.1,rotZ:-0.08},
                  {dx:0.031,dz:-0.023,sx:0.15,sy:0.16,sz:0.12,rotY:4.5,rotZ:-0.23},
                  {dx:0.028,dz:0.011,sx:0.27,sy:0.2,sz:0.22,rotY:4.1,rotZ:-0.18},
                  {dx:-0.056,dz:-0.027,sx:0.13,sy:0.18,sz:0.15,rotY:4.5,rotZ:0.14},
                  {dx:0.006,dz:0.036,sx:0.23,sy:0.17,sz:0.19,rotY:2.4,rotZ:-0.24}
                ],
                colliders: [
                  {dx:0.028,dz:0.016,r:0.0283},
                  {dx:0.043,dz:-0.058,r:0.0217},
                  {dx:0.024,dz:-0.012,r:0.0136},
                  {dx:-0.044,dz:-0.033,r:0.0176},
                  {dx:0.006,dz:0.036,r:0.0161}
                ]
              }
            ]
          }
        },
        {
          id: 'rock_5',
          seed: 501,
          terrain: {
            hills: [
              {x:0.01,z:0.53,radius:0.34,height:0.31},
              {x:0.28,z:0.19,radius:0.35,height:0.47},
              {x:0.81,z:0.9,radius:0.36,height:0.23},
              {x:0.63,z:0.2,radius:0.24,height:0.59},
              {x:0.55,z:0.01,radius:0.21,height:0.66},
              {x:0.96,z:0.51,radius:0.3,height:0.42},
              {x:0.26,z:0.17,radius:0.23,height:0.58},
              {x:0.5,z:0.9,radius:0.37,height:0.14},
              {x:0.17,z:0.62,radius:0.2,height:0.38},
              {x:1,z:0.3,radius:0.37,height:0.67},
              {x:0.47,z:0.05,radius:0.24,height:0.66},
              {x:0.15,z:0.1,radius:0.29,height:0.55}
            ]
          },
          items: {
            trees: [
              {
                x: 0.506,
                z: 0.359,
                v: 'bare',
                cols: [
                  [0.506, 0.359, 0.0055]
                ]
              },
              {
                x: 0.442,
                z: 0.427,
                v: 'scraggly',
                cols: [
                  [0.442, 0.427, 0.0055]
                ]
              },
              {
                x: 0.529,
                z: 0.457,
                v: 'bare',
                cols: [
                  [0.529, 0.457, 0.0055]
                ]
              },
              {
                x: 0.413,
                z: 0.377,
                v: 'bare',
                cols: [
                  [0.413, 0.377, 0.0055]
                ]
              },
              {
                x: 0.467,
                z: 0.429,
                v: 'scraggly',
                cols: [
                  [0.467, 0.429, 0.0055]
                ]
              },
              {
                x: 0.517,
                z: 0.376,
                v: 'bare',
                cols: [
                  [0.517, 0.376, 0.0055]
                ]
              },
              {
                x: 0.482,
                z: 0.429,
                v: 'bare',
                cols: [
                  [0.482, 0.429, 0.0055]
                ]
              },
              {
                x: 0.481,
                z: 0.444,
                v: 'scraggly',
                cols: [
                  [0.481, 0.444, 0.0055]
                ]
              },
              {
                x: 0.877,
                z: 0.098,
                v: 'scraggly',
                cols: [
                  [0.877, 0.098, 0.0055]
                ]
              },
              {
                x: 0.793,
                z: 0.014,
                v: 'bare',
                cols: [
                  [0.793, 0.014, 0.0055]
                ]
              },
              {
                x: 0.827,
                z: 0.058,
                v: 'scraggly',
                cols: [
                  [0.827, 0.058, 0.0055]
                ]
              },
              {
                x: 0.877,
                z: 0.078,
                v: 'scraggly',
                cols: [
                  [0.877, 0.078, 0.0055]
                ]
              },
              {
                x: 0.806,
                z: 0.007,
                v: 'bare',
                cols: [
                  [0.806, 0.007, 0.0055]
                ]
              },
              {
                x: 0.81,
                z: 0.033,
                v: 'scraggly',
                cols: [
                  [0.81, 0.033, 0.0055]
                ]
              },
              {
                x: 0.242,
                z: 0.743,
                v: 'sparse',
                cols: [
                  [0.242, 0.743, 0.0055]
                ]
              },
              {
                x: 0.362,
                z: 0.677,
                v: 'dry',
                cols: [
                  [0.362, 0.677, 0.0055]
                ]
              },
              {
                x: 0.303,
                z: 0.734,
                v: 'bare',
                cols: [
                  [0.303, 0.734, 0.0055]
                ]
              },
              {
                x: 0.298,
                z: 0.787,
                v: 'dry',
                cols: [
                  [0.298, 0.787, 0.0055]
                ]
              },
              {
                x: 0.186,
                z: 0.716,
                v: 'scraggly',
                cols: [
                  [0.186, 0.716, 0.0055]
                ]
              },
              {
                x: 0.356,
                z: 0.664,
                v: 'scraggly',
                cols: [
                  [0.356, 0.664, 0.0055]
                ]
              },
              {
                x: 0.23,
                z: 0.82,
                v: 'bare',
                cols: [
                  [0.23, 0.82, 0.0055]
                ]
              },
              {
                x: 0.668,
                z: 0.974,
                v: 'dry',
                cols: [
                  [0.668, 0.974, 0.0055]
                ]
              },
              {
                x: 0.648,
                z: 0.984,
                v: 'sparse',
                cols: [
                  [0.648, 0.984, 0.0055]
                ]
              },
              {
                x: 0.637,
                z: 0.971,
                v: 'bare',
                cols: [
                  [0.637, 0.971, 0.0055]
                ]
              },
              {
                x: 0.67,
                z: 0.917,
                v: 'dry',
                cols: [
                  [0.67, 0.917, 0.0055]
                ]
              },
              {
                x: 0.72,
                z: 0.925,
                v: 'dry',
                cols: [
                  [0.72, 0.925, 0.0055]
                ]
              },
              {
                x: 0.584,
                z: 0.948,
                v: 'bare',
                cols: [
                  [0.584, 0.948, 0.0055]
                ]
              },
              {
                x: 0.687,
                z: 0.988,
                v: 'dry',
                cols: [
                  [0.687, 0.988, 0.0055]
                ]
              },
              {
                x: 0.368,
                z: 0.719,
                v: 'dry',
                cols: [
                  [0.368, 0.719, 0.0055]
                ]
              },
              {
                x: 0.364,
                z: 0.767,
                v: 'bare',
                cols: [
                  [0.364, 0.767, 0.0055]
                ]
              },
              {
                x: 0.315,
                z: 0.669,
                v: 'sparse',
                cols: [
                  [0.315, 0.669, 0.0055]
                ]
              },
              {
                x: 0.376,
                z: 0.686,
                v: 'dry',
                cols: [
                  [0.376, 0.686, 0.0055]
                ]
              },
              {
                x: 0.329,
                z: 0.665,
                v: 'bare',
                cols: [
                  [0.329, 0.665, 0.0055]
                ]
              },
              {
                x: 0.289,
                z: 0.83,
                v: 'bare',
                cols: [
                  [0.289, 0.83, 0.0055]
                ]
              },
              {
                x: 0.4,
                z: 0.72,
                v: 'scraggly',
                cols: [
                  [0.4, 0.72, 0.0055]
                ]
              },
              {
                x: 0.337,
                z: 0.083,
                v: 'bare',
                cols: [
                  [0.337, 0.083, 0.0055]
                ]
              },
              {
                x: 0.339,
                z: 0.043,
                v: 'dry',
                cols: [
                  [0.339, 0.043, 0.0055]
                ]
              },
              {
                x: 0.302,
                z: 0.05,
                v: 'bare',
                cols: [
                  [0.302, 0.05, 0.0055]
                ]
              },
              {
                x: 0.384,
                z: 0.029,
                v: 'sparse',
                cols: [
                  [0.384, 0.029, 0.0055]
                ]
              },
              {
                x: 0.382,
                z: 0.017,
                v: 'bare',
                cols: [
                  [0.382, 0.017, 0.0055]
                ]
              },
              {
                x: 0.43,
                z: 0.139,
                v: 'bare',
                cols: [
                  [0.43, 0.139, 0.0055]
                ]
              },
              {
                x: 0.316,
                z: 0.09,
                v: 'dry',
                cols: [
                  [0.316, 0.09, 0.0055]
                ]
              },
              {
                x: 0.349,
                z: 0.053,
                v: 'dry',
                cols: [
                  [0.349, 0.053, 0.0055]
                ]
              },
              {
                x: 0.372,
                z: 0.009,
                v: 'sparse',
                cols: [
                  [0.372, 0.009, 0.0055]
                ]
              },
              {
                x: 0.296,
                z: 0.085,
                v: 'bare',
                cols: [
                  [0.296, 0.085, 0.0055]
                ]
              },
              {
                x: 0.451,
                z: 0.099,
                v: 'scraggly',
                cols: [
                  [0.451, 0.099, 0.0055]
                ]
              },
              {
                x: 0.26,
                z: 0.206,
                v: 'sparse',
                cols: [
                  [0.26, 0.206, 0.0055]
                ]
              },
              {
                x: 0.182,
                z: 0.156,
                v: 'scraggly',
                cols: [
                  [0.182, 0.156, 0.0055]
                ]
              },
              {
                x: 0.324,
                z: 0.156,
                v: 'scraggly',
                cols: [
                  [0.324, 0.156, 0.0055]
                ]
              },
              {
                x: 0.22,
                z: 0.163,
                v: 'sparse',
                cols: [
                  [0.22, 0.163, 0.0055]
                ]
              },
              {
                x: 0.164,
                z: 0.216,
                v: 'scraggly',
                cols: [
                  [0.164, 0.216, 0.0055]
                ]
              },
              {
                x: 0.643,
                z: 0.728,
                v: 'dry',
                cols: [
                  [0.643, 0.728, 0.0055]
                ]
              },
              {
                x: 0.656,
                z: 0.712,
                v: 'sparse',
                cols: [
                  [0.656, 0.712, 0.0055]
                ]
              },
              {
                x: 0.661,
                z: 0.744,
                v: 'dry',
                cols: [
                  [0.661, 0.744, 0.0055]
                ]
              },
              {
                x: 0.591,
                z: 0.724,
                v: 'sparse',
                cols: [
                  [0.591, 0.724, 0.0055]
                ]
              },
              {
                x: 0.68,
                z: 0.781,
                v: 'dry',
                cols: [
                  [0.68, 0.781, 0.0055]
                ]
              },
              {
                x: 0.733,
                z: 0.748,
                v: 'sparse',
                cols: [
                  [0.733, 0.748, 0.0055]
                ]
              },
              {
                x: 0.383,
                z: 0.425,
                v: 'bare',
                cols: [
                  [0.383, 0.425, 0.0055]
                ]
              },
              {
                x: 0.363,
                z: 0.371,
                v: 'dry',
                cols: [
                  [0.363, 0.371, 0.0055]
                ]
              },
              {
                x: 0.37,
                z: 0.316,
                v: 'bare',
                cols: [
                  [0.37, 0.316, 0.0055]
                ]
              },
              {
                x: 0.446,
                z: 0.406,
                v: 'dry',
                cols: [
                  [0.446, 0.406, 0.0055]
                ]
              },
              {
                x: 0.364,
                z: 0.29,
                v: 'scraggly',
                cols: [
                  [0.364, 0.29, 0.0055]
                ]
              },
              {
                x: 0.467,
                z: 0.368,
                v: 'dry',
                cols: [
                  [0.467, 0.368, 0.0055]
                ]
              },
              {
                x: 0.321,
                z: 0.494,
                v: 'sparse',
                cols: [
                  [0.321, 0.494, 0.0055]
                ]
              },
              {
                x: 0.387,
                z: 0.4,
                v: 'scraggly',
                cols: [
                  [0.387, 0.4, 0.0055]
                ]
              },
              {
                x: 0.362,
                z: 0.503,
                v: 'scraggly',
                cols: [
                  [0.362, 0.503, 0.0055]
                ]
              },
              {
                x: 0.394,
                z: 0.343,
                v: 'sparse',
                cols: [
                  [0.394, 0.343, 0.0055]
                ]
              },
              {
                x: 0.071,
                z: 0.978,
                v: 'scraggly',
                cols: [
                  [0.071, 0.978, 0.0055]
                ]
              },
              {
                x: 0.119,
                z: 0.981,
                v: 'sparse',
                cols: [
                  [0.119, 0.981, 0.0055]
                ]
              },
              {
                x: 0.037,
                z: 0.913,
                v: 'dry',
                cols: [
                  [0.037, 0.913, 0.0055]
                ]
              },
              {
                x: 0.006,
                z: 0.969,
                v: 'bare',
                cols: [
                  [0.006, 0.969, 0.0055]
                ]
              },
              {
                x: 0.097,
                z: 0.969,
                v: 'bare',
                cols: [
                  [0.097, 0.969, 0.0055]
                ]
              },
              {
                x: 0.407,
                z: 0.933,
                v: 'sparse',
                cols: [
                  [0.407, 0.933, 0.0055]
                ]
              },
              {
                x: 0.449,
                z: 0.881,
                v: 'scraggly',
                cols: [
                  [0.449, 0.881, 0.0055]
                ]
              },
              {
                x: 0.408,
                z: 0.948,
                v: 'dry',
                cols: [
                  [0.408, 0.948, 0.0055]
                ]
              },
              {
                x: 0.521,
                z: 0.799,
                v: 'dry',
                cols: [
                  [0.521, 0.799, 0.0055]
                ]
              }
            ],
            rocks: [
              {
                x: 0.284,
                z: 0.608,
                rotY: 0.8,
                scale: 0.74,
                cols: [
                  [0.284, 0.608, 0.0111]
                ]
              },
              {
                x: 0.706,
                z: 0.965,
                rotY: 4.7,
                scale: 0.63,
                cols: [
                  [0.706, 0.965, 0.0095]
                ]
              },
              {
                x: 0.597,
                z: 0.935,
                rotY: 3.9,
                scale: 0.83,
                cols: [
                  [0.597, 0.935, 0.0124]
                ]
              },
              {
                x: 0.915,
                z: 0.197,
                rotY: 3.4,
                scale: 0.71,
                cols: [
                  [0.915, 0.197, 0.0106]
                ]
              },
              {
                x: 0.093,
                z: 0.094,
                rotY: 6.2,
                scale: 0.7,
                cols: [
                  [0.093, 0.094, 0.0105]
                ]
              },
              {
                x: 0.609,
                z: 0.567,
                rotY: 2.3,
                scale: 0.99,
                cols: [
                  [0.609, 0.567, 0.0148]
                ]
              },
              {
                x: 0.946,
                z: 0.782,
                rotY: 2,
                scale: 0.9,
                cols: [
                  [0.946, 0.782, 0.0135]
                ]
              },
              {
                x: 0.219,
                z: 0.896,
                rotY: 3.4,
                scale: 0.79,
                cols: [
                  [0.219, 0.896, 0.0118]
                ]
              }
            ],
            sticks: [],
            minables: [
              {
                material: 'crystal',
                x: 0.649,
                z: 0.737,
                cubes: [
                  {dx:-0.062,dz:0.057,sx:0.17,sy:0.18,sz:0.1,rotY:5.9,rotZ:-0.01},
                  {dx:-0.034,dz:-0.005,sx:0.16,sy:0.21,sz:0.19,rotY:3.2,rotZ:0.25},
                  {dx:0.029,dz:-0.004,sx:0.32,sy:0.2,sz:0.17,rotY:1.2,rotZ:-0.17},
                  {dx:-0.004,dz:0.007,sx:0.12,sy:0.19,sz:0.2,rotY:1.5,rotZ:0.12},
                  {dx:0.047,dz:-0.062,sx:0.21,sy:0.15,sz:0.13,rotY:2.4,rotZ:-0.13},
                  {dx:0.063,dz:0.057,sx:0.24,sy:0.12,sz:0.21,rotY:3.2,rotZ:-0.02},
                  {dx:-0.006,dz:0.003,sx:0.22,sy:0.26,sz:0.13,rotY:3.5,rotZ:0.12},
                  {dx:0.043,dz:0.018,sx:0.14,sy:0.15,sz:0.14,rotY:1.2,rotZ:-0.27}
                ],
                colliders: [
                  {dx:-0.062,dz:0.057,r:0.0119},
                  {dx:0.045,dz:0.024,r:0.0347},
                  {dx:0.047,dz:-0.062,r:0.0147},
                  {dx:-0.015,dz:0.002,r:0.0203},
                  {dx:0.063,dz:0.057,r:0.0168}
                ]
              },
              {
                material: 'crystal',
                x: 0.882,
                z: 0.136,
                cubes: [
                  {dx:0.022,dz:0.047,sx:0.27,sy:0.26,sz:0.19,rotY:2.3,rotZ:-0.02},
                  {dx:-0.048,dz:0.003,sx:0.31,sy:0.27,sz:0.2,rotY:3,rotZ:0.18},
                  {dx:0.002,dz:0.022,sx:0.18,sy:0.2,sz:0.13,rotY:2,rotZ:-0.14},
                  {dx:-0.015,dz:0.007,sx:0.27,sy:0.22,sz:0.1,rotY:2.9,rotZ:0.03},
                  {dx:-0.019,dz:-0.037,sx:0.26,sy:0.27,sz:0.13,rotY:0.5,rotZ:0.18},
                  {dx:-0.034,dz:0.023,sx:0.1,sy:0.19,sz:0.11,rotY:0.1,rotZ:-0.13},
                  {dx:-0.058,dz:-0.035,sx:0.15,sy:0.13,sz:0.21,rotY:3.3,rotZ:-0.23},
                  {dx:0.033,dz:-0.056,sx:0.19,sy:0.2,sz:0.23,rotY:4.4,rotZ:-0.07},
                  {dx:0.046,dz:-0.005,sx:0.26,sy:0.24,sz:0.22,rotY:3.5,rotZ:-0.2},
                  {dx:-0.063,dz:0.05,sx:0.26,sy:0.28,sz:0.18,rotY:3.1,rotZ:-0.27},
                  {dx:0.015,dz:-0.007,sx:0.26,sy:0.23,sz:0.17,rotY:4,rotZ:-0.17},
                  {dx:0.039,dz:-0.047,sx:0.28,sy:0.18,sz:0.23,rotY:2,rotZ:0.05},
                  {dx:-0.03,dz:0.027,sx:0.18,sy:0.27,sz:0.17,rotY:5.9,rotZ:0.25}
                ],
                colliders: [
                  {dx:0.021,dz:0.014,r:0.0317},
                  {dx:0.036,dz:-0.052,r:0.0114},
                  {dx:-0.042,dz:-0.023,r:0.0282},
                  {dx:-0.036,dz:0.027,r:0.0338},
                  {dx:0.022,dz:0.047,r:0.0189},
                  {dx:-0.063,dz:0.05,r:0.0182}
                ]
              },
              {
                material: 'crystal',
                x: 0.199,
                z: 0.78,
                cubes: [
                  {dx:-0.04,dz:-0.053,sx:0.3,sy:0.16,sz:0.22,rotY:3.5,rotZ:-0.14},
                  {dx:0.025,dz:-0.008,sx:0.19,sy:0.14,sz:0.2,rotY:1.3,rotZ:-0.19},
                  {dx:-0.048,dz:-0.004,sx:0.12,sy:0.26,sz:0.16,rotY:3.8,rotZ:0.16},
                  {dx:0.036,dz:-0.015,sx:0.19,sy:0.25,sz:0.11,rotY:2.5,rotZ:-0.01},
                  {dx:-0.003,dz:-0.013,sx:0.29,sy:0.19,sz:0.16,rotY:0.2,rotZ:-0.18},
                  {dx:-0.051,dz:0.051,sx:0.28,sy:0.12,sz:0.2,rotY:2.3,rotZ:-0.16},
                  {dx:0.048,dz:-0.012,sx:0.17,sy:0.18,sz:0.12,rotY:2.6,rotZ:0.14},
                  {dx:-0.001,dz:-0.01,sx:0.26,sy:0.12,sz:0.19,rotY:4.2,rotZ:-0.15},
                  {dx:-0.034,dz:-0.044,sx:0.22,sy:0.24,sz:0.23,rotY:2.9,rotZ:-0.22},
                  {dx:-0.042,dz:0.063,sx:0.14,sy:0.18,sz:0.24,rotY:1.9,rotZ:0.07}
                ],
                colliders: [
                  {dx:-0.037,dz:-0.048,r:0.0119},
                  {dx:-0.048,dz:-0.004,r:0.0112},
                  {dx:-0.046,dz:0.057,r:0.013},
                  {dx:0.021,dz:-0.012,r:0.0256},
                  {dx:0.048,dz:-0.012,r:0.0119}
                ]
              },
              {
                material: 'crystal',
                x: 0.396,
                z: 0.123,
                cubes: [
                  {dx:0.046,dz:0.029,sx:0.11,sy:0.12,sz:0.14,rotY:3,rotZ:0.07},
                  {dx:0.054,dz:0.014,sx:0.11,sy:0.25,sz:0.13,rotY:1,rotZ:-0.19},
                  {dx:-0.002,dz:-0.048,sx:0.18,sy:0.2,sz:0.15,rotY:5.1,rotZ:0.09},
                  {dx:-0.037,dz:-0.06,sx:0.27,sy:0.19,sz:0.23,rotY:4.2,rotZ:-0.22},
                  {dx:0.018,dz:-0.034,sx:0.16,sy:0.17,sz:0.23,rotY:1.4,rotZ:-0.03},
                  {dx:0.019,dz:-0.025,sx:0.19,sy:0.26,sz:0.22,rotY:3.1,rotZ:0.08},
                  {dx:0.016,dz:0.032,sx:0.23,sy:0.2,sz:0.23,rotY:6,rotZ:0.15},
                  {dx:-0.026,dz:0.063,sx:0.22,sy:0.13,sz:0.17,rotY:5.6,rotZ:0.13},
                  {dx:-0.009,dz:0.055,sx:0.3,sy:0.27,sz:0.18,rotY:0.6,rotZ:-0.09},
                  {dx:0.061,dz:0.014,sx:0.12,sy:0.12,sz:0.17,rotY:0.8,rotZ:0.21},
                  {dx:-0.009,dz:-0.048,sx:0.13,sy:0.21,sz:0.11,rotY:5.2,rotZ:0.1},
                  {dx:0.013,dz:0.002,sx:0.12,sy:0.15,sz:0.12,rotY:5.9,rotZ:-0.13},
                  {dx:-0.019,dz:0.06,sx:0.27,sy:0.22,sz:0.15,rotY:4.8,rotZ:-0.15},
                  {dx:0.041,dz:-0.051,sx:0.2,sy:0.26,sz:0.22,rotY:5.2,rotZ:0.1}
                ],
                colliders: [
                  {dx:0.038,dz:0.018,r:0.0255},
                  {dx:-0.037,dz:-0.06,r:0.0189},
                  {dx:-0.018,dz:0.059,r:0.0154},
                  {dx:0.013,dz:-0.041,r:0.0277},
                  {dx:0.013,dz:0.002,r:0.0084},
                  {dx:0.041,dz:-0.051,r:0.0154}
                ]
              },
              {
                material: 'crystal',
                x: 0.627,
                z: 0.358,
                cubes: [
                  {dx:0.036,dz:0.059,sx:0.19,sy:0.16,sz:0.15,rotY:5.3,rotZ:-0.12},
                  {dx:0.025,dz:-0.025,sx:0.15,sy:0.19,sz:0.12,rotY:3.5,rotZ:0.06},
                  {dx:-0.003,dz:0.023,sx:0.13,sy:0.12,sz:0.14,rotY:5.8,rotZ:-0.1},
                  {dx:-0.062,dz:-0.008,sx:0.22,sy:0.15,sz:0.21,rotY:2.2,rotZ:-0.07},
                  {dx:0.059,dz:0.039,sx:0.27,sy:0.25,sz:0.22,rotY:6,rotZ:-0.12},
                  {dx:0.059,dz:0.035,sx:0.21,sy:0.14,sz:0.17,rotY:5.7,rotZ:-0.12},
                  {dx:-0.015,dz:-0.047,sx:0.2,sy:0.27,sz:0.14,rotY:2.6,rotZ:-0.06},
                  {dx:0.038,dz:0.011,sx:0.12,sy:0.21,sz:0.19,rotY:4.3,rotZ:0.17}
                ],
                colliders: [
                  {dx:0.036,dz:0.059,r:0.0133},
                  {dx:-0.003,dz:0.023,r:0.0098},
                  {dx:0.052,dz:0.028,r:0.0217},
                  {dx:-0.017,dz:-0.027,r:0.0421},
                  {dx:-0.062,dz:-0.008,r:0.0154}
                ]
              }
            ]
          }
        },
        {
          id: 'rock_6',
          seed: 601,
          terrain: {
            hills: [
              {x:0.34,z:0.27,radius:0.34,height:0.6},
              {x:0.61,z:0.54,radius:0.34,height:0.43},
              {x:0.52,z:0.49,radius:0.29,height:0.46},
              {x:0.64,z:0.26,radius:0.28,height:0.49},
              {x:0.51,z:0.6,radius:0.23,height:0.3},
              {x:0.91,z:0.19,radius:0.19,height:0.67},
              {x:0.46,z:0.38,radius:0.28,height:0.4},
              {x:0.05,z:0.89,radius:0.37,height:0.33},
              {x:0.09,z:0.13,radius:0.38,height:0.68},
              {x:0.03,z:0.35,radius:0.18,height:0.68},
              {x:0.42,z:0.95,radius:0.39,height:0.18},
              {x:1,z:0.21,radius:0.31,height:0.67},
              {x:0.84,z:0.96,radius:0.33,height:0.16}
            ]
          },
          items: {
            trees: [
              {
                x: 0.067,
                z: 0.312,
                v: 'dry',
                cols: [
                  [0.067, 0.312, 0.0055]
                ]
              },
              {
                x: 0.064,
                z: 0.349,
                v: 'dry',
                cols: [
                  [0.064, 0.349, 0.0055]
                ]
              },
              {
                x: 0.024,
                z: 0.38,
                v: 'dry',
                cols: [
                  [0.024, 0.38, 0.0055]
                ]
              },
              {
                x: 0.032,
                z: 0.244,
                v: 'bare',
                cols: [
                  [0.032, 0.244, 0.0055]
                ]
              },
              {
                x: 0.159,
                z: 0.047,
                v: 'bare',
                cols: [
                  [0.159, 0.047, 0.0055]
                ]
              },
              {
                x: 0.111,
                z: 0.16,
                v: 'bare',
                cols: [
                  [0.111, 0.16, 0.0055]
                ]
              },
              {
                x: 0.194,
                z: 0.154,
                v: 'bare',
                cols: [
                  [0.194, 0.154, 0.0055]
                ]
              },
              {
                x: 0.151,
                z: 0.059,
                v: 'scraggly',
                cols: [
                  [0.151, 0.059, 0.0055]
                ]
              },
              {
                x: 0.133,
                z: 0.114,
                v: 'bare',
                cols: [
                  [0.133, 0.114, 0.0055]
                ]
              },
              {
                x: 0.241,
                z: 0.141,
                v: 'dry',
                cols: [
                  [0.241, 0.141, 0.0055]
                ]
              },
              {
                x: 0.067,
                z: 0.098,
                v: 'dry',
                cols: [
                  [0.067, 0.098, 0.0055]
                ]
              },
              {
                x: 0.171,
                z: 0.063,
                v: 'dry',
                cols: [
                  [0.171, 0.063, 0.0055]
                ]
              },
              {
                x: 0.275,
                z: 0.911,
                v: 'bare',
                cols: [
                  [0.275, 0.911, 0.0055]
                ]
              },
              {
                x: 0.22,
                z: 0.769,
                v: 'scraggly',
                cols: [
                  [0.22, 0.769, 0.0055]
                ]
              },
              {
                x: 0.263,
                z: 0.904,
                v: 'bare',
                cols: [
                  [0.263, 0.904, 0.0055]
                ]
              },
              {
                x: 0.249,
                z: 0.912,
                v: 'scraggly',
                cols: [
                  [0.249, 0.912, 0.0055]
                ]
              },
              {
                x: 0.2,
                z: 0.812,
                v: 'dry',
                cols: [
                  [0.2, 0.812, 0.0055]
                ]
              },
              {
                x: 0.432,
                z: 0.766,
                v: 'scraggly',
                cols: [
                  [0.432, 0.766, 0.0055]
                ]
              },
              {
                x: 0.267,
                z: 0.782,
                v: 'bare',
                cols: [
                  [0.267, 0.782, 0.0055]
                ]
              },
              {
                x: 0.318,
                z: 0.721,
                v: 'bare',
                cols: [
                  [0.318, 0.721, 0.0055]
                ]
              },
              {
                x: 0.265,
                z: 0.761,
                v: 'scraggly',
                cols: [
                  [0.265, 0.761, 0.0055]
                ]
              },
              {
                x: 0.277,
                z: 0.823,
                v: 'bare',
                cols: [
                  [0.277, 0.823, 0.0055]
                ]
              },
              {
                x: 0.327,
                z: 0.706,
                v: 'bare',
                cols: [
                  [0.327, 0.706, 0.0055]
                ]
              },
              {
                x: 0.348,
                z: 0.628,
                v: 'scraggly',
                cols: [
                  [0.348, 0.628, 0.0055]
                ]
              },
              {
                x: 0.339,
                z: 0.648,
                v: 'bare',
                cols: [
                  [0.339, 0.648, 0.0055]
                ]
              },
              {
                x: 0.337,
                z: 0.781,
                v: 'scraggly',
                cols: [
                  [0.337, 0.781, 0.0055]
                ]
              },
              {
                x: 0.223,
                z: 0.742,
                v: 'dry',
                cols: [
                  [0.223, 0.742, 0.0055]
                ]
              },
              {
                x: 0.361,
                z: 0.798,
                v: 'bare',
                cols: [
                  [0.361, 0.798, 0.0055]
                ]
              },
              {
                x: 0.563,
                z: 0.895,
                v: 'bare',
                cols: [
                  [0.563, 0.895, 0.0055]
                ]
              },
              {
                x: 0.625,
                z: 0.988,
                v: 'sparse',
                cols: [
                  [0.625, 0.988, 0.0055]
                ]
              },
              {
                x: 0.615,
                z: 0.982,
                v: 'dry',
                cols: [
                  [0.615, 0.982, 0.0055]
                ]
              },
              {
                x: 0.64,
                z: 0.992,
                v: 'sparse',
                cols: [
                  [0.64, 0.992, 0.0055]
                ]
              },
              {
                x: 0.653,
                z: 0.899,
                v: 'bare',
                cols: [
                  [0.653, 0.899, 0.0055]
                ]
              },
              {
                x: 0.588,
                z: 0.963,
                v: 'dry',
                cols: [
                  [0.588, 0.963, 0.0055]
                ]
              },
              {
                x: 0.601,
                z: 0.991,
                v: 'sparse',
                cols: [
                  [0.601, 0.991, 0.0055]
                ]
              },
              {
                x: 0.747,
                z: 0.774,
                v: 'scraggly',
                cols: [
                  [0.747, 0.774, 0.0055]
                ]
              },
              {
                x: 0.78,
                z: 0.75,
                v: 'bare',
                cols: [
                  [0.78, 0.75, 0.0055]
                ]
              },
              {
                x: 0.803,
                z: 0.879,
                v: 'dry',
                cols: [
                  [0.803, 0.879, 0.0055]
                ]
              },
              {
                x: 0.728,
                z: 0.855,
                v: 'bare',
                cols: [
                  [0.728, 0.855, 0.0055]
                ]
              },
              {
                x: 0.738,
                z: 0.903,
                v: 'sparse',
                cols: [
                  [0.738, 0.903, 0.0055]
                ]
              },
              {
                x: 0.843,
                z: 0.883,
                v: 'sparse',
                cols: [
                  [0.843, 0.883, 0.0055]
                ]
              },
              {
                x: 0.725,
                z: 0.905,
                v: 'sparse',
                cols: [
                  [0.725, 0.905, 0.0055]
                ]
              },
              {
                x: 0.813,
                z: 0.897,
                v: 'scraggly',
                cols: [
                  [0.813, 0.897, 0.0055]
                ]
              },
              {
                x: 0.685,
                z: 0.813,
                v: 'scraggly',
                cols: [
                  [0.685, 0.813, 0.0055]
                ]
              },
              {
                x: 0.714,
                z: 0.759,
                v: 'dry',
                cols: [
                  [0.714, 0.759, 0.0055]
                ]
              },
              {
                x: 0.622,
                z: 0.845,
                v: 'sparse',
                cols: [
                  [0.622, 0.845, 0.0055]
                ]
              },
              {
                x: 0.721,
                z: 0.799,
                v: 'sparse',
                cols: [
                  [0.721, 0.799, 0.0055]
                ]
              },
              {
                x: 0.767,
                z: 0.864,
                v: 'dry',
                cols: [
                  [0.767, 0.864, 0.0055]
                ]
              },
              {
                x: 0.721,
                z: 0.811,
                v: 'sparse',
                cols: [
                  [0.721, 0.811, 0.0055]
                ]
              },
              {
                x: 0.148,
                z: 0.99,
                v: 'sparse',
                cols: [
                  [0.148, 0.99, 0.0055]
                ]
              },
              {
                x: 0.111,
                z: 0.955,
                v: 'sparse',
                cols: [
                  [0.111, 0.955, 0.0055]
                ]
              },
              {
                x: 0.172,
                z: 0.954,
                v: 'sparse',
                cols: [
                  [0.172, 0.954, 0.0055]
                ]
              },
              {
                x: 0.147,
                z: 0.883,
                v: 'scraggly',
                cols: [
                  [0.147, 0.883, 0.0055]
                ]
              },
              {
                x: 0.259,
                z: 0.401,
                v: 'scraggly',
                cols: [
                  [0.259, 0.401, 0.0055]
                ]
              },
              {
                x: 0.254,
                z: 0.475,
                v: 'dry',
                cols: [
                  [0.254, 0.475, 0.0055]
                ]
              },
              {
                x: 0.3,
                z: 0.372,
                v: 'sparse',
                cols: [
                  [0.3, 0.372, 0.0055]
                ]
              },
              {
                x: 0.268,
                z: 0.428,
                v: 'dry',
                cols: [
                  [0.268, 0.428, 0.0055]
                ]
              },
              {
                x: 0.301,
                z: 0.506,
                v: 'scraggly',
                cols: [
                  [0.301, 0.506, 0.0055]
                ]
              },
              {
                x: 0.155,
                z: 0.547,
                v: 'scraggly',
                cols: [
                  [0.155, 0.547, 0.0055]
                ]
              },
              {
                x: 0.27,
                z: 0.504,
                v: 'scraggly',
                cols: [
                  [0.27, 0.504, 0.0055]
                ]
              },
              {
                x: 0.195,
                z: 0.447,
                v: 'sparse',
                cols: [
                  [0.195, 0.447, 0.0055]
                ]
              },
              {
                x: 0.652,
                z: 0.57,
                v: 'bare',
                cols: [
                  [0.652, 0.57, 0.0055]
                ]
              },
              {
                x: 0.613,
                z: 0.467,
                v: 'dry',
                cols: [
                  [0.613, 0.467, 0.0055]
                ]
              },
              {
                x: 0.66,
                z: 0.551,
                v: 'sparse',
                cols: [
                  [0.66, 0.551, 0.0055]
                ]
              },
              {
                x: 0.67,
                z: 0.591,
                v: 'sparse',
                cols: [
                  [0.67, 0.591, 0.0055]
                ]
              },
              {
                x: 0.67,
                z: 0.609,
                v: 'sparse',
                cols: [
                  [0.67, 0.609, 0.0055]
                ]
              },
              {
                x: 0.644,
                z: 0.557,
                v: 'dry',
                cols: [
                  [0.644, 0.557, 0.0055]
                ]
              },
              {
                x: 0.716,
                z: 0.55,
                v: 'sparse',
                cols: [
                  [0.716, 0.55, 0.0055]
                ]
              },
              {
                x: 0.588,
                z: 0.578,
                v: 'scraggly',
                cols: [
                  [0.588, 0.578, 0.0055]
                ]
              }
            ],
            rocks: [
              {
                x: 0.038,
                z: 0.342,
                rotY: 6.2,
                scale: 0.7,
                cols: [
                  [0.038, 0.342, 0.0105]
                ]
              },
              {
                x: 0.015,
                z: 0.944,
                rotY: 2.5,
                scale: 0.87,
                cols: [
                  [0.015, 0.944, 0.013]
                ]
              },
              {
                x: 0.243,
                z: 0.583,
                rotY: 5.5,
                scale: 0.69,
                cols: [
                  [0.243, 0.583, 0.0103]
                ]
              },
              {
                x: 0.84,
                z: 0.792,
                rotY: 1.4,
                scale: 0.74,
                cols: [
                  [0.84, 0.792, 0.0111]
                ]
              },
              {
                x: 0.452,
                z: 0.32,
                rotY: 4.3,
                scale: 0.61,
                cols: [
                  [0.452, 0.32, 0.0092]
                ]
              },
              {
                x: 0.619,
                z: 0.015,
                rotY: 2.6,
                scale: 0.78,
                cols: [
                  [0.619, 0.015, 0.0117]
                ]
              },
              {
                x: 0.529,
                z: 0.197,
                rotY: 4.6,
                scale: 0.89,
                cols: [
                  [0.529, 0.197, 0.0133]
                ]
              },
              {
                x: 0.17,
                z: 0.716,
                rotY: 2.2,
                scale: 0.86,
                cols: [
                  [0.17, 0.716, 0.0129]
                ]
              },
              {
                x: 0.144,
                z: 0.161,
                rotY: 0.8,
                scale: 0.72,
                cols: [
                  [0.144, 0.161, 0.0108]
                ]
              },
              {
                x: 0.666,
                z: 0.919,
                rotY: 2.2,
                scale: 0.6,
                cols: [
                  [0.666, 0.919, 0.009]
                ]
              },
              {
                x: 0.507,
                z: 0.029,
                rotY: 2.6,
                scale: 0.63,
                cols: [
                  [0.507, 0.029, 0.0095]
                ]
              },
              {
                x: 0.898,
                z: 0.048,
                rotY: 2.6,
                scale: 0.74,
                cols: [
                  [0.898, 0.048, 0.0111]
                ]
              },
              {
                x: 0.666,
                z: 0.371,
                rotY: 0.6,
                scale: 0.63,
                cols: [
                  [0.666, 0.371, 0.0095]
                ]
              },
              {
                x: 0.107,
                z: 0.717,
                rotY: 0.1,
                scale: 0.75,
                cols: [
                  [0.107, 0.717, 0.0112]
                ]
              }
            ],
            sticks: [],
            minables: [
              {
                material: 'crystal',
                x: 0.677,
                z: 0.689,
                cubes: [
                  {dx:-0.016,dz:0.044,sx:0.12,sy:0.2,sz:0.17,rotY:0.3,rotZ:-0.01},
                  {dx:0.002,dz:0.011,sx:0.1,sy:0.16,sz:0.16,rotY:0.2,rotZ:0.09},
                  {dx:-0.008,dz:-0.028,sx:0.31,sy:0.17,sz:0.2,rotY:4.9,rotZ:0.07},
                  {dx:-0.037,dz:-0.049,sx:0.16,sy:0.12,sz:0.14,rotY:0.8,rotZ:0.12},
                  {dx:0.023,dz:-0.025,sx:0.17,sy:0.16,sz:0.16,rotY:2.1,rotZ:-0.08},
                  {dx:-0.004,dz:-0.058,sx:0.12,sy:0.27,sz:0.12,rotY:0.7,rotZ:-0.14},
                  {dx:-0.032,dz:0.043,sx:0.17,sy:0.2,sz:0.23,rotY:1.5,rotZ:0.22},
                  {dx:-0.011,dz:-0.016,sx:0.22,sy:0.19,sz:0.17,rotY:2,rotZ:-0.08}
                ],
                colliders: [
                  {dx:0.002,dz:0.011,r:0.0112},
                  {dx:-0.015,dz:-0.038,r:0.0227},
                  {dx:0.023,dz:-0.025,r:0.0119},
                  {dx:-0.024,dz:0.044,r:0.012},
                  {dx:-0.037,dz:-0.049,r:0.0112}
                ]
              },
              {
                material: 'crystal',
                x: 0.902,
                z: 0.88,
                cubes: [
                  {dx:-0.011,dz:-0.017,sx:0.28,sy:0.17,sz:0.17,rotY:5.5,rotZ:-0.07},
                  {dx:0.017,dz:-0.002,sx:0.25,sy:0.28,sz:0.14,rotY:4.3,rotZ:0.12},
                  {dx:-0.011,dz:0.014,sx:0.24,sy:0.16,sz:0.2,rotY:0.6,rotZ:-0.17},
                  {dx:-0.025,dz:-0.015,sx:0.18,sy:0.17,sz:0.13,rotY:2.5,rotZ:-0.1},
                  {dx:-0.054,dz:0.043,sx:0.24,sy:0.26,sz:0.23,rotY:4.9,rotZ:-0.21},
                  {dx:0.006,dz:-0.056,sx:0.28,sy:0.19,sz:0.16,rotY:1.1,rotZ:-0.25},
                  {dx:0.061,dz:0.026,sx:0.22,sy:0.28,sz:0.12,rotY:4.4,rotZ:0.24},
                  {dx:-0.06,dz:0.001,sx:0.23,sy:0.17,sz:0.16,rotY:4.2,rotZ:-0.21},
                  {dx:-0.03,dz:0.047,sx:0.26,sy:0.17,sz:0.24,rotY:2.9,rotZ:-0.17},
                  {dx:-0.044,dz:-0.053,sx:0.24,sy:0.16,sz:0.23,rotY:2.6,rotZ:-0.25},
                  {dx:-0.007,dz:0.001,sx:0.24,sy:0.26,sz:0.22,rotY:5.7,rotZ:0.2},
                  {dx:0.027,dz:0.064,sx:0.24,sy:0.23,sz:0.16,rotY:0.8,rotZ:-0.27},
                  {dx:0.053,dz:-0.055,sx:0.32,sy:0.16,sz:0.23,rotY:1.1,rotZ:0.21}
                ],
                colliders: [
                  {dx:0.006,dz:-0.024,r:0.0509},
                  {dx:-0.039,dz:0.026,r:0.0308},
                  {dx:0.044,dz:0.045,r:0.0254},
                  {dx:-0.044,dz:-0.053,r:0.0168},
                  {dx:-0.06,dz:0.001,r:0.0161},
                  {dx:0.053,dz:-0.055,r:0.0224}
                ]
              },
              {
                material: 'crystal',
                x: 0.907,
                z: 0.286,
                cubes: [
                  {dx:-0.037,dz:0.035,sx:0.23,sy:0.12,sz:0.15,rotY:1.9,rotZ:-0.15},
                  {dx:0.062,dz:-0.003,sx:0.3,sy:0.18,sz:0.18,rotY:0.3,rotZ:-0.24},
                  {dx:-0.012,dz:0.034,sx:0.14,sy:0.18,sz:0.24,rotY:2.6,rotZ:0.26},
                  {dx:-0.059,dz:0.005,sx:0.27,sy:0.19,sz:0.2,rotY:2.4,rotZ:0.21},
                  {dx:0.03,dz:0.008,sx:0.27,sy:0.21,sz:0.13,rotY:4.9,rotZ:-0.18},
                  {dx:-0.006,dz:-0.012,sx:0.23,sy:0.19,sz:0.19,rotY:0.2,rotZ:0.22},
                  {dx:-0.006,dz:0.017,sx:0.22,sy:0.27,sz:0.2,rotY:1.1,rotZ:0.22},
                  {dx:0.011,dz:0.015,sx:0.2,sy:0.19,sz:0.14,rotY:5.9,rotZ:0.06},
                  {dx:-0.011,dz:0.015,sx:0.11,sy:0.21,sz:0.22,rotY:4.6,rotZ:-0.17},
                  {dx:0.008,dz:-0.005,sx:0.32,sy:0.19,sz:0.21,rotY:4.8,rotZ:0.12},
                  {dx:-0.049,dz:0.043,sx:0.31,sy:0.13,sz:0.14,rotY:2,rotZ:0.23},
                  {dx:0.027,dz:0.055,sx:0.13,sy:0.13,sz:0.19,rotY:3.3,rotZ:-0.05},
                  {dx:-0.05,dz:0,sx:0.11,sy:0.18,sz:0.19,rotY:2.7,rotZ:0.19},
                  {dx:0.036,dz:-0.024,sx:0.27,sy:0.25,sz:0.17,rotY:0.6,rotZ:0.26},
                  {dx:-0.057,dz:-0.018,sx:0.26,sy:0.22,sz:0.18,rotY:5.1,rotZ:-0.07}
                ],
                colliders: [
                  {dx:-0.033,dz:0.037,r:0.022},
                  {dx:-0.055,dz:-0.004,r:0.0172},
                  {dx:0.016,dz:0.001,r:0.0429},
                  {dx:0.027,dz:0.055,r:0.0133},
                  {dx:0.062,dz:-0.003,r:0.021}
                ]
              }
            ]
          }
        },
        {
          id: 'rock_7',
          seed: 701,
          terrain: {
            hills: [
              {x:0.67,z:0.51,radius:0.34,height:0.3},
              {x:0.93,z:0,radius:0.33,height:0.68},
              {x:0.23,z:0.16,radius:0.21,height:0.4},
              {x:0.64,z:0.56,radius:0.33,height:0.53},
              {x:0.48,z:0.99,radius:0.26,height:0.21},
              {x:0.87,z:0.13,radius:0.29,height:0.46},
              {x:0.66,z:0.56,radius:0.33,height:0.38},
              {x:0.6,z:0.29,radius:0.37,height:0.5},
              {x:1,z:0.83,radius:0.33,height:0.12},
              {x:0.07,z:0.4,radius:0.22,height:0.68},
              {x:0.37,z:0.5,radius:0.33,height:0.41},
              {x:0.85,z:0.56,radius:0.33,height:0.34},
              {x:0.8,z:0.15,radius:0.35,height:0.59}
            ]
          },
          items: {
            trees: [
              {
                x: 0.544,
                z: 0.706,
                v: 'scraggly',
                cols: [
                  [0.544, 0.706, 0.0055]
                ]
              },
              {
                x: 0.496,
                z: 0.659,
                v: 'scraggly',
                cols: [
                  [0.496, 0.659, 0.0055]
                ]
              },
              {
                x: 0.475,
                z: 0.675,
                v: 'dry',
                cols: [
                  [0.475, 0.675, 0.0055]
                ]
              },
              {
                x: 0.457,
                z: 0.673,
                v: 'bare',
                cols: [
                  [0.457, 0.673, 0.0055]
                ]
              },
              {
                x: 0.531,
                z: 0.641,
                v: 'bare',
                cols: [
                  [0.531, 0.641, 0.0055]
                ]
              },
              {
                x: 0.399,
                z: 0.716,
                v: 'dry',
                cols: [
                  [0.399, 0.716, 0.0055]
                ]
              },
              {
                x: 0.558,
                z: 0.556,
                v: 'scraggly',
                cols: [
                  [0.558, 0.556, 0.0055]
                ]
              },
              {
                x: 0.45,
                z: 0.693,
                v: 'dry',
                cols: [
                  [0.45, 0.693, 0.0055]
                ]
              },
              {
                x: 0.934,
                z: 0.962,
                v: 'bare',
                cols: [
                  [0.934, 0.962, 0.0055]
                ]
              },
              {
                x: 0.937,
                z: 0.986,
                v: 'dry',
                cols: [
                  [0.937, 0.986, 0.0055]
                ]
              },
              {
                x: 0.969,
                z: 0.969,
                v: 'sparse',
                cols: [
                  [0.969, 0.969, 0.0055]
                ]
              },
              {
                x: 0.983,
                z: 0.956,
                v: 'scraggly',
                cols: [
                  [0.983, 0.956, 0.0055]
                ]
              },
              {
                x: 0.862,
                z: 0.939,
                v: 'scraggly',
                cols: [
                  [0.862, 0.939, 0.0055]
                ]
              },
              {
                x: 0.918,
                z: 0.971,
                v: 'bare',
                cols: [
                  [0.918, 0.971, 0.0055]
                ]
              },
              {
                x: 0.747,
                z: 0.661,
                v: 'scraggly',
                cols: [
                  [0.747, 0.661, 0.0055]
                ]
              },
              {
                x: 0.778,
                z: 0.644,
                v: 'dry',
                cols: [
                  [0.778, 0.644, 0.0055]
                ]
              },
              {
                x: 0.8,
                z: 0.684,
                v: 'scraggly',
                cols: [
                  [0.8, 0.684, 0.0055]
                ]
              },
              {
                x: 0.799,
                z: 0.642,
                v: 'scraggly',
                cols: [
                  [0.799, 0.642, 0.0055]
                ]
              },
              {
                x: 0.709,
                z: 0.729,
                v: 'scraggly',
                cols: [
                  [0.709, 0.729, 0.0055]
                ]
              },
              {
                x: 0.769,
                z: 0.742,
                v: 'scraggly',
                cols: [
                  [0.769, 0.742, 0.0055]
                ]
              },
              {
                x: 0.739,
                z: 0.634,
                v: 'dry',
                cols: [
                  [0.739, 0.634, 0.0055]
                ]
              },
              {
                x: 0.737,
                z: 0.873,
                v: 'sparse',
                cols: [
                  [0.737, 0.873, 0.0055]
                ]
              },
              {
                x: 0.752,
                z: 0.822,
                v: 'bare',
                cols: [
                  [0.752, 0.822, 0.0055]
                ]
              },
              {
                x: 0.767,
                z: 0.717,
                v: 'sparse',
                cols: [
                  [0.767, 0.717, 0.0055]
                ]
              },
              {
                x: 0.702,
                z: 0.857,
                v: 'scraggly',
                cols: [
                  [0.702, 0.857, 0.0055]
                ]
              },
              {
                x: 0.606,
                z: 0.592,
                v: 'scraggly',
                cols: [
                  [0.606, 0.592, 0.0055]
                ]
              },
              {
                x: 0.662,
                z: 0.608,
                v: 'scraggly',
                cols: [
                  [0.662, 0.608, 0.0055]
                ]
              },
              {
                x: 0.566,
                z: 0.703,
                v: 'scraggly',
                cols: [
                  [0.566, 0.703, 0.0055]
                ]
              },
              {
                x: 0.676,
                z: 0.659,
                v: 'bare',
                cols: [
                  [0.676, 0.659, 0.0055]
                ]
              },
              {
                x: 0.545,
                z: 0.662,
                v: 'dry',
                cols: [
                  [0.545, 0.662, 0.0055]
                ]
              },
              {
                x: 0.661,
                z: 0.557,
                v: 'sparse',
                cols: [
                  [0.661, 0.557, 0.0055]
                ]
              },
              {
                x: 0.683,
                z: 0.671,
                v: 'sparse',
                cols: [
                  [0.683, 0.671, 0.0055]
                ]
              },
              {
                x: 0.627,
                z: 0.737,
                v: 'sparse',
                cols: [
                  [0.627, 0.737, 0.0055]
                ]
              },
              {
                x: 0.65,
                z: 0.557,
                v: 'bare',
                cols: [
                  [0.65, 0.557, 0.0055]
                ]
              },
              {
                x: 0.704,
                z: 0.626,
                v: 'dry',
                cols: [
                  [0.704, 0.626, 0.0055]
                ]
              },
              {
                x: 0.634,
                z: 0.625,
                v: 'dry',
                cols: [
                  [0.634, 0.625, 0.0055]
                ]
              },
              {
                x: 0.597,
                z: 0.692,
                v: 'dry',
                cols: [
                  [0.597, 0.692, 0.0055]
                ]
              },
              {
                x: 0.748,
                z: 0.643,
                v: 'bare',
                cols: [
                  [0.748, 0.643, 0.0055]
                ]
              },
              {
                x: 0.651,
                z: 0.633,
                v: 'sparse',
                cols: [
                  [0.651, 0.633, 0.0055]
                ]
              },
              {
                x: 0.617,
                z: 0.709,
                v: 'scraggly',
                cols: [
                  [0.617, 0.709, 0.0055]
                ]
              },
              {
                x: 0.725,
                z: 0.726,
                v: 'bare',
                cols: [
                  [0.725, 0.726, 0.0055]
                ]
              },
              {
                x: 0.574,
                z: 0.661,
                v: 'bare',
                cols: [
                  [0.574, 0.661, 0.0055]
                ]
              },
              {
                x: 0.214,
                z: 0.87,
                v: 'dry',
                cols: [
                  [0.214, 0.87, 0.0055]
                ]
              },
              {
                x: 0.203,
                z: 0.888,
                v: 'scraggly',
                cols: [
                  [0.203, 0.888, 0.0055]
                ]
              },
              {
                x: 0.227,
                z: 0.877,
                v: 'sparse',
                cols: [
                  [0.227, 0.877, 0.0055]
                ]
              },
              {
                x: 0.14,
                z: 0.897,
                v: 'sparse',
                cols: [
                  [0.14, 0.897, 0.0055]
                ]
              },
              {
                x: 0.153,
                z: 0.961,
                v: 'scraggly',
                cols: [
                  [0.153, 0.961, 0.0055]
                ]
              },
              {
                x: 0.242,
                z: 0.873,
                v: 'bare',
                cols: [
                  [0.242, 0.873, 0.0055]
                ]
              },
              {
                x: 0.19,
                z: 0.843,
                v: 'scraggly',
                cols: [
                  [0.19, 0.843, 0.0055]
                ]
              },
              {
                x: 0.228,
                z: 0.823,
                v: 'dry',
                cols: [
                  [0.228, 0.823, 0.0055]
                ]
              },
              {
                x: 0.254,
                z: 0.898,
                v: 'scraggly',
                cols: [
                  [0.254, 0.898, 0.0055]
                ]
              },
              {
                x: 0.27,
                z: 0.795,
                v: 'scraggly',
                cols: [
                  [0.27, 0.795, 0.0055]
                ]
              },
              {
                x: 0.179,
                z: 0.949,
                v: 'dry',
                cols: [
                  [0.179, 0.949, 0.0055]
                ]
              },
              {
                x: 0.595,
                z: 0.926,
                v: 'bare',
                cols: [
                  [0.595, 0.926, 0.0055]
                ]
              },
              {
                x: 0.593,
                z: 0.878,
                v: 'sparse',
                cols: [
                  [0.593, 0.878, 0.0055]
                ]
              },
              {
                x: 0.65,
                z: 0.801,
                v: 'sparse',
                cols: [
                  [0.65, 0.801, 0.0055]
                ]
              },
              {
                x: 0.511,
                z: 0.885,
                v: 'scraggly',
                cols: [
                  [0.511, 0.885, 0.0055]
                ]
              },
              {
                x: 0.63,
                z: 0.97,
                v: 'scraggly',
                cols: [
                  [0.63, 0.97, 0.0055]
                ]
              },
              {
                x: 0.478,
                z: 0.888,
                v: 'sparse',
                cols: [
                  [0.478, 0.888, 0.0055]
                ]
              },
              {
                x: 0.51,
                z: 0.854,
                v: 'bare',
                cols: [
                  [0.51, 0.854, 0.0055]
                ]
              },
              {
                x: 0.516,
                z: 0.866,
                v: 'scraggly',
                cols: [
                  [0.516, 0.866, 0.0055]
                ]
              },
              {
                x: 0.532,
                z: 0.93,
                v: 'sparse',
                cols: [
                  [0.532, 0.93, 0.0055]
                ]
              },
              {
                x: 0.598,
                z: 0.955,
                v: 'scraggly',
                cols: [
                  [0.598, 0.955, 0.0055]
                ]
              },
              {
                x: 0.583,
                z: 0.851,
                v: 'dry',
                cols: [
                  [0.583, 0.851, 0.0055]
                ]
              }
            ],
            rocks: [
              {
                x: 0.143,
                z: 0.215,
                rotY: 2.7,
                scale: 0.71,
                cols: [
                  [0.143, 0.215, 0.0106]
                ]
              },
              {
                x: 0.072,
                z: 0.272,
                rotY: 0.3,
                scale: 0.96,
                cols: [
                  [0.072, 0.272, 0.0144]
                ]
              },
              {
                x: 0.126,
                z: 0.747,
                rotY: 2.6,
                scale: 0.74,
                cols: [
                  [0.126, 0.747, 0.0111]
                ]
              },
              {
                x: 0.787,
                z: 0.963,
                rotY: 5.3,
                scale: 0.67,
                cols: [
                  [0.787, 0.963, 0.01]
                ]
              },
              {
                x: 0.333,
                z: 0.933,
                rotY: 0.5,
                scale: 0.68,
                cols: [
                  [0.333, 0.933, 0.0102]
                ]
              },
              {
                x: 0.529,
                z: 0.308,
                rotY: 4.2,
                scale: 0.97,
                cols: [
                  [0.529, 0.308, 0.0145]
                ]
              },
              {
                x: 0.474,
                z: 0.677,
                rotY: 5.3,
                scale: 0.93,
                cols: [
                  [0.474, 0.677, 0.014]
                ]
              },
              {
                x: 0.728,
                z: 0.026,
                rotY: 0.1,
                scale: 0.71,
                cols: [
                  [0.728, 0.026, 0.0106]
                ]
              },
              {
                x: 0.104,
                z: 0.449,
                rotY: 6.2,
                scale: 0.73,
                cols: [
                  [0.104, 0.449, 0.0109]
                ]
              },
              {
                x: 0.781,
                z: 0.434,
                rotY: 2.4,
                scale: 0.73,
                cols: [
                  [0.781, 0.434, 0.0109]
                ]
              }
            ],
            sticks: [],
            minables: [
              {
                material: 'crystal',
                x: 0.338,
                z: 0.211,
                cubes: [
                  {dx:0.042,dz:0.017,sx:0.22,sy:0.28,sz:0.15,rotY:4.5,rotZ:0.27},
                  {dx:-0.049,dz:0.012,sx:0.21,sy:0.23,sz:0.19,rotY:3.7,rotZ:-0.13},
                  {dx:-0.033,dz:-0.024,sx:0.17,sy:0.19,sz:0.15,rotY:2.4,rotZ:0.26},
                  {dx:-0.06,dz:-0.05,sx:0.2,sy:0.23,sz:0.13,rotY:5.6,rotZ:0.09},
                  {dx:0.002,dz:0.058,sx:0.12,sy:0.25,sz:0.23,rotY:0.2,rotZ:-0.21},
                  {dx:0.024,dz:-0.055,sx:0.28,sy:0.13,sz:0.12,rotY:5,rotZ:-0.24},
                  {dx:0.001,dz:-0.004,sx:0.25,sy:0.16,sz:0.12,rotY:3.1,rotZ:0.22},
                  {dx:-0.008,dz:0.044,sx:0.2,sy:0.27,sz:0.16,rotY:5.7,rotZ:-0.27},
                  {dx:0.03,dz:-0.06,sx:0.22,sy:0.2,sz:0.18,rotY:3.1,rotZ:-0.21},
                  {dx:0.004,dz:-0.05,sx:0.16,sy:0.22,sz:0.21,rotY:6.2,rotZ:-0.27},
                  {dx:-0.033,dz:0.033,sx:0.2,sy:0.19,sz:0.1,rotY:4.3,rotZ:0.25},
                  {dx:-0.053,dz:-0.02,sx:0.25,sy:0.14,sz:0.14,rotY:2.7,rotZ:-0.07},
                  {dx:-0.049,dz:-0.028,sx:0.23,sy:0.16,sz:0.12,rotY:5,rotZ:-0.14},
                  {dx:0.065,dz:0.062,sx:0.2,sy:0.19,sz:0.18,rotY:1.7,rotZ:-0.07},
                  {dx:-0.025,dz:-0.048,sx:0.21,sy:0.17,sz:0.11,rotY:6,rotZ:-0.19}
                ],
                colliders: [
                  {dx:0.032,dz:-0.008,r:0.0632},
                  {dx:-0.027,dz:-0.049,r:0.03},
                  {dx:-0.013,dz:0.045,r:0.0227},
                  {dx:-0.046,dz:-0.015,r:0.0259},
                  {dx:-0.049,dz:0.012,r:0.0147},
                  {dx:-0.06,dz:-0.05,r:0.014},
                  {dx:0.065,dz:0.062,r:0.014}
                ]
              },
              {
                material: 'crystal',
                x: 0.502,
                z: 0.724,
                cubes: [
                  {dx:-0.041,dz:0.046,sx:0.28,sy:0.27,sz:0.18,rotY:1.7,rotZ:-0.13},
                  {dx:-0.03,dz:0.04,sx:0.2,sy:0.24,sz:0.11,rotY:2,rotZ:0.17},
                  {dx:0.025,dz:0.064,sx:0.23,sy:0.13,sz:0.14,rotY:1.2,rotZ:0.27},
                  {dx:-0.014,dz:0.02,sx:0.26,sy:0.14,sz:0.23,rotY:3.8,rotZ:-0.25},
                  {dx:0.035,dz:0.003,sx:0.16,sy:0.25,sz:0.19,rotY:2.3,rotZ:0.06},
                  {dx:-0.024,dz:-0.015,sx:0.24,sy:0.25,sz:0.16,rotY:1.2,rotZ:0.28},
                  {dx:0.015,dz:0.026,sx:0.12,sy:0.26,sz:0.18,rotY:4.9,rotZ:0.07},
                  {dx:-0.035,dz:-0.056,sx:0.22,sy:0.22,sz:0.14,rotY:4,rotZ:0.05},
                  {dx:-0.026,dz:-0.024,sx:0.24,sy:0.23,sz:0.16,rotY:1.7,rotZ:0.24},
                  {dx:0.059,dz:-0.038,sx:0.14,sy:0.12,sz:0.17,rotY:3.8,rotZ:0.06},
                  {dx:-0.061,dz:-0.05,sx:0.21,sy:0.15,sz:0.23,rotY:4,rotZ:-0.05},
                  {dx:-0.037,dz:-0.002,sx:0.16,sy:0.27,sz:0.18,rotY:2.4,rotZ:0.03}
                ],
                colliders: [
                  {dx:-0.028,dz:0.035,r:0.0226},
                  {dx:-0.037,dz:-0.029,r:0.03},
                  {dx:0.025,dz:0.031,r:0.0308},
                  {dx:0.059,dz:-0.038,r:0.0119},
                  {dx:0.025,dz:0.064,r:0.0161},
                  {dx:-0.061,dz:-0.05,r:0.0161}
                ]
              },
              {
                material: 'crystal',
                x: 0.833,
                z: 0.763,
                cubes: [
                  {dx:-0.002,dz:-0.018,sx:0.13,sy:0.27,sz:0.14,rotY:0.9,rotZ:0.17},
                  {dx:0.063,dz:-0.009,sx:0.16,sy:0.25,sz:0.18,rotY:3.4,rotZ:0.18},
                  {dx:0.065,dz:0.041,sx:0.2,sy:0.26,sz:0.24,rotY:6.1,rotZ:-0.15},
                  {dx:-0.03,dz:0.023,sx:0.17,sy:0.26,sz:0.17,rotY:3.7,rotZ:0.03},
                  {dx:-0.025,dz:-0.014,sx:0.32,sy:0.14,sz:0.13,rotY:1.3,rotZ:0.06},
                  {dx:-0.061,dz:0.034,sx:0.29,sy:0.27,sz:0.23,rotY:2.9,rotZ:0.08},
                  {dx:-0.023,dz:-0.055,sx:0.32,sy:0.27,sz:0.24,rotY:0.7,rotZ:0.18},
                  {dx:-0.006,dz:-0.008,sx:0.15,sy:0.12,sz:0.21,rotY:2.4,rotZ:-0.17}
                ],
                colliders: [
                  {dx:-0.011,dz:-0.013,r:0.0189},
                  {dx:0.064,dz:0.016,r:0.0251},
                  {dx:-0.045,dz:0.029,r:0.0199},
                  {dx:-0.023,dz:-0.055,r:0.0224}
                ]
              },
              {
                material: 'crystal',
                x: 0.817,
                z: 0.141,
                cubes: [
                  {dx:0.02,dz:-0.016,sx:0.19,sy:0.21,sz:0.2,rotY:0.4,rotZ:-0.17},
                  {dx:-0.036,dz:-0.055,sx:0.12,sy:0.16,sz:0.12,rotY:3.7,rotZ:-0.21},
                  {dx:0.051,dz:0.038,sx:0.27,sy:0.15,sz:0.11,rotY:5.6,rotZ:-0.19},
                  {dx:0,dz:-0.059,sx:0.17,sy:0.21,sz:0.1,rotY:3.9,rotZ:-0.1},
                  {dx:0.027,dz:-0.025,sx:0.23,sy:0.17,sz:0.23,rotY:4.8,rotZ:0.22},
                  {dx:-0.039,dz:0.026,sx:0.16,sy:0.14,sz:0.11,rotY:1.1,rotZ:-0.11},
                  {dx:0.034,dz:-0.061,sx:0.17,sy:0.2,sz:0.15,rotY:0.3,rotZ:0.1},
                  {dx:-0.049,dz:-0.024,sx:0.31,sy:0.26,sz:0.22,rotY:4.9,rotZ:0.23},
                  {dx:-0.051,dz:0.065,sx:0.26,sy:0.26,sz:0.16,rotY:3.5,rotZ:-0.27},
                  {dx:-0.007,dz:0.038,sx:0.21,sy:0.22,sz:0.13,rotY:2.6,rotZ:0.25},
                  {dx:0.06,dz:0.065,sx:0.13,sy:0.17,sz:0.13,rotY:1.9,rotZ:-0.08},
                  {dx:0.047,dz:-0.045,sx:0.16,sy:0.15,sz:0.15,rotY:4.4,rotZ:0.25},
                  {dx:0.004,dz:-0.049,sx:0.3,sy:0.16,sz:0.22,rotY:4,rotZ:-0.08},
                  {dx:0.019,dz:0.047,sx:0.15,sy:0.12,sz:0.2,rotY:6.3,rotZ:-0.23}
                ],
                colliders: [
                  {dx:0.032,dz:-0.037,r:0.0232},
                  {dx:-0.02,dz:-0.047,r:0.0356},
                  {dx:-0.032,dz:0.043,r:0.0285},
                  {dx:0.043,dz:0.05,r:0.0236},
                  {dx:-0.049,dz:-0.024,r:0.0217}
                ]
              }
            ]
          }
        },
        {
          id: 'rock_8',
          seed: 801,
          terrain: {
            hills: [
              {x:0,z:0.25,radius:0.34,height:0.59},
              {x:0.25,z:0.71,radius:0.32,height:0.21},
              {x:0.94,z:0.7,radius:0.36,height:0.22},
              {x:0.65,z:0.6,radius:0.37,height:0.43},
              {x:0.44,z:0.98,radius:0.28,height:0.13},
              {x:0.83,z:0.66,radius:0.4,height:0.28},
              {x:0.87,z:0.82,radius:0.38,height:0.23},
              {x:0.15,z:0.28,radius:0.37,height:0.69},
              {x:0.91,z:0.56,radius:0.28,height:0.27},
              {x:0.11,z:0.05,radius:0.25,height:0.69},
              {x:0.32,z:0.14,radius:0.26,height:0.67},
              {x:0.7,z:0.38,radius:0.34,height:0.47},
              {x:0.76,z:0.56,radius:0.38,height:0.29}
            ]
          },
          items: {
            trees: [
              {
                x: 0.88,
                z: 0.036,
                v: 'bare',
                cols: [
                  [0.88, 0.036, 0.0055]
                ]
              },
              {
                x: 0.921,
                z: 0.01,
                v: 'sparse',
                cols: [
                  [0.921, 0.01, 0.0055]
                ]
              },
              {
                x: 0.958,
                z: 0.085,
                v: 'sparse',
                cols: [
                  [0.958, 0.085, 0.0055]
                ]
              },
              {
                x: 0.836,
                z: 0.081,
                v: 'dry',
                cols: [
                  [0.836, 0.081, 0.0055]
                ]
              },
              {
                x: 0.908,
                z: 0.038,
                v: 'scraggly',
                cols: [
                  [0.908, 0.038, 0.0055]
                ]
              },
              {
                x: 0.9,
                z: 0.15,
                v: 'scraggly',
                cols: [
                  [0.9, 0.15, 0.0055]
                ]
              },
              {
                x: 0.853,
                z: 0.244,
                v: 'dry',
                cols: [
                  [0.853, 0.244, 0.0055]
                ]
              },
              {
                x: 0.945,
                z: 0.07,
                v: 'scraggly',
                cols: [
                  [0.945, 0.07, 0.0055]
                ]
              },
              {
                x: 0.94,
                z: 0.057,
                v: 'bare',
                cols: [
                  [0.94, 0.057, 0.0055]
                ]
              },
              {
                x: 0.968,
                z: 0.099,
                v: 'sparse',
                cols: [
                  [0.968, 0.099, 0.0055]
                ]
              },
              {
                x: 0.928,
                z: 0.18,
                v: 'sparse',
                cols: [
                  [0.928, 0.18, 0.0055]
                ]
              },
              {
                x: 0.53,
                z: 0.504,
                v: 'scraggly',
                cols: [
                  [0.53, 0.504, 0.0055]
                ]
              },
              {
                x: 0.603,
                z: 0.516,
                v: 'dry',
                cols: [
                  [0.603, 0.516, 0.0055]
                ]
              },
              {
                x: 0.46,
                z: 0.609,
                v: 'scraggly',
                cols: [
                  [0.46, 0.609, 0.0055]
                ]
              },
              {
                x: 0.439,
                z: 0.598,
                v: 'scraggly',
                cols: [
                  [0.439, 0.598, 0.0055]
                ]
              },
              {
                x: 0.502,
                z: 0.575,
                v: 'sparse',
                cols: [
                  [0.502, 0.575, 0.0055]
                ]
              },
              {
                x: 0.506,
                z: 0.518,
                v: 'bare',
                cols: [
                  [0.506, 0.518, 0.0055]
                ]
              },
              {
                x: 0.506,
                z: 0.555,
                v: 'sparse',
                cols: [
                  [0.506, 0.555, 0.0055]
                ]
              },
              {
                x: 0.559,
                z: 0.575,
                v: 'scraggly',
                cols: [
                  [0.559, 0.575, 0.0055]
                ]
              },
              {
                x: 0.944,
                z: 0.171,
                v: 'scraggly',
                cols: [
                  [0.944, 0.171, 0.0055]
                ]
              },
              {
                x: 0.931,
                z: 0.085,
                v: 'dry',
                cols: [
                  [0.931, 0.085, 0.0055]
                ]
              },
              {
                x: 0.974,
                z: 0.077,
                v: 'scraggly',
                cols: [
                  [0.974, 0.077, 0.0055]
                ]
              },
              {
                x: 0.974,
                z: 0.065,
                v: 'sparse',
                cols: [
                  [0.974, 0.065, 0.0055]
                ]
              },
              {
                x: 0.957,
                z: 0.023,
                v: 'dry',
                cols: [
                  [0.957, 0.023, 0.0055]
                ]
              },
              {
                x: 0.895,
                z: 0.023,
                v: 'scraggly',
                cols: [
                  [0.895, 0.023, 0.0055]
                ]
              },
              {
                x: 0.957,
                z: 0.049,
                v: 'dry',
                cols: [
                  [0.957, 0.049, 0.0055]
                ]
              },
              {
                x: 0.977,
                z: 0.109,
                v: 'sparse',
                cols: [
                  [0.977, 0.109, 0.0055]
                ]
              },
              {
                x: 0.948,
                z: 0.142,
                v: 'sparse',
                cols: [
                  [0.948, 0.142, 0.0055]
                ]
              },
              {
                x: 0.531,
                z: 0.778,
                v: 'bare',
                cols: [
                  [0.531, 0.778, 0.0055]
                ]
              },
              {
                x: 0.446,
                z: 0.899,
                v: 'sparse',
                cols: [
                  [0.446, 0.899, 0.0055]
                ]
              },
              {
                x: 0.495,
                z: 0.834,
                v: 'sparse',
                cols: [
                  [0.495, 0.834, 0.0055]
                ]
              },
              {
                x: 0.503,
                z: 0.785,
                v: 'sparse',
                cols: [
                  [0.503, 0.785, 0.0055]
                ]
              },
              {
                x: 0.462,
                z: 0.768,
                v: 'dry',
                cols: [
                  [0.462, 0.768, 0.0055]
                ]
              },
              {
                x: 0.42,
                z: 0.903,
                v: 'dry',
                cols: [
                  [0.42, 0.903, 0.0055]
                ]
              },
              {
                x: 0.478,
                z: 0.808,
                v: 'dry',
                cols: [
                  [0.478, 0.808, 0.0055]
                ]
              },
              {
                x: 0.551,
                z: 0.869,
                v: 'sparse',
                cols: [
                  [0.551, 0.869, 0.0055]
                ]
              },
              {
                x: 0.542,
                z: 0.886,
                v: 'sparse',
                cols: [
                  [0.542, 0.886, 0.0055]
                ]
              },
              {
                x: 0.409,
                z: 0.759,
                v: 'bare',
                cols: [
                  [0.409, 0.759, 0.0055]
                ]
              },
              {
                x: 0.56,
                z: 0.27,
                v: 'sparse',
                cols: [
                  [0.56, 0.27, 0.0055]
                ]
              },
              {
                x: 0.556,
                z: 0.255,
                v: 'sparse',
                cols: [
                  [0.556, 0.255, 0.0055]
                ]
              },
              {
                x: 0.517,
                z: 0.304,
                v: 'sparse',
                cols: [
                  [0.517, 0.304, 0.0055]
                ]
              },
              {
                x: 0.517,
                z: 0.203,
                v: 'dry',
                cols: [
                  [0.517, 0.203, 0.0055]
                ]
              },
              {
                x: 0.535,
                z: 0.353,
                v: 'scraggly',
                cols: [
                  [0.535, 0.353, 0.0055]
                ]
              },
              {
                x: 0.525,
                z: 0.311,
                v: 'scraggly',
                cols: [
                  [0.525, 0.311, 0.0055]
                ]
              },
              {
                x: 0.468,
                z: 0.224,
                v: 'dry',
                cols: [
                  [0.468, 0.224, 0.0055]
                ]
              },
              {
                x: 0.489,
                z: 0.239,
                v: 'dry',
                cols: [
                  [0.489, 0.239, 0.0055]
                ]
              },
              {
                x: 0.492,
                z: 0.172,
                v: 'sparse',
                cols: [
                  [0.492, 0.172, 0.0055]
                ]
              },
              {
                x: 0.481,
                z: 0.182,
                v: 'dry',
                cols: [
                  [0.481, 0.182, 0.0055]
                ]
              },
              {
                x: 0.547,
                z: 0.265,
                v: 'sparse',
                cols: [
                  [0.547, 0.265, 0.0055]
                ]
              },
              {
                x: 0.306,
                z: 0.956,
                v: 'dry',
                cols: [
                  [0.306, 0.956, 0.0055]
                ]
              },
              {
                x: 0.303,
                z: 0.926,
                v: 'sparse',
                cols: [
                  [0.303, 0.926, 0.0055]
                ]
              },
              {
                x: 0.205,
                z: 0.962,
                v: 'bare',
                cols: [
                  [0.205, 0.962, 0.0055]
                ]
              },
              {
                x: 0.217,
                z: 0.964,
                v: 'scraggly',
                cols: [
                  [0.217, 0.964, 0.0055]
                ]
              },
              {
                x: 0.295,
                z: 0.986,
                v: 'sparse',
                cols: [
                  [0.295, 0.986, 0.0055]
                ]
              },
              {
                x: 0.3,
                z: 0.941,
                v: 'dry',
                cols: [
                  [0.3, 0.941, 0.0055]
                ]
              },
              {
                x: 0.281,
                z: 0.992,
                v: 'dry',
                cols: [
                  [0.281, 0.992, 0.0055]
                ]
              },
              {
                x: 0.317,
                z: 0.994,
                v: 'dry',
                cols: [
                  [0.317, 0.994, 0.0055]
                ]
              },
              {
                x: 0.328,
                z: 0.984,
                v: 'scraggly',
                cols: [
                  [0.328, 0.984, 0.0055]
                ]
              },
              {
                x: 0.39,
                z: 0.917,
                v: 'scraggly',
                cols: [
                  [0.39, 0.917, 0.0055]
                ]
              },
              {
                x: 0.413,
                z: 0.174,
                v: 'bare',
                cols: [
                  [0.413, 0.174, 0.0055]
                ]
              },
              {
                x: 0.506,
                z: 0.177,
                v: 'scraggly',
                cols: [
                  [0.506, 0.177, 0.0055]
                ]
              },
              {
                x: 0.48,
                z: 0.082,
                v: 'sparse',
                cols: [
                  [0.48, 0.082, 0.0055]
                ]
              },
              {
                x: 0.416,
                z: 0.142,
                v: 'dry',
                cols: [
                  [0.416, 0.142, 0.0055]
                ]
              },
              {
                x: 0.418,
                z: 0.122,
                v: 'sparse',
                cols: [
                  [0.418, 0.122, 0.0055]
                ]
              },
              {
                x: 0.398,
                z: 0.189,
                v: 'bare',
                cols: [
                  [0.398, 0.189, 0.0055]
                ]
              },
              {
                x: 0.467,
                z: 0.21,
                v: 'dry',
                cols: [
                  [0.467, 0.21, 0.0055]
                ]
              },
              {
                x: 0.429,
                z: 0.263,
                v: 'sparse',
                cols: [
                  [0.429, 0.263, 0.0055]
                ]
              },
              {
                x: 0.356,
                z: 0.155,
                v: 'scraggly',
                cols: [
                  [0.356, 0.155, 0.0055]
                ]
              },
              {
                x: 0.4,
                z: 0.159,
                v: 'sparse',
                cols: [
                  [0.4, 0.159, 0.0055]
                ]
              },
              {
                x: 0.727,
                z: 0.92,
                v: 'sparse',
                cols: [
                  [0.727, 0.92, 0.0055]
                ]
              },
              {
                x: 0.725,
                z: 0.964,
                v: 'dry',
                cols: [
                  [0.725, 0.964, 0.0055]
                ]
              },
              {
                x: 0.637,
                z: 0.902,
                v: 'bare',
                cols: [
                  [0.637, 0.902, 0.0055]
                ]
              },
              {
                x: 0.656,
                z: 0.935,
                v: 'dry',
                cols: [
                  [0.656, 0.935, 0.0055]
                ]
              },
              {
                x: 0.67,
                z: 0.882,
                v: 'bare',
                cols: [
                  [0.67, 0.882, 0.0055]
                ]
              },
              {
                x: 0.682,
                z: 0.991,
                v: 'bare',
                cols: [
                  [0.682, 0.991, 0.0055]
                ]
              },
              {
                x: 0.723,
                z: 0.985,
                v: 'sparse',
                cols: [
                  [0.723, 0.985, 0.0055]
                ]
              }
            ],
            rocks: [
              {
                x: 0.093,
                z: 0.714,
                rotY: 1.9,
                scale: 0.62,
                cols: [
                  [0.093, 0.714, 0.0093]
                ]
              },
              {
                x: 0.117,
                z: 0.413,
                rotY: 3.5,
                scale: 0.61,
                cols: [
                  [0.117, 0.413, 0.0092]
                ]
              },
              {
                x: 0.639,
                z: 0.626,
                rotY: 4,
                scale: 0.9,
                cols: [
                  [0.639, 0.626, 0.0135]
                ]
              },
              {
                x: 0.352,
                z: 0.324,
                rotY: 1.4,
                scale: 0.92,
                cols: [
                  [0.352, 0.324, 0.0138]
                ]
              },
              {
                x: 0.43,
                z: 0.899,
                rotY: 0.3,
                scale: 0.81,
                cols: [
                  [0.43, 0.899, 0.0122]
                ]
              },
              {
                x: 0.909,
                z: 0.22,
                rotY: 3.3,
                scale: 0.99,
                cols: [
                  [0.909, 0.22, 0.0148]
                ]
              },
              {
                x: 0.922,
                z: 0.278,
                rotY: 5.3,
                scale: 0.62,
                cols: [
                  [0.922, 0.278, 0.0093]
                ]
              },
              {
                x: 0.3,
                z: 0.111,
                rotY: 2.4,
                scale: 0.89,
                cols: [
                  [0.3, 0.111, 0.0133]
                ]
              },
              {
                x: 0.311,
                z: 0.97,
                rotY: 3.6,
                scale: 0.99,
                cols: [
                  [0.311, 0.97, 0.0148]
                ]
              },
              {
                x: 0.544,
                z: 0.932,
                rotY: 3.5,
                scale: 0.94,
                cols: [
                  [0.544, 0.932, 0.0141]
                ]
              },
              {
                x: 0.209,
                z: 0.402,
                rotY: 1.4,
                scale: 0.92,
                cols: [
                  [0.209, 0.402, 0.0138]
                ]
              },
              {
                x: 0.371,
                z: 0.215,
                rotY: 1.7,
                scale: 0.7,
                cols: [
                  [0.371, 0.215, 0.0105]
                ]
              },
              {
                x: 0.875,
                z: 0.294,
                rotY: 3.9,
                scale: 0.91,
                cols: [
                  [0.875, 0.294, 0.0137]
                ]
              }
            ],
            sticks: [],
            minables: [
              {
                material: 'crystal',
                x: 0.138,
                z: 0.708,
                cubes: [
                  {dx:-0.063,dz:-0.059,sx:0.32,sy:0.17,sz:0.16,rotY:2.7,rotZ:0.22},
                  {dx:-0.051,dz:-0.045,sx:0.19,sy:0.17,sz:0.16,rotY:2.3,rotZ:0.14},
                  {dx:0.026,dz:-0.051,sx:0.22,sy:0.22,sz:0.19,rotY:3.2,rotZ:0.13},
                  {dx:0.045,dz:0.021,sx:0.13,sy:0.22,sz:0.16,rotY:6.2,rotZ:0.08},
                  {dx:0.007,dz:-0.048,sx:0.24,sy:0.17,sz:0.13,rotY:0.8,rotZ:0.19},
                  {dx:-0.06,dz:0.018,sx:0.14,sy:0.28,sz:0.16,rotY:5.6,rotZ:-0.18},
                  {dx:-0.016,dz:0.056,sx:0.25,sy:0.21,sz:0.18,rotY:3.2,rotZ:-0.1},
                  {dx:0.02,dz:0.05,sx:0.23,sy:0.28,sz:0.11,rotY:5.5,rotZ:0.06},
                  {dx:0.062,dz:0.027,sx:0.15,sy:0.27,sz:0.21,rotY:0.2,rotZ:-0.03},
                  {dx:0.039,dz:-0.009,sx:0.21,sy:0.16,sz:0.13,rotY:5.2,rotZ:-0.08},
                  {dx:0.057,dz:0.04,sx:0.14,sy:0.19,sz:0.17,rotY:1.1,rotZ:-0.17}
                ],
                colliders: [
                  {dx:-0.057,dz:-0.052,r:0.0153},
                  {dx:0.017,dz:-0.049,r:0.0135},
                  {dx:-0.038,dz:0.037,r:0.0284},
                  {dx:0.045,dz:0.026,r:0.0319},
                  {dx:0.02,dz:0.05,r:0.0161},
                  {dx:0.039,dz:-0.009,r:0.0147}
                ]
              },
              {
                material: 'crystal',
                x: 0.412,
                z: 0.549,
                cubes: [
                  {dx:-0.052,dz:0.011,sx:0.25,sy:0.16,sz:0.22,rotY:3.1,rotZ:-0.02},
                  {dx:-0.017,dz:-0.007,sx:0.23,sy:0.2,sz:0.18,rotY:2.4,rotZ:0.12},
                  {dx:-0.031,dz:-0.032,sx:0.18,sy:0.24,sz:0.14,rotY:5,rotZ:-0.27},
                  {dx:0.038,dz:-0.003,sx:0.25,sy:0.13,sz:0.16,rotY:5.8,rotZ:0.03},
                  {dx:-0.032,dz:0.01,sx:0.15,sy:0.19,sz:0.15,rotY:6.2,rotZ:0.06},
                  {dx:0.059,dz:-0.05,sx:0.25,sy:0.25,sz:0.11,rotY:0.3,rotZ:0.07},
                  {dx:0.052,dz:0.029,sx:0.29,sy:0.19,sz:0.16,rotY:2.3,rotZ:0.11},
                  {dx:0.056,dz:0.018,sx:0.17,sy:0.17,sz:0.12,rotY:0.4,rotZ:-0.02},
                  {dx:0.056,dz:0.001,sx:0.11,sy:0.23,sz:0.22,rotY:5.1,rotZ:-0.14},
                  {dx:0.052,dz:-0.017,sx:0.1,sy:0.26,sz:0.23,rotY:4.8,rotZ:0.24},
                  {dx:0.056,dz:-0.02,sx:0.13,sy:0.19,sz:0.18,rotY:5.3,rotZ:-0.14},
                  {dx:0.033,dz:0.005,sx:0.16,sy:0.27,sz:0.21,rotY:2.9,rotZ:-0.24}
                ],
                colliders: [
                  {dx:-0.033,dz:-0.005,r:0.0254},
                  {dx:0.042,dz:0.001,r:0.016},
                  {dx:0.054,dz:0.024,r:0.012},
                  {dx:0.056,dz:-0.029,r:0.0225},
                  {dx:-0.031,dz:-0.032,r:0.0126}
                ]
              },
              {
                material: 'crystal',
                x: 0.873,
                z: 0.473,
                cubes: [
                  {dx:-0.053,dz:-0.035,sx:0.17,sy:0.23,sz:0.11,rotY:4,rotZ:-0.26},
                  {dx:-0.008,dz:-0.01,sx:0.13,sy:0.13,sz:0.23,rotY:2.3,rotZ:0.16},
                  {dx:0.031,dz:0.005,sx:0.27,sy:0.21,sz:0.18,rotY:1.7,rotZ:0.08},
                  {dx:-0.001,dz:0.02,sx:0.23,sy:0.23,sz:0.16,rotY:0.5,rotZ:0.1},
                  {dx:-0.018,dz:-0.046,sx:0.32,sy:0.2,sz:0.19,rotY:5.2,rotZ:-0.05},
                  {dx:0.062,dz:0.028,sx:0.25,sy:0.2,sz:0.19,rotY:3.4,rotZ:0.05},
                  {dx:0.061,dz:0.044,sx:0.32,sy:0.28,sz:0.21,rotY:2.4,rotZ:-0.09},
                  {dx:-0.058,dz:0.029,sx:0.16,sy:0.17,sz:0.16,rotY:3.2,rotZ:0.23},
                  {dx:-0.015,dz:0.032,sx:0.11,sy:0.23,sz:0.2,rotY:2.6,rotZ:-0.14},
                  {dx:0.057,dz:0.042,sx:0.15,sy:0.16,sz:0.19,rotY:2.5,rotZ:0.2},
                  {dx:-0.035,dz:-0.053,sx:0.16,sy:0.27,sz:0.23,rotY:5.7,rotZ:0.05},
                  {dx:0.055,dz:0.054,sx:0.14,sy:0.13,sz:0.12,rotY:2.4,rotZ:-0.14},
                  {dx:-0.022,dz:0.036,sx:0.18,sy:0.14,sz:0.15,rotY:0.7,rotZ:-0.08}
                ],
                colliders: [
                  {dx:-0.035,dz:-0.045,r:0.0214},
                  {dx:-0.021,dz:0.021,r:0.0327},
                  {dx:0.059,dz:0.042,r:0.0173},
                  {dx:0.031,dz:0.005,r:0.0189},
                  {dx:-0.058,dz:0.029,r:0.0112}
                ]
              },
              {
                material: 'crystal',
                x: 0.828,
                z: 0.771,
                cubes: [
                  {dx:-0.004,dz:-0.054,sx:0.14,sy:0.25,sz:0.12,rotY:1.9,rotZ:-0.23},
                  {dx:0.063,dz:0.04,sx:0.23,sy:0.14,sz:0.15,rotY:6.1,rotZ:0.08},
                  {dx:0.042,dz:0.039,sx:0.23,sy:0.27,sz:0.22,rotY:0.3,rotZ:0.14},
                  {dx:0.043,dz:0.017,sx:0.14,sy:0.16,sz:0.15,rotY:4.2,rotZ:0.13},
                  {dx:-0.046,dz:-0.053,sx:0.23,sy:0.14,sz:0.21,rotY:1.7,rotZ:0},
                  {dx:0.065,dz:0.026,sx:0.12,sy:0.14,sz:0.12,rotY:1.1,rotZ:0.27},
                  {dx:-0.048,dz:0.012,sx:0.27,sy:0.24,sz:0.12,rotY:3.4,rotZ:-0.17},
                  {dx:-0.064,dz:0.032,sx:0.3,sy:0.17,sz:0.14,rotY:2.7,rotZ:0.07},
                  {dx:0.006,dz:0.005,sx:0.29,sy:0.18,sz:0.13,rotY:1.7,rotZ:0.07},
                  {dx:0.055,dz:-0.021,sx:0.17,sy:0.21,sz:0.13,rotY:4.7,rotZ:0.23}
                ],
                colliders: [
                  {dx:-0.025,dz:-0.053,r:0.0218},
                  {dx:0.03,dz:0.02,r:0.0292},
                  {dx:0.061,dz:0.015,r:0.0318},
                  {dx:-0.056,dz:0.022,r:0.0175},
                  {dx:0.055,dz:-0.021,r:0.0119}
                ]
              },
              {
                material: 'crystal',
                x: 0.758,
                z: 0.111,
                cubes: [
                  {dx:0.044,dz:-0.06,sx:0.11,sy:0.25,sz:0.22,rotY:4.5,rotZ:0.02},
                  {dx:-0.029,dz:-0.031,sx:0.13,sy:0.22,sz:0.12,rotY:2,rotZ:-0.25},
                  {dx:0.013,dz:-0.021,sx:0.22,sy:0.14,sz:0.15,rotY:1.9,rotZ:0.27},
                  {dx:-0.026,dz:-0.037,sx:0.14,sy:0.12,sz:0.14,rotY:0.4,rotZ:0.14},
                  {dx:-0.053,dz:-0.046,sx:0.2,sy:0.28,sz:0.12,rotY:2.5,rotZ:-0.18},
                  {dx:-0.03,dz:-0.038,sx:0.28,sy:0.14,sz:0.11,rotY:3.8,rotZ:-0.08},
                  {dx:-0.019,dz:-0.025,sx:0.16,sy:0.27,sz:0.15,rotY:0.2,rotZ:0.07},
                  {dx:-0.037,dz:0.056,sx:0.24,sy:0.23,sz:0.17,rotY:0.8,rotZ:-0.05},
                  {dx:-0.041,dz:-0.039,sx:0.27,sy:0.18,sz:0.15,rotY:3.9,rotZ:-0.24},
                  {dx:0.011,dz:0.036,sx:0.21,sy:0.27,sz:0.15,rotY:0.7,rotZ:0.07},
                  {dx:-0.031,dz:-0.061,sx:0.18,sy:0.12,sz:0.16,rotY:3.9,rotZ:0.04},
                  {dx:0.029,dz:0.051,sx:0.28,sy:0.2,sz:0.17,rotY:0.2,rotZ:0.06},
                  {dx:0.041,dz:0.047,sx:0.19,sy:0.21,sz:0.14,rotY:1.4,rotZ:0.01},
                  {dx:-0.041,dz:0.013,sx:0.26,sy:0.15,sz:0.16,rotY:4.1,rotZ:0.05}
                ],
                colliders: [
                  {dx:0.044,dz:-0.06,r:0.0154},
                  {dx:-0.016,dz:-0.011,r:0.033},
                  {dx:0.011,dz:0.048,r:0.0429},
                  {dx:-0.035,dz:-0.042,r:0.0193},
                  {dx:-0.037,dz:0.056,r:0.0168},
                  {dx:-0.041,dz:0.013,r:0.0182}
                ]
              }
            ]
          }
        },
        {
          id: 'rock_9',
          seed: 901,
          terrain: {
            hills: [
              {x:0.33,z:0.49,radius:0.34,height:0.29},
              {x:0.58,z:0.21,radius:0.3,height:0.6},
              {x:0.65,z:0.37,radius:0.28,height:0.44},
              {x:0.66,z:0.38,radius:0.19,height:0.32},
              {x:0.4,z:0.58,radius:0.3,height:0.48},
              {x:0.79,z:1,radius:0.28,height:0.38},
              {x:0.07,z:0.1,radius:0.21,height:0.49},
              {x:0.7,z:0.27,radius:0.37,height:0.57},
              {x:0.82,z:0.65,radius:0.24,height:0.16},
              {x:0.15,z:0.7,radius:0.28,height:0.42},
              {x:0.27,z:0.63,radius:0.2,height:0.19},
              {x:0.55,z:0.76,radius:0.36,height:0.16},
              {x:0.72,z:0.12,radius:0.4,height:0.59}
            ]
          },
          items: {
            trees: [
              {
                x: 0.338,
                z: 0.404,
                v: 'bare',
                cols: [
                  [0.338, 0.404, 0.0055]
                ]
              },
              {
                x: 0.337,
                z: 0.468,
                v: 'dry',
                cols: [
                  [0.337, 0.468, 0.0055]
                ]
              },
              {
                x: 0.39,
                z: 0.399,
                v: 'sparse',
                cols: [
                  [0.39, 0.399, 0.0055]
                ]
              },
              {
                x: 0.266,
                z: 0.491,
                v: 'dry',
                cols: [
                  [0.266, 0.491, 0.0055]
                ]
              },
              {
                x: 0.402,
                z: 0.42,
                v: 'bare',
                cols: [
                  [0.402, 0.42, 0.0055]
                ]
              },
              {
                x: 0.284,
                z: 0.329,
                v: 'bare',
                cols: [
                  [0.284, 0.329, 0.0055]
                ]
              },
              {
                x: 0.371,
                z: 0.364,
                v: 'scraggly',
                cols: [
                  [0.371, 0.364, 0.0055]
                ]
              },
              {
                x: 0.425,
                z: 0.337,
                v: 'scraggly',
                cols: [
                  [0.425, 0.337, 0.0055]
                ]
              },
              {
                x: 0.246,
                z: 0.411,
                v: 'scraggly',
                cols: [
                  [0.246, 0.411, 0.0055]
                ]
              },
              {
                x: 0.835,
                z: 0.653,
                v: 'bare',
                cols: [
                  [0.835, 0.653, 0.0055]
                ]
              },
              {
                x: 0.9,
                z: 0.637,
                v: 'scraggly',
                cols: [
                  [0.9, 0.637, 0.0055]
                ]
              },
              {
                x: 0.809,
                z: 0.674,
                v: 'dry',
                cols: [
                  [0.809, 0.674, 0.0055]
                ]
              },
              {
                x: 0.786,
                z: 0.604,
                v: 'dry',
                cols: [
                  [0.786, 0.604, 0.0055]
                ]
              },
              {
                x: 0.855,
                z: 0.73,
                v: 'scraggly',
                cols: [
                  [0.855, 0.73, 0.0055]
                ]
              },
              {
                x: 0.745,
                z: 0.575,
                v: 'bare',
                cols: [
                  [0.745, 0.575, 0.0055]
                ]
              },
              {
                x: 0.927,
                z: 0.67,
                v: 'sparse',
                cols: [
                  [0.927, 0.67, 0.0055]
                ]
              },
              {
                x: 0.882,
                z: 0.537,
                v: 'bare',
                cols: [
                  [0.882, 0.537, 0.0055]
                ]
              },
              {
                x: 0.932,
                z: 0.695,
                v: 'scraggly',
                cols: [
                  [0.932, 0.695, 0.0055]
                ]
              },
              {
                x: 0.916,
                z: 0.717,
                v: 'dry',
                cols: [
                  [0.916, 0.717, 0.0055]
                ]
              },
              {
                x: 0.221,
                z: 0.567,
                v: 'bare',
                cols: [
                  [0.221, 0.567, 0.0055]
                ]
              },
              {
                x: 0.189,
                z: 0.564,
                v: 'scraggly',
                cols: [
                  [0.189, 0.564, 0.0055]
                ]
              },
              {
                x: 0.181,
                z: 0.508,
                v: 'dry',
                cols: [
                  [0.181, 0.508, 0.0055]
                ]
              },
              {
                x: 0.191,
                z: 0.595,
                v: 'bare',
                cols: [
                  [0.191, 0.595, 0.0055]
                ]
              },
              {
                x: 0.116,
                z: 0.572,
                v: 'sparse',
                cols: [
                  [0.116, 0.572, 0.0055]
                ]
              },
              {
                x: 0.163,
                z: 0.595,
                v: 'sparse',
                cols: [
                  [0.163, 0.595, 0.0055]
                ]
              },
              {
                x: 0.159,
                z: 0.618,
                v: 'scraggly',
                cols: [
                  [0.159, 0.618, 0.0055]
                ]
              },
              {
                x: 0.178,
                z: 0.604,
                v: 'scraggly',
                cols: [
                  [0.178, 0.604, 0.0055]
                ]
              },
              {
                x: 0.153,
                z: 0.707,
                v: 'scraggly',
                cols: [
                  [0.153, 0.707, 0.0055]
                ]
              },
              {
                x: 0.064,
                z: 0.634,
                v: 'bare',
                cols: [
                  [0.064, 0.634, 0.0055]
                ]
              },
              {
                x: 0.2,
                z: 0.576,
                v: 'sparse',
                cols: [
                  [0.2, 0.576, 0.0055]
                ]
              },
              {
                x: 0.189,
                z: 0.743,
                v: 'sparse',
                cols: [
                  [0.189, 0.743, 0.0055]
                ]
              },
              {
                x: 0.218,
                z: 0.698,
                v: 'bare',
                cols: [
                  [0.218, 0.698, 0.0055]
                ]
              },
              {
                x: 0.286,
                z: 0.779,
                v: 'scraggly',
                cols: [
                  [0.286, 0.779, 0.0055]
                ]
              },
              {
                x: 0.209,
                z: 0.724,
                v: 'scraggly',
                cols: [
                  [0.209, 0.724, 0.0055]
                ]
              },
              {
                x: 0.991,
                z: 0.536,
                v: 'dry',
                cols: [
                  [0.991, 0.536, 0.0055]
                ]
              },
              {
                x: 0.936,
                z: 0.498,
                v: 'scraggly',
                cols: [
                  [0.936, 0.498, 0.0055]
                ]
              },
              {
                x: 0.982,
                z: 0.491,
                v: 'sparse',
                cols: [
                  [0.982, 0.491, 0.0055]
                ]
              },
              {
                x: 0.969,
                z: 0.384,
                v: 'dry',
                cols: [
                  [0.969, 0.384, 0.0055]
                ]
              },
              {
                x: 0.723,
                z: 0.868,
                v: 'bare',
                cols: [
                  [0.723, 0.868, 0.0055]
                ]
              },
              {
                x: 0.787,
                z: 0.974,
                v: 'scraggly',
                cols: [
                  [0.787, 0.974, 0.0055]
                ]
              },
              {
                x: 0.73,
                z: 0.883,
                v: 'sparse',
                cols: [
                  [0.73, 0.883, 0.0055]
                ]
              },
              {
                x: 0.725,
                z: 0.786,
                v: 'sparse',
                cols: [
                  [0.725, 0.786, 0.0055]
                ]
              },
              {
                x: 0.749,
                z: 0.822,
                v: 'dry',
                cols: [
                  [0.749, 0.822, 0.0055]
                ]
              },
              {
                x: 0.681,
                z: 0.848,
                v: 'scraggly',
                cols: [
                  [0.681, 0.848, 0.0055]
                ]
              },
              {
                x: 0.684,
                z: 0.985,
                v: 'dry',
                cols: [
                  [0.684, 0.985, 0.0055]
                ]
              },
              {
                x: 0.675,
                z: 0.884,
                v: 'sparse',
                cols: [
                  [0.675, 0.884, 0.0055]
                ]
              },
              {
                x: 0.692,
                z: 0.97,
                v: 'scraggly',
                cols: [
                  [0.692, 0.97, 0.0055]
                ]
              },
              {
                x: 0.788,
                z: 0.797,
                v: 'bare',
                cols: [
                  [0.788, 0.797, 0.0055]
                ]
              },
              {
                x: 0.77,
                z: 0.791,
                v: 'dry',
                cols: [
                  [0.77, 0.791, 0.0055]
                ]
              },
              {
                x: 0.921,
                z: 0.828,
                v: 'sparse',
                cols: [
                  [0.921, 0.828, 0.0055]
                ]
              },
              {
                x: 0.864,
                z: 0.918,
                v: 'dry',
                cols: [
                  [0.864, 0.918, 0.0055]
                ]
              },
              {
                x: 0.941,
                z: 0.735,
                v: 'dry',
                cols: [
                  [0.941, 0.735, 0.0055]
                ]
              },
              {
                x: 0.921,
                z: 0.808,
                v: 'sparse',
                cols: [
                  [0.921, 0.808, 0.0055]
                ]
              },
              {
                x: 0.553,
                z: 0.859,
                v: 'sparse',
                cols: [
                  [0.553, 0.859, 0.0055]
                ]
              },
              {
                x: 0.532,
                z: 0.931,
                v: 'dry',
                cols: [
                  [0.532, 0.931, 0.0055]
                ]
              },
              {
                x: 0.601,
                z: 0.992,
                v: 'sparse',
                cols: [
                  [0.601, 0.992, 0.0055]
                ]
              },
              {
                x: 0.584,
                z: 0.765,
                v: 'bare',
                cols: [
                  [0.584, 0.765, 0.0055]
                ]
              },
              {
                x: 0.617,
                z: 0.894,
                v: 'sparse',
                cols: [
                  [0.617, 0.894, 0.0055]
                ]
              },
              {
                x: 0.602,
                z: 0.921,
                v: 'scraggly',
                cols: [
                  [0.602, 0.921, 0.0055]
                ]
              },
              {
                x: 0.565,
                z: 0.899,
                v: 'scraggly',
                cols: [
                  [0.565, 0.899, 0.0055]
                ]
              },
              {
                x: 0.571,
                z: 0.806,
                v: 'bare',
                cols: [
                  [0.571, 0.806, 0.0055]
                ]
              },
              {
                x: 0.265,
                z: 0.733,
                v: 'dry',
                cols: [
                  [0.265, 0.733, 0.0055]
                ]
              },
              {
                x: 0.25,
                z: 0.606,
                v: 'scraggly',
                cols: [
                  [0.25, 0.606, 0.0055]
                ]
              },
              {
                x: 0.279,
                z: 0.571,
                v: 'sparse',
                cols: [
                  [0.279, 0.571, 0.0055]
                ]
              },
              {
                x: 0.287,
                z: 0.696,
                v: 'scraggly',
                cols: [
                  [0.287, 0.696, 0.0055]
                ]
              },
              {
                x: 0.297,
                z: 0.686,
                v: 'scraggly',
                cols: [
                  [0.297, 0.686, 0.0055]
                ]
              },
              {
                x: 0.188,
                z: 0.691,
                v: 'bare',
                cols: [
                  [0.188, 0.691, 0.0055]
                ]
              },
              {
                x: 0.331,
                z: 0.683,
                v: 'scraggly',
                cols: [
                  [0.331, 0.683, 0.0055]
                ]
              },
              {
                x: 0.244,
                z: 0.574,
                v: 'scraggly',
                cols: [
                  [0.244, 0.574, 0.0055]
                ]
              },
              {
                x: 0.248,
                z: 0.74,
                v: 'sparse',
                cols: [
                  [0.248, 0.74, 0.0055]
                ]
              }
            ],
            rocks: [
              {
                x: 0.822,
                z: 0.208,
                rotY: 1.6,
                scale: 0.93,
                cols: [
                  [0.822, 0.208, 0.014]
                ]
              },
              {
                x: 0.082,
                z: 0.427,
                rotY: 3.5,
                scale: 0.91,
                cols: [
                  [0.082, 0.427, 0.0137]
                ]
              },
              {
                x: 0.643,
                z: 0.54,
                rotY: 1.7,
                scale: 0.82,
                cols: [
                  [0.643, 0.54, 0.0123]
                ]
              },
              {
                x: 0.624,
                z: 0.869,
                rotY: 1.4,
                scale: 0.65,
                cols: [
                  [0.624, 0.869, 0.0097]
                ]
              },
              {
                x: 0.922,
                z: 0.622,
                rotY: 1.5,
                scale: 0.88,
                cols: [
                  [0.922, 0.622, 0.0132]
                ]
              },
              {
                x: 0.039,
                z: 0.067,
                rotY: 3.4,
                scale: 0.71,
                cols: [
                  [0.039, 0.067, 0.0106]
                ]
              },
              {
                x: 0.294,
                z: 0.083,
                rotY: 5,
                scale: 0.97,
                cols: [
                  [0.294, 0.083, 0.0145]
                ]
              },
              {
                x: 0.297,
                z: 0.681,
                rotY: 1.7,
                scale: 0.97,
                cols: [
                  [0.297, 0.681, 0.0145]
                ]
              }
            ],
            sticks: [],
            minables: [
              {
                material: 'crystal',
                x: 0.354,
                z: 0.891,
                cubes: [
                  {dx:0.004,dz:-0.052,sx:0.31,sy:0.25,sz:0.1,rotY:0.8,rotZ:0.27},
                  {dx:-0.019,dz:-0.027,sx:0.26,sy:0.12,sz:0.2,rotY:4.7,rotZ:-0.22},
                  {dx:0.052,dz:0.064,sx:0.29,sy:0.28,sz:0.2,rotY:3.5,rotZ:0.01},
                  {dx:0.055,dz:0.033,sx:0.26,sy:0.22,sz:0.16,rotY:0.4,rotZ:0.27},
                  {dx:-0.009,dz:-0.015,sx:0.18,sy:0.15,sz:0.17,rotY:1,rotZ:-0.17},
                  {dx:-0.01,dz:0.012,sx:0.16,sy:0.21,sz:0.23,rotY:3.4,rotZ:0.07},
                  {dx:0.04,dz:0.021,sx:0.15,sy:0.12,sz:0.14,rotY:6.1,rotZ:-0.13},
                  {dx:0.037,dz:0.026,sx:0.11,sy:0.15,sz:0.14,rotY:4.8,rotZ:0.14},
                  {dx:0.005,dz:-0.022,sx:0.26,sy:0.27,sz:0.13,rotY:0.6,rotZ:0.01},
                  {dx:-0.015,dz:-0.048,sx:0.24,sy:0.17,sz:0.14,rotY:3,rotZ:-0.17}
                ],
                colliders: [
                  {dx:-0.006,dz:-0.037,r:0.0216},
                  {dx:0.052,dz:0.064,r:0.0203},
                  {dx:-0.009,dz:-0.001,r:0.0162},
                  {dx:0.044,dz:0.027,r:0.0163}
                ]
              },
              {
                material: 'crystal',
                x: 0.163,
                z: 0.626,
                cubes: [
                  {dx:0.001,dz:0,sx:0.28,sy:0.14,sz:0.21,rotY:6.1,rotZ:-0.04},
                  {dx:0.008,dz:0.043,sx:0.25,sy:0.19,sz:0.22,rotY:2,rotZ:-0.06},
                  {dx:-0.003,dz:0.022,sx:0.3,sy:0.23,sz:0.18,rotY:3.2,rotZ:-0.22},
                  {dx:0.001,dz:0.001,sx:0.19,sy:0.24,sz:0.19,rotY:4,rotZ:0.28},
                  {dx:0.02,dz:-0.044,sx:0.22,sy:0.25,sz:0.23,rotY:1.6,rotZ:0.22},
                  {dx:0.043,dz:0.039,sx:0.17,sy:0.23,sz:0.11,rotY:4.5,rotZ:0.09},
                  {dx:-0.028,dz:-0.05,sx:0.28,sy:0.12,sz:0.11,rotY:1,rotZ:-0.06},
                  {dx:-0.064,dz:-0.028,sx:0.19,sy:0.13,sz:0.19,rotY:0.9,rotZ:0.01},
                  {dx:0.057,dz:-0.017,sx:0.13,sy:0.24,sz:0.21,rotY:2.2,rotZ:-0.06},
                  {dx:0.016,dz:-0.032,sx:0.18,sy:0.18,sz:0.19,rotY:2.5,rotZ:-0.16},
                  {dx:-0.036,dz:-0.036,sx:0.15,sy:0.16,sz:0.2,rotY:0.5,rotZ:0.18}
                ],
                colliders: [
                  {dx:-0.043,dz:-0.038,r:0.0227},
                  {dx:0.002,dz:0.017,r:0.027},
                  {dx:0.043,dz:0.039,r:0.0119},
                  {dx:0.031,dz:-0.031,r:0.0277},
                  {dx:0.057,dz:-0.017,r:0.0147}
                ]
              },
              {
                material: 'crystal',
                x: 0.776,
                z: 0.333,
                cubes: [
                  {dx:0.016,dz:0.031,sx:0.14,sy:0.26,sz:0.17,rotY:5,rotZ:-0.28},
                  {dx:-0.001,dz:0.045,sx:0.13,sy:0.22,sz:0.2,rotY:1.2,rotZ:-0.25},
                  {dx:-0.01,dz:0.018,sx:0.19,sy:0.16,sz:0.17,rotY:3.5,rotZ:0.21},
                  {dx:0.044,dz:-0.004,sx:0.17,sy:0.17,sz:0.2,rotY:6,rotZ:0.26},
                  {dx:0.064,dz:0.064,sx:0.2,sy:0.19,sz:0.13,rotY:0.9,rotZ:-0.16},
                  {dx:-0.01,dz:0.053,sx:0.11,sy:0.26,sz:0.17,rotY:1.9,rotZ:-0.12},
                  {dx:-0.013,dz:0.052,sx:0.31,sy:0.22,sz:0.17,rotY:0.3,rotZ:-0.2},
                  {dx:-0.003,dz:0,sx:0.18,sy:0.19,sz:0.21,rotY:0.1,rotZ:0.14},
                  {dx:-0.033,dz:-0.06,sx:0.26,sy:0.17,sz:0.15,rotY:3.2,rotZ:-0.01},
                  {dx:-0.045,dz:0.001,sx:0.23,sy:0.16,sz:0.18,rotY:5.1,rotZ:0.24},
                  {dx:0.015,dz:0.022,sx:0.18,sy:0.26,sz:0.1,rotY:5,rotZ:0.07},
                  {dx:-0.03,dz:-0.044,sx:0.22,sy:0.25,sz:0.21,rotY:1.9,rotZ:0.03},
                  {dx:-0.017,dz:-0.053,sx:0.22,sy:0.27,sz:0.15,rotY:4.6,rotZ:-0.27}
                ],
                colliders: [
                  {dx:0.016,dz:0.027,r:0.0505},
                  {dx:0.044,dz:-0.004,r:0.014},
                  {dx:-0.008,dz:0.05,r:0.0122},
                  {dx:-0.031,dz:-0.039,r:0.0378},
                  {dx:0.064,dz:0.064,r:0.014},
                  {dx:-0.045,dz:0.001,r:0.0161}
                ]
              },
              {
                material: 'crystal',
                x: 0.655,
                z: 0.797,
                cubes: [
                  {dx:0.013,dz:-0.008,sx:0.14,sy:0.15,sz:0.14,rotY:2.7,rotZ:-0.05},
                  {dx:-0.057,dz:-0.048,sx:0.12,sy:0.17,sz:0.15,rotY:3.7,rotZ:-0.27},
                  {dx:0.027,dz:-0.002,sx:0.26,sy:0.14,sz:0.2,rotY:1.6,rotZ:-0.14},
                  {dx:0.064,dz:-0.047,sx:0.27,sy:0.13,sz:0.11,rotY:3.5,rotZ:0.11},
                  {dx:0.043,dz:-0.059,sx:0.22,sy:0.26,sz:0.19,rotY:5.6,rotZ:0.02},
                  {dx:-0.043,dz:-0.007,sx:0.17,sy:0.24,sz:0.19,rotY:5.8,rotZ:-0.25},
                  {dx:0.019,dz:-0.033,sx:0.15,sy:0.15,sz:0.15,rotY:1.2,rotZ:0.1},
                  {dx:0.02,dz:-0.013,sx:0.14,sy:0.24,sz:0.2,rotY:4.6,rotZ:-0.11},
                  {dx:0.036,dz:0.021,sx:0.17,sy:0.21,sz:0.24,rotY:3.1,rotZ:0.06},
                  {dx:0.031,dz:-0.022,sx:0.1,sy:0.25,sz:0.22,rotY:3.6,rotZ:-0.05},
                  {dx:0.022,dz:0.029,sx:0.29,sy:0.13,sz:0.14,rotY:2.8,rotZ:-0.12}
                ],
                colliders: [
                  {dx:0.022,dz:-0.016,r:0.0177},
                  {dx:0.054,dz:-0.053,r:0.0162},
                  {dx:-0.05,dz:-0.027,r:0.0212},
                  {dx:0.029,dz:0.025,r:0.0137}
                ]
              },
              {
                material: 'crystal',
                x: 0.406,
                z: 0.642,
                cubes: [
                  {dx:-0.034,dz:0.047,sx:0.2,sy:0.14,sz:0.21,rotY:1.8,rotZ:0.14},
                  {dx:-0.058,dz:-0.015,sx:0.22,sy:0.18,sz:0.14,rotY:0.5,rotZ:-0.28},
                  {dx:-0.05,dz:-0.009,sx:0.29,sy:0.27,sz:0.13,rotY:2.8,rotZ:0},
                  {dx:-0.031,dz:0.065,sx:0.28,sy:0.17,sz:0.23,rotY:6.2,rotZ:0.13},
                  {dx:0.06,dz:0.056,sx:0.31,sy:0.14,sz:0.16,rotY:1.9,rotZ:0.2},
                  {dx:0.016,dz:0.025,sx:0.3,sy:0.21,sz:0.22,rotY:1.3,rotZ:-0.14},
                  {dx:-0.008,dz:-0.045,sx:0.3,sy:0.23,sz:0.11,rotY:1.2,rotZ:0.03},
                  {dx:-0.052,dz:0.064,sx:0.13,sy:0.16,sz:0.11,rotY:6.1,rotZ:0.06},
                  {dx:-0.061,dz:-0.029,sx:0.13,sy:0.18,sz:0.12,rotY:1.4,rotZ:-0.09},
                  {dx:-0.03,dz:-0.036,sx:0.3,sy:0.22,sz:0.11,rotY:4.9,rotZ:-0.08},
                  {dx:0.024,dz:0.051,sx:0.32,sy:0.14,sz:0.23,rotY:0.1,rotZ:-0.27},
                  {dx:0.026,dz:-0.041,sx:0.1,sy:0.21,sz:0.17,rotY:2.7,rotZ:-0.17}
                ],
                colliders: [
                  {dx:-0.039,dz:0.059,r:0.015},
                  {dx:0.033,dz:0.044,r:0.0301},
                  {dx:0.009,dz:-0.043,r:0.0207},
                  {dx:-0.05,dz:-0.022,r:0.0259}
                ]
              }
            ]
          }
        }
      ],
  },
  forest: {
    name: 'Forest Biome',
    borderMargin: 0.04, // UV margin on edges adjacent to a different biome
    generationRules: {
      // Each config defines exactly 1 hill formation covering ~half the region,
      // pushed against one of the 4 edges. Shape is rectangular or triangular, low.
      hills: {
        count: 1, // exactly 1 hill per config
        // The hill is pushed against one of the 4 edges and covers the
        // full width of that edge. Shape is either rectangular or triangular.
        //
        // Rectangular (shape:'rect'):
        //   Center (x,z) on the edge (e.g. x=0.5,z=0.0 for back edge)
        //   wx, wz = half-widths. The edge-parallel axis is wide (0.55-0.65)
        //   to cover the full edge. The depth axis is 0.35-0.50.
        //   height: 0.35-0.50 (moderate mound)
        //
        // Triangular (shape:'tri'):
        //   Corner (x,z) at a region corner (e.g. 0,0 or 1,1)
        //   wx, wz = extent from corner (0.70-0.90)
        //   dirX, dirZ = +1 or -1 indicating which direction the triangle extends
        //   height: 0.35-0.50
      },
      trees: {
        // RULE: All tree proximity/collision checks use the collider (colX, colZ, colR),
        // never the billboard anchor or billboard bounds. This applies to: overlap testing
        // during generation, spawn clearance, and player blocking at runtime.
        //
        // Generated via generateForestShape(), then baked to static data.
        // To create a new config: call generateForestShape(opts), copy the
        // returned array into the config as static data.
        generator: 'generateForestShape',
        seed: 'unique integer per config (e.g. 101, 202, 303)',
        frequency: { min: 2.5, max: 4.5 },   // noise scale â€” lower = larger patches
        threshold: { min: 0.12, max: 0.22 },  // noise cutoff â€” lower = denser forest
        density: { min: 35, max: 45 },         // noise sampling grid resolution (higher = more candidates = denser forest)
        octaves: { min: 1, max: 3 },           // fractal complexity
        margin: 0.1,                           // border margin in UV (must match biome margin)
        jitter: { min: 0.6, max: 0.9 },       // random offset from grid points
        // Variant baked per-tree at generation time via hash: floor((x*7919+z*6271)*1000) % 2
        // Per-variant collider radii: c3=0.24, c5=0.28 (world units)
        // Per-variant margin: offset_magnitude + colR (see variantReachUV in generator)
        // Overlap: collider centers checked â€” min dist = (rA+rB) * 0.825 (allows ~17.5% penetration)
        // Billboard sizes: fir_cluster_3 = 0.65w, fir_cluster_5 = 0.85w
        // Each billboard represents 3/5 visual trees (avg 4)
        // Typical output: 30-80 placements per config (representing ~120-320 visual trees)
      },
      rocks: null,    // not yet defined
      minables: null, // not yet defined
      sticks: {
        // Generated via generateForestSticks(), then baked to static data.
        // To create: call generateForestSticks(opts) with config's trees array,
        // copy returned array into config as static data.
        generator: 'generateForestSticks',
        seed: 'unique integer per config (e.g. 1501, 1502)',
        count: { min: 4, max: 8 },            // target stick count (~6 per region)
        // Stick-to-tree avoidance: collider-to-collider via getCollidersUV() + collidersOverlap()
        // See getCollidersUV() + collidersOverlap() for per-collider avoidance logic
        // Stick-to-stick: collider-to-collider overlap check (no min dist constant)
        nearbyDist: 0.12,                      // UV radius for rotation similarity check
        minRotDiff: 'PI/4 (45 degrees)',       // min rotation diff for sticks within nearbyDist
        // Rotation constraint: nearby sticks (within nearbyDist UV) must differ
        //   by >= 45 degrees (mod 180 degrees, since 180 flip looks identical).
        //   Generator retries rotation up to 8 times per candidate; skips if no valid angle found.
        // Flip: ~50% of sticks get flip:1 (mirrors mesh on Z axis via negative scale,
        //   reversing fork direction for visual variety).
        // Output fields per stick: { x, z, rotY, flip }
        // Rendering: forked stick mesh (3 box prisms, 36 tris), STICK_BASE_SCALE world units,
        //   warm brown with rock-style face shading. No physics collision.
        // Debug: passthrough collider shown as dotted cyan circle (STICK_PASSTHROUGH_RADIUS=0.17).
      },
    },
    treeVariants: ['fir_cluster_3', 'fir_cluster_5'],
    configs: [
        {
          id: 'forest_1',
          seed: 201,
          terrain: {
            hills: [
              {
                shape: 'tri',
                x: 0,
                z: 0,
                wx: 0.887,
                wz: 0.812,
                dirX: 1,
                dirZ: 1,
                height: 0.393
              }
            ]
          },
          items: {
            trees: [
              {
                x: 0.052,
                z: 0.409,
                v: 'c3',
                cols: [
                  [0.028, 0.387, 0.028]
                ]
              },
              {
                x: 0.054,
                z: 0.462,
                v: 'c3',
                cols: [
                  [0.03, 0.44, 0.028]
                ]
              },
              {
                x: 0.075,
                z: 0.327,
                v: 'c5',
                cols: [
                  [0.053, 0.304, 0.033]
                ]
              },
              {
                x: 0.102,
                z: 0.438,
                v: 'c3',
                cols: [
                  [0.078, 0.416, 0.028]
                ]
              },
              {
                x: 0.096,
                z: 0.497,
                v: 'c5',
                cols: [
                  [0.074, 0.474, 0.033]
                ]
              },
              {
                x: 0.119,
                z: 0.594,
                v: 'c3',
                cols: [
                  [0.095, 0.572, 0.028]
                ]
              },
              {
                x: 0.122,
                z: 0.658,
                v: 'c5',
                cols: [
                  [0.1, 0.635, 0.033]
                ]
              },
              {
                x: 0.146,
                z: 0.188,
                v: 'c5',
                cols: [
                  [0.124, 0.165, 0.033]
                ]
              },
              {
                x: 0.138,
                z: 0.706,
                v: 'c3',
                cols: [
                  [0.114, 0.684, 0.028]
                ]
              },
              {
                x: 0.146,
                z: 0.831,
                v: 'c5',
                cols: [
                  [0.124, 0.808, 0.033]
                ]
              },
              {
                x: 0.16,
                z: 0.459,
                v: 'c3',
                cols: [
                  [0.136, 0.437, 0.028]
                ]
              },
              {
                x: 0.171,
                z: 0.616,
                v: 'c3',
                cols: [
                  [0.147, 0.594, 0.028]
                ]
              },
              {
                x: 0.196,
                z: 0.15,
                v: 'c5',
                cols: [
                  [0.174, 0.127, 0.033]
                ]
              },
              {
                x: 0.191,
                z: 0.239,
                v: 'c3',
                cols: [
                  [0.167, 0.217, 0.028]
                ]
              },
              {
                x: 0.182,
                z: 0.671,
                v: 'c3',
                cols: [
                  [0.158, 0.649, 0.028]
                ]
              },
              {
                x: 0.19,
                z: 0.884,
                v: 'c5',
                cols: [
                  [0.168, 0.861, 0.033]
                ]
              },
              {
                x: 0.184,
                z: 0.972,
                v: 'c3',
                cols: [
                  [0.16, 0.95, 0.028]
                ]
              },
              {
                x: 0.206,
                z: 0.516,
                v: 'c5',
                cols: [
                  [0.184, 0.493, 0.033]
                ]
              },
              {
                x: 0.208,
                z: 0.83,
                v: 'c5',
                cols: [
                  [0.186, 0.807, 0.033]
                ]
              },
              {
                x: 0.235,
                z: 0.193,
                v: 'c5',
                cols: [
                  [0.213, 0.17, 0.033]
                ]
              },
              {
                x: 0.237,
                z: 0.283,
                v: 'c3',
                cols: [
                  [0.213, 0.261, 0.028]
                ]
              },
              {
                x: 0.228,
                z: 0.566,
                v: 'c3',
                cols: [
                  [0.204, 0.544, 0.028]
                ]
              },
              {
                x: 0.236,
                z: 0.639,
                v: 'c5',
                cols: [
                  [0.214, 0.616, 0.033]
                ]
              },
              {
                x: 0.25,
                z: 0.08,
                v: 'c5',
                cols: [
                  [0.228, 0.057, 0.033]
                ]
              },
              {
                x: 0.261,
                z: 0.527,
                v: 'c3',
                cols: [
                  [0.237, 0.505, 0.028]
                ]
              },
              {
                x: 0.259,
                z: 0.879,
                v: 'c5',
                cols: [
                  [0.237, 0.856, 0.033]
                ]
              },
              {
                x: 0.256,
                z: 0.941,
                v: 'c3',
                cols: [
                  [0.232, 0.919, 0.028]
                ]
              },
              {
                x: 0.273,
                z: 0.144,
                v: 'c5',
                cols: [
                  [0.251, 0.121, 0.033]
                ]
              },
              {
                x: 0.283,
                z: 0.259,
                v: 'c3',
                cols: [
                  [0.259, 0.237, 0.028]
                ]
              },
              {
                x: 0.271,
                z: 0.589,
                v: 'c3',
                cols: [
                  [0.247, 0.567, 0.028]
                ]
              },
              {
                x: 0.273,
                z: 0.991,
                v: 'c3',
                cols: [
                  [0.249, 0.969, 0.028]
                ]
              },
              {
                x: 0.306,
                z: 0.083,
                v: 'c3',
                cols: [
                  [0.282, 0.061, 0.028]
                ]
              },
              {
                x: 0.307,
                z: 0.196,
                v: 'c5',
                cols: [
                  [0.285, 0.173, 0.033]
                ]
              },
              {
                x: 0.3,
                z: 0.66,
                v: 'c3',
                cols: [
                  [0.276, 0.638, 0.028]
                ]
              },
              {
                x: 0.305,
                z: 0.838,
                v: 'c5',
                cols: [
                  [0.283, 0.815, 0.033]
                ]
              },
              {
                x: 0.3,
                z: 0.921,
                v: 'c5',
                cols: [
                  [0.278, 0.898, 0.033]
                ]
              },
              {
                x: 0.329,
                z: 0.589,
                v: 'c5',
                cols: [
                  [0.307, 0.566, 0.033]
                ]
              },
              {
                x: 0.344,
                z: 0.638,
                v: 'c3',
                cols: [
                  [0.32, 0.616, 0.028]
                ]
              },
              {
                x: 0.35,
                z: 0.706,
                v: 'c3',
                cols: [
                  [0.326, 0.684, 0.028]
                ]
              },
              {
                x: 0.371,
                z: 0.145,
                v: 'c3',
                cols: [
                  [0.347, 0.123, 0.028]
                ]
              },
              {
                x: 0.369,
                z: 0.39,
                v: 'c5',
                cols: [
                  [0.347, 0.367, 0.033]
                ]
              },
              {
                x: 0.361,
                z: 0.877,
                v: 'c3',
                cols: [
                  [0.337, 0.855, 0.028]
                ]
              },
              {
                x: 0.373,
                z: 0.991,
                v: 'c3',
                cols: [
                  [0.349, 0.969, 0.028]
                ]
              },
              {
                x: 0.39,
                z: 0.674,
                v: 'c5',
                cols: [
                  [0.368, 0.651, 0.033]
                ]
              },
              {
                x: 0.404,
                z: 0.43,
                v: 'c3',
                cols: [
                  [0.38, 0.408, 0.028]
                ]
              },
              {
                x: 0.409,
                z: 0.904,
                v: 'c3',
                cols: [
                  [0.385, 0.882, 0.028]
                ]
              },
              {
                x: 0.418,
                z: 0.97,
                v: 'c3',
                cols: [
                  [0.394, 0.948, 0.028]
                ]
              },
              {
                x: 0.43,
                z: 0.317,
                v: 'c5',
                cols: [
                  [0.408, 0.294, 0.033]
                ]
              },
              {
                x: 0.438,
                z: 0.373,
                v: 'c5',
                cols: [
                  [0.416, 0.35, 0.033]
                ]
              },
              {
                x: 0.501,
                z: 0.057,
                v: 'c3',
                cols: [
                  [0.477, 0.035, 0.028]
                ]
              },
              {
                x: 0.505,
                z: 0.126,
                v: 'c5',
                cols: [
                  [0.483, 0.103, 0.033]
                ]
              },
              {
                x: 0.5,
                z: 0.25,
                v: 'c5',
                cols: [
                  [0.478, 0.227, 0.033]
                ]
              },
              {
                x: 0.499,
                z: 0.392,
                v: 'c3',
                cols: [
                  [0.475, 0.37, 0.028]
                ]
              },
              {
                x: 0.521,
                z: 0.478,
                v: 'c5',
                cols: [
                  [0.499, 0.455, 0.033]
                ]
              },
              {
                x: 0.548,
                z: 0.195,
                v: 'c5',
                cols: [
                  [0.526, 0.172, 0.033]
                ]
              },
              {
                x: 0.547,
                z: 0.306,
                v: 'c3',
                cols: [
                  [0.523, 0.284, 0.028]
                ]
              },
              {
                x: 0.545,
                z: 0.546,
                v: 'c5',
                cols: [
                  [0.523, 0.523, 0.033]
                ]
              },
              {
                x: 0.548,
                z: 0.871,
                v: 'c5',
                cols: [
                  [0.526, 0.848, 0.033]
                ]
              },
              {
                x: 0.57,
                z: 0.248,
                v: 'c3',
                cols: [
                  [0.546, 0.226, 0.028]
                ]
              },
              {
                x: 0.569,
                z: 0.382,
                v: 'c3',
                cols: [
                  [0.545, 0.36, 0.028]
                ]
              },
              {
                x: 0.567,
                z: 0.718,
                v: 'c3',
                cols: [
                  [0.543, 0.696, 0.028]
                ]
              },
              {
                x: 0.568,
                z: 0.768,
                v: 'c3',
                cols: [
                  [0.544, 0.746, 0.028]
                ]
              },
              {
                x: 0.596,
                z: 0.433,
                v: 'c3',
                cols: [
                  [0.572, 0.411, 0.028]
                ]
              },
              {
                x: 0.587,
                z: 0.481,
                v: 'c3',
                cols: [
                  [0.563, 0.459, 0.028]
                ]
              },
              {
                x: 0.592,
                z: 0.812,
                v: 'c3',
                cols: [
                  [0.568, 0.79, 0.028]
                ]
              },
              {
                x: 0.592,
                z: 0.899,
                v: 'c3',
                cols: [
                  [0.568, 0.877, 0.028]
                ]
              },
              {
                x: 0.617,
                z: 0.166,
                v: 'c5',
                cols: [
                  [0.595, 0.143, 0.033]
                ]
              },
              {
                x: 0.612,
                z: 0.523,
                v: 'c3',
                cols: [
                  [0.588, 0.501, 0.028]
                ]
              },
              {
                x: 0.614,
                z: 0.747,
                v: 'c5',
                cols: [
                  [0.592, 0.724, 0.033]
                ]
              },
              {
                x: 0.639,
                z: 0.828,
                v: 'c5',
                cols: [
                  [0.617, 0.805, 0.033]
                ]
              },
              {
                x: 0.638,
                z: 0.941,
                v: 'c3',
                cols: [
                  [0.614, 0.919, 0.028]
                ]
              },
              {
                x: 0.66,
                z: 0.128,
                v: 'c3',
                cols: [
                  [0.636, 0.106, 0.028]
                ]
              },
              {
                x: 0.656,
                z: 0.417,
                v: 'c5',
                cols: [
                  [0.634, 0.394, 0.033]
                ]
              },
              {
                x: 0.66,
                z: 0.585,
                v: 'c3',
                cols: [
                  [0.636, 0.563, 0.028]
                ]
              },
              {
                x: 0.653,
                z: 0.893,
                v: 'c5',
                cols: [
                  [0.631, 0.87, 0.033]
                ]
              },
              {
                x: 0.699,
                z: 0.808,
                v: 'c3',
                cols: [
                  [0.675, 0.786, 0.028]
                ]
              },
              {
                x: 0.722,
                z: 0.094,
                v: 'c3',
                cols: [
                  [0.698, 0.072, 0.028]
                ]
              },
              {
                x: 0.747,
                z: 0.763,
                v: 'c5',
                cols: [
                  [0.725, 0.74, 0.033]
                ]
              },
              {
                x: 0.769,
                z: 0.082,
                v: 'c3',
                cols: [
                  [0.745, 0.06, 0.028]
                ]
              },
              {
                x: 0.772,
                z: 0.144,
                v: 'c5',
                cols: [
                  [0.75, 0.121, 0.033]
                ]
              },
              {
                x: 0.763,
                z: 0.276,
                v: 'c3',
                cols: [
                  [0.739, 0.254, 0.028]
                ]
              },
              {
                x: 0.766,
                z: 0.338,
                v: 'c5',
                cols: [
                  [0.744, 0.315, 0.033]
                ]
              },
              {
                x: 0.77,
                z: 0.818,
                v: 'c5',
                cols: [
                  [0.748, 0.795, 0.033]
                ]
              },
              {
                x: 0.771,
                z: 0.896,
                v: 'c3',
                cols: [
                  [0.747, 0.874, 0.028]
                ]
              },
              {
                x: 0.787,
                z: 0.606,
                v: 'c3',
                cols: [
                  [0.763, 0.584, 0.028]
                ]
              },
              {
                x: 0.808,
                z: 0.302,
                v: 'c5',
                cols: [
                  [0.786, 0.279, 0.033]
                ]
              },
              {
                x: 0.814,
                z: 0.384,
                v: 'c3',
                cols: [
                  [0.79, 0.362, 0.028]
                ]
              },
              {
                x: 0.817,
                z: 0.516,
                v: 'c5',
                cols: [
                  [0.795, 0.493, 0.033]
                ]
              },
              {
                x: 0.813,
                z: 0.651,
                v: 'c3',
                cols: [
                  [0.789, 0.629, 0.028]
                ]
              },
              {
                x: 0.817,
                z: 0.729,
                v: 'c5',
                cols: [
                  [0.795, 0.706, 0.033]
                ]
              },
              {
                x: 0.816,
                z: 0.856,
                v: 'c3',
                cols: [
                  [0.792, 0.834, 0.028]
                ]
              },
              {
                x: 0.84,
                z: 0.569,
                v: 'c3',
                cols: [
                  [0.816, 0.547, 0.028]
                ]
              },
              {
                x: 0.834,
                z: 0.921,
                v: 'c3',
                cols: [
                  [0.81, 0.899, 0.028]
                ]
              },
              {
                x: 0.853,
                z: 0.059,
                v: 'c5',
                cols: [
                  [0.831, 0.036, 0.033]
                ]
              },
              {
                x: 0.856,
                z: 0.434,
                v: 'c3',
                cols: [
                  [0.832, 0.412, 0.028]
                ]
              },
              {
                x: 0.86,
                z: 0.616,
                v: 'c5',
                cols: [
                  [0.838, 0.593, 0.033]
                ]
              },
              {
                x: 0.857,
                z: 0.682,
                v: 'c5',
                cols: [
                  [0.835, 0.659, 0.033]
                ]
              },
              {
                x: 0.879,
                z: 0.106,
                v: 'c3',
                cols: [
                  [0.855, 0.084, 0.028]
                ]
              },
              {
                x: 0.874,
                z: 0.493,
                v: 'c5',
                cols: [
                  [0.852, 0.47, 0.033]
                ]
              },
              {
                x: 0.873,
                z: 0.739,
                v: 'c5',
                cols: [
                  [0.851, 0.716, 0.033]
                ]
              },
              {
                x: 0.873,
                z: 0.951,
                v: 'c3',
                cols: [
                  [0.849, 0.929, 0.028]
                ]
              },
              {
                x: 0.896,
                z: 0.562,
                v: 'c3',
                cols: [
                  [0.872, 0.54, 0.028]
                ]
              },
              {
                x: 0.907,
                z: 0.66,
                v: 'c3',
                cols: [
                  [0.883, 0.638, 0.028]
                ]
              },
              {
                x: 0.905,
                z: 0.991,
                v: 'c3',
                cols: [
                  [0.881, 0.969, 0.028]
                ]
              },
              {
                x: 0.938,
                z: 0.062,
                v: 'c3',
                cols: [
                  [0.914, 0.04, 0.028]
                ]
              },
              {
                x: 0.948,
                z: 0.252,
                v: 'c5',
                cols: [
                  [0.926, 0.229, 0.033]
                ]
              },
              {
                x: 0.941,
                z: 0.542,
                v: 'c3',
                cols: [
                  [0.917, 0.52, 0.028]
                ]
              },
              {
                x: 0.947,
                z: 0.595,
                v: 'c5',
                cols: [
                  [0.925, 0.572, 0.033]
                ]
              },
              {
                x: 0.965,
                z: 0.651,
                v: 'c3',
                cols: [
                  [0.941, 0.629, 0.028]
                ]
              },
              {
                x: 0.967,
                z: 0.939,
                v: 'c3',
                cols: [
                  [0.943, 0.917, 0.028]
                ]
              },
              {
                x: 0.988,
                z: 0.148,
                v: 'c5',
                cols: [
                  [0.966, 0.125, 0.033]
                ]
              },
              {
                x: 0.993,
                z: 0.214,
                v: 'c3',
                cols: [
                  [0.969, 0.192, 0.028]
                ]
              },
              {
                x: 0.995,
                z: 0.304,
                v: 'c3',
                cols: [
                  [0.971, 0.282, 0.028]
                ]
              },
              {
                x: 0.987,
                z: 0.506,
                v: 'c3',
                cols: [
                  [0.963, 0.484, 0.028]
                ]
              }
            ],
            rocks: [],
            sticks: [
              {
                x: 0.613,
                z: 0.288,
                rotY: 1.96,
                flip: 1,
                scale: 1,
                cols: [
                  [0.613, 0.288, 0.017]
                ]
              },
              {
                x: 0.388,
                z: 0.163,
                rotY: 3.45,
                flip: 0,
                scale: 1,
                cols: [
                  [0.388, 0.163, 0.017]
                ]
              },
              {
                x: 0.313,
                z: 0.313,
                rotY: 2.93,
                flip: 0,
                scale: 1,
                cols: [
                  [0.313, 0.313, 0.017]
                ]
              },
              {
                x: 0.713,
                z: 0.188,
                rotY: 2.67,
                flip: 1,
                scale: 1,
                cols: [
                  [0.713, 0.188, 0.017]
                ]
              },
              {
                x: 0.063,
                z: 0.113,
                rotY: 6.04,
                flip: 1,
                scale: 1,
                cols: [
                  [0.063, 0.113, 0.017]
                ]
              }
            ],
            minables: []
          }
        },
        {
          id: 'forest_2',
          seed: 301,
          terrain: {
            hills: [
              {
                shape: 'tri',
                x: 0,
                z: 0,
                wx: 0.774,
                wz: 0.877,
                dirX: 1,
                dirZ: 1,
                height: 0.438
              }
            ]
          },
          items: {
            trees: [
              {
                x: 0.068,
                z: 0.065,
                v: 'c5',
                cols: [
                  [0.046, 0.042, 0.033]
                ]
              },
              {
                x: 0.061,
                z: 0.145,
                v: 'c5',
                cols: [
                  [0.039, 0.122, 0.033]
                ]
              },
              {
                x: 0.069,
                z: 0.27,
                v: 'c3',
                cols: [
                  [0.045, 0.248, 0.028]
                ]
              },
              {
                x: 0.068,
                z: 0.351,
                v: 'c5',
                cols: [
                  [0.046, 0.328, 0.033]
                ]
              },
              {
                x: 0.063,
                z: 0.513,
                v: 'c3',
                cols: [
                  [0.039, 0.491, 0.028]
                ]
              },
              {
                x: 0.072,
                z: 0.59,
                v: 'c5',
                cols: [
                  [0.05, 0.567, 0.033]
                ]
              },
              {
                x: 0.101,
                z: 0.486,
                v: 'c3',
                cols: [
                  [0.077, 0.464, 0.028]
                ]
              },
              {
                x: 0.093,
                z: 0.655,
                v: 'c3',
                cols: [
                  [0.069, 0.633, 0.028]
                ]
              },
              {
                x: 0.132,
                z: 0.076,
                v: 'c5',
                cols: [
                  [0.11, 0.053, 0.033]
                ]
              },
              {
                x: 0.133,
                z: 0.538,
                v: 'c5',
                cols: [
                  [0.111, 0.515, 0.033]
                ]
              },
              {
                x: 0.125,
                z: 0.71,
                v: 'c5',
                cols: [
                  [0.103, 0.687, 0.033]
                ]
              },
              {
                x: 0.148,
                z: 0.592,
                v: 'c5',
                cols: [
                  [0.126, 0.569, 0.033]
                ]
              },
              {
                x: 0.159,
                z: 0.65,
                v: 'c3',
                cols: [
                  [0.135, 0.628, 0.028]
                ]
              },
              {
                x: 0.154,
                z: 0.756,
                v: 'c5',
                cols: [
                  [0.132, 0.733, 0.033]
                ]
              },
              {
                x: 0.151,
                z: 0.813,
                v: 'c3',
                cols: [
                  [0.127, 0.791, 0.028]
                ]
              },
              {
                x: 0.16,
                z: 0.883,
                v: 'c5',
                cols: [
                  [0.138, 0.86, 0.033]
                ]
              },
              {
                x: 0.179,
                z: 0.122,
                v: 'c5',
                cols: [
                  [0.157, 0.099, 0.033]
                ]
              },
              {
                x: 0.188,
                z: 0.261,
                v: 'c3',
                cols: [
                  [0.164, 0.239, 0.028]
                ]
              },
              {
                x: 0.178,
                z: 0.482,
                v: 'c3',
                cols: [
                  [0.154, 0.46, 0.028]
                ]
              },
              {
                x: 0.204,
                z: 0.326,
                v: 'c3',
                cols: [
                  [0.18, 0.304, 0.028]
                ]
              },
              {
                x: 0.205,
                z: 0.533,
                v: 'c3',
                cols: [
                  [0.181, 0.511, 0.028]
                ]
              },
              {
                x: 0.209,
                z: 0.793,
                v: 'c3',
                cols: [
                  [0.185, 0.771, 0.028]
                ]
              },
              {
                x: 0.216,
                z: 0.932,
                v: 'c5',
                cols: [
                  [0.194, 0.909, 0.033]
                ]
              },
              {
                x: 0.235,
                z: 0.096,
                v: 'c3',
                cols: [
                  [0.211, 0.074, 0.028]
                ]
              },
              {
                x: 0.236,
                z: 0.272,
                v: 'c3',
                cols: [
                  [0.212, 0.25, 0.028]
                ]
              },
              {
                x: 0.238,
                z: 0.487,
                v: 'c3',
                cols: [
                  [0.214, 0.465, 0.028]
                ]
              },
              {
                x: 0.245,
                z: 0.853,
                v: 'c5',
                cols: [
                  [0.223, 0.83, 0.033]
                ]
              },
              {
                x: 0.265,
                z: 0.148,
                v: 'c3',
                cols: [
                  [0.241, 0.126, 0.028]
                ]
              },
              {
                x: 0.27,
                z: 0.316,
                v: 'c3',
                cols: [
                  [0.246, 0.294, 0.028]
                ]
              },
              {
                x: 0.268,
                z: 0.367,
                v: 'c3',
                cols: [
                  [0.244, 0.345, 0.028]
                ]
              },
              {
                x: 0.266,
                z: 0.539,
                v: 'c5',
                cols: [
                  [0.244, 0.516, 0.033]
                ]
              },
              {
                x: 0.26,
                z: 0.741,
                v: 'c3',
                cols: [
                  [0.236, 0.719, 0.028]
                ]
              },
              {
                x: 0.27,
                z: 0.788,
                v: 'c3',
                cols: [
                  [0.246, 0.766, 0.028]
                ]
              },
              {
                x: 0.271,
                z: 0.902,
                v: 'c5',
                cols: [
                  [0.249, 0.879, 0.033]
                ]
              },
              {
                x: 0.295,
                z: 0.104,
                v: 'c3',
                cols: [
                  [0.271, 0.082, 0.028]
                ]
              },
              {
                x: 0.292,
                z: 0.487,
                v: 'c3',
                cols: [
                  [0.268, 0.465, 0.028]
                ]
              },
              {
                x: 0.292,
                z: 0.98,
                v: 'c5',
                cols: [
                  [0.27, 0.957, 0.033]
                ]
              },
              {
                x: 0.31,
                z: 0.347,
                v: 'c3',
                cols: [
                  [0.286, 0.325, 0.028]
                ]
              },
              {
                x: 0.326,
                z: 0.399,
                v: 'c5',
                cols: [
                  [0.304, 0.376, 0.033]
                ]
              },
              {
                x: 0.326,
                z: 0.455,
                v: 'c3',
                cols: [
                  [0.302, 0.433, 0.028]
                ]
              },
              {
                x: 0.315,
                z: 0.689,
                v: 'c3',
                cols: [
                  [0.291, 0.667, 0.028]
                ]
              },
              {
                x: 0.327,
                z: 0.735,
                v: 'c3',
                cols: [
                  [0.303, 0.713, 0.028]
                ]
              },
              {
                x: 0.342,
                z: 0.097,
                v: 'c3',
                cols: [
                  [0.318, 0.075, 0.028]
                ]
              },
              {
                x: 0.346,
                z: 0.146,
                v: 'c3',
                cols: [
                  [0.322, 0.124, 0.028]
                ]
              },
              {
                x: 0.35,
                z: 0.651,
                v: 'c5',
                cols: [
                  [0.328, 0.628, 0.033]
                ]
              },
              {
                x: 0.342,
                z: 0.925,
                v: 'c3',
                cols: [
                  [0.318, 0.903, 0.028]
                ]
              },
              {
                x: 0.355,
                z: 0.979,
                v: 'c5',
                cols: [
                  [0.333, 0.956, 0.033]
                ]
              },
              {
                x: 0.382,
                z: 0.433,
                v: 'c5',
                cols: [
                  [0.36, 0.41, 0.033]
                ]
              },
              {
                x: 0.372,
                z: 0.49,
                v: 'c3',
                cols: [
                  [0.348, 0.468, 0.028]
                ]
              },
              {
                x: 0.372,
                z: 0.705,
                v: 'c3',
                cols: [
                  [0.348, 0.683, 0.028]
                ]
              },
              {
                x: 0.398,
                z: 0.12,
                v: 'c5',
                cols: [
                  [0.376, 0.097, 0.033]
                ]
              },
              {
                x: 0.394,
                z: 0.182,
                v: 'c5',
                cols: [
                  [0.372, 0.159, 0.033]
                ]
              },
              {
                x: 0.412,
                z: 0.593,
                v: 'c3',
                cols: [
                  [0.388, 0.571, 0.028]
                ]
              },
              {
                x: 0.397,
                z: 0.869,
                v: 'c3',
                cols: [
                  [0.373, 0.847, 0.028]
                ]
              },
              {
                x: 0.402,
                z: 0.939,
                v: 'c3',
                cols: [
                  [0.378, 0.917, 0.028]
                ]
              },
              {
                x: 0.427,
                z: 0.466,
                v: 'c5',
                cols: [
                  [0.405, 0.443, 0.033]
                ]
              },
              {
                x: 0.428,
                z: 0.661,
                v: 'c3',
                cols: [
                  [0.404, 0.639, 0.028]
                ]
              },
              {
                x: 0.463,
                z: 0.127,
                v: 'c3',
                cols: [
                  [0.439, 0.105, 0.028]
                ]
              },
              {
                x: 0.449,
                z: 0.189,
                v: 'c3',
                cols: [
                  [0.425, 0.167, 0.028]
                ]
              },
              {
                x: 0.45,
                z: 0.522,
                v: 'c5',
                cols: [
                  [0.428, 0.499, 0.033]
                ]
              },
              {
                x: 0.467,
                z: 0.598,
                v: 'c5',
                cols: [
                  [0.445, 0.575, 0.033]
                ]
              },
              {
                x: 0.46,
                z: 0.819,
                v: 'c5',
                cols: [
                  [0.438, 0.796, 0.033]
                ]
              },
              {
                x: 0.451,
                z: 0.87,
                v: 'c3',
                cols: [
                  [0.427, 0.848, 0.028]
                ]
              },
              {
                x: 0.513,
                z: 0.06,
                v: 'c3',
                cols: [
                  [0.489, 0.038, 0.028]
                ]
              },
              {
                x: 0.514,
                z: 0.151,
                v: 'c3',
                cols: [
                  [0.49, 0.129, 0.028]
                ]
              },
              {
                x: 0.519,
                z: 0.206,
                v: 'c5',
                cols: [
                  [0.497, 0.183, 0.033]
                ]
              },
              {
                x: 0.505,
                z: 0.494,
                v: 'c3',
                cols: [
                  [0.481, 0.472, 0.028]
                ]
              },
              {
                x: 0.514,
                z: 0.549,
                v: 'c3',
                cols: [
                  [0.49, 0.527, 0.028]
                ]
              },
              {
                x: 0.52,
                z: 0.768,
                v: 'c3',
                cols: [
                  [0.496, 0.746, 0.028]
                ]
              },
              {
                x: 0.515,
                z: 0.817,
                v: 'c3',
                cols: [
                  [0.491, 0.795, 0.028]
                ]
              },
              {
                x: 0.56,
                z: 0.075,
                v: 'c5',
                cols: [
                  [0.538, 0.052, 0.033]
                ]
              },
              {
                x: 0.57,
                z: 0.16,
                v: 'c5',
                cols: [
                  [0.548, 0.137, 0.033]
                ]
              },
              {
                x: 0.576,
                z: 0.239,
                v: 'c3',
                cols: [
                  [0.552, 0.217, 0.028]
                ]
              },
              {
                x: 0.577,
                z: 0.495,
                v: 'c3',
                cols: [
                  [0.553, 0.473, 0.028]
                ]
              },
              {
                x: 0.573,
                z: 0.738,
                v: 'c5',
                cols: [
                  [0.551, 0.715, 0.033]
                ]
              },
              {
                x: 0.568,
                z: 0.818,
                v: 'c3',
                cols: [
                  [0.544, 0.796, 0.028]
                ]
              },
              {
                x: 0.604,
                z: 0.299,
                v: 'c3',
                cols: [
                  [0.58, 0.277, 0.028]
                ]
              },
              {
                x: 0.597,
                z: 0.548,
                v: 'c5',
                cols: [
                  [0.575, 0.525, 0.033]
                ]
              },
              {
                x: 0.617,
                z: 0.075,
                v: 'c3',
                cols: [
                  [0.593, 0.053, 0.028]
                ]
              },
              {
                x: 0.634,
                z: 0.172,
                v: 'c3',
                cols: [
                  [0.61, 0.15, 0.028]
                ]
              },
              {
                x: 0.626,
                z: 0.231,
                v: 'c5',
                cols: [
                  [0.604, 0.208, 0.033]
                ]
              },
              {
                x: 0.626,
                z: 0.341,
                v: 'c3',
                cols: [
                  [0.602, 0.319, 0.028]
                ]
              },
              {
                x: 0.629,
                z: 0.716,
                v: 'c5',
                cols: [
                  [0.607, 0.693, 0.033]
                ]
              },
              {
                x: 0.621,
                z: 0.783,
                v: 'c3',
                cols: [
                  [0.597, 0.761, 0.028]
                ]
              },
              {
                x: 0.618,
                z: 0.847,
                v: 'c3',
                cols: [
                  [0.594, 0.825, 0.028]
                ]
              },
              {
                x: 0.654,
                z: 0.397,
                v: 'c3',
                cols: [
                  [0.63, 0.375, 0.028]
                ]
              },
              {
                x: 0.661,
                z: 0.816,
                v: 'c3',
                cols: [
                  [0.637, 0.794, 0.028]
                ]
              },
              {
                x: 0.679,
                z: 0.273,
                v: 'c5',
                cols: [
                  [0.657, 0.25, 0.033]
                ]
              },
              {
                x: 0.681,
                z: 0.328,
                v: 'c5',
                cols: [
                  [0.659, 0.305, 0.033]
                ]
              },
              {
                x: 0.678,
                z: 0.734,
                v: 'c3',
                cols: [
                  [0.654, 0.712, 0.028]
                ]
              },
              {
                x: 0.688,
                z: 0.881,
                v: 'c5',
                cols: [
                  [0.666, 0.858, 0.033]
                ]
              },
              {
                x: 0.715,
                z: 0.371,
                v: 'c3',
                cols: [
                  [0.691, 0.349, 0.028]
                ]
              },
              {
                x: 0.711,
                z: 0.773,
                v: 'c3',
                cols: [
                  [0.687, 0.751, 0.028]
                ]
              },
              {
                x: 0.74,
                z: 0.259,
                v: 'c3',
                cols: [
                  [0.716, 0.237, 0.028]
                ]
              },
              {
                x: 0.737,
                z: 0.32,
                v: 'c3',
                cols: [
                  [0.713, 0.298, 0.028]
                ]
              },
              {
                x: 0.735,
                z: 0.733,
                v: 'c3',
                cols: [
                  [0.711, 0.711, 0.028]
                ]
              },
              {
                x: 0.733,
                z: 0.817,
                v: 'c3',
                cols: [
                  [0.709, 0.795, 0.028]
                ]
              },
              {
                x: 0.77,
                z: 0.095,
                v: 'c5',
                cols: [
                  [0.748, 0.072, 0.033]
                ]
              },
              {
                x: 0.762,
                z: 0.399,
                v: 'c3',
                cols: [
                  [0.738, 0.377, 0.028]
                ]
              },
              {
                x: 0.768,
                z: 0.455,
                v: 'c5',
                cols: [
                  [0.746, 0.432, 0.033]
                ]
              },
              {
                x: 0.768,
                z: 0.52,
                v: 'c5',
                cols: [
                  [0.746, 0.497, 0.033]
                ]
              },
              {
                x: 0.791,
                z: 0.157,
                v: 'c5',
                cols: [
                  [0.769, 0.134, 0.033]
                ]
              },
              {
                x: 0.786,
                z: 0.32,
                v: 'c3',
                cols: [
                  [0.762, 0.298, 0.028]
                ]
              },
              {
                x: 0.798,
                z: 0.563,
                v: 'c3',
                cols: [
                  [0.774, 0.541, 0.028]
                ]
              },
              {
                x: 0.793,
                z: 0.71,
                v: 'c5',
                cols: [
                  [0.771, 0.687, 0.033]
                ]
              },
              {
                x: 0.788,
                z: 0.771,
                v: 'c3',
                cols: [
                  [0.764, 0.749, 0.028]
                ]
              },
              {
                x: 0.825,
                z: 0.066,
                v: 'c5',
                cols: [
                  [0.803, 0.043, 0.033]
                ]
              },
              {
                x: 0.829,
                z: 0.46,
                v: 'c5',
                cols: [
                  [0.807, 0.437, 0.033]
                ]
              },
              {
                x: 0.826,
                z: 0.515,
                v: 'c5',
                cols: [
                  [0.804, 0.492, 0.033]
                ]
              },
              {
                x: 0.819,
                z: 0.822,
                v: 'c3',
                cols: [
                  [0.795, 0.8, 0.028]
                ]
              },
              {
                x: 0.856,
                z: 0.705,
                v: 'c5',
                cols: [
                  [0.834, 0.682, 0.033]
                ]
              },
              {
                x: 0.849,
                z: 0.762,
                v: 'c5',
                cols: [
                  [0.827, 0.739, 0.033]
                ]
              },
              {
                x: 0.881,
                z: 0.49,
                v: 'c5',
                cols: [
                  [0.859, 0.467, 0.033]
                ]
              },
              {
                x: 0.881,
                z: 0.819,
                v: 'c5',
                cols: [
                  [0.859, 0.796, 0.033]
                ]
              },
              {
                x: 0.904,
                z: 0.234,
                v: 'c5',
                cols: [
                  [0.882, 0.211, 0.033]
                ]
              },
              {
                x: 0.903,
                z: 0.29,
                v: 'c5',
                cols: [
                  [0.881, 0.267, 0.033]
                ]
              },
              {
                x: 0.908,
                z: 0.677,
                v: 'c5',
                cols: [
                  [0.886, 0.654, 0.033]
                ]
              },
              {
                x: 0.91,
                z: 0.744,
                v: 'c5',
                cols: [
                  [0.888, 0.721, 0.033]
                ]
              },
              {
                x: 0.908,
                z: 0.926,
                v: 'c3',
                cols: [
                  [0.884, 0.904, 0.028]
                ]
              },
              {
                x: 0.912,
                z: 0.992,
                v: 'c3',
                cols: [
                  [0.888, 0.97, 0.028]
                ]
              },
              {
                x: 0.93,
                z: 0.466,
                v: 'c3',
                cols: [
                  [0.906, 0.444, 0.028]
                ]
              },
              {
                x: 0.933,
                z: 0.52,
                v: 'c3',
                cols: [
                  [0.909, 0.498, 0.028]
                ]
              },
              {
                x: 0.949,
                z: 0.204,
                v: 'c3',
                cols: [
                  [0.925, 0.182, 0.028]
                ]
              },
              {
                x: 0.961,
                z: 0.262,
                v: 'c3',
                cols: [
                  [0.937, 0.24, 0.028]
                ]
              },
              {
                x: 0.962,
                z: 0.327,
                v: 'c5',
                cols: [
                  [0.94, 0.304, 0.033]
                ]
              },
              {
                x: 0.965,
                z: 0.686,
                v: 'c5',
                cols: [
                  [0.943, 0.663, 0.033]
                ]
              },
              {
                x: 0.963,
                z: 0.76,
                v: 'c5',
                cols: [
                  [0.941, 0.737, 0.033]
                ]
              },
              {
                x: 0.959,
                z: 0.815,
                v: 'c5',
                cols: [
                  [0.937, 0.792, 0.033]
                ]
              },
              {
                x: 0.964,
                z: 0.963,
                v: 'c3',
                cols: [
                  [0.94, 0.941, 0.028]
                ]
              },
              {
                x: 0.984,
                z: 0.484,
                v: 'c5',
                cols: [
                  [0.962, 0.461, 0.033]
                ]
              }
            ],
            rocks: [],
            sticks: [
              {
                x: 0.713,
                z: 0.563,
                rotY: 5.07,
                flip: 0,
                scale: 1,
                cols: [
                  [0.713, 0.563, 0.017]
                ]
              },
              {
                x: 0.763,
                z: 0.888,
                rotY: 5.27,
                flip: 0,
                scale: 1,
                cols: [
                  [0.763, 0.888, 0.017]
                ]
              },
              {
                x: 0.813,
                z: 0.963,
                rotY: 3.91,
                flip: 1,
                scale: 1,
                cols: [
                  [0.813, 0.963, 0.017]
                ]
              },
              {
                x: 0.538,
                z: 0.938,
                rotY: 5.84,
                flip: 1,
                scale: 1,
                cols: [
                  [0.538, 0.938, 0.017]
                ]
              },
              {
                x: 0.813,
                z: 0.288,
                rotY: 1.28,
                flip: 0,
                scale: 1,
                cols: [
                  [0.813, 0.288, 0.017]
                ]
              },
              {
                x: 0.638,
                z: 0.913,
                rotY: 0.61,
                flip: 1,
                scale: 1,
                cols: [
                  [0.638, 0.913, 0.017]
                ]
              },
              {
                x: 0.663,
                z: 0.163,
                rotY: 3.32,
                flip: 1,
                scale: 1,
                cols: [
                  [0.663, 0.163, 0.017]
                ]
              }
            ],
            minables: []
          }
        },
        {
          id: 'forest_3',
          seed: 401,
          terrain: {
            hills: [
              {
                shape: 'rect',
                x: 0.5,
                z: 1,
                wx: 0.577,
                wz: 0.369,
                height: 0.408
              }
            ]
          },
          items: {
            trees: [
              {
                x: 0.064,
                z: 0.337,
                v: 'c5',
                cols: [
                  [0.042, 0.314, 0.033]
                ]
              },
              {
                x: 0.063,
                z: 0.408,
                v: 'c3',
                cols: [
                  [0.039, 0.386, 0.028]
                ]
              },
              {
                x: 0.063,
                z: 0.878,
                v: 'c5',
                cols: [
                  [0.041, 0.855, 0.033]
                ]
              },
              {
                x: 0.069,
                z: 0.958,
                v: 'c3',
                cols: [
                  [0.045, 0.936, 0.028]
                ]
              },
              {
                x: 0.099,
                z: 0.194,
                v: 'c5',
                cols: [
                  [0.077, 0.171, 0.033]
                ]
              },
              {
                x: 0.086,
                z: 0.242,
                v: 'c3',
                cols: [
                  [0.062, 0.22, 0.028]
                ]
              },
              {
                x: 0.091,
                z: 0.668,
                v: 'c5',
                cols: [
                  [0.069, 0.645, 0.033]
                ]
              },
              {
                x: 0.099,
                z: 0.831,
                v: 'c5',
                cols: [
                  [0.077, 0.808, 0.033]
                ]
              },
              {
                x: 0.111,
                z: 0.413,
                v: 'c5',
                cols: [
                  [0.089, 0.39, 0.033]
                ]
              },
              {
                x: 0.121,
                z: 0.617,
                v: 'c3',
                cols: [
                  [0.097, 0.595, 0.028]
                ]
              },
              {
                x: 0.143,
                z: 0.464,
                v: 'c5',
                cols: [
                  [0.121, 0.441, 0.033]
                ]
              },
              {
                x: 0.154,
                z: 0.653,
                v: 'c3',
                cols: [
                  [0.13, 0.631, 0.028]
                ]
              },
              {
                x: 0.149,
                z: 0.858,
                v: 'c3',
                cols: [
                  [0.125, 0.836, 0.028]
                ]
              },
              {
                x: 0.146,
                z: 0.938,
                v: 'c3',
                cols: [
                  [0.122, 0.916, 0.028]
                ]
              },
              {
                x: 0.17,
                z: 0.205,
                v: 'c5',
                cols: [
                  [0.148, 0.182, 0.033]
                ]
              },
              {
                x: 0.197,
                z: 0.253,
                v: 'c5',
                cols: [
                  [0.175, 0.23, 0.033]
                ]
              },
              {
                x: 0.206,
                z: 0.461,
                v: 'c5',
                cols: [
                  [0.184, 0.438, 0.033]
                ]
              },
              {
                x: 0.201,
                z: 0.851,
                v: 'c5',
                cols: [
                  [0.179, 0.828, 0.033]
                ]
              },
              {
                x: 0.191,
                z: 0.9,
                v: 'c3',
                cols: [
                  [0.167, 0.878, 0.028]
                ]
              },
              {
                x: 0.231,
                z: 0.193,
                v: 'c3',
                cols: [
                  [0.207, 0.171, 0.028]
                ]
              },
              {
                x: 0.228,
                z: 0.519,
                v: 'c5',
                cols: [
                  [0.206, 0.496, 0.033]
                ]
              },
              {
                x: 0.221,
                z: 0.751,
                v: 'c5',
                cols: [
                  [0.199, 0.728, 0.033]
                ]
              },
              {
                x: 0.252,
                z: 0.143,
                v: 'c5',
                cols: [
                  [0.23, 0.12, 0.033]
                ]
              },
              {
                x: 0.253,
                z: 0.247,
                v: 'c3',
                cols: [
                  [0.229, 0.225, 0.028]
                ]
              },
              {
                x: 0.245,
                z: 0.809,
                v: 'c3',
                cols: [
                  [0.221, 0.787, 0.028]
                ]
              },
              {
                x: 0.256,
                z: 0.873,
                v: 'c5',
                cols: [
                  [0.234, 0.85, 0.033]
                ]
              },
              {
                x: 0.241,
                z: 0.931,
                v: 'c5',
                cols: [
                  [0.219, 0.908, 0.033]
                ]
              },
              {
                x: 0.282,
                z: 0.205,
                v: 'c5',
                cols: [
                  [0.26, 0.182, 0.033]
                ]
              },
              {
                x: 0.305,
                z: 0.812,
                v: 'c5',
                cols: [
                  [0.283, 0.789, 0.033]
                ]
              },
              {
                x: 0.332,
                z: 0.114,
                v: 'c3',
                cols: [
                  [0.308, 0.092, 0.028]
                ]
              },
              {
                x: 0.329,
                z: 0.164,
                v: 'c3',
                cols: [
                  [0.305, 0.142, 0.028]
                ]
              },
              {
                x: 0.36,
                z: 0.429,
                v: 'c5',
                cols: [
                  [0.338, 0.406, 0.033]
                ]
              },
              {
                x: 0.354,
                z: 0.488,
                v: 'c3',
                cols: [
                  [0.33, 0.466, 0.028]
                ]
              },
              {
                x: 0.354,
                z: 0.59,
                v: 'c3',
                cols: [
                  [0.33, 0.568, 0.028]
                ]
              },
              {
                x: 0.379,
                z: 0.09,
                v: 'c5',
                cols: [
                  [0.357, 0.067, 0.033]
                ]
              },
              {
                x: 0.416,
                z: 0.468,
                v: 'c3',
                cols: [
                  [0.392, 0.446, 0.028]
                ]
              },
              {
                x: 0.41,
                z: 0.572,
                v: 'c5',
                cols: [
                  [0.388, 0.549, 0.033]
                ]
              },
              {
                x: 0.406,
                z: 0.652,
                v: 'c5',
                cols: [
                  [0.384, 0.629, 0.033]
                ]
              },
              {
                x: 0.417,
                z: 0.917,
                v: 'c5',
                cols: [
                  [0.395, 0.894, 0.033]
                ]
              },
              {
                x: 0.413,
                z: 0.97,
                v: 'c3',
                cols: [
                  [0.389, 0.948, 0.028]
                ]
              },
              {
                x: 0.434,
                z: 0.415,
                v: 'c3',
                cols: [
                  [0.41, 0.393, 0.028]
                ]
              },
              {
                x: 0.434,
                z: 0.705,
                v: 'c5',
                cols: [
                  [0.412, 0.682, 0.033]
                ]
              },
              {
                x: 0.442,
                z: 0.768,
                v: 'c3',
                cols: [
                  [0.418, 0.746, 0.028]
                ]
              },
              {
                x: 0.467,
                z: 0.195,
                v: 'c3',
                cols: [
                  [0.443, 0.173, 0.028]
                ]
              },
              {
                x: 0.457,
                z: 0.336,
                v: 'c5',
                cols: [
                  [0.435, 0.313, 0.033]
                ]
              },
              {
                x: 0.47,
                z: 0.943,
                v: 'c5',
                cols: [
                  [0.448, 0.92, 0.033]
                ]
              },
              {
                x: 0.487,
                z: 0.242,
                v: 'c3',
                cols: [
                  [0.463, 0.22, 0.028]
                ]
              },
              {
                x: 0.491,
                z: 0.887,
                v: 'c5',
                cols: [
                  [0.469, 0.864, 0.033]
                ]
              },
              {
                x: 0.51,
                z: 0.177,
                v: 'c3',
                cols: [
                  [0.486, 0.155, 0.028]
                ]
              },
              {
                x: 0.521,
                z: 0.281,
                v: 'c3',
                cols: [
                  [0.497, 0.259, 0.028]
                ]
              },
              {
                x: 0.505,
                z: 0.362,
                v: 'c3',
                cols: [
                  [0.481, 0.34, 0.028]
                ]
              },
              {
                x: 0.52,
                z: 0.442,
                v: 'c3',
                cols: [
                  [0.496, 0.42, 0.028]
                ]
              },
              {
                x: 0.538,
                z: 0.231,
                v: 'c5',
                cols: [
                  [0.516, 0.208, 0.033]
                ]
              },
              {
                x: 0.532,
                z: 0.509,
                v: 'c5',
                cols: [
                  [0.51, 0.486, 0.033]
                ]
              },
              {
                x: 0.561,
                z: 0.12,
                v: 'c5',
                cols: [
                  [0.539, 0.097, 0.033]
                ]
              },
              {
                x: 0.572,
                z: 0.171,
                v: 'c3',
                cols: [
                  [0.548, 0.149, 0.028]
                ]
              },
              {
                x: 0.566,
                z: 0.35,
                v: 'c5',
                cols: [
                  [0.544, 0.327, 0.033]
                ]
              },
              {
                x: 0.565,
                z: 0.416,
                v: 'c5',
                cols: [
                  [0.543, 0.393, 0.033]
                ]
              },
              {
                x: 0.559,
                z: 0.862,
                v: 'c5',
                cols: [
                  [0.537, 0.839, 0.033]
                ]
              },
              {
                x: 0.587,
                z: 0.495,
                v: 'c3',
                cols: [
                  [0.563, 0.473, 0.028]
                ]
              },
              {
                x: 0.59,
                z: 0.616,
                v: 'c5',
                cols: [
                  [0.568, 0.593, 0.033]
                ]
              },
              {
                x: 0.588,
                z: 0.672,
                v: 'c3',
                cols: [
                  [0.564, 0.65, 0.028]
                ]
              },
              {
                x: 0.598,
                z: 0.908,
                v: 'c5',
                cols: [
                  [0.576, 0.885, 0.033]
                ]
              },
              {
                x: 0.616,
                z: 0.115,
                v: 'c5',
                cols: [
                  [0.594, 0.092, 0.033]
                ]
              },
              {
                x: 0.638,
                z: 0.439,
                v: 'c5',
                cols: [
                  [0.616, 0.416, 0.033]
                ]
              },
              {
                x: 0.644,
                z: 0.586,
                v: 'c3',
                cols: [
                  [0.62, 0.564, 0.028]
                ]
              },
              {
                x: 0.649,
                z: 0.937,
                v: 'c5',
                cols: [
                  [0.627, 0.914, 0.033]
                ]
              },
              {
                x: 0.68,
                z: 0.281,
                v: 'c3',
                cols: [
                  [0.656, 0.259, 0.028]
                ]
              },
              {
                x: 0.693,
                z: 0.126,
                v: 'c3',
                cols: [
                  [0.669, 0.104, 0.028]
                ]
              },
              {
                x: 0.7,
                z: 0.386,
                v: 'c5',
                cols: [
                  [0.678, 0.363, 0.033]
                ]
              },
              {
                x: 0.704,
                z: 0.838,
                v: 'c5',
                cols: [
                  [0.682, 0.815, 0.033]
                ]
              },
              {
                x: 0.697,
                z: 0.9,
                v: 'c5',
                cols: [
                  [0.675, 0.877, 0.033]
                ]
              },
              {
                x: 0.695,
                z: 0.969,
                v: 'c3',
                cols: [
                  [0.671, 0.947, 0.028]
                ]
              },
              {
                x: 0.729,
                z: 0.249,
                v: 'c5',
                cols: [
                  [0.707, 0.226, 0.033]
                ]
              },
              {
                x: 0.747,
                z: 0.929,
                v: 'c3',
                cols: [
                  [0.723, 0.907, 0.028]
                ]
              },
              {
                x: 0.778,
                z: 0.804,
                v: 'c5',
                cols: [
                  [0.756, 0.781, 0.033]
                ]
              },
              {
                x: 0.777,
                z: 0.859,
                v: 'c3',
                cols: [
                  [0.753, 0.837, 0.028]
                ]
              },
              {
                x: 0.802,
                z: 0.072,
                v: 'c3',
                cols: [
                  [0.778, 0.05, 0.028]
                ]
              },
              {
                x: 0.805,
                z: 0.242,
                v: 'c3',
                cols: [
                  [0.781, 0.22, 0.028]
                ]
              },
              {
                x: 0.809,
                z: 0.678,
                v: 'c3',
                cols: [
                  [0.785, 0.656, 0.028]
                ]
              },
              {
                x: 0.809,
                z: 0.938,
                v: 'c5',
                cols: [
                  [0.787, 0.915, 0.033]
                ]
              },
              {
                x: 0.825,
                z: 0.828,
                v: 'c3',
                cols: [
                  [0.801, 0.806, 0.028]
                ]
              },
              {
                x: 0.852,
                z: 0.068,
                v: 'c5',
                cols: [
                  [0.83, 0.045, 0.033]
                ]
              },
              {
                x: 0.852,
                z: 0.218,
                v: 'c5',
                cols: [
                  [0.83, 0.195, 0.033]
                ]
              },
              {
                x: 0.861,
                z: 0.596,
                v: 'c5',
                cols: [
                  [0.839, 0.573, 0.033]
                ]
              },
              {
                x: 0.858,
                z: 0.646,
                v: 'c3',
                cols: [
                  [0.834, 0.624, 0.028]
                ]
              },
              {
                x: 0.856,
                z: 0.702,
                v: 'c5',
                cols: [
                  [0.834, 0.679, 0.033]
                ]
              },
              {
                x: 0.86,
                z: 0.907,
                v: 'c3',
                cols: [
                  [0.836, 0.885, 0.028]
                ]
              },
              {
                x: 0.888,
                z: 0.27,
                v: 'c5',
                cols: [
                  [0.866, 0.247, 0.033]
                ]
              },
              {
                x: 0.886,
                z: 0.825,
                v: 'c5',
                cols: [
                  [0.864, 0.802, 0.033]
                ]
              },
              {
                x: 0.908,
                z: 0.219,
                v: 'c3',
                cols: [
                  [0.884, 0.197, 0.028]
                ]
              },
              {
                x: 0.912,
                z: 0.327,
                v: 'c3',
                cols: [
                  [0.888, 0.305, 0.028]
                ]
              },
              {
                x: 0.903,
                z: 0.428,
                v: 'c5',
                cols: [
                  [0.881, 0.405, 0.033]
                ]
              },
              {
                x: 0.912,
                z: 0.508,
                v: 'c5',
                cols: [
                  [0.89, 0.485, 0.033]
                ]
              },
              {
                x: 0.912,
                z: 0.647,
                v: 'c3',
                cols: [
                  [0.888, 0.625, 0.028]
                ]
              },
              {
                x: 0.914,
                z: 0.724,
                v: 'c3',
                cols: [
                  [0.89, 0.702, 0.028]
                ]
              },
              {
                x: 0.912,
                z: 0.939,
                v: 'c5',
                cols: [
                  [0.89, 0.916, 0.033]
                ]
              },
              {
                x: 0.943,
                z: 0.388,
                v: 'c5',
                cols: [
                  [0.921, 0.365, 0.033]
                ]
              },
              {
                x: 0.932,
                z: 0.559,
                v: 'c3',
                cols: [
                  [0.908, 0.537, 0.028]
                ]
              },
              {
                x: 0.963,
                z: 0.464,
                v: 'c3',
                cols: [
                  [0.939, 0.442, 0.028]
                ]
              },
              {
                x: 0.969,
                z: 0.627,
                v: 'c5',
                cols: [
                  [0.947, 0.604, 0.033]
                ]
              },
              {
                x: 0.961,
                z: 0.691,
                v: 'c3',
                cols: [
                  [0.937, 0.669, 0.028]
                ]
              }
            ],
            rocks: [],
            sticks: [
              {
                x: 0.413,
                z: 0.263,
                rotY: 3.14,
                flip: 1,
                scale: 1,
                cols: [
                  [0.413, 0.263, 0.017]
                ]
              },
              {
                x: 0.088,
                z: 0.113,
                rotY: 4.2,
                flip: 1,
                scale: 1,
                cols: [
                  [0.088, 0.113, 0.017]
                ]
              },
              {
                x: 0.263,
                z: 0.438,
                rotY: 3.43,
                flip: 0,
                scale: 1,
                cols: [
                  [0.263, 0.438, 0.017]
                ]
              },
              {
                x: 0.563,
                z: 0.963,
                rotY: 0.78,
                flip: 0,
                scale: 1,
                cols: [
                  [0.563, 0.963, 0.017]
                ]
              }
            ],
            minables: []
          }
        },
        {
          id: 'forest_4',
          seed: 501,
          terrain: {
            hills: [
              {
                shape: 'rect',
                x: 0,
                z: 0.5,
                wx: 0.438,
                wz: 0.593,
                height: 0.473
              }
            ]
          },
          items: {
            trees: [
              {
                x: 0.066,
                z: 0.063,
                v: 'c3',
                cols: [
                  [0.042, 0.041, 0.028]
                ]
              },
              {
                x: 0.062,
                z: 0.141,
                v: 'c5',
                cols: [
                  [0.04, 0.118, 0.033]
                ]
              },
              {
                x: 0.059,
                z: 0.215,
                v: 'c5',
                cols: [
                  [0.037, 0.192, 0.033]
                ]
              },
              {
                x: 0.058,
                z: 0.266,
                v: 'c3',
                cols: [
                  [0.034, 0.244, 0.028]
                ]
              },
              {
                x: 0.07,
                z: 0.406,
                v: 'c5',
                cols: [
                  [0.048, 0.383, 0.033]
                ]
              },
              {
                x: 0.061,
                z: 0.46,
                v: 'c3',
                cols: [
                  [0.037, 0.438, 0.028]
                ]
              },
              {
                x: 0.057,
                z: 0.566,
                v: 'c3',
                cols: [
                  [0.033, 0.544, 0.028]
                ]
              },
              {
                x: 0.066,
                z: 0.857,
                v: 'c5',
                cols: [
                  [0.044, 0.834, 0.033]
                ]
              },
              {
                x: 0.058,
                z: 0.913,
                v: 'c5',
                cols: [
                  [0.036, 0.89, 0.033]
                ]
              },
              {
                x: 0.096,
                z: 0.333,
                v: 'c3',
                cols: [
                  [0.072, 0.311, 0.028]
                ]
              },
              {
                x: 0.095,
                z: 0.516,
                v: 'c5',
                cols: [
                  [0.073, 0.493, 0.033]
                ]
              },
              {
                x: 0.09,
                z: 0.97,
                v: 'c3',
                cols: [
                  [0.066, 0.948, 0.028]
                ]
              },
              {
                x: 0.115,
                z: 0.071,
                v: 'c5',
                cols: [
                  [0.093, 0.048, 0.033]
                ]
              },
              {
                x: 0.115,
                z: 0.171,
                v: 'c5',
                cols: [
                  [0.093, 0.148, 0.033]
                ]
              },
              {
                x: 0.111,
                z: 0.236,
                v: 'c5',
                cols: [
                  [0.089, 0.213, 0.033]
                ]
              },
              {
                x: 0.115,
                z: 0.434,
                v: 'c3',
                cols: [
                  [0.091, 0.412, 0.028]
                ]
              },
              {
                x: 0.134,
                z: 0.296,
                v: 'c5',
                cols: [
                  [0.112, 0.273, 0.033]
                ]
              },
              {
                x: 0.131,
                z: 0.369,
                v: 'c3',
                cols: [
                  [0.107, 0.347, 0.028]
                ]
              },
              {
                x: 0.129,
                z: 0.931,
                v: 'c5',
                cols: [
                  [0.107, 0.908, 0.033]
                ]
              },
              {
                x: 0.162,
                z: 0.209,
                v: 'c3',
                cols: [
                  [0.138, 0.187, 0.028]
                ]
              },
              {
                x: 0.165,
                z: 0.415,
                v: 'c3',
                cols: [
                  [0.141, 0.393, 0.028]
                ]
              },
              {
                x: 0.168,
                z: 0.481,
                v: 'c5',
                cols: [
                  [0.146, 0.458, 0.033]
                ]
              },
              {
                x: 0.162,
                z: 0.98,
                v: 'c5',
                cols: [
                  [0.14, 0.957, 0.033]
                ]
              },
              {
                x: 0.186,
                z: 0.06,
                v: 'c3',
                cols: [
                  [0.162, 0.038, 0.028]
                ]
              },
              {
                x: 0.183,
                z: 0.363,
                v: 'c5',
                cols: [
                  [0.161, 0.34, 0.033]
                ]
              },
              {
                x: 0.211,
                z: 0.166,
                v: 'c3',
                cols: [
                  [0.187, 0.144, 0.028]
                ]
              },
              {
                x: 0.212,
                z: 0.69,
                v: 'c5',
                cols: [
                  [0.19, 0.667, 0.033]
                ]
              },
              {
                x: 0.243,
                z: 0.066,
                v: 'c3',
                cols: [
                  [0.219, 0.044, 0.028]
                ]
              },
              {
                x: 0.23,
                z: 0.84,
                v: 'c5',
                cols: [
                  [0.208, 0.817, 0.033]
                ]
              },
              {
                x: 0.265,
                z: 0.691,
                v: 'c3',
                cols: [
                  [0.241, 0.669, 0.028]
                ]
              },
              {
                x: 0.271,
                z: 0.796,
                v: 'c3',
                cols: [
                  [0.247, 0.774, 0.028]
                ]
              },
              {
                x: 0.253,
                z: 0.915,
                v: 'c5',
                cols: [
                  [0.231, 0.892, 0.033]
                ]
              },
              {
                x: 0.281,
                z: 0.741,
                v: 'c5',
                cols: [
                  [0.259, 0.718, 0.033]
                ]
              },
              {
                x: 0.282,
                z: 0.867,
                v: 'c3',
                cols: [
                  [0.258, 0.845, 0.028]
                ]
              },
              {
                x: 0.294,
                z: 0.97,
                v: 'c5',
                cols: [
                  [0.272, 0.947, 0.033]
                ]
              },
              {
                x: 0.307,
                z: 0.394,
                v: 'c3',
                cols: [
                  [0.283, 0.372, 0.028]
                ]
              },
              {
                x: 0.316,
                z: 0.832,
                v: 'c3',
                cols: [
                  [0.292, 0.81, 0.028]
                ]
              },
              {
                x: 0.313,
                z: 0.906,
                v: 'c3',
                cols: [
                  [0.289, 0.884, 0.028]
                ]
              },
              {
                x: 0.341,
                z: 0.068,
                v: 'c5',
                cols: [
                  [0.319, 0.045, 0.033]
                ]
              },
              {
                x: 0.346,
                z: 0.343,
                v: 'c5',
                cols: [
                  [0.324, 0.32, 0.033]
                ]
              },
              {
                x: 0.346,
                z: 0.437,
                v: 'c3',
                cols: [
                  [0.322, 0.415, 0.028]
                ]
              },
              {
                x: 0.339,
                z: 0.779,
                v: 'c3',
                cols: [
                  [0.315, 0.757, 0.028]
                ]
              },
              {
                x: 0.346,
                z: 0.982,
                v: 'c3',
                cols: [
                  [0.322, 0.96, 0.028]
                ]
              },
              {
                x: 0.37,
                z: 0.396,
                v: 'c5',
                cols: [
                  [0.348, 0.373, 0.033]
                ]
              },
              {
                x: 0.394,
                z: 0.122,
                v: 'c5',
                cols: [
                  [0.372, 0.099, 0.033]
                ]
              },
              {
                x: 0.394,
                z: 0.189,
                v: 'c5',
                cols: [
                  [0.372, 0.166, 0.033]
                ]
              },
              {
                x: 0.392,
                z: 0.942,
                v: 'c3',
                cols: [
                  [0.368, 0.92, 0.028]
                ]
              },
              {
                x: 0.412,
                z: 0.057,
                v: 'c5',
                cols: [
                  [0.39, 0.034, 0.033]
                ]
              },
              {
                x: 0.411,
                z: 0.313,
                v: 'c3',
                cols: [
                  [0.387, 0.291, 0.028]
                ]
              },
              {
                x: 0.417,
                z: 0.429,
                v: 'c5',
                cols: [
                  [0.395, 0.406, 0.033]
                ]
              },
              {
                x: 0.438,
                z: 0.372,
                v: 'c3',
                cols: [
                  [0.414, 0.35, 0.028]
                ]
              },
              {
                x: 0.439,
                z: 0.987,
                v: 'c5',
                cols: [
                  [0.417, 0.964, 0.033]
                ]
              },
              {
                x: 0.466,
                z: 0.092,
                v: 'c5',
                cols: [
                  [0.444, 0.069, 0.033]
                ]
              },
              {
                x: 0.456,
                z: 0.142,
                v: 'c3',
                cols: [
                  [0.432, 0.12, 0.028]
                ]
              },
              {
                x: 0.483,
                z: 0.321,
                v: 'c5',
                cols: [
                  [0.461, 0.298, 0.033]
                ]
              },
              {
                x: 0.486,
                z: 0.414,
                v: 'c5',
                cols: [
                  [0.464, 0.391, 0.033]
                ]
              },
              {
                x: 0.52,
                z: 0.103,
                v: 'c5',
                cols: [
                  [0.498, 0.08, 0.033]
                ]
              },
              {
                x: 0.546,
                z: 0.331,
                v: 'c5',
                cols: [
                  [0.524, 0.308, 0.033]
                ]
              },
              {
                x: 0.537,
                z: 0.396,
                v: 'c3',
                cols: [
                  [0.513, 0.374, 0.028]
                ]
              },
              {
                x: 0.572,
                z: 0.058,
                v: 'c3',
                cols: [
                  [0.548, 0.036, 0.028]
                ]
              },
              {
                x: 0.594,
                z: 0.859,
                v: 'c3',
                cols: [
                  [0.57, 0.837, 0.028]
                ]
              },
              {
                x: 0.582,
                z: 0.916,
                v: 'c3',
                cols: [
                  [0.558, 0.894, 0.028]
                ]
              },
              {
                x: 0.606,
                z: 0.958,
                v: 'c3',
                cols: [
                  [0.582, 0.936, 0.028]
                ]
              },
              {
                x: 0.647,
                z: 0.807,
                v: 'c3',
                cols: [
                  [0.623, 0.785, 0.028]
                ]
              },
              {
                x: 0.637,
                z: 0.894,
                v: 'c3',
                cols: [
                  [0.613, 0.872, 0.028]
                ]
              },
              {
                x: 0.666,
                z: 0.068,
                v: 'c5',
                cols: [
                  [0.644, 0.045, 0.033]
                ]
              },
              {
                x: 0.663,
                z: 0.712,
                v: 'c3',
                cols: [
                  [0.639, 0.69, 0.028]
                ]
              },
              {
                x: 0.67,
                z: 0.954,
                v: 'c5',
                cols: [
                  [0.648, 0.931, 0.033]
                ]
              },
              {
                x: 0.692,
                z: 0.465,
                v: 'c5',
                cols: [
                  [0.67, 0.442, 0.033]
                ]
              },
              {
                x: 0.695,
                z: 0.661,
                v: 'c3',
                cols: [
                  [0.671, 0.639, 0.028]
                ]
              },
              {
                x: 0.68,
                z: 0.77,
                v: 'c5',
                cols: [
                  [0.658, 0.747, 0.033]
                ]
              },
              {
                x: 0.688,
                z: 0.842,
                v: 'c5',
                cols: [
                  [0.666, 0.819, 0.033]
                ]
              },
              {
                x: 0.72,
                z: 0.085,
                v: 'c3',
                cols: [
                  [0.696, 0.063, 0.028]
                ]
              },
              {
                x: 0.71,
                z: 0.139,
                v: 'c3',
                cols: [
                  [0.686, 0.117, 0.028]
                ]
              },
              {
                x: 0.722,
                z: 0.41,
                v: 'c3',
                cols: [
                  [0.698, 0.388, 0.028]
                ]
              },
              {
                x: 0.713,
                z: 0.714,
                v: 'c5',
                cols: [
                  [0.691, 0.691, 0.033]
                ]
              },
              {
                x: 0.704,
                z: 0.909,
                v: 'c3',
                cols: [
                  [0.68, 0.887, 0.028]
                ]
              },
              {
                x: 0.739,
                z: 0.192,
                v: 'c3',
                cols: [
                  [0.715, 0.17, 0.028]
                ]
              },
              {
                x: 0.747,
                z: 0.481,
                v: 'c3',
                cols: [
                  [0.723, 0.459, 0.028]
                ]
              },
              {
                x: 0.745,
                z: 0.77,
                v: 'c5',
                cols: [
                  [0.723, 0.747, 0.033]
                ]
              },
              {
                x: 0.743,
                z: 0.83,
                v: 'c5',
                cols: [
                  [0.721, 0.807, 0.033]
                ]
              },
              {
                x: 0.732,
                z: 0.967,
                v: 'c5',
                cols: [
                  [0.71, 0.944, 0.033]
                ]
              },
              {
                x: 0.764,
                z: 0.115,
                v: 'c3',
                cols: [
                  [0.74, 0.093, 0.028]
                ]
              },
              {
                x: 0.767,
                z: 0.664,
                v: 'c5',
                cols: [
                  [0.745, 0.641, 0.033]
                ]
              },
              {
                x: 0.756,
                z: 0.879,
                v: 'c3',
                cols: [
                  [0.732, 0.857, 0.028]
                ]
              },
              {
                x: 0.792,
                z: 0.165,
                v: 'c3',
                cols: [
                  [0.768, 0.143, 0.028]
                ]
              },
              {
                x: 0.79,
                z: 0.397,
                v: 'c5',
                cols: [
                  [0.768, 0.374, 0.033]
                ]
              },
              {
                x: 0.812,
                z: 0.104,
                v: 'c3',
                cols: [
                  [0.788, 0.082, 0.028]
                ]
              },
              {
                x: 0.814,
                z: 0.471,
                v: 'c3',
                cols: [
                  [0.79, 0.449, 0.028]
                ]
              },
              {
                x: 0.811,
                z: 0.694,
                v: 'c3',
                cols: [
                  [0.787, 0.672, 0.028]
                ]
              },
              {
                x: 0.813,
                z: 0.744,
                v: 'c3',
                cols: [
                  [0.789, 0.722, 0.028]
                ]
              },
              {
                x: 0.814,
                z: 0.815,
                v: 'c5',
                cols: [
                  [0.792, 0.792, 0.033]
                ]
              },
              {
                x: 0.818,
                z: 0.888,
                v: 'c5',
                cols: [
                  [0.796, 0.865, 0.033]
                ]
              },
              {
                x: 0.846,
                z: 0.282,
                v: 'c5',
                cols: [
                  [0.824, 0.259, 0.033]
                ]
              },
              {
                x: 0.834,
                z: 0.346,
                v: 'c3',
                cols: [
                  [0.81, 0.324, 0.028]
                ]
              },
              {
                x: 0.842,
                z: 0.42,
                v: 'c5',
                cols: [
                  [0.82, 0.397, 0.033]
                ]
              },
              {
                x: 0.862,
                z: 0.143,
                v: 'c3',
                cols: [
                  [0.838, 0.121, 0.028]
                ]
              },
              {
                x: 0.864,
                z: 0.69,
                v: 'c3',
                cols: [
                  [0.84, 0.668, 0.028]
                ]
              },
              {
                x: 0.862,
                z: 0.764,
                v: 'c5',
                cols: [
                  [0.84, 0.741, 0.033]
                ]
              },
              {
                x: 0.883,
                z: 0.33,
                v: 'c3',
                cols: [
                  [0.859, 0.308, 0.028]
                ]
              },
              {
                x: 0.894,
                z: 0.405,
                v: 'c3',
                cols: [
                  [0.87, 0.383, 0.028]
                ]
              },
              {
                x: 0.888,
                z: 0.466,
                v: 'c5',
                cols: [
                  [0.866, 0.443, 0.033]
                ]
              },
              {
                x: 0.895,
                z: 0.82,
                v: 'c5',
                cols: [
                  [0.873, 0.797, 0.033]
                ]
              },
              {
                x: 0.921,
                z: 0.129,
                v: 'c5',
                cols: [
                  [0.899, 0.106, 0.033]
                ]
              },
              {
                x: 0.934,
                z: 0.435,
                v: 'c3',
                cols: [
                  [0.91, 0.413, 0.028]
                ]
              },
              {
                x: 0.932,
                z: 0.763,
                v: 'c3',
                cols: [
                  [0.908, 0.741, 0.028]
                ]
              },
              {
                x: 0.961,
                z: 0.618,
                v: 'c3',
                cols: [
                  [0.937, 0.596, 0.028]
                ]
              },
              {
                x: 0.962,
                z: 0.808,
                v: 'c3',
                cols: [
                  [0.938, 0.786, 0.028]
                ]
              },
              {
                x: 0.993,
                z: 0.405,
                v: 'c3',
                cols: [
                  [0.969, 0.383, 0.028]
                ]
              }
            ],
            rocks: [],
            sticks: [
              {
                x: 0.313,
                z: 0.263,
                rotY: 3.11,
                flip: 0,
                scale: 1,
                cols: [
                  [0.313, 0.263, 0.017]
                ]
              },
              {
                x: 0.638,
                z: 0.263,
                rotY: 4.97,
                flip: 1,
                scale: 1,
                cols: [
                  [0.638, 0.263, 0.017]
                ]
              },
              {
                x: 0.563,
                z: 0.438,
                rotY: 1.59,
                flip: 0,
                scale: 1,
                cols: [
                  [0.563, 0.438, 0.017]
                ]
              },
              {
                x: 0.363,
                z: 0.638,
                rotY: 0.31,
                flip: 0,
                scale: 1,
                cols: [
                  [0.363, 0.638, 0.017]
                ]
              },
              {
                x: 0.863,
                z: 0.038,
                rotY: 6.06,
                flip: 1,
                scale: 1,
                cols: [
                  [0.863, 0.038, 0.017]
                ]
              },
              {
                x: 0.238,
                z: 0.238,
                rotY: 4.59,
                flip: 0,
                scale: 1,
                cols: [
                  [0.238, 0.238, 0.017]
                ]
              }
            ],
            minables: []
          }
        },
        {
          id: 'forest_5',
          seed: 601,
          terrain: {
            hills: [
              {
                shape: 'tri',
                x: 1,
                z: 1,
                wx: 0.868,
                wz: 0.894,
                dirX: -1,
                dirZ: -1,
                height: 0.496
              }
            ]
          },
          items: {
            trees: [
              {
                x: 0.059,
                z: 0.139,
                v: 'c5',
                cols: [
                  [0.037, 0.116, 0.033]
                ]
              },
              {
                x: 0.052,
                z: 0.78,
                v: 'c3',
                cols: [
                  [0.028, 0.758, 0.028]
                ]
              },
              {
                x: 0.058,
                z: 0.837,
                v: 'c3',
                cols: [
                  [0.034, 0.815, 0.028]
                ]
              },
              {
                x: 0.065,
                z: 0.897,
                v: 'c3',
                cols: [
                  [0.041, 0.875, 0.028]
                ]
              },
              {
                x: 0.078,
                z: 0.224,
                v: 'c3',
                cols: [
                  [0.054, 0.202, 0.028]
                ]
              },
              {
                x: 0.115,
                z: 0.266,
                v: 'c3',
                cols: [
                  [0.091, 0.244, 0.028]
                ]
              },
              {
                x: 0.103,
                z: 0.316,
                v: 'c3',
                cols: [
                  [0.079, 0.294, 0.028]
                ]
              },
              {
                x: 0.111,
                z: 0.376,
                v: 'c5',
                cols: [
                  [0.089, 0.353, 0.033]
                ]
              },
              {
                x: 0.108,
                z: 0.445,
                v: 'c5',
                cols: [
                  [0.086, 0.422, 0.033]
                ]
              },
              {
                x: 0.104,
                z: 0.853,
                v: 'c5',
                cols: [
                  [0.082, 0.83, 0.033]
                ]
              },
              {
                x: 0.14,
                z: 0.221,
                v: 'c5',
                cols: [
                  [0.118, 0.198, 0.033]
                ]
              },
              {
                x: 0.153,
                z: 0.294,
                v: 'c3',
                cols: [
                  [0.129, 0.272, 0.028]
                ]
              },
              {
                x: 0.164,
                z: 0.349,
                v: 'c5',
                cols: [
                  [0.142, 0.326, 0.033]
                ]
              },
              {
                x: 0.156,
                z: 0.484,
                v: 'c3',
                cols: [
                  [0.132, 0.462, 0.028]
                ]
              },
              {
                x: 0.151,
                z: 0.892,
                v: 'c5',
                cols: [
                  [0.129, 0.869, 0.033]
                ]
              },
              {
                x: 0.187,
                z: 0.409,
                v: 'c5',
                cols: [
                  [0.165, 0.386, 0.033]
                ]
              },
              {
                x: 0.184,
                z: 0.678,
                v: 'c3',
                cols: [
                  [0.16, 0.656, 0.028]
                ]
              },
              {
                x: 0.203,
                z: 0.233,
                v: 'c3',
                cols: [
                  [0.179, 0.211, 0.028]
                ]
              },
              {
                x: 0.206,
                z: 0.313,
                v: 'c3',
                cols: [
                  [0.182, 0.291, 0.028]
                ]
              },
              {
                x: 0.204,
                z: 0.463,
                v: 'c3',
                cols: [
                  [0.18, 0.441, 0.028]
                ]
              },
              {
                x: 0.205,
                z: 0.896,
                v: 'c3',
                cols: [
                  [0.181, 0.874, 0.028]
                ]
              },
              {
                x: 0.227,
                z: 0.563,
                v: 'c3',
                cols: [
                  [0.203, 0.541, 0.028]
                ]
              },
              {
                x: 0.233,
                z: 0.629,
                v: 'c5',
                cols: [
                  [0.211, 0.606, 0.033]
                ]
              },
              {
                x: 0.23,
                z: 0.734,
                v: 'c3',
                cols: [
                  [0.206, 0.712, 0.028]
                ]
              },
              {
                x: 0.248,
                z: 0.247,
                v: 'c3',
                cols: [
                  [0.224, 0.225, 0.028]
                ]
              },
              {
                x: 0.25,
                z: 0.351,
                v: 'c5',
                cols: [
                  [0.228, 0.328, 0.033]
                ]
              },
              {
                x: 0.258,
                z: 0.473,
                v: 'c5',
                cols: [
                  [0.236, 0.45, 0.033]
                ]
              },
              {
                x: 0.251,
                z: 0.683,
                v: 'c3',
                cols: [
                  [0.227, 0.661, 0.028]
                ]
              },
              {
                x: 0.253,
                z: 0.874,
                v: 'c5',
                cols: [
                  [0.231, 0.851, 0.033]
                ]
              },
              {
                x: 0.277,
                z: 0.059,
                v: 'c5',
                cols: [
                  [0.255, 0.036, 0.033]
                ]
              },
              {
                x: 0.269,
                z: 0.529,
                v: 'c5',
                cols: [
                  [0.247, 0.506, 0.033]
                ]
              },
              {
                x: 0.272,
                z: 0.589,
                v: 'c3',
                cols: [
                  [0.248, 0.567, 0.028]
                ]
              },
              {
                x: 0.304,
                z: 0.248,
                v: 'c3',
                cols: [
                  [0.28, 0.226, 0.028]
                ]
              },
              {
                x: 0.29,
                z: 0.423,
                v: 'c3',
                cols: [
                  [0.266, 0.401, 0.028]
                ]
              },
              {
                x: 0.289,
                z: 0.651,
                v: 'c5',
                cols: [
                  [0.267, 0.628, 0.033]
                ]
              },
              {
                x: 0.3,
                z: 0.912,
                v: 'c5',
                cols: [
                  [0.278, 0.889, 0.033]
                ]
              },
              {
                x: 0.321,
                z: 0.293,
                v: 'c3',
                cols: [
                  [0.297, 0.271, 0.028]
                ]
              },
              {
                x: 0.328,
                z: 0.467,
                v: 'c3',
                cols: [
                  [0.304, 0.445, 0.028]
                ]
              },
              {
                x: 0.326,
                z: 0.541,
                v: 'c3',
                cols: [
                  [0.302, 0.519, 0.028]
                ]
              },
              {
                x: 0.329,
                z: 0.837,
                v: 'c5',
                cols: [
                  [0.307, 0.814, 0.033]
                ]
              },
              {
                x: 0.33,
                z: 0.963,
                v: 'c3',
                cols: [
                  [0.306, 0.941, 0.028]
                ]
              },
              {
                x: 0.339,
                z: 0.419,
                v: 'c5',
                cols: [
                  [0.317, 0.396, 0.033]
                ]
              },
              {
                x: 0.345,
                z: 0.592,
                v: 'c3',
                cols: [
                  [0.321, 0.57, 0.028]
                ]
              },
              {
                x: 0.35,
                z: 0.663,
                v: 'c3',
                cols: [
                  [0.326, 0.641, 0.028]
                ]
              },
              {
                x: 0.369,
                z: 0.895,
                v: 'c5',
                cols: [
                  [0.347, 0.872, 0.033]
                ]
              },
              {
                x: 0.399,
                z: 0.447,
                v: 'c3',
                cols: [
                  [0.375, 0.425, 0.028]
                ]
              },
              {
                x: 0.398,
                z: 0.506,
                v: 'c5',
                cols: [
                  [0.376, 0.483, 0.033]
                ]
              },
              {
                x: 0.395,
                z: 0.609,
                v: 'c3',
                cols: [
                  [0.371, 0.587, 0.028]
                ]
              },
              {
                x: 0.408,
                z: 0.563,
                v: 'c3',
                cols: [
                  [0.384, 0.541, 0.028]
                ]
              },
              {
                x: 0.45,
                z: 0.538,
                v: 'c3',
                cols: [
                  [0.426, 0.516, 0.028]
                ]
              },
              {
                x: 0.46,
                z: 0.061,
                v: 'c5',
                cols: [
                  [0.438, 0.038, 0.033]
                ]
              },
              {
                x: 0.506,
                z: 0.107,
                v: 'c5',
                cols: [
                  [0.484, 0.084, 0.033]
                ]
              },
              {
                x: 0.531,
                z: 0.053,
                v: 'c3',
                cols: [
                  [0.507, 0.031, 0.028]
                ]
              },
              {
                x: 0.536,
                z: 0.917,
                v: 'c3',
                cols: [
                  [0.512, 0.895, 0.028]
                ]
              },
              {
                x: 0.544,
                z: 0.99,
                v: 'c3',
                cols: [
                  [0.52, 0.968, 0.028]
                ]
              },
              {
                x: 0.552,
                z: 0.139,
                v: 'c5',
                cols: [
                  [0.53, 0.116, 0.033]
                ]
              },
              {
                x: 0.578,
                z: 0.053,
                v: 'c3',
                cols: [
                  [0.554, 0.031, 0.028]
                ]
              },
              {
                x: 0.59,
                z: 0.483,
                v: 'c3',
                cols: [
                  [0.566, 0.461, 0.028]
                ]
              },
              {
                x: 0.586,
                z: 0.915,
                v: 'c3',
                cols: [
                  [0.562, 0.893, 0.028]
                ]
              },
              {
                x: 0.583,
                z: 0.962,
                v: 'c3',
                cols: [
                  [0.559, 0.94, 0.028]
                ]
              },
              {
                x: 0.609,
                z: 0.11,
                v: 'c3',
                cols: [
                  [0.585, 0.088, 0.028]
                ]
              },
              {
                x: 0.608,
                z: 0.54,
                v: 'c5',
                cols: [
                  [0.586, 0.517, 0.033]
                ]
              },
              {
                x: 0.614,
                z: 0.871,
                v: 'c5',
                cols: [
                  [0.592, 0.848, 0.033]
                ]
              },
              {
                x: 0.634,
                z: 0.448,
                v: 'c5',
                cols: [
                  [0.612, 0.425, 0.033]
                ]
              },
              {
                x: 0.639,
                z: 0.59,
                v: 'c3',
                cols: [
                  [0.615, 0.568, 0.028]
                ]
              },
              {
                x: 0.638,
                z: 0.923,
                v: 'c3',
                cols: [
                  [0.614, 0.901, 0.028]
                ]
              },
              {
                x: 0.633,
                z: 0.985,
                v: 'c3',
                cols: [
                  [0.609, 0.963, 0.028]
                ]
              },
              {
                x: 0.654,
                z: 0.086,
                v: 'c5',
                cols: [
                  [0.632, 0.063, 0.033]
                ]
              },
              {
                x: 0.656,
                z: 0.495,
                v: 'c3',
                cols: [
                  [0.632, 0.473, 0.028]
                ]
              },
              {
                x: 0.68,
                z: 0.411,
                v: 'c5',
                cols: [
                  [0.658, 0.388, 0.033]
                ]
              },
              {
                x: 0.686,
                z: 0.553,
                v: 'c5',
                cols: [
                  [0.664, 0.53, 0.033]
                ]
              },
              {
                x: 0.676,
                z: 0.636,
                v: 'c3',
                cols: [
                  [0.652, 0.614, 0.028]
                ]
              },
              {
                x: 0.686,
                z: 0.846,
                v: 'c3',
                cols: [
                  [0.662, 0.824, 0.028]
                ]
              },
              {
                x: 0.703,
                z: 0.466,
                v: 'c5',
                cols: [
                  [0.681, 0.443, 0.033]
                ]
              },
              {
                x: 0.706,
                z: 0.902,
                v: 'c3',
                cols: [
                  [0.682, 0.88, 0.028]
                ]
              },
              {
                x: 0.727,
                z: 0.327,
                v: 'c3',
                cols: [
                  [0.703, 0.305, 0.028]
                ]
              },
              {
                x: 0.729,
                z: 0.588,
                v: 'c3',
                cols: [
                  [0.705, 0.566, 0.028]
                ]
              },
              {
                x: 0.746,
                z: 0.374,
                v: 'c3',
                cols: [
                  [0.722, 0.352, 0.028]
                ]
              },
              {
                x: 0.753,
                z: 0.491,
                v: 'c3',
                cols: [
                  [0.729, 0.469, 0.028]
                ]
              },
              {
                x: 0.754,
                z: 0.658,
                v: 'c3',
                cols: [
                  [0.73, 0.636, 0.028]
                ]
              },
              {
                x: 0.741,
                z: 0.861,
                v: 'c3',
                cols: [
                  [0.717, 0.839, 0.028]
                ]
              },
              {
                x: 0.756,
                z: 0.913,
                v: 'c3',
                cols: [
                  [0.732, 0.891, 0.028]
                ]
              },
              {
                x: 0.779,
                z: 0.422,
                v: 'c5',
                cols: [
                  [0.757, 0.399, 0.033]
                ]
              },
              {
                x: 0.772,
                z: 0.554,
                v: 'c3',
                cols: [
                  [0.748, 0.532, 0.028]
                ]
              },
              {
                x: 0.797,
                z: 0.351,
                v: 'c5',
                cols: [
                  [0.775, 0.328, 0.033]
                ]
              },
              {
                x: 0.806,
                z: 0.606,
                v: 'c5',
                cols: [
                  [0.784, 0.583, 0.033]
                ]
              },
              {
                x: 0.802,
                z: 0.892,
                v: 'c5',
                cols: [
                  [0.78, 0.869, 0.033]
                ]
              },
              {
                x: 0.823,
                z: 0.527,
                v: 'c3',
                cols: [
                  [0.799, 0.505, 0.028]
                ]
              },
              {
                x: 0.822,
                z: 0.96,
                v: 'c5',
                cols: [
                  [0.8, 0.937, 0.033]
                ]
              },
              {
                x: 0.853,
                z: 0.902,
                v: 'c3',
                cols: [
                  [0.829, 0.88, 0.028]
                ]
              },
              {
                x: 0.86,
                z: 0.566,
                v: 'c5',
                cols: [
                  [0.838, 0.543, 0.033]
                ]
              },
              {
                x: 0.877,
                z: 0.798,
                v: 'c5',
                cols: [
                  [0.855, 0.775, 0.033]
                ]
              },
              {
                x: 0.874,
                z: 0.948,
                v: 'c3',
                cols: [
                  [0.85, 0.926, 0.028]
                ]
              },
              {
                x: 0.891,
                z: 0.625,
                v: 'c5',
                cols: [
                  [0.869, 0.602, 0.033]
                ]
              },
              {
                x: 0.913,
                z: 0.155,
                v: 'c5',
                cols: [
                  [0.891, 0.132, 0.033]
                ]
              },
              {
                x: 0.908,
                z: 0.911,
                v: 'c3',
                cols: [
                  [0.884, 0.889, 0.028]
                ]
              },
              {
                x: 0.948,
                z: 0.606,
                v: 'c3',
                cols: [
                  [0.924, 0.584, 0.028]
                ]
              },
              {
                x: 0.943,
                z: 0.758,
                v: 'c3',
                cols: [
                  [0.919, 0.736, 0.028]
                ]
              },
              {
                x: 0.944,
                z: 0.968,
                v: 'c3',
                cols: [
                  [0.92, 0.946, 0.028]
                ]
              },
              {
                x: 0.972,
                z: 0.086,
                v: 'c5',
                cols: [
                  [0.95, 0.063, 0.033]
                ]
              },
              {
                x: 0.967,
                z: 0.174,
                v: 'c5',
                cols: [
                  [0.945, 0.151, 0.033]
                ]
              },
              {
                x: 0.962,
                z: 0.711,
                v: 'c5',
                cols: [
                  [0.94, 0.688, 0.033]
                ]
              },
              {
                x: 0.988,
                z: 0.651,
                v: 'c3',
                cols: [
                  [0.964, 0.629, 0.028]
                ]
              }
            ],
            rocks: [],
            sticks: [
              {
                x: 0.513,
                z: 0.488,
                rotY: 1.78,
                flip: 0,
                scale: 1,
                cols: [
                  [0.513, 0.488, 0.017]
                ]
              },
              {
                x: 0.838,
                z: 0.438,
                rotY: 3.66,
                flip: 0,
                scale: 1,
                cols: [
                  [0.838, 0.438, 0.017]
                ]
              },
              {
                x: 0.063,
                z: 0.038,
                rotY: 3.62,
                flip: 0,
                scale: 1,
                cols: [
                  [0.063, 0.038, 0.017]
                ]
              },
              {
                x: 0.388,
                z: 0.238,
                rotY: 0.27,
                flip: 0,
                scale: 1,
                cols: [
                  [0.388, 0.238, 0.017]
                ]
              },
              {
                x: 0.538,
                z: 0.213,
                rotY: 5.2,
                flip: 0,
                scale: 1,
                cols: [
                  [0.538, 0.213, 0.017]
                ]
              },
              {
                x: 0.763,
                z: 0.738,
                rotY: 0.41,
                flip: 0,
                scale: 1,
                cols: [
                  [0.763, 0.738, 0.017]
                ]
              },
              {
                x: 0.338,
                z: 0.138,
                rotY: 2.04,
                flip: 0,
                scale: 1,
                cols: [
                  [0.338, 0.138, 0.017]
                ]
              },
              {
                x: 0.438,
                z: 0.763,
                rotY: 1.06,
                flip: 1,
                scale: 1,
                cols: [
                  [0.438, 0.763, 0.017]
                ]
              }
            ],
            minables: []
          }
        },
        {
          id: 'forest_6',
          seed: 701,
          terrain: {
            hills: [
              {
                shape: 'rect',
                x: 1,
                z: 0.5,
                wx: 0.394,
                wz: 0.577,
                height: 0.391
              }
            ]
          },
          items: {
            trees: [
              {
                x: 0.063,
                z: 0.329,
                v: 'c3',
                cols: [
                  [0.039, 0.307, 0.028]
                ]
              },
              {
                x: 0.061,
                z: 0.419,
                v: 'c3',
                cols: [
                  [0.037, 0.397, 0.028]
                ]
              },
              {
                x: 0.061,
                z: 0.474,
                v: 'c3',
                cols: [
                  [0.037, 0.452, 0.028]
                ]
              },
              {
                x: 0.062,
                z: 0.576,
                v: 'c5',
                cols: [
                  [0.04, 0.553, 0.033]
                ]
              },
              {
                x: 0.063,
                z: 0.64,
                v: 'c5',
                cols: [
                  [0.041, 0.617, 0.033]
                ]
              },
              {
                x: 0.065,
                z: 0.695,
                v: 'c5',
                cols: [
                  [0.043, 0.672, 0.033]
                ]
              },
              {
                x: 0.058,
                z: 0.891,
                v: 'c5',
                cols: [
                  [0.036, 0.868, 0.033]
                ]
              },
              {
                x: 0.105,
                z: 0.434,
                v: 'c3',
                cols: [
                  [0.081, 0.412, 0.028]
                ]
              },
              {
                x: 0.094,
                z: 0.509,
                v: 'c3',
                cols: [
                  [0.07, 0.487, 0.028]
                ]
              },
              {
                x: 0.105,
                z: 0.747,
                v: 'c3',
                cols: [
                  [0.081, 0.725, 0.028]
                ]
              },
              {
                x: 0.121,
                z: 0.555,
                v: 'c3',
                cols: [
                  [0.097, 0.533, 0.028]
                ]
              },
              {
                x: 0.116,
                z: 0.608,
                v: 'c5',
                cols: [
                  [0.094, 0.585, 0.033]
                ]
              },
              {
                x: 0.123,
                z: 0.675,
                v: 'c3',
                cols: [
                  [0.099, 0.653, 0.028]
                ]
              },
              {
                x: 0.128,
                z: 0.847,
                v: 'c5',
                cols: [
                  [0.106, 0.824, 0.033]
                ]
              },
              {
                x: 0.152,
                z: 0.717,
                v: 'c5',
                cols: [
                  [0.13, 0.694, 0.033]
                ]
              },
              {
                x: 0.141,
                z: 0.787,
                v: 'c3',
                cols: [
                  [0.117, 0.765, 0.028]
                ]
              },
              {
                x: 0.162,
                z: 0.054,
                v: 'c3',
                cols: [
                  [0.138, 0.032, 0.028]
                ]
              },
              {
                x: 0.178,
                z: 0.618,
                v: 'c3',
                cols: [
                  [0.154, 0.596, 0.028]
                ]
              },
              {
                x: 0.174,
                z: 0.872,
                v: 'c3',
                cols: [
                  [0.15, 0.85, 0.028]
                ]
              },
              {
                x: 0.201,
                z: 0.161,
                v: 'c3',
                cols: [
                  [0.177, 0.139, 0.028]
                ]
              },
              {
                x: 0.202,
                z: 0.211,
                v: 'c3',
                cols: [
                  [0.178, 0.189, 0.028]
                ]
              },
              {
                x: 0.192,
                z: 0.76,
                v: 'c3',
                cols: [
                  [0.168, 0.738, 0.028]
                ]
              },
              {
                x: 0.222,
                z: 0.059,
                v: 'c3',
                cols: [
                  [0.198, 0.037, 0.028]
                ]
              },
              {
                x: 0.225,
                z: 0.256,
                v: 'c3',
                cols: [
                  [0.201, 0.234, 0.028]
                ]
              },
              {
                x: 0.222,
                z: 0.652,
                v: 'c5',
                cols: [
                  [0.2, 0.629, 0.033]
                ]
              },
              {
                x: 0.214,
                z: 0.708,
                v: 'c5',
                cols: [
                  [0.192, 0.685, 0.033]
                ]
              },
              {
                x: 0.218,
                z: 0.808,
                v: 'c5',
                cols: [
                  [0.196, 0.785, 0.033]
                ]
              },
              {
                x: 0.239,
                z: 0.107,
                v: 'c5',
                cols: [
                  [0.217, 0.084, 0.033]
                ]
              },
              {
                x: 0.236,
                z: 0.861,
                v: 'c5',
                cols: [
                  [0.214, 0.838, 0.033]
                ]
              },
              {
                x: 0.261,
                z: 0.165,
                v: 'c3',
                cols: [
                  [0.237, 0.143, 0.028]
                ]
              },
              {
                x: 0.268,
                z: 0.223,
                v: 'c3',
                cols: [
                  [0.244, 0.201, 0.028]
                ]
              },
              {
                x: 0.269,
                z: 0.719,
                v: 'c3',
                cols: [
                  [0.245, 0.697, 0.028]
                ]
              },
              {
                x: 0.286,
                z: 0.054,
                v: 'c3',
                cols: [
                  [0.262, 0.032, 0.028]
                ]
              },
              {
                x: 0.275,
                z: 0.27,
                v: 'c3',
                cols: [
                  [0.251, 0.248, 0.028]
                ]
              },
              {
                x: 0.288,
                z: 0.422,
                v: 'c5',
                cols: [
                  [0.266, 0.399, 0.033]
                ]
              },
              {
                x: 0.277,
                z: 0.792,
                v: 'c5',
                cols: [
                  [0.255, 0.769, 0.033]
                ]
              },
              {
                x: 0.31,
                z: 0.103,
                v: 'c5',
                cols: [
                  [0.288, 0.08, 0.033]
                ]
              },
              {
                x: 0.311,
                z: 0.162,
                v: 'c3',
                cols: [
                  [0.287, 0.14, 0.028]
                ]
              },
              {
                x: 0.301,
                z: 0.473,
                v: 'c3',
                cols: [
                  [0.277, 0.451, 0.028]
                ]
              },
              {
                x: 0.309,
                z: 0.665,
                v: 'c3',
                cols: [
                  [0.285, 0.643, 0.028]
                ]
              },
              {
                x: 0.308,
                z: 0.845,
                v: 'c3',
                cols: [
                  [0.284, 0.823, 0.028]
                ]
              },
              {
                x: 0.338,
                z: 0.201,
                v: 'c3',
                cols: [
                  [0.314, 0.179, 0.028]
                ]
              },
              {
                x: 0.338,
                z: 0.446,
                v: 'c3',
                cols: [
                  [0.314, 0.424, 0.028]
                ]
              },
              {
                x: 0.325,
                z: 0.725,
                v: 'c3',
                cols: [
                  [0.301, 0.703, 0.028]
                ]
              },
              {
                x: 0.359,
                z: 0.666,
                v: 'c3',
                cols: [
                  [0.335, 0.644, 0.028]
                ]
              },
              {
                x: 0.349,
                z: 0.776,
                v: 'c5',
                cols: [
                  [0.327, 0.753, 0.033]
                ]
              },
              {
                x: 0.366,
                z: 0.088,
                v: 'c3',
                cols: [
                  [0.342, 0.066, 0.028]
                ]
              },
              {
                x: 0.369,
                z: 0.157,
                v: 'c5',
                cols: [
                  [0.347, 0.134, 0.033]
                ]
              },
              {
                x: 0.381,
                z: 0.394,
                v: 'c5',
                cols: [
                  [0.359, 0.371, 0.033]
                ]
              },
              {
                x: 0.381,
                z: 0.49,
                v: 'c5',
                cols: [
                  [0.359, 0.467, 0.033]
                ]
              },
              {
                x: 0.38,
                z: 0.718,
                v: 'c5',
                cols: [
                  [0.358, 0.695, 0.033]
                ]
              },
              {
                x: 0.38,
                z: 0.823,
                v: 'c3',
                cols: [
                  [0.356, 0.801, 0.028]
                ]
              },
              {
                x: 0.401,
                z: 0.21,
                v: 'c3',
                cols: [
                  [0.377, 0.188, 0.028]
                ]
              },
              {
                x: 0.428,
                z: 0.125,
                v: 'c5',
                cols: [
                  [0.406, 0.102, 0.033]
                ]
              },
              {
                x: 0.427,
                z: 0.448,
                v: 'c3',
                cols: [
                  [0.403, 0.426, 0.028]
                ]
              },
              {
                x: 0.427,
                z: 0.767,
                v: 'c5',
                cols: [
                  [0.405, 0.744, 0.033]
                ]
              },
              {
                x: 0.449,
                z: 0.223,
                v: 'c3',
                cols: [
                  [0.425, 0.201, 0.028]
                ]
              },
              {
                x: 0.436,
                z: 0.695,
                v: 'c5',
                cols: [
                  [0.414, 0.672, 0.033]
                ]
              },
              {
                x: 0.472,
                z: 0.174,
                v: 'c5',
                cols: [
                  [0.45, 0.151, 0.033]
                ]
              },
              {
                x: 0.473,
                z: 0.418,
                v: 'c3',
                cols: [
                  [0.449, 0.396, 0.028]
                ]
              },
              {
                x: 0.466,
                z: 0.806,
                v: 'c5',
                cols: [
                  [0.444, 0.783, 0.033]
                ]
              },
              {
                x: 0.489,
                z: 0.673,
                v: 'c5',
                cols: [
                  [0.467, 0.65, 0.033]
                ]
              },
              {
                x: 0.49,
                z: 0.741,
                v: 'c3',
                cols: [
                  [0.466, 0.719, 0.028]
                ]
              },
              {
                x: 0.535,
                z: 0.632,
                v: 'c3',
                cols: [
                  [0.511, 0.61, 0.028]
                ]
              },
              {
                x: 0.537,
                z: 0.722,
                v: 'c5',
                cols: [
                  [0.515, 0.699, 0.033]
                ]
              },
              {
                x: 0.536,
                z: 0.788,
                v: 'c5',
                cols: [
                  [0.514, 0.765, 0.033]
                ]
              },
              {
                x: 0.572,
                z: 0.595,
                v: 'c3',
                cols: [
                  [0.548, 0.573, 0.028]
                ]
              },
              {
                x: 0.579,
                z: 0.672,
                v: 'c3',
                cols: [
                  [0.555, 0.65, 0.028]
                ]
              },
              {
                x: 0.588,
                z: 0.752,
                v: 'c3',
                cols: [
                  [0.564, 0.73, 0.028]
                ]
              },
              {
                x: 0.607,
                z: 0.802,
                v: 'c5',
                cols: [
                  [0.585, 0.779, 0.033]
                ]
              },
              {
                x: 0.623,
                z: 0.537,
                v: 'c3',
                cols: [
                  [0.599, 0.515, 0.028]
                ]
              },
              {
                x: 0.624,
                z: 0.601,
                v: 'c5',
                cols: [
                  [0.602, 0.578, 0.033]
                ]
              },
              {
                x: 0.631,
                z: 0.662,
                v: 'c5',
                cols: [
                  [0.609, 0.639, 0.033]
                ]
              },
              {
                x: 0.633,
                z: 0.717,
                v: 'c3',
                cols: [
                  [0.609, 0.695, 0.028]
                ]
              },
              {
                x: 0.649,
                z: 0.143,
                v: 'c5',
                cols: [
                  [0.627, 0.12, 0.033]
                ]
              },
              {
                x: 0.655,
                z: 0.497,
                v: 'c5',
                cols: [
                  [0.633, 0.474, 0.033]
                ]
              },
              {
                x: 0.665,
                z: 0.201,
                v: 'c5',
                cols: [
                  [0.643, 0.178, 0.033]
                ]
              },
              {
                x: 0.667,
                z: 0.266,
                v: 'c5',
                cols: [
                  [0.645, 0.243, 0.033]
                ]
              },
              {
                x: 0.661,
                z: 0.33,
                v: 'c5',
                cols: [
                  [0.639, 0.307, 0.033]
                ]
              },
              {
                x: 0.662,
                z: 0.406,
                v: 'c5',
                cols: [
                  [0.64, 0.383, 0.033]
                ]
              },
              {
                x: 0.676,
                z: 0.56,
                v: 'c3',
                cols: [
                  [0.652, 0.538, 0.028]
                ]
              },
              {
                x: 0.67,
                z: 0.757,
                v: 'c5',
                cols: [
                  [0.648, 0.734, 0.033]
                ]
              },
              {
                x: 0.667,
                z: 0.814,
                v: 'c3',
                cols: [
                  [0.643, 0.792, 0.028]
                ]
              },
              {
                x: 0.701,
                z: 0.441,
                v: 'c3',
                cols: [
                  [0.677, 0.419, 0.028]
                ]
              },
              {
                x: 0.687,
                z: 0.63,
                v: 'c5',
                cols: [
                  [0.665, 0.607, 0.033]
                ]
              },
              {
                x: 0.689,
                z: 0.688,
                v: 'c3',
                cols: [
                  [0.665, 0.666, 0.028]
                ]
              },
              {
                x: 0.72,
                z: 0.08,
                v: 'c5',
                cols: [
                  [0.698, 0.057, 0.033]
                ]
              },
              {
                x: 0.711,
                z: 0.154,
                v: 'c3',
                cols: [
                  [0.687, 0.132, 0.028]
                ]
              },
              {
                x: 0.719,
                z: 0.212,
                v: 'c5',
                cols: [
                  [0.697, 0.189, 0.033]
                ]
              },
              {
                x: 0.72,
                z: 0.286,
                v: 'c3',
                cols: [
                  [0.696, 0.264, 0.028]
                ]
              },
              {
                x: 0.717,
                z: 0.333,
                v: 'c3',
                cols: [
                  [0.693, 0.311, 0.028]
                ]
              },
              {
                x: 0.723,
                z: 0.394,
                v: 'c3',
                cols: [
                  [0.699, 0.372, 0.028]
                ]
              },
              {
                x: 0.722,
                z: 0.744,
                v: 'c3',
                cols: [
                  [0.698, 0.722, 0.028]
                ]
              },
              {
                x: 0.716,
                z: 0.946,
                v: 'c5',
                cols: [
                  [0.694, 0.923, 0.033]
                ]
              },
              {
                x: 0.734,
                z: 0.496,
                v: 'c5',
                cols: [
                  [0.712, 0.473, 0.033]
                ]
              },
              {
                x: 0.735,
                z: 0.564,
                v: 'c5',
                cols: [
                  [0.713, 0.541, 0.033]
                ]
              },
              {
                x: 0.746,
                z: 0.651,
                v: 'c5',
                cols: [
                  [0.724, 0.628, 0.033]
                ]
              },
              {
                x: 0.761,
                z: 0.121,
                v: 'c5',
                cols: [
                  [0.739, 0.098, 0.033]
                ]
              },
              {
                x: 0.768,
                z: 0.334,
                v: 'c5',
                cols: [
                  [0.746, 0.311, 0.033]
                ]
              },
              {
                x: 0.766,
                z: 0.712,
                v: 'c3',
                cols: [
                  [0.742, 0.69, 0.028]
                ]
              },
              {
                x: 0.756,
                z: 0.988,
                v: 'c5',
                cols: [
                  [0.734, 0.965, 0.033]
                ]
              },
              {
                x: 0.784,
                z: 0.053,
                v: 'c3',
                cols: [
                  [0.76, 0.031, 0.028]
                ]
              },
              {
                x: 0.791,
                z: 0.189,
                v: 'c3',
                cols: [
                  [0.767, 0.167, 0.028]
                ]
              },
              {
                x: 0.779,
                z: 0.254,
                v: 'c5',
                cols: [
                  [0.757, 0.231, 0.033]
                ]
              },
              {
                x: 0.788,
                z: 0.402,
                v: 'c5',
                cols: [
                  [0.766, 0.379, 0.033]
                ]
              },
              {
                x: 0.784,
                z: 0.465,
                v: 'c3',
                cols: [
                  [0.76, 0.443, 0.028]
                ]
              },
              {
                x: 0.784,
                z: 0.537,
                v: 'c3',
                cols: [
                  [0.76, 0.515, 0.028]
                ]
              },
              {
                x: 0.781,
                z: 0.925,
                v: 'c3',
                cols: [
                  [0.757, 0.903, 0.028]
                ]
              },
              {
                x: 0.802,
                z: 0.652,
                v: 'c3',
                cols: [
                  [0.778, 0.63, 0.028]
                ]
              },
              {
                x: 0.833,
                z: 0.084,
                v: 'c5',
                cols: [
                  [0.811, 0.061, 0.033]
                ]
              },
              {
                x: 0.831,
                z: 0.155,
                v: 'c3',
                cols: [
                  [0.807, 0.133, 0.028]
                ]
              },
              {
                x: 0.836,
                z: 0.212,
                v: 'c5',
                cols: [
                  [0.814, 0.189, 0.033]
                ]
              },
              {
                x: 0.832,
                z: 0.269,
                v: 'c5',
                cols: [
                  [0.81, 0.246, 0.033]
                ]
              },
              {
                x: 0.835,
                z: 0.335,
                v: 'c3',
                cols: [
                  [0.811, 0.313, 0.028]
                ]
              },
              {
                x: 0.833,
                z: 0.429,
                v: 'c3',
                cols: [
                  [0.809, 0.407, 0.028]
                ]
              },
              {
                x: 0.836,
                z: 0.926,
                v: 'c5',
                cols: [
                  [0.814, 0.903, 0.033]
                ]
              },
              {
                x: 0.836,
                z: 0.981,
                v: 'c3',
                cols: [
                  [0.812, 0.959, 0.028]
                ]
              },
              {
                x: 0.879,
                z: 0.169,
                v: 'c5',
                cols: [
                  [0.857, 0.146, 0.033]
                ]
              },
              {
                x: 0.879,
                z: 0.303,
                v: 'c5',
                cols: [
                  [0.857, 0.28, 0.033]
                ]
              },
              {
                x: 0.871,
                z: 0.379,
                v: 'c3',
                cols: [
                  [0.847, 0.357, 0.028]
                ]
              },
              {
                x: 0.884,
                z: 0.668,
                v: 'c5',
                cols: [
                  [0.862, 0.645, 0.033]
                ]
              },
              {
                x: 0.903,
                z: 0.869,
                v: 'c5',
                cols: [
                  [0.881, 0.846, 0.033]
                ]
              },
              {
                x: 0.9,
                z: 0.929,
                v: 'c5',
                cols: [
                  [0.878, 0.906, 0.033]
                ]
              },
              {
                x: 0.924,
                z: 0.714,
                v: 'c5',
                cols: [
                  [0.902, 0.691, 0.033]
                ]
              },
              {
                x: 0.944,
                z: 0.632,
                v: 'c5',
                cols: [
                  [0.922, 0.609, 0.033]
                ]
              },
              {
                x: 0.94,
                z: 0.768,
                v: 'c5',
                cols: [
                  [0.918, 0.745, 0.033]
                ]
              },
              {
                x: 0.97,
                z: 0.81,
                v: 'c3',
                cols: [
                  [0.946, 0.788, 0.028]
                ]
              },
              {
                x: 0.986,
                z: 0.674,
                v: 'c3',
                cols: [
                  [0.962, 0.652, 0.028]
                ]
              },
              {
                x: 0.986,
                z: 0.74,
                v: 'c3',
                cols: [
                  [0.962, 0.718, 0.028]
                ]
              }
            ],
            rocks: [],
            sticks: [
              {
                x: 0.438,
                z: 0.288,
                rotY: 4.88,
                flip: 0,
                scale: 1,
                cols: [
                  [0.438, 0.288, 0.017]
                ]
              },
              {
                x: 0.413,
                z: 0.338,
                rotY: 0.68,
                flip: 0,
                scale: 1,
                cols: [
                  [0.413, 0.338, 0.017]
                ]
              },
              {
                x: 0.588,
                z: 0.363,
                rotY: 2.27,
                flip: 0,
                scale: 1,
                cols: [
                  [0.588, 0.363, 0.017]
                ]
              },
              {
                x: 0.263,
                z: 0.888,
                rotY: 0.96,
                flip: 0,
                scale: 1,
                cols: [
                  [0.263, 0.888, 0.017]
                ]
              },
              {
                x: 0.338,
                z: 0.863,
                rotY: 5,
                flip: 1,
                scale: 1,
                cols: [
                  [0.338, 0.863, 0.017]
                ]
              }
            ],
            minables: []
          }
        },
        {
          id: 'forest_7',
          seed: 801,
          terrain: {
            hills: [
              {
                shape: 'rect',
                x: 0,
                z: 0.5,
                wx: 0.471,
                wz: 0.573,
                height: 0.365
              }
            ]
          },
          items: {
            trees: [
              {
                x: 0.053,
                z: 0.49,
                v: 'c3',
                cols: [
                  [0.029, 0.468, 0.028]
                ]
              },
              {
                x: 0.064,
                z: 0.731,
                v: 'c5',
                cols: [
                  [0.042, 0.708, 0.033]
                ]
              },
              {
                x: 0.069,
                z: 0.797,
                v: 'c5',
                cols: [
                  [0.047, 0.774, 0.033]
                ]
              },
              {
                x: 0.062,
                z: 0.875,
                v: 'c5',
                cols: [
                  [0.04, 0.852, 0.033]
                ]
              },
              {
                x: 0.068,
                z: 0.968,
                v: 'c3',
                cols: [
                  [0.044, 0.946, 0.028]
                ]
              },
              {
                x: 0.105,
                z: 0.066,
                v: 'c5',
                cols: [
                  [0.083, 0.043, 0.033]
                ]
              },
              {
                x: 0.105,
                z: 0.462,
                v: 'c3',
                cols: [
                  [0.081, 0.44, 0.028]
                ]
              },
              {
                x: 0.1,
                z: 0.531,
                v: 'c3',
                cols: [
                  [0.076, 0.509, 0.028]
                ]
              },
              {
                x: 0.108,
                z: 0.902,
                v: 'c3',
                cols: [
                  [0.084, 0.88, 0.028]
                ]
              },
              {
                x: 0.197,
                z: 0.15,
                v: 'c3',
                cols: [
                  [0.173, 0.128, 0.028]
                ]
              },
              {
                x: 0.221,
                z: 0.906,
                v: 'c3',
                cols: [
                  [0.197, 0.884, 0.028]
                ]
              },
              {
                x: 0.218,
                z: 0.962,
                v: 'c5',
                cols: [
                  [0.196, 0.939, 0.033]
                ]
              },
              {
                x: 0.251,
                z: 0.185,
                v: 'c5',
                cols: [
                  [0.229, 0.162, 0.033]
                ]
              },
              {
                x: 0.235,
                z: 0.251,
                v: 'c3',
                cols: [
                  [0.211, 0.229, 0.028]
                ]
              },
              {
                x: 0.234,
                z: 0.331,
                v: 'c5',
                cols: [
                  [0.212, 0.308, 0.033]
                ]
              },
              {
                x: 0.246,
                z: 0.649,
                v: 'c3',
                cols: [
                  [0.222, 0.627, 0.028]
                ]
              },
              {
                x: 0.25,
                z: 0.708,
                v: 'c3',
                cols: [
                  [0.226, 0.686, 0.028]
                ]
              },
              {
                x: 0.24,
                z: 0.86,
                v: 'c5',
                cols: [
                  [0.218, 0.837, 0.033]
                ]
              },
              {
                x: 0.28,
                z: 0.261,
                v: 'c3',
                cols: [
                  [0.256, 0.239, 0.028]
                ]
              },
              {
                x: 0.282,
                z: 0.367,
                v: 'c5',
                cols: [
                  [0.26, 0.344, 0.033]
                ]
              },
              {
                x: 0.275,
                z: 0.808,
                v: 'c5',
                cols: [
                  [0.253, 0.785, 0.033]
                ]
              },
              {
                x: 0.31,
                z: 0.207,
                v: 'c3',
                cols: [
                  [0.286, 0.185, 0.028]
                ]
              },
              {
                x: 0.305,
                z: 0.609,
                v: 'c5',
                cols: [
                  [0.283, 0.586, 0.033]
                ]
              },
              {
                x: 0.308,
                z: 0.674,
                v: 'c5',
                cols: [
                  [0.286, 0.651, 0.033]
                ]
              },
              {
                x: 0.306,
                z: 0.757,
                v: 'c3',
                cols: [
                  [0.282, 0.735, 0.028]
                ]
              },
              {
                x: 0.291,
                z: 0.901,
                v: 'c3',
                cols: [
                  [0.267, 0.879, 0.028]
                ]
              },
              {
                x: 0.333,
                z: 0.252,
                v: 'c3',
                cols: [
                  [0.309, 0.23, 0.028]
                ]
              },
              {
                x: 0.337,
                z: 0.324,
                v: 'c3',
                cols: [
                  [0.313, 0.302, 0.028]
                ]
              },
              {
                x: 0.351,
                z: 0.553,
                v: 'c3',
                cols: [
                  [0.327, 0.531, 0.028]
                ]
              },
              {
                x: 0.353,
                z: 0.646,
                v: 'c3',
                cols: [
                  [0.329, 0.624, 0.028]
                ]
              },
              {
                x: 0.366,
                z: 0.711,
                v: 'c5',
                cols: [
                  [0.344, 0.688, 0.033]
                ]
              },
              {
                x: 0.36,
                z: 0.784,
                v: 'c3',
                cols: [
                  [0.336, 0.762, 0.028]
                ]
              },
              {
                x: 0.361,
                z: 0.903,
                v: 'c3',
                cols: [
                  [0.337, 0.881, 0.028]
                ]
              },
              {
                x: 0.395,
                z: 0.607,
                v: 'c5',
                cols: [
                  [0.373, 0.584, 0.033]
                ]
              },
              {
                x: 0.425,
                z: 0.081,
                v: 'c3',
                cols: [
                  [0.401, 0.059, 0.028]
                ]
              },
              {
                x: 0.408,
                z: 0.661,
                v: 'c3',
                cols: [
                  [0.384, 0.639, 0.028]
                ]
              },
              {
                x: 0.415,
                z: 0.746,
                v: 'c3',
                cols: [
                  [0.391, 0.724, 0.028]
                ]
              },
              {
                x: 0.411,
                z: 0.918,
                v: 'c5',
                cols: [
                  [0.389, 0.895, 0.033]
                ]
              },
              {
                x: 0.41,
                z: 0.977,
                v: 'c3',
                cols: [
                  [0.386, 0.955, 0.028]
                ]
              },
              {
                x: 0.445,
                z: 0.482,
                v: 'c5',
                cols: [
                  [0.423, 0.459, 0.033]
                ]
              },
              {
                x: 0.442,
                z: 0.705,
                v: 'c3',
                cols: [
                  [0.418, 0.683, 0.028]
                ]
              },
              {
                x: 0.471,
                z: 0.105,
                v: 'c3',
                cols: [
                  [0.447, 0.083, 0.028]
                ]
              },
              {
                x: 0.477,
                z: 0.911,
                v: 'c3',
                cols: [
                  [0.453, 0.889, 0.028]
                ]
              },
              {
                x: 0.47,
                z: 0.959,
                v: 'c3',
                cols: [
                  [0.446, 0.937, 0.028]
                ]
              },
              {
                x: 0.499,
                z: 0.454,
                v: 'c5',
                cols: [
                  [0.477, 0.431, 0.033]
                ]
              },
              {
                x: 0.504,
                z: 0.724,
                v: 'c5',
                cols: [
                  [0.482, 0.701, 0.033]
                ]
              },
              {
                x: 0.53,
                z: 0.073,
                v: 'c5',
                cols: [
                  [0.508, 0.05, 0.033]
                ]
              },
              {
                x: 0.538,
                z: 0.397,
                v: 'c3',
                cols: [
                  [0.514, 0.375, 0.028]
                ]
              },
              {
                x: 0.559,
                z: 0.666,
                v: 'c5',
                cols: [
                  [0.537, 0.643, 0.033]
                ]
              },
              {
                x: 0.565,
                z: 0.734,
                v: 'c3',
                cols: [
                  [0.541, 0.712, 0.028]
                ]
              },
              {
                x: 0.597,
                z: 0.33,
                v: 'c3',
                cols: [
                  [0.573, 0.308, 0.028]
                ]
              },
              {
                x: 0.587,
                z: 0.422,
                v: 'c5',
                cols: [
                  [0.565, 0.399, 0.033]
                ]
              },
              {
                x: 0.576,
                z: 0.488,
                v: 'c3',
                cols: [
                  [0.552, 0.466, 0.028]
                ]
              },
              {
                x: 0.62,
                z: 0.128,
                v: 'c5',
                cols: [
                  [0.598, 0.105, 0.033]
                ]
              },
              {
                x: 0.605,
                z: 0.706,
                v: 'c3',
                cols: [
                  [0.581, 0.684, 0.028]
                ]
              },
              {
                x: 0.606,
                z: 0.98,
                v: 'c5',
                cols: [
                  [0.584, 0.957, 0.033]
                ]
              },
              {
                x: 0.655,
                z: 0.252,
                v: 'c3',
                cols: [
                  [0.631, 0.23, 0.028]
                ]
              },
              {
                x: 0.647,
                z: 0.322,
                v: 'c5',
                cols: [
                  [0.625, 0.299, 0.033]
                ]
              },
              {
                x: 0.636,
                z: 0.394,
                v: 'c3',
                cols: [
                  [0.612, 0.372, 0.028]
                ]
              },
              {
                x: 0.633,
                z: 0.48,
                v: 'c5',
                cols: [
                  [0.611, 0.457, 0.033]
                ]
              },
              {
                x: 0.644,
                z: 0.676,
                v: 'c3',
                cols: [
                  [0.62, 0.654, 0.028]
                ]
              },
              {
                x: 0.652,
                z: 0.767,
                v: 'c5',
                cols: [
                  [0.63, 0.744, 0.033]
                ]
              },
              {
                x: 0.674,
                z: 0.127,
                v: 'c3',
                cols: [
                  [0.65, 0.105, 0.028]
                ]
              },
              {
                x: 0.706,
                z: 0.073,
                v: 'c3',
                cols: [
                  [0.682, 0.051, 0.028]
                ]
              },
              {
                x: 0.703,
                z: 0.189,
                v: 'c5',
                cols: [
                  [0.681, 0.166, 0.033]
                ]
              },
              {
                x: 0.708,
                z: 0.252,
                v: 'c3',
                cols: [
                  [0.684, 0.23, 0.028]
                ]
              },
              {
                x: 0.699,
                z: 0.612,
                v: 'c5',
                cols: [
                  [0.677, 0.589, 0.033]
                ]
              },
              {
                x: 0.706,
                z: 0.982,
                v: 'c3',
                cols: [
                  [0.682, 0.96, 0.028]
                ]
              },
              {
                x: 0.723,
                z: 0.122,
                v: 'c5',
                cols: [
                  [0.701, 0.099, 0.033]
                ]
              },
              {
                x: 0.719,
                z: 0.325,
                v: 'c3',
                cols: [
                  [0.695, 0.303, 0.028]
                ]
              },
              {
                x: 0.766,
                z: 0.083,
                v: 'c5',
                cols: [
                  [0.744, 0.06, 0.033]
                ]
              },
              {
                x: 0.75,
                z: 0.223,
                v: 'c3',
                cols: [
                  [0.726, 0.201, 0.028]
                ]
              },
              {
                x: 0.768,
                z: 0.934,
                v: 'c3',
                cols: [
                  [0.744, 0.912, 0.028]
                ]
              },
              {
                x: 0.765,
                z: 0.991,
                v: 'c3',
                cols: [
                  [0.741, 0.969, 0.028]
                ]
              },
              {
                x: 0.787,
                z: 0.177,
                v: 'c5',
                cols: [
                  [0.765, 0.154, 0.033]
                ]
              },
              {
                x: 0.792,
                z: 0.266,
                v: 'c5',
                cols: [
                  [0.77, 0.243, 0.033]
                ]
              },
              {
                x: 0.778,
                z: 0.338,
                v: 'c3',
                cols: [
                  [0.754, 0.316, 0.028]
                ]
              },
              {
                x: 0.783,
                z: 0.469,
                v: 'c5',
                cols: [
                  [0.761, 0.446, 0.033]
                ]
              },
              {
                x: 0.789,
                z: 0.524,
                v: 'c3',
                cols: [
                  [0.765, 0.502, 0.028]
                ]
              },
              {
                x: 0.822,
                z: 0.317,
                v: 'c5',
                cols: [
                  [0.8, 0.294, 0.033]
                ]
              },
              {
                x: 0.814,
                z: 0.565,
                v: 'c3',
                cols: [
                  [0.79, 0.543, 0.028]
                ]
              },
              {
                x: 0.821,
                z: 0.902,
                v: 'c5',
                cols: [
                  [0.799, 0.879, 0.033]
                ]
              },
              {
                x: 0.816,
                z: 0.951,
                v: 'c3',
                cols: [
                  [0.792, 0.929, 0.028]
                ]
              },
              {
                x: 0.832,
                z: 0.221,
                v: 'c3',
                cols: [
                  [0.808, 0.199, 0.028]
                ]
              },
              {
                x: 0.832,
                z: 0.439,
                v: 'c3',
                cols: [
                  [0.808, 0.417, 0.028]
                ]
              },
              {
                x: 0.847,
                z: 0.495,
                v: 'c5',
                cols: [
                  [0.825, 0.472, 0.033]
                ]
              },
              {
                x: 0.832,
                z: 0.623,
                v: 'c3',
                cols: [
                  [0.808, 0.601, 0.028]
                ]
              },
              {
                x: 0.871,
                z: 0.56,
                v: 'c3',
                cols: [
                  [0.847, 0.538, 0.028]
                ]
              },
              {
                x: 0.883,
                z: 0.956,
                v: 'c3',
                cols: [
                  [0.859, 0.934, 0.028]
                ]
              },
              {
                x: 0.901,
                z: 0.61,
                v: 'c5',
                cols: [
                  [0.879, 0.587, 0.033]
                ]
              },
              {
                x: 0.937,
                z: 0.568,
                v: 'c5',
                cols: [
                  [0.915, 0.545, 0.033]
                ]
              },
              {
                x: 0.937,
                z: 0.965,
                v: 'c3',
                cols: [
                  [0.913, 0.943, 0.028]
                ]
              },
              {
                x: 0.957,
                z: 0.163,
                v: 'c5',
                cols: [
                  [0.935, 0.14, 0.033]
                ]
              }
            ],
            rocks: [],
            sticks: [
              {
                x: 0.263,
                z: 0.513,
                rotY: 5.28,
                flip: 0,
                scale: 1,
                cols: [
                  [0.263, 0.513, 0.017]
                ]
              },
              {
                x: 0.463,
                z: 0.613,
                rotY: 0.29,
                flip: 1,
                scale: 1,
                cols: [
                  [0.463, 0.613, 0.017]
                ]
              },
              {
                x: 0.088,
                z: 0.338,
                rotY: 1.14,
                flip: 0,
                scale: 1,
                cols: [
                  [0.088, 0.338, 0.017]
                ]
              },
              {
                x: 0.538,
                z: 0.763,
                rotY: 4.14,
                flip: 1,
                scale: 1,
                cols: [
                  [0.538, 0.763, 0.017]
                ]
              },
              {
                x: 0.738,
                z: 0.688,
                rotY: 1.79,
                flip: 1,
                scale: 1,
                cols: [
                  [0.738, 0.688, 0.017]
                ]
              },
              {
                x: 0.713,
                z: 0.513,
                rotY: 2.54,
                flip: 1,
                scale: 1,
                cols: [
                  [0.713, 0.513, 0.017]
                ]
              },
              {
                x: 0.313,
                z: 0.463,
                rotY: 1.27,
                flip: 0,
                scale: 1,
                cols: [
                  [0.313, 0.463, 0.017]
                ]
              }
            ],
            minables: []
          }
        },
        {
          id: 'forest_8',
          seed: 901,
          terrain: {
            hills: [
              {
                shape: 'rect',
                x: 0,
                z: 0.5,
                wx: 0.369,
                wz: 0.603,
                height: 0.43
              }
            ]
          },
          items: {
            trees: [
              {
                x: 0.062,
                z: 0.076,
                v: 'c5',
                cols: [
                  [0.04, 0.053, 0.033]
                ]
              },
              {
                x: 0.069,
                z: 0.479,
                v: 'c5',
                cols: [
                  [0.047, 0.456, 0.033]
                ]
              },
              {
                x: 0.068,
                z: 0.911,
                v: 'c3',
                cols: [
                  [0.044, 0.889, 0.028]
                ]
              },
              {
                x: 0.07,
                z: 0.988,
                v: 'c5',
                cols: [
                  [0.048, 0.965, 0.033]
                ]
              },
              {
                x: 0.106,
                z: 0.126,
                v: 'c3',
                cols: [
                  [0.082, 0.104, 0.028]
                ]
              },
              {
                x: 0.129,
                z: 0.338,
                v: 'c3',
                cols: [
                  [0.105, 0.316, 0.028]
                ]
              },
              {
                x: 0.131,
                z: 0.554,
                v: 'c5',
                cols: [
                  [0.109, 0.531, 0.033]
                ]
              },
              {
                x: 0.122,
                z: 0.933,
                v: 'c5',
                cols: [
                  [0.1, 0.91, 0.033]
                ]
              },
              {
                x: 0.139,
                z: 0.079,
                v: 'c5',
                cols: [
                  [0.117, 0.056, 0.033]
                ]
              },
              {
                x: 0.141,
                z: 0.184,
                v: 'c5',
                cols: [
                  [0.119, 0.161, 0.033]
                ]
              },
              {
                x: 0.147,
                z: 0.382,
                v: 'c3',
                cols: [
                  [0.123, 0.36, 0.028]
                ]
              },
              {
                x: 0.15,
                z: 0.467,
                v: 'c3',
                cols: [
                  [0.126, 0.445, 0.028]
                ]
              },
              {
                x: 0.16,
                z: 0.977,
                v: 'c5',
                cols: [
                  [0.138, 0.954, 0.033]
                ]
              },
              {
                x: 0.182,
                z: 0.422,
                v: 'c3',
                cols: [
                  [0.158, 0.4, 0.028]
                ]
              },
              {
                x: 0.179,
                z: 0.517,
                v: 'c5',
                cols: [
                  [0.157, 0.494, 0.033]
                ]
              },
              {
                x: 0.181,
                z: 0.651,
                v: 'c3',
                cols: [
                  [0.157, 0.629, 0.028]
                ]
              },
              {
                x: 0.187,
                z: 0.697,
                v: 'c3',
                cols: [
                  [0.163, 0.675, 0.028]
                ]
              },
              {
                x: 0.202,
                z: 0.073,
                v: 'c3',
                cols: [
                  [0.178, 0.051, 0.028]
                ]
              },
              {
                x: 0.214,
                z: 0.313,
                v: 'c3',
                cols: [
                  [0.19, 0.291, 0.028]
                ]
              },
              {
                x: 0.209,
                z: 0.376,
                v: 'c5',
                cols: [
                  [0.187, 0.353, 0.033]
                ]
              },
              {
                x: 0.207,
                z: 0.469,
                v: 'c3',
                cols: [
                  [0.183, 0.447, 0.028]
                ]
              },
              {
                x: 0.211,
                z: 0.748,
                v: 'c3',
                cols: [
                  [0.187, 0.726, 0.028]
                ]
              },
              {
                x: 0.234,
                z: 0.571,
                v: 'c5',
                cols: [
                  [0.212, 0.548, 0.033]
                ]
              },
              {
                x: 0.241,
                z: 0.636,
                v: 'c3',
                cols: [
                  [0.217, 0.614, 0.028]
                ]
              },
              {
                x: 0.249,
                z: 0.268,
                v: 'c3',
                cols: [
                  [0.225, 0.246, 0.028]
                ]
              },
              {
                x: 0.267,
                z: 0.326,
                v: 'c5',
                cols: [
                  [0.245, 0.303, 0.033]
                ]
              },
              {
                x: 0.253,
                z: 0.423,
                v: 'c5',
                cols: [
                  [0.231, 0.4, 0.033]
                ]
              },
              {
                x: 0.259,
                z: 0.698,
                v: 'c5',
                cols: [
                  [0.237, 0.675, 0.033]
                ]
              },
              {
                x: 0.267,
                z: 0.833,
                v: 'c3',
                cols: [
                  [0.243, 0.811, 0.028]
                ]
              },
              {
                x: 0.284,
                z: 0.143,
                v: 'c3',
                cols: [
                  [0.26, 0.121, 0.028]
                ]
              },
              {
                x: 0.294,
                z: 0.389,
                v: 'c3',
                cols: [
                  [0.27, 0.367, 0.028]
                ]
              },
              {
                x: 0.286,
                z: 0.75,
                v: 'c3',
                cols: [
                  [0.262, 0.728, 0.028]
                ]
              },
              {
                x: 0.321,
                z: 0.341,
                v: 'c5',
                cols: [
                  [0.299, 0.318, 0.033]
                ]
              },
              {
                x: 0.316,
                z: 0.971,
                v: 'c3',
                cols: [
                  [0.292, 0.949, 0.028]
                ]
              },
              {
                x: 0.341,
                z: 0.45,
                v: 'c3',
                cols: [
                  [0.317, 0.428, 0.028]
                ]
              },
              {
                x: 0.333,
                z: 0.701,
                v: 'c5',
                cols: [
                  [0.311, 0.678, 0.033]
                ]
              },
              {
                x: 0.374,
                z: 0.07,
                v: 'c3',
                cols: [
                  [0.35, 0.048, 0.028]
                ]
              },
              {
                x: 0.368,
                z: 0.644,
                v: 'c3',
                cols: [
                  [0.344, 0.622, 0.028]
                ]
              },
              {
                x: 0.399,
                z: 0.425,
                v: 'c3',
                cols: [
                  [0.375, 0.403, 0.028]
                ]
              },
              {
                x: 0.403,
                z: 0.561,
                v: 'c3',
                cols: [
                  [0.379, 0.539, 0.028]
                ]
              },
              {
                x: 0.384,
                z: 0.992,
                v: 'c3',
                cols: [
                  [0.36, 0.97, 0.028]
                ]
              },
              {
                x: 0.423,
                z: 0.073,
                v: 'c5',
                cols: [
                  [0.401, 0.05, 0.033]
                ]
              },
              {
                x: 0.424,
                z: 0.476,
                v: 'c5',
                cols: [
                  [0.402, 0.453, 0.033]
                ]
              },
              {
                x: 0.422,
                z: 0.636,
                v: 'c5',
                cols: [
                  [0.4, 0.613, 0.033]
                ]
              },
              {
                x: 0.45,
                z: 0.564,
                v: 'c3',
                cols: [
                  [0.426, 0.542, 0.028]
                ]
              },
              {
                x: 0.447,
                z: 0.689,
                v: 'c3',
                cols: [
                  [0.423, 0.667, 0.028]
                ]
              },
              {
                x: 0.443,
                z: 0.957,
                v: 'c3',
                cols: [
                  [0.419, 0.935, 0.028]
                ]
              },
              {
                x: 0.485,
                z: 0.63,
                v: 'c3',
                cols: [
                  [0.461, 0.608, 0.028]
                ]
              },
              {
                x: 0.496,
                z: 0.066,
                v: 'c3',
                cols: [
                  [0.472, 0.044, 0.028]
                ]
              },
              {
                x: 0.489,
                z: 0.511,
                v: 'c5',
                cols: [
                  [0.467, 0.488, 0.033]
                ]
              },
              {
                x: 0.511,
                z: 0.563,
                v: 'c5',
                cols: [
                  [0.489, 0.54, 0.033]
                ]
              },
              {
                x: 0.531,
                z: 0.318,
                v: 'c5',
                cols: [
                  [0.509, 0.295, 0.033]
                ]
              },
              {
                x: 0.537,
                z: 0.619,
                v: 'c5',
                cols: [
                  [0.515, 0.596, 0.033]
                ]
              },
              {
                x: 0.549,
                z: 0.076,
                v: 'c5',
                cols: [
                  [0.527, 0.053, 0.033]
                ]
              },
              {
                x: 0.553,
                z: 0.687,
                v: 'c5',
                cols: [
                  [0.531, 0.664, 0.033]
                ]
              },
              {
                x: 0.588,
                z: 0.33,
                v: 'c5',
                cols: [
                  [0.566, 0.307, 0.033]
                ]
              },
              {
                x: 0.586,
                z: 0.387,
                v: 'c5',
                cols: [
                  [0.564, 0.364, 0.033]
                ]
              },
              {
                x: 0.586,
                z: 0.581,
                v: 'c3',
                cols: [
                  [0.562, 0.559, 0.028]
                ]
              },
              {
                x: 0.591,
                z: 0.645,
                v: 'c5',
                cols: [
                  [0.569, 0.622, 0.033]
                ]
              },
              {
                x: 0.588,
                z: 0.744,
                v: 'c3',
                cols: [
                  [0.564, 0.722, 0.028]
                ]
              },
              {
                x: 0.591,
                z: 0.854,
                v: 'c5',
                cols: [
                  [0.569, 0.831, 0.033]
                ]
              },
              {
                x: 0.604,
                z: 0.25,
                v: 'c3',
                cols: [
                  [0.58, 0.228, 0.028]
                ]
              },
              {
                x: 0.619,
                z: 0.456,
                v: 'c3',
                cols: [
                  [0.595, 0.434, 0.028]
                ]
              },
              {
                x: 0.614,
                z: 0.7,
                v: 'c5',
                cols: [
                  [0.592, 0.677, 0.033]
                ]
              },
              {
                x: 0.61,
                z: 0.801,
                v: 'c3',
                cols: [
                  [0.586, 0.779, 0.028]
                ]
              },
              {
                x: 0.645,
                z: 0.563,
                v: 'c3',
                cols: [
                  [0.621, 0.541, 0.028]
                ]
              },
              {
                x: 0.638,
                z: 0.886,
                v: 'c5',
                cols: [
                  [0.616, 0.863, 0.033]
                ]
              },
              {
                x: 0.647,
                z: 0.951,
                v: 'c5',
                cols: [
                  [0.625, 0.928, 0.033]
                ]
              },
              {
                x: 0.663,
                z: 0.349,
                v: 'c5',
                cols: [
                  [0.641, 0.326, 0.033]
                ]
              },
              {
                x: 0.662,
                z: 0.414,
                v: 'c3',
                cols: [
                  [0.638, 0.392, 0.028]
                ]
              },
              {
                x: 0.651,
                z: 0.499,
                v: 'c3',
                cols: [
                  [0.627, 0.477, 0.028]
                ]
              },
              {
                x: 0.661,
                z: 0.737,
                v: 'c3',
                cols: [
                  [0.637, 0.715, 0.028]
                ]
              },
              {
                x: 0.661,
                z: 0.818,
                v: 'c3',
                cols: [
                  [0.637, 0.796, 0.028]
                ]
              },
              {
                x: 0.689,
                z: 0.457,
                v: 'c3',
                cols: [
                  [0.665, 0.435, 0.028]
                ]
              },
              {
                x: 0.695,
                z: 0.912,
                v: 'c5',
                cols: [
                  [0.673, 0.889, 0.033]
                ]
              },
              {
                x: 0.709,
                z: 0.504,
                v: 'c5',
                cols: [
                  [0.687, 0.481, 0.033]
                ]
              },
              {
                x: 0.728,
                z: 0.833,
                v: 'c5',
                cols: [
                  [0.706, 0.81, 0.033]
                ]
              },
              {
                x: 0.75,
                z: 0.887,
                v: 'c3',
                cols: [
                  [0.726, 0.865, 0.028]
                ]
              },
              {
                x: 0.779,
                z: 0.259,
                v: 'c3',
                cols: [
                  [0.755, 0.237, 0.028]
                ]
              },
              {
                x: 0.778,
                z: 0.554,
                v: 'c5',
                cols: [
                  [0.756, 0.531, 0.033]
                ]
              },
              {
                x: 0.808,
                z: 0.211,
                v: 'c5',
                cols: [
                  [0.786, 0.188, 0.033]
                ]
              },
              {
                x: 0.805,
                z: 0.831,
                v: 'c5',
                cols: [
                  [0.783, 0.808, 0.033]
                ]
              },
              {
                x: 0.809,
                z: 0.916,
                v: 'c5',
                cols: [
                  [0.787, 0.893, 0.033]
                ]
              },
              {
                x: 0.833,
                z: 0.062,
                v: 'c3',
                cols: [
                  [0.809, 0.04, 0.028]
                ]
              },
              {
                x: 0.818,
                z: 0.114,
                v: 'c5',
                cols: [
                  [0.796, 0.091, 0.033]
                ]
              },
              {
                x: 0.836,
                z: 0.265,
                v: 'c3',
                cols: [
                  [0.812, 0.243, 0.028]
                ]
              },
              {
                x: 0.827,
                z: 0.597,
                v: 'c5',
                cols: [
                  [0.805, 0.574, 0.033]
                ]
              },
              {
                x: 0.861,
                z: 0.204,
                v: 'c3',
                cols: [
                  [0.837, 0.182, 0.028]
                ]
              },
              {
                x: 0.849,
                z: 0.475,
                v: 'c3',
                cols: [
                  [0.825, 0.453, 0.028]
                ]
              },
              {
                x: 0.851,
                z: 0.856,
                v: 'c3',
                cols: [
                  [0.827, 0.834, 0.028]
                ]
              },
              {
                x: 0.84,
                z: 0.96,
                v: 'c3',
                cols: [
                  [0.816, 0.938, 0.028]
                ]
              },
              {
                x: 0.881,
                z: 0.09,
                v: 'c3',
                cols: [
                  [0.857, 0.068, 0.028]
                ]
              },
              {
                x: 0.869,
                z: 0.538,
                v: 'c3',
                cols: [
                  [0.845, 0.516, 0.028]
                ]
              },
              {
                x: 0.88,
                z: 0.589,
                v: 'c3',
                cols: [
                  [0.856, 0.567, 0.028]
                ]
              },
              {
                x: 0.884,
                z: 0.899,
                v: 'c3',
                cols: [
                  [0.86, 0.877, 0.028]
                ]
              },
              {
                x: 0.896,
                z: 0.142,
                v: 'c3',
                cols: [
                  [0.872, 0.12, 0.028]
                ]
              },
              {
                x: 0.908,
                z: 0.22,
                v: 'c3',
                cols: [
                  [0.884, 0.198, 0.028]
                ]
              },
              {
                x: 0.895,
                z: 0.438,
                v: 'c5',
                cols: [
                  [0.873, 0.415, 0.033]
                ]
              },
              {
                x: 0.907,
                z: 0.505,
                v: 'c3',
                cols: [
                  [0.883, 0.483, 0.028]
                ]
              },
              {
                x: 0.931,
                z: 0.074,
                v: 'c5',
                cols: [
                  [0.909, 0.051, 0.033]
                ]
              },
              {
                x: 0.938,
                z: 0.174,
                v: 'c5',
                cols: [
                  [0.916, 0.151, 0.033]
                ]
              },
              {
                x: 0.958,
                z: 0.123,
                v: 'c3',
                cols: [
                  [0.934, 0.101, 0.028]
                ]
              },
              {
                x: 0.95,
                z: 0.395,
                v: 'c3',
                cols: [
                  [0.926, 0.373, 0.028]
                ]
              },
              {
                x: 0.961,
                z: 0.447,
                v: 'c5',
                cols: [
                  [0.939, 0.424, 0.033]
                ]
              },
              {
                x: 0.987,
                z: 0.087,
                v: 'c3',
                cols: [
                  [0.963, 0.065, 0.028]
                ]
              }
            ],
            rocks: [],
            sticks: [
              {
                x: 0.538,
                z: 0.113,
                rotY: 0.68,
                flip: 0,
                scale: 1,
                cols: [
                  [0.538, 0.113, 0.017]
                ]
              },
              {
                x: 0.738,
                z: 0.113,
                rotY: 5.82,
                flip: 1,
                scale: 1,
                cols: [
                  [0.738, 0.113, 0.017]
                ]
              },
              {
                x: 0.388,
                z: 0.238,
                rotY: 3.06,
                flip: 0,
                scale: 1,
                cols: [
                  [0.388, 0.238, 0.017]
                ]
              },
              {
                x: 0.688,
                z: 0.588,
                rotY: 0.43,
                flip: 1,
                scale: 1,
                cols: [
                  [0.688, 0.588, 0.017]
                ]
              }
            ],
            minables: []
          }
        },
        {
          id: 'forest_9',
          seed: 1001,
          terrain: {
            hills: [
              {
                shape: 'tri',
                x: 1,
                z: 0,
                wx: 0.81,
                wz: 0.802,
                dirX: -1,
                dirZ: 1,
                height: 0.361
              }
            ]
          },
          items: {
            trees: [
              {
                x: 0.064,
                z: 0.059,
                v: 'c3',
                cols: [
                  [0.04, 0.037, 0.028]
                ]
              },
              {
                x: 0.068,
                z: 0.118,
                v: 'c3',
                cols: [
                  [0.044, 0.096, 0.028]
                ]
              },
              {
                x: 0.072,
                z: 0.169,
                v: 'c3',
                cols: [
                  [0.048, 0.147, 0.028]
                ]
              },
              {
                x: 0.07,
                z: 0.27,
                v: 'c3',
                cols: [
                  [0.046, 0.248, 0.028]
                ]
              },
              {
                x: 0.06,
                z: 0.328,
                v: 'c3',
                cols: [
                  [0.036, 0.306, 0.028]
                ]
              },
              {
                x: 0.06,
                z: 0.58,
                v: 'c5',
                cols: [
                  [0.038, 0.557, 0.033]
                ]
              },
              {
                x: 0.072,
                z: 0.634,
                v: 'c5',
                cols: [
                  [0.05, 0.611, 0.033]
                ]
              },
              {
                x: 0.057,
                z: 0.784,
                v: 'c3',
                cols: [
                  [0.033, 0.762, 0.028]
                ]
              },
              {
                x: 0.094,
                z: 0.834,
                v: 'c5',
                cols: [
                  [0.072, 0.811, 0.033]
                ]
              },
              {
                x: 0.119,
                z: 0.196,
                v: 'c3',
                cols: [
                  [0.095, 0.174, 0.028]
                ]
              },
              {
                x: 0.12,
                z: 0.249,
                v: 'c3',
                cols: [
                  [0.096, 0.227, 0.028]
                ]
              },
              {
                x: 0.112,
                z: 0.328,
                v: 'c5',
                cols: [
                  [0.09, 0.305, 0.033]
                ]
              },
              {
                x: 0.135,
                z: 0.528,
                v: 'c3',
                cols: [
                  [0.111, 0.506, 0.028]
                ]
              },
              {
                x: 0.14,
                z: 0.764,
                v: 'c3',
                cols: [
                  [0.116, 0.742, 0.028]
                ]
              },
              {
                x: 0.147,
                z: 0.839,
                v: 'c3',
                cols: [
                  [0.123, 0.817, 0.028]
                ]
              },
              {
                x: 0.142,
                z: 0.905,
                v: 'c5',
                cols: [
                  [0.12, 0.882, 0.033]
                ]
              },
              {
                x: 0.171,
                z: 0.211,
                v: 'c3',
                cols: [
                  [0.147, 0.189, 0.028]
                ]
              },
              {
                x: 0.17,
                z: 0.351,
                v: 'c3',
                cols: [
                  [0.146, 0.329, 0.028]
                ]
              },
              {
                x: 0.166,
                z: 0.474,
                v: 'c3',
                cols: [
                  [0.142, 0.452, 0.028]
                ]
              },
              {
                x: 0.188,
                z: 0.525,
                v: 'c3',
                cols: [
                  [0.164, 0.503, 0.028]
                ]
              },
              {
                x: 0.196,
                z: 0.762,
                v: 'c3',
                cols: [
                  [0.172, 0.74, 0.028]
                ]
              },
              {
                x: 0.199,
                z: 0.853,
                v: 'c3',
                cols: [
                  [0.175, 0.831, 0.028]
                ]
              },
              {
                x: 0.186,
                z: 0.941,
                v: 'c3',
                cols: [
                  [0.162, 0.919, 0.028]
                ]
              },
              {
                x: 0.217,
                z: 0.454,
                v: 'c5',
                cols: [
                  [0.195, 0.431, 0.033]
                ]
              },
              {
                x: 0.243,
                z: 0.505,
                v: 'c3',
                cols: [
                  [0.219, 0.483, 0.028]
                ]
              },
              {
                x: 0.242,
                z: 0.784,
                v: 'c3',
                cols: [
                  [0.218, 0.762, 0.028]
                ]
              },
              {
                x: 0.249,
                z: 0.879,
                v: 'c3',
                cols: [
                  [0.225, 0.857, 0.028]
                ]
              },
              {
                x: 0.241,
                z: 0.934,
                v: 'c3',
                cols: [
                  [0.217, 0.912, 0.028]
                ]
              },
              {
                x: 0.272,
                z: 0.213,
                v: 'c5',
                cols: [
                  [0.25, 0.19, 0.033]
                ]
              },
              {
                x: 0.27,
                z: 0.423,
                v: 'c5',
                cols: [
                  [0.248, 0.4, 0.033]
                ]
              },
              {
                x: 0.299,
                z: 0.749,
                v: 'c3',
                cols: [
                  [0.275, 0.727, 0.028]
                ]
              },
              {
                x: 0.297,
                z: 0.891,
                v: 'c5',
                cols: [
                  [0.275, 0.868, 0.033]
                ]
              },
              {
                x: 0.298,
                z: 0.954,
                v: 'c5',
                cols: [
                  [0.276, 0.931, 0.033]
                ]
              },
              {
                x: 0.322,
                z: 0.172,
                v: 'c5',
                cols: [
                  [0.3, 0.149, 0.033]
                ]
              },
              {
                x: 0.316,
                z: 0.267,
                v: 'c3',
                cols: [
                  [0.292, 0.245, 0.028]
                ]
              },
              {
                x: 0.318,
                z: 0.68,
                v: 'c5',
                cols: [
                  [0.296, 0.657, 0.033]
                ]
              },
              {
                x: 0.352,
                z: 0.218,
                v: 'c3',
                cols: [
                  [0.328, 0.196, 0.028]
                ]
              },
              {
                x: 0.349,
                z: 0.319,
                v: 'c3',
                cols: [
                  [0.325, 0.297, 0.028]
                ]
              },
              {
                x: 0.349,
                z: 0.455,
                v: 'c5',
                cols: [
                  [0.327, 0.432, 0.033]
                ]
              },
              {
                x: 0.349,
                z: 0.756,
                v: 'c5',
                cols: [
                  [0.327, 0.733, 0.033]
                ]
              },
              {
                x: 0.351,
                z: 0.955,
                v: 'c3',
                cols: [
                  [0.327, 0.933, 0.028]
                ]
              },
              {
                x: 0.366,
                z: 0.115,
                v: 'c5',
                cols: [
                  [0.344, 0.092, 0.033]
                ]
              },
              {
                x: 0.377,
                z: 0.172,
                v: 'c3',
                cols: [
                  [0.353, 0.15, 0.028]
                ]
              },
              {
                x: 0.366,
                z: 0.268,
                v: 'c3',
                cols: [
                  [0.342, 0.246, 0.028]
                ]
              },
              {
                x: 0.398,
                z: 0.316,
                v: 'c5',
                cols: [
                  [0.376, 0.293, 0.033]
                ]
              },
              {
                x: 0.4,
                z: 0.401,
                v: 'c3',
                cols: [
                  [0.376, 0.379, 0.028]
                ]
              },
              {
                x: 0.39,
                z: 0.675,
                v: 'c3',
                cols: [
                  [0.366, 0.653, 0.028]
                ]
              },
              {
                x: 0.421,
                z: 0.093,
                v: 'c5',
                cols: [
                  [0.399, 0.07, 0.033]
                ]
              },
              {
                x: 0.431,
                z: 0.172,
                v: 'c3',
                cols: [
                  [0.407, 0.15, 0.028]
                ]
              },
              {
                x: 0.426,
                z: 0.735,
                v: 'c5',
                cols: [
                  [0.404, 0.712, 0.033]
                ]
              },
              {
                x: 0.454,
                z: 0.398,
                v: 'c5',
                cols: [
                  [0.432, 0.375, 0.033]
                ]
              },
              {
                x: 0.478,
                z: 0.059,
                v: 'c3',
                cols: [
                  [0.454, 0.037, 0.028]
                ]
              },
              {
                x: 0.478,
                z: 0.148,
                v: 'c3',
                cols: [
                  [0.454, 0.126, 0.028]
                ]
              },
              {
                x: 0.473,
                z: 0.814,
                v: 'c5',
                cols: [
                  [0.451, 0.791, 0.033]
                ]
              },
              {
                x: 0.506,
                z: 0.197,
                v: 'c5',
                cols: [
                  [0.484, 0.174, 0.033]
                ]
              },
              {
                x: 0.504,
                z: 0.373,
                v: 'c3',
                cols: [
                  [0.48, 0.351, 0.028]
                ]
              },
              {
                x: 0.501,
                z: 0.426,
                v: 'c5',
                cols: [
                  [0.479, 0.403, 0.033]
                ]
              },
              {
                x: 0.505,
                z: 0.863,
                v: 'c5',
                cols: [
                  [0.483, 0.84, 0.033]
                ]
              },
              {
                x: 0.529,
                z: 0.064,
                v: 'c5',
                cols: [
                  [0.507, 0.041, 0.033]
                ]
              },
              {
                x: 0.53,
                z: 0.805,
                v: 'c5',
                cols: [
                  [0.508, 0.782, 0.033]
                ]
              },
              {
                x: 0.552,
                z: 0.117,
                v: 'c5',
                cols: [
                  [0.53, 0.094, 0.033]
                ]
              },
              {
                x: 0.559,
                z: 0.276,
                v: 'c3',
                cols: [
                  [0.535, 0.254, 0.028]
                ]
              },
              {
                x: 0.548,
                z: 0.403,
                v: 'c3',
                cols: [
                  [0.524, 0.381, 0.028]
                ]
              },
              {
                x: 0.581,
                z: 0.168,
                v: 'c5',
                cols: [
                  [0.559, 0.145, 0.033]
                ]
              },
              {
                x: 0.575,
                z: 0.326,
                v: 'c5',
                cols: [
                  [0.553, 0.303, 0.033]
                ]
              },
              {
                x: 0.575,
                z: 0.657,
                v: 'c5',
                cols: [
                  [0.553, 0.634, 0.033]
                ]
              },
              {
                x: 0.608,
                z: 0.243,
                v: 'c3',
                cols: [
                  [0.584, 0.221, 0.028]
                ]
              },
              {
                x: 0.595,
                z: 0.372,
                v: 'c3',
                cols: [
                  [0.571, 0.35, 0.028]
                ]
              },
              {
                x: 0.6,
                z: 0.733,
                v: 'c3',
                cols: [
                  [0.576, 0.711, 0.028]
                ]
              },
              {
                x: 0.633,
                z: 0.199,
                v: 'c5',
                cols: [
                  [0.611, 0.176, 0.033]
                ]
              },
              {
                x: 0.633,
                z: 0.656,
                v: 'c5',
                cols: [
                  [0.611, 0.633, 0.033]
                ]
              },
              {
                x: 0.66,
                z: 0.322,
                v: 'c5',
                cols: [
                  [0.638, 0.299, 0.033]
                ]
              },
              {
                x: 0.656,
                z: 0.396,
                v: 'c3',
                cols: [
                  [0.632, 0.374, 0.028]
                ]
              },
              {
                x: 0.659,
                z: 0.709,
                v: 'c5',
                cols: [
                  [0.637, 0.686, 0.033]
                ]
              },
              {
                x: 0.66,
                z: 0.934,
                v: 'c3',
                cols: [
                  [0.636, 0.912, 0.028]
                ]
              },
              {
                x: 0.684,
                z: 0.25,
                v: 'c3',
                cols: [
                  [0.66, 0.228, 0.028]
                ]
              },
              {
                x: 0.681,
                z: 0.881,
                v: 'c3',
                cols: [
                  [0.657, 0.859, 0.028]
                ]
              },
              {
                x: 0.683,
                z: 0.993,
                v: 'c3',
                cols: [
                  [0.659, 0.971, 0.028]
                ]
              },
              {
                x: 0.711,
                z: 0.297,
                v: 'c3',
                cols: [
                  [0.687, 0.275, 0.028]
                ]
              },
              {
                x: 0.707,
                z: 0.353,
                v: 'c3',
                cols: [
                  [0.683, 0.331, 0.028]
                ]
              },
              {
                x: 0.706,
                z: 0.738,
                v: 'c5',
                cols: [
                  [0.684, 0.715, 0.033]
                ]
              },
              {
                x: 0.702,
                z: 0.809,
                v: 'c5',
                cols: [
                  [0.68, 0.786, 0.033]
                ]
              },
              {
                x: 0.731,
                z: 0.225,
                v: 'c5',
                cols: [
                  [0.709, 0.202, 0.033]
                ]
              },
              {
                x: 0.736,
                z: 0.884,
                v: 'c5',
                cols: [
                  [0.714, 0.861, 0.033]
                ]
              },
              {
                x: 0.738,
                z: 0.942,
                v: 'c5',
                cols: [
                  [0.716, 0.919, 0.033]
                ]
              },
              {
                x: 0.763,
                z: 0.291,
                v: 'c5',
                cols: [
                  [0.741, 0.268, 0.033]
                ]
              },
              {
                x: 0.75,
                z: 0.834,
                v: 'c3',
                cols: [
                  [0.726, 0.812, 0.028]
                ]
              },
              {
                x: 0.815,
                z: 0.225,
                v: 'c3',
                cols: [
                  [0.791, 0.203, 0.028]
                ]
              },
              {
                x: 0.801,
                z: 0.391,
                v: 'c3',
                cols: [
                  [0.777, 0.369, 0.028]
                ]
              },
              {
                x: 0.811,
                z: 0.808,
                v: 'c3',
                cols: [
                  [0.787, 0.786, 0.028]
                ]
              },
              {
                x: 0.865,
                z: 0.188,
                v: 'c5',
                cols: [
                  [0.843, 0.165, 0.033]
                ]
              },
              {
                x: 0.855,
                z: 0.379,
                v: 'c3',
                cols: [
                  [0.831, 0.357, 0.028]
                ]
              },
              {
                x: 0.865,
                z: 0.452,
                v: 'c5',
                cols: [
                  [0.843, 0.429, 0.033]
                ]
              },
              {
                x: 0.855,
                z: 0.557,
                v: 'c5',
                cols: [
                  [0.833, 0.534, 0.033]
                ]
              },
              {
                x: 0.885,
                z: 0.506,
                v: 'c3',
                cols: [
                  [0.861, 0.484, 0.028]
                ]
              },
              {
                x: 0.887,
                z: 0.604,
                v: 'c5',
                cols: [
                  [0.865, 0.581, 0.033]
                ]
              },
              {
                x: 0.916,
                z: 0.349,
                v: 'c5',
                cols: [
                  [0.894, 0.326, 0.033]
                ]
              },
              {
                x: 0.918,
                z: 0.99,
                v: 'c3',
                cols: [
                  [0.894, 0.968, 0.028]
                ]
              },
              {
                x: 0.931,
                z: 0.145,
                v: 'c5',
                cols: [
                  [0.909, 0.122, 0.033]
                ]
              },
              {
                x: 0.936,
                z: 0.222,
                v: 'c3',
                cols: [
                  [0.912, 0.2, 0.028]
                ]
              },
              {
                x: 0.934,
                z: 0.475,
                v: 'c3',
                cols: [
                  [0.91, 0.453, 0.028]
                ]
              },
              {
                x: 0.942,
                z: 0.529,
                v: 'c3',
                cols: [
                  [0.918, 0.507, 0.028]
                ]
              },
              {
                x: 0.936,
                z: 0.581,
                v: 'c3',
                cols: [
                  [0.912, 0.559, 0.028]
                ]
              },
              {
                x: 0.959,
                z: 0.931,
                v: 'c3',
                cols: [
                  [0.935, 0.909, 0.028]
                ]
              },
              {
                x: 0.964,
                z: 0.991,
                v: 'c3',
                cols: [
                  [0.94, 0.969, 0.028]
                ]
              },
              {
                x: 0.985,
                z: 0.171,
                v: 'c5',
                cols: [
                  [0.963, 0.148, 0.033]
                ]
              },
              {
                x: 0.994,
                z: 0.246,
                v: 'c3',
                cols: [
                  [0.97, 0.224, 0.028]
                ]
              },
              {
                x: 0.982,
                z: 0.76,
                v: 'c5',
                cols: [
                  [0.96, 0.737, 0.033]
                ]
              }
            ],
            rocks: [],
            sticks: [
              {
                x: 0.838,
                z: 0.088,
                rotY: 6.23,
                flip: 0,
                scale: 1,
                cols: [
                  [0.838, 0.088, 0.017]
                ]
              },
              {
                x: 0.213,
                z: 0.338,
                rotY: 6.18,
                flip: 0,
                scale: 1,
                cols: [
                  [0.213, 0.338, 0.017]
                ]
              },
              {
                x: 0.488,
                z: 0.613,
                rotY: 2.86,
                flip: 1,
                scale: 1,
                cols: [
                  [0.488, 0.613, 0.017]
                ]
              },
              {
                x: 0.388,
                z: 0.563,
                rotY: 0.52,
                flip: 0,
                scale: 1,
                cols: [
                  [0.388, 0.563, 0.017]
                ]
              },
              {
                x: 0.438,
                z: 0.288,
                rotY: 5.1,
                flip: 0,
                scale: 1,
                cols: [
                  [0.438, 0.288, 0.017]
                ]
              },
              {
                x: 0.888,
                z: 0.838,
                rotY: 3.54,
                flip: 1,
                scale: 1,
                cols: [
                  [0.888, 0.838, 0.017]
                ]
              }
            ],
            minables: []
          }
        },
      ],
  },
  desert: {
    name: 'Desert Biome',
    borderMargin: 0.03, // UV margin on edges adjacent to a different biome
    generationRules: {
      hills: null, // deserts are flat â€” no hills
      trees: {
        totalRange: { min: 14, max: 22 },
        variantWeights: { sg: 0.40, br: 0.25, pp: 0.20, db: 0.15 },
        minSpacing: 0.06,
      },
      rocks: { count: { min: 4, max: 8 }, scale: { min: 0.50, max: 0.85 } },
      minables: null, // no desert-specific minable material yet
    },
    treeVariants: ['cactus_saguaro', 'cactus_barrel', 'cactus_prickly', 'dead_bush'],
    configs: [
        {
          id: 'desert_1',
          seed: 301,
          terrain: {
            hills: []
          },
          items: {
            trees: [
              {
                x: 0.347,
                z: 0.352,
                v: 'pp',
                cols: [
                  [0.347, 0.352, 0.007]
                ]
              },
              {
                x: 0.764,
                z: 0.214,
                v: 'br',
                cols: [
                  [0.764, 0.214, 0.006]
                ]
              },
              {
                x: 0.151,
                z: 0.967,
                v: 'db',
                cols: [
                  [0.151, 0.967, 0.004]
                ]
              },
              {
                x: 0.534,
                z: 0.384,
                v: 'br',
                cols: [
                  [0.534, 0.384, 0.006]
                ]
              },
              {
                x: 0.082,
                z: 0.51,
                v: 'pp',
                cols: [
                  [0.082, 0.51, 0.007]
                ]
              },
              {
                x: 0.617,
                z: 0.025,
                v: 'sg',
                cols: [
                  [0.617, 0.025, 0.005]
                ]
              },
              {
                x: 0.89,
                z: 0.348,
                v: 'br',
                cols: [
                  [0.89, 0.348, 0.006]
                ]
              },
              {
                x: 0.204,
                z: 0.078,
                v: 'db',
                cols: [
                  [0.204, 0.078, 0.004]
                ]
              },
              {
                x: 0.386,
                z: 0.038,
                v: 'pp',
                cols: [
                  [0.386, 0.038, 0.007]
                ]
              },
              {
                x: 0.979,
                z: 0.59,
                v: 'db',
                cols: [
                  [0.979, 0.59, 0.004]
                ]
              },
              {
                x: 0.862,
                z: 0.849,
                v: 'sg',
                cols: [
                  [0.862, 0.849, 0.005]
                ]
              },
              {
                x: 0.783,
                z: 0.734,
                v: 'br',
                cols: [
                  [0.783, 0.734, 0.006]
                ]
              },
              {
                x: 0.663,
                z: 0.782,
                v: 'pp',
                cols: [
                  [0.663, 0.782, 0.007]
                ]
              },
              {
                x: 0.819,
                z: 0.349,
                v: 'db',
                cols: [
                  [0.819, 0.349, 0.004]
                ]
              },
              {
                x: 0.523,
                z: 0.522,
                v: 'pp',
                cols: [
                  [0.523, 0.522, 0.007]
                ]
              },
              {
                x: 0.921,
                z: 0.262,
                v: 'br',
                cols: [
                  [0.921, 0.262, 0.006]
                ]
              },
              {
                x: 0.532,
                z: 0.837,
                v: 'br',
                cols: [
                  [0.532, 0.837, 0.006]
                ]
              },
              {
                x: 0.159,
                z: 0.656,
                v: 'pp',
                cols: [
                  [0.159, 0.656, 0.007]
                ]
              },
              {
                x: 0.173,
                z: 0.451,
                v: 'pp',
                cols: [
                  [0.173, 0.451, 0.007]
                ]
              },
              {
                x: 0.663,
                z: 0.375,
                v: 'pp',
                cols: [
                  [0.663, 0.375, 0.007]
                ]
              }
            ],
            rocks: [
              {
                x: 0.637,
                z: 0.481,
                rotY: 3.9,
                scale: 0.62,
                cols: [
                  [0.637, 0.481, 0.0093]
                ]
              },
              {
                x: 0.54,
                z: 0.828,
                rotY: 2.4,
                scale: 0.55,
                cols: [
                  [0.54, 0.828, 0.0083]
                ]
              },
              {
                x: 0.471,
                z: 0.871,
                rotY: 2.5,
                scale: 0.7,
                cols: [
                  [0.471, 0.871, 0.0105]
                ]
              },
              {
                x: 0.693,
                z: 0.192,
                rotY: 1.5,
                scale: 0.53,
                cols: [
                  [0.693, 0.192, 0.008]
                ]
              },
              {
                x: 0.922,
                z: 0.509,
                rotY: 2.4,
                scale: 0.71,
                cols: [
                  [0.922, 0.509, 0.0106]
                ]
              },
              {
                x: 0.429,
                z: 0.535,
                rotY: 4.1,
                scale: 0.7,
                cols: [
                  [0.429, 0.535, 0.0105]
                ]
              },
              {
                x: 0.254,
                z: 0.615,
                rotY: 0.4,
                scale: 0.77,
                cols: [
                  [0.254, 0.615, 0.0115]
                ]
              },
              {
                x: 0.547,
                z: 0.371,
                rotY: 1.9,
                scale: 0.71,
                cols: [
                  [0.547, 0.371, 0.0106]
                ]
              }
            ],
            sticks: [],
            minables: []
          }
        },
        {
          id: 'desert_2',
          seed: 401,
          terrain: {
            hills: []
          },
          items: {
            trees: [
              {
                x: 0.679,
                z: 0.91,
                v: 'pp',
                cols: [
                  [0.679, 0.91, 0.007]
                ]
              },
              {
                x: 0.754,
                z: 0.699,
                v: 'db',
                cols: [
                  [0.754, 0.699, 0.004]
                ]
              },
              {
                x: 0.673,
                z: 0.227,
                v: 'pp',
                cols: [
                  [0.673, 0.227, 0.007]
                ]
              },
              {
                x: 0.888,
                z: 0.096,
                v: 'sg',
                cols: [
                  [0.888, 0.096, 0.005]
                ]
              },
              {
                x: 0.914,
                z: 0.171,
                v: 'sg',
                cols: [
                  [0.914, 0.171, 0.005]
                ]
              },
              {
                x: 0.623,
                z: 0.14,
                v: 'sg',
                cols: [
                  [0.623, 0.14, 0.005]
                ]
              },
              {
                x: 0.125,
                z: 0.054,
                v: 'sg',
                cols: [
                  [0.125, 0.054, 0.005]
                ]
              },
              {
                x: 0.815,
                z: 0.07,
                v: 'sg',
                cols: [
                  [0.815, 0.07, 0.005]
                ]
              },
              {
                x: 0.062,
                z: 0.068,
                v: 'pp',
                cols: [
                  [0.062, 0.068, 0.007]
                ]
              },
              {
                x: 0.005,
                z: 0.661,
                v: 'db',
                cols: [
                  [0.005, 0.661, 0.004]
                ]
              },
              {
                x: 0.748,
                z: 0.765,
                v: 'pp',
                cols: [
                  [0.748, 0.765, 0.007]
                ]
              },
              {
                x: 0.446,
                z: 0.261,
                v: 'br',
                cols: [
                  [0.446, 0.261, 0.006]
                ]
              },
              {
                x: 0.789,
                z: 0.312,
                v: 'pp',
                cols: [
                  [0.789, 0.312, 0.007]
                ]
              },
              {
                x: 0.959,
                z: 0.213,
                v: 'br',
                cols: [
                  [0.959, 0.213, 0.006]
                ]
              },
              {
                x: 0.689,
                z: 0.864,
                v: 'br',
                cols: [
                  [0.689, 0.864, 0.006]
                ]
              },
              {
                x: 0.759,
                z: 0.394,
                v: 'br',
                cols: [
                  [0.759, 0.394, 0.006]
                ]
              },
              {
                x: 0.517,
                z: 0.3,
                v: 'sg',
                cols: [
                  [0.517, 0.3, 0.005]
                ]
              },
              {
                x: 0.954,
                z: 0.446,
                v: 'sg',
                cols: [
                  [0.954, 0.446, 0.005]
                ]
              },
              {
                x: 0.927,
                z: 0.049,
                v: 'db',
                cols: [
                  [0.927, 0.049, 0.004]
                ]
              },
              {
                x: 0.456,
                z: 0.123,
                v: 'sg',
                cols: [
                  [0.456, 0.123, 0.005]
                ]
              },
              {
                x: 0.246,
                z: 0.525,
                v: 'db',
                cols: [
                  [0.246, 0.525, 0.004]
                ]
              }
            ],
            rocks: [
              {
                x: 0.688,
                z: 0.828,
                rotY: 3.9,
                scale: 1.0,
                cols: [
                  [0.688, 0.828, 0.0075]
                ]
              },
              {
                x: 0.408,
                z: 0.826,
                rotY: 0.1,
                scale: 0.51,
                cols: [
                  [0.408, 0.826, 0.0076]
                ]
              },
              {
                x: 0.784,
                z: 0.053,
                rotY: 4,
                scale: 0.55,
                cols: [
                  [0.784, 0.053, 0.0083]
                ]
              },
              {
                x: 0.845,
                z: 0.904,
                rotY: 1.4,
                scale: 0.61,
                cols: [
                  [0.845, 0.904, 0.0092]
                ]
              },
              {
                x: 0.947,
                z: 0.342,
                rotY: 5.8,
                scale: 0.57,
                cols: [
                  [0.947, 0.342, 0.0085]
                ]
              }
            ],
            sticks: [],
            minables: []
          }
        },
        {
          id: 'desert_3',
          seed: 501,
          terrain: {
            hills: []
          },
          items: {
            trees: [
              {
                x: 0.01,
                z: 0.467,
                v: 'pp',
                cols: [
                  [0.01, 0.467, 0.007]
                ]
              },
              {
                x: 0.745,
                z: 0.184,
                v: 'sg',
                cols: [
                  [0.745, 0.184, 0.005]
                ]
              },
              {
                x: 0.195,
                z: 0.487,
                v: 'pp',
                cols: [
                  [0.195, 0.487, 0.007]
                ]
              },
              {
                x: 0.242,
                z: 0.807,
                v: 'db',
                cols: [
                  [0.242, 0.807, 0.004]
                ]
              },
              {
                x: 0.745,
                z: 0.832,
                v: 'sg',
                cols: [
                  [0.745, 0.832, 0.005]
                ]
              },
              {
                x: 0.63,
                z: 0.255,
                v: 'br',
                cols: [
                  [0.63, 0.255, 0.006]
                ]
              },
              {
                x: 0.279,
                z: 0.644,
                v: 'br',
                cols: [
                  [0.279, 0.644, 0.006]
                ]
              },
              {
                x: 0.046,
                z: 0.029,
                v: 'sg',
                cols: [
                  [0.046, 0.029, 0.005]
                ]
              },
              {
                x: 0.851,
                z: 0.955,
                v: 'br',
                cols: [
                  [0.851, 0.955, 0.006]
                ]
              },
              {
                x: 0.651,
                z: 0.549,
                v: 'br',
                cols: [
                  [0.651, 0.549, 0.006]
                ]
              },
              {
                x: 0.263,
                z: 0.287,
                v: 'br',
                cols: [
                  [0.263, 0.287, 0.006]
                ]
              },
              {
                x: 0.227,
                z: 0.588,
                v: 'br',
                cols: [
                  [0.227, 0.588, 0.006]
                ]
              },
              {
                x: 0.833,
                z: 0.748,
                v: 'db',
                cols: [
                  [0.833, 0.748, 0.004]
                ]
              },
              {
                x: 0.073,
                z: 0.174,
                v: 'db',
                cols: [
                  [0.073, 0.174, 0.004]
                ]
              },
              {
                x: 0.054,
                z: 0.101,
                v: 'db',
                cols: [
                  [0.054, 0.101, 0.004]
                ]
              },
              {
                x: 0.846,
                z: 0.891,
                v: 'br',
                cols: [
                  [0.846, 0.891, 0.006]
                ]
              },
              {
                x: 0.359,
                z: 0.132,
                v: 'sg',
                cols: [
                  [0.359, 0.132, 0.005]
                ]
              },
              {
                x: 0.86,
                z: 0.149,
                v: 'sg',
                cols: [
                  [0.86, 0.149, 0.005]
                ]
              },
              {
                x: 0.246,
                z: 0.517,
                v: 'br',
                cols: [
                  [0.246, 0.517, 0.006]
                ]
              },
              {
                x: 0.885,
                z: 0.461,
                v: 'br',
                cols: [
                  [0.885, 0.461, 0.006]
                ]
              },
              {
                x: 0.564,
                z: 0.623,
                v: 'pp',
                cols: [
                  [0.564, 0.623, 0.007]
                ]
              }
            ],
            rocks: [
              {
                x: 0.902,
                z: 0.482,
                rotY: 3.2,
                scale: 0.56,
                cols: [
                  [0.902, 0.482, 0.0084]
                ]
              },
              {
                x: 0.07,
                z: 0.631,
                rotY: 3.9,
                scale: 0.69,
                cols: [
                  [0.07, 0.631, 0.0103]
                ]
              },
              {
                x: 0.56,
                z: 0.821,
                rotY: 0.4,
                scale: 0.53,
                cols: [
                  [0.56, 0.821, 0.008]
                ]
              },
              {
                x: 0.515,
                z: 0.886,
                rotY: 4.3,
                scale: 0.72,
                cols: [
                  [0.515, 0.886, 0.0108]
                ]
              },
              {
                x: 0.032,
                z: 0.178,
                rotY: 2,
                scale: 0.82,
                cols: [
                  [0.032, 0.178, 0.0123]
                ]
              },
              {
                x: 0.033,
                z: 0.12,
                rotY: 5,
                scale: 0.58,
                cols: [
                  [0.033, 0.12, 0.0087]
                ]
              },
              {
                x: 0.564,
                z: 0.119,
                rotY: 6.1,
                scale: 0.55,
                cols: [
                  [0.564, 0.119, 0.0083]
                ]
              }
            ],
            sticks: [],
            minables: []
          }
        },
        {
          id: 'desert_4',
          seed: 601,
          terrain: {
            hills: []
          },
          items: {
            trees: [
              {
                x: 0.341,
                z: 0.025,
                v: 'pp',
                cols: [
                  [0.341, 0.025, 0.007]
                ]
              },
              {
                x: 0.735,
                z: 0.668,
                v: 'br',
                cols: [
                  [0.735, 0.668, 0.006]
                ]
              },
              {
                x: 0.718,
                z: 0.748,
                v: 'pp',
                cols: [
                  [0.718, 0.748, 0.007]
                ]
              },
              {
                x: 0.596,
                z: 0.519,
                v: 'br',
                cols: [
                  [0.596, 0.519, 0.006]
                ]
              },
              {
                x: 0.576,
                z: 0.492,
                v: 'pp',
                cols: [
                  [0.576, 0.492, 0.007]
                ]
              },
              {
                x: 0.636,
                z: 0.371,
                v: 'pp',
                cols: [
                  [0.636, 0.371, 0.007]
                ]
              },
              {
                x: 0.474,
                z: 0.292,
                v: 'br',
                cols: [
                  [0.474, 0.292, 0.006]
                ]
              },
              {
                x: 0.584,
                z: 0.914,
                v: 'sg',
                cols: [
                  [0.584, 0.914, 0.005]
                ]
              },
              {
                x: 0.487,
                z: 0.029,
                v: 'db',
                cols: [
                  [0.487, 0.029, 0.004]
                ]
              },
              {
                x: 0.464,
                z: 0.506,
                v: 'sg',
                cols: [
                  [0.464, 0.506, 0.005]
                ]
              },
              {
                x: 0.45,
                z: 0.515,
                v: 'sg',
                cols: [
                  [0.45, 0.515, 0.005]
                ]
              },
              {
                x: 0.918,
                z: 0.731,
                v: 'db',
                cols: [
                  [0.918, 0.731, 0.004]
                ]
              },
              {
                x: 0.699,
                z: 0.086,
                v: 'br',
                cols: [
                  [0.699, 0.086, 0.006]
                ]
              },
              {
                x: 0.319,
                z: 0.891,
                v: 'db',
                cols: [
                  [0.319, 0.891, 0.004]
                ]
              },
              {
                x: 0.035,
                z: 0.116,
                v: 'db',
                cols: [
                  [0.035, 0.116, 0.004]
                ]
              },
              {
                x: 0.959,
                z: 0.87,
                v: 'db',
                cols: [
                  [0.959, 0.87, 0.004]
                ]
              },
              {
                x: 0.537,
                z: 0.589,
                v: 'db',
                cols: [
                  [0.537, 0.589, 0.004]
                ]
              },
              {
                x: 0.844,
                z: 0.873,
                v: 'db',
                cols: [
                  [0.844, 0.873, 0.004]
                ]
              },
              {
                x: 0.672,
                z: 0.122,
                v: 'br',
                cols: [
                  [0.672, 0.122, 0.006]
                ]
              },
              {
                x: 0.083,
                z: 0.279,
                v: 'sg',
                cols: [
                  [0.083, 0.279, 0.005]
                ]
              },
              {
                x: 0.008,
                z: 0.322,
                v: 'sg',
                cols: [
                  [0.008, 0.322, 0.005]
                ]
              }
            ],
            rocks: [
              {
                x: 0.473,
                z: 0.841,
                rotY: 3.8,
                scale: 0.6,
                cols: [
                  [0.473, 0.841, 0.009]
                ]
              },
              {
                x: 0.185,
                z: 0.333,
                rotY: 4,
                scale: 0.84,
                cols: [
                  [0.185, 0.333, 0.0126]
                ]
              },
              {
                x: 0.595,
                z: 0.518,
                rotY: 0.3,
                scale: 0.56,
                cols: [
                  [0.595, 0.518, 0.0084]
                ]
              },
              {
                x: 0.595,
                z: 0.688,
                rotY: 0.3,
                scale: 0.75,
                cols: [
                  [0.595, 0.688, 0.0112]
                ]
              },
              {
                x: 0.539,
                z: 0.317,
                rotY: 4.7,
                scale: 0.84,
                cols: [
                  [0.539, 0.317, 0.0126]
                ]
              }
            ],
            sticks: [],
            minables: []
          }
        },
        {
          id: 'desert_5',
          seed: 701,
          terrain: {
            hills: []
          },
          items: {
            trees: [
              {
                x: 0.672,
                z: 0.582,
                v: 'br',
                cols: [
                  [0.672, 0.582, 0.006]
                ]
              },
              {
                x: 0.725,
                z: 0.153,
                v: 'db',
                cols: [
                  [0.725, 0.153, 0.004]
                ]
              },
              {
                x: 0.24,
                z: 0.008,
                v: 'pp',
                cols: [
                  [0.24, 0.008, 0.007]
                ]
              },
              {
                x: 0.95,
                z: 0.231,
                v: 'sg',
                cols: [
                  [0.95, 0.231, 0.005]
                ]
              },
              {
                x: 0.407,
                z: 0.153,
                v: 'sg',
                cols: [
                  [0.407, 0.153, 0.005]
                ]
              },
              {
                x: 0.643,
                z: 0.486,
                v: 'pp',
                cols: [
                  [0.643, 0.486, 0.007]
                ]
              },
              {
                x: 0.668,
                z: 0.94,
                v: 'br',
                cols: [
                  [0.668, 0.94, 0.006]
                ]
              },
              {
                x: 0.888,
                z: 0.98,
                v: 'sg',
                cols: [
                  [0.888, 0.98, 0.005]
                ]
              },
              {
                x: 0.316,
                z: 0.873,
                v: 'sg',
                cols: [
                  [0.316, 0.873, 0.005]
                ]
              },
              {
                x: 0.324,
                z: 0.509,
                v: 'sg',
                cols: [
                  [0.324, 0.509, 0.005]
                ]
              },
              {
                x: 0.664,
                z: 0.724,
                v: 'pp',
                cols: [
                  [0.664, 0.724, 0.007]
                ]
              },
              {
                x: 0.672,
                z: 0.442,
                v: 'br',
                cols: [
                  [0.672, 0.442, 0.006]
                ]
              },
              {
                x: 0.584,
                z: 0.681,
                v: 'sg',
                cols: [
                  [0.584, 0.681, 0.005]
                ]
              },
              {
                x: 0.073,
                z: 0.068,
                v: 'db',
                cols: [
                  [0.073, 0.068, 0.004]
                ]
              },
              {
                x: 0.16,
                z: 0.946,
                v: 'sg',
                cols: [
                  [0.16, 0.946, 0.005]
                ]
              },
              {
                x: 0.56,
                z: 0.608,
                v: 'pp',
                cols: [
                  [0.56, 0.608, 0.007]
                ]
              },
              {
                x: 0.548,
                z: 0.848,
                v: 'br',
                cols: [
                  [0.548, 0.848, 0.006]
                ]
              },
              {
                x: 0.828,
                z: 0.66,
                v: 'sg',
                cols: [
                  [0.828, 0.66, 0.005]
                ]
              },
              {
                x: 0.802,
                z: 0.285,
                v: 'sg',
                cols: [
                  [0.802, 0.285, 0.005]
                ]
              },
              {
                x: 0.78,
                z: 0.622,
                v: 'sg',
                cols: [
                  [0.78, 0.622, 0.005]
                ]
              },
              {
                x: 0.501,
                z: 0.655,
                v: 'br',
                cols: [
                  [0.501, 0.655, 0.006]
                ]
              },
              {
                x: 0.854,
                z: 0.139,
                v: 'br',
                cols: [
                  [0.854, 0.139, 0.006]
                ]
              }
            ],
            rocks: [
              {
                x: 0.4,
                z: 0.058,
                rotY: 2.5,
                scale: 0.51,
                cols: [
                  [0.4, 0.058, 0.0076]
                ]
              },
              {
                x: 0.273,
                z: 0.608,
                rotY: 2.5,
                scale: 0.65,
                cols: [
                  [0.273, 0.608, 0.0097]
                ]
              },
              {
                x: 0.571,
                z: 0.354,
                rotY: 5.8,
                scale: 0.6,
                cols: [
                  [0.571, 0.354, 0.009]
                ]
              },
              {
                x: 0.282,
                z: 0.059,
                rotY: 6.2,
                scale: 0.65,
                cols: [
                  [0.282, 0.059, 0.0097]
                ]
              },
              {
                x: 0.848,
                z: 0.833,
                rotY: 0.9,
                scale: 0.83,
                cols: [
                  [0.848, 0.833, 0.0124]
                ]
              },
              {
                x: 0.4,
                z: 0.53,
                rotY: 6.2,
                scale: 0.83,
                cols: [
                  [0.4, 0.53, 0.0124]
                ]
              },
              {
                x: 0.309,
                z: 0.723,
                rotY: 4.4,
                scale: 0.84,
                cols: [
                  [0.309, 0.723, 0.0126]
                ]
              },
              {
                x: 0.932,
                z: 0.831,
                rotY: 3.9,
                scale: 0.6,
                cols: [
                  [0.932, 0.831, 0.009]
                ]
              }
            ],
            sticks: [],
            minables: []
          }
        },
        {
          id: 'desert_6',
          seed: 801,
          terrain: {
            hills: []
          },
          items: {
            trees: [
              {
                x: 0.715,
                z: 0.638,
                v: 'sg',
                cols: [
                  [0.715, 0.638, 0.005]
                ]
              },
              {
                x: 0.762,
                z: 0.268,
                v: 'br',
                cols: [
                  [0.762, 0.268, 0.006]
                ]
              },
              {
                x: 0.304,
                z: 0.942,
                v: 'db',
                cols: [
                  [0.304, 0.942, 0.004]
                ]
              },
              {
                x: 0.238,
                z: 0.814,
                v: 'sg',
                cols: [
                  [0.238, 0.814, 0.005]
                ]
              },
              {
                x: 0.649,
                z: 0.601,
                v: 'db',
                cols: [
                  [0.649, 0.601, 0.004]
                ]
              },
              {
                x: 0.863,
                z: 0.588,
                v: 'br',
                cols: [
                  [0.863, 0.588, 0.006]
                ]
              },
              {
                x: 0.81,
                z: 0.955,
                v: 'br',
                cols: [
                  [0.81, 0.955, 0.006]
                ]
              },
              {
                x: 0.049,
                z: 0.832,
                v: 'db',
                cols: [
                  [0.049, 0.832, 0.004]
                ]
              },
              {
                x: 0.16,
                z: 0.989,
                v: 'br',
                cols: [
                  [0.16, 0.989, 0.006]
                ]
              },
              {
                x: 0.865,
                z: 0.943,
                v: 'br',
                cols: [
                  [0.865, 0.943, 0.006]
                ]
              },
              {
                x: 0.894,
                z: 0.369,
                v: 'sg',
                cols: [
                  [0.894, 0.369, 0.005]
                ]
              },
              {
                x: 0.087,
                z: 0.698,
                v: 'db',
                cols: [
                  [0.087, 0.698, 0.004]
                ]
              },
              {
                x: 0.953,
                z: 0.91,
                v: 'br',
                cols: [
                  [0.953, 0.91, 0.006]
                ]
              },
              {
                x: 0.849,
                z: 0.471,
                v: 'sg',
                cols: [
                  [0.849, 0.471, 0.005]
                ]
              },
              {
                x: 0.111,
                z: 0.02,
                v: 'sg',
                cols: [
                  [0.111, 0.02, 0.005]
                ]
              },
              {
                x: 0.316,
                z: 0.973,
                v: 'sg',
                cols: [
                  [0.316, 0.973, 0.005]
                ]
              },
              {
                x: 0.16,
                z: 0.346,
                v: 'sg',
                cols: [
                  [0.16, 0.346, 0.005]
                ]
              },
              {
                x: 0.891,
                z: 0.697,
                v: 'br',
                cols: [
                  [0.891, 0.697, 0.006]
                ]
              },
              {
                x: 0.119,
                z: 0.731,
                v: 'pp',
                cols: [
                  [0.119, 0.731, 0.007]
                ]
              },
              {
                x: 0.76,
                z: 0.697,
                v: 'pp',
                cols: [
                  [0.76, 0.697, 0.007]
                ]
              },
              {
                x: 0.888,
                z: 0.121,
                v: 'pp',
                cols: [
                  [0.888, 0.121, 0.007]
                ]
              },
              {
                x: 0.919,
                z: 0.032,
                v: 'sg',
                cols: [
                  [0.919, 0.032, 0.005]
                ]
              }
            ],
            rocks: [
              {
                x: 0.956,
                z: 0.797,
                rotY: 2,
                scale: 0.67,
                cols: [
                  [0.956, 0.797, 0.01]
                ]
              },
              {
                x: 0.274,
                z: 0.759,
                rotY: 2.3,
                scale: 0.56,
                cols: [
                  [0.274, 0.759, 0.0084]
                ]
              },
              {
                x: 0.882,
                z: 0.902,
                rotY: 3.4,
                scale: 0.55,
                cols: [
                  [0.882, 0.902, 0.0083]
                ]
              },
              {
                x: 0.19,
                z: 0.415,
                rotY: 6.1,
                scale: 0.78,
                cols: [
                  [0.19, 0.415, 0.0117]
                ]
              },
              {
                x: 0.43,
                z: 0.106,
                rotY: 1,
                scale: 0.82,
                cols: [
                  [0.43, 0.106, 0.0123]
                ]
              },
              {
                x: 0.348,
                z: 0.92,
                rotY: 1,
                scale: 0.69,
                cols: [
                  [0.348, 0.92, 0.0103]
                ]
              },
              {
                x: 0.013,
                z: 0.35,
                rotY: 6.1,
                scale: 0.82,
                cols: [
                  [0.013, 0.35, 0.0123]
                ]
              }
            ],
            sticks: [],
            minables: []
          }
        },
        {
          id: 'desert_7',
          seed: 901,
          terrain: {
            hills: []
          },
          items: {
            trees: [
              {
                x: 0.334,
                z: 0.697,
                v: 'br',
                cols: [
                  [0.334, 0.697, 0.006]
                ]
              },
              {
                x: 0.706,
                z: 0.123,
                v: 'br',
                cols: [
                  [0.706, 0.123, 0.006]
                ]
              },
              {
                x: 0.285,
                z: 0.528,
                v: 'br',
                cols: [
                  [0.285, 0.528, 0.006]
                ]
              },
              {
                x: 0.658,
                z: 0.654,
                v: 'br',
                cols: [
                  [0.658, 0.654, 0.006]
                ]
              },
              {
                x: 0.069,
                z: 0.474,
                v: 'br',
                cols: [
                  [0.069, 0.474, 0.006]
                ]
              },
              {
                x: 0.656,
                z: 0.717,
                v: 'sg',
                cols: [
                  [0.656, 0.717, 0.005]
                ]
              },
              {
                x: 0.057,
                z: 0.236,
                v: 'br',
                cols: [
                  [0.057, 0.236, 0.006]
                ]
              },
              {
                x: 0.731,
                z: 0.931,
                v: 'br',
                cols: [
                  [0.731, 0.931, 0.006]
                ]
              },
              {
                x: 0.781,
                z: 0.791,
                v: 'pp',
                cols: [
                  [0.781, 0.791, 0.007]
                ]
              },
              {
                x: 0.996,
                z: 0.469,
                v: 'db',
                cols: [
                  [0.996, 0.469, 0.004]
                ]
              },
              {
                x: 0.066,
                z: 0.162,
                v: 'sg',
                cols: [
                  [0.066, 0.162, 0.005]
                ]
              },
              {
                x: 0.117,
                z: 0.296,
                v: 'pp',
                cols: [
                  [0.117, 0.296, 0.007]
                ]
              },
              {
                x: 0.172,
                z: 0.681,
                v: 'db',
                cols: [
                  [0.172, 0.681, 0.004]
                ]
              },
              {
                x: 0.58,
                z: 0.822,
                v: 'db',
                cols: [
                  [0.58, 0.822, 0.004]
                ]
              },
              {
                x: 0.114,
                z: 0.261,
                v: 'sg',
                cols: [
                  [0.114, 0.261, 0.005]
                ]
              },
              {
                x: 0.149,
                z: 0.971,
                v: 'sg',
                cols: [
                  [0.149, 0.971, 0.005]
                ]
              },
              {
                x: 0.76,
                z: 0.084,
                v: 'sg',
                cols: [
                  [0.76, 0.084, 0.005]
                ]
              },
              {
                x: 0.235,
                z: 0.546,
                v: 'pp',
                cols: [
                  [0.235, 0.546, 0.007]
                ]
              },
              {
                x: 0.411,
                z: 0.802,
                v: 'sg',
                cols: [
                  [0.411, 0.802, 0.005]
                ]
              },
              {
                x: 0.718,
                z: 0.109,
                v: 'sg',
                cols: [
                  [0.718, 0.109, 0.005]
                ]
              },
              {
                x: 0.338,
                z: 0.409,
                v: 'pp',
                cols: [
                  [0.338, 0.409, 0.007]
                ]
              },
              {
                x: 0.546,
                z: 0.773,
                v: 'sg',
                cols: [
                  [0.546, 0.773, 0.005]
                ]
              }
            ],
            rocks: [
              {
                x: 0.253,
                z: 0.491,
                rotY: 6.1,
                scale: 0.67,
                cols: [
                  [0.253, 0.491, 0.01]
                ]
              },
              {
                x: 0.449,
                z: 0.157,
                rotY: 5.7,
                scale: 0.63,
                cols: [
                  [0.449, 0.157, 0.0095]
                ]
              },
              {
                x: 0.523,
                z: 0.027,
                rotY: 4.3,
                scale: 0.69,
                cols: [
                  [0.523, 0.027, 0.0103]
                ]
              },
              {
                x: 0.655,
                z: 0.801,
                rotY: 5.3,
                scale: 0.78,
                cols: [
                  [0.655, 0.801, 0.0117]
                ]
              }
            ],
            sticks: [],
            minables: []
          }
        },
        {
          id: 'desert_8',
          seed: 1001,
          terrain: {
            hills: []
          },
          items: {
            trees: [
              {
                x: 0.665,
                z: 0.255,
                v: 'br',
                cols: [
                  [0.665, 0.255, 0.006]
                ]
              },
              {
                x: 0.696,
                z: 0.607,
                v: 'db',
                cols: [
                  [0.696, 0.607, 0.004]
                ]
              },
              {
                x: 0.807,
                z: 0.788,
                v: 'br',
                cols: [
                  [0.807, 0.788, 0.006]
                ]
              },
              {
                x: 0.012,
                z: 0.366,
                v: 'sg',
                cols: [
                  [0.012, 0.366, 0.005]
                ]
              },
              {
                x: 0.9,
                z: 0.135,
                v: 'db',
                cols: [
                  [0.9, 0.135, 0.004]
                ]
              },
              {
                x: 0.662,
                z: 0.832,
                v: 'sg',
                cols: [
                  [0.662, 0.832, 0.005]
                ]
              },
              {
                x: 0.252,
                z: 0.884,
                v: 'sg',
                cols: [
                  [0.252, 0.884, 0.005]
                ]
              },
              {
                x: 0.652,
                z: 0.906,
                v: 'pp',
                cols: [
                  [0.652, 0.906, 0.007]
                ]
              },
              {
                x: 0.514,
                z: 0.749,
                v: 'pp',
                cols: [
                  [0.514, 0.749, 0.007]
                ]
              },
              {
                x: 0.832,
                z: 0.949,
                v: 'sg',
                cols: [
                  [0.832, 0.949, 0.005]
                ]
              },
              {
                x: 0.267,
                z: 0.381,
                v: 'db',
                cols: [
                  [0.267, 0.381, 0.004]
                ]
              },
              {
                x: 0.339,
                z: 0.223,
                v: 'sg',
                cols: [
                  [0.339, 0.223, 0.005]
                ]
              },
              {
                x: 0.257,
                z: 0.665,
                v: 'db',
                cols: [
                  [0.257, 0.665, 0.004]
                ]
              },
              {
                x: 0.206,
                z: 0.734,
                v: 'br',
                cols: [
                  [0.206, 0.734, 0.006]
                ]
              }
            ],
            rocks: [
              {
                x: 0.051,
                z: 0.185,
                rotY: 5.8,
                scale: 0.57,
                cols: [
                  [0.051, 0.185, 0.0085]
                ]
              },
              {
                x: 0.376,
                z: 0.63,
                rotY: 1.4,
                scale: 0.51,
                cols: [
                  [0.376, 0.63, 0.0076]
                ]
              },
              {
                x: 0.36,
                z: 0.822,
                rotY: 3.6,
                scale: 0.78,
                cols: [
                  [0.36, 0.822, 0.0117]
                ]
              },
              {
                x: 0.396,
                z: 0.942,
                rotY: 5.5,
                scale: 0.75,
                cols: [
                  [0.396, 0.942, 0.0112]
                ]
              },
              {
                x: 0.544,
                z: 0.676,
                rotY: 4.9,
                scale: 0.68,
                cols: [
                  [0.544, 0.676, 0.0102]
                ]
              }
            ],
            sticks: [],
            minables: []
          }
        },
        {
          id: 'desert_9',
          seed: 1101,
          terrain: {
            hills: []
          },
          items: {
            trees: [
              {
                x: 0.686,
                z: 0.092,
                v: 'sg',
                cols: [
                  [0.686, 0.092, 0.005]
                ]
              },
              {
                x: 0.329,
                z: 0.048,
                v: 'br',
                cols: [
                  [0.329, 0.048, 0.006]
                ]
              },
              {
                x: 0.366,
                z: 0.077,
                v: 'db',
                cols: [
                  [0.366, 0.077, 0.004]
                ]
              },
              {
                x: 0.732,
                z: 0.796,
                v: 'sg',
                cols: [
                  [0.732, 0.796, 0.005]
                ]
              },
              {
                x: 0.669,
                z: 0.948,
                v: 'br',
                cols: [
                  [0.669, 0.948, 0.006]
                ]
              },
              {
                x: 0.446,
                z: 0.532,
                v: 'sg',
                cols: [
                  [0.446, 0.532, 0.005]
                ]
              },
              {
                x: 0.573,
                z: 0.882,
                v: 'pp',
                cols: [
                  [0.573, 0.882, 0.007]
                ]
              },
              {
                x: 0.246,
                z: 0.708,
                v: 'br',
                cols: [
                  [0.246, 0.708, 0.006]
                ]
              },
              {
                x: 0.668,
                z: 0.428,
                v: 'br',
                cols: [
                  [0.668, 0.428, 0.006]
                ]
              },
              {
                x: 0.467,
                z: 0.599,
                v: 'pp',
                cols: [
                  [0.467, 0.599, 0.007]
                ]
              },
              {
                x: 0.562,
                z: 0.15,
                v: 'pp',
                cols: [
                  [0.562, 0.15, 0.007]
                ]
              },
              {
                x: 0.342,
                z: 0.648,
                v: 'db',
                cols: [
                  [0.342, 0.648, 0.004]
                ]
              },
              {
                x: 0.833,
                z: 0.646,
                v: 'db',
                cols: [
                  [0.833, 0.646, 0.004]
                ]
              },
              {
                x: 0.645,
                z: 0.841,
                v: 'sg',
                cols: [
                  [0.645, 0.841, 0.005]
                ]
              }
            ],
            rocks: [
              {
                x: 0.874,
                z: 0.503,
                rotY: 0.3,
                scale: 0.78,
                cols: [
                  [0.874, 0.503, 0.0117]
                ]
              },
              {
                x: 0.176,
                z: 0.961,
                rotY: 3.2,
                scale: 0.7,
                cols: [
                  [0.176, 0.961, 0.0105]
                ]
              },
              {
                x: 0.923,
                z: 0.245,
                rotY: 6.2,
                scale: 0.53,
                cols: [
                  [0.923, 0.245, 0.008]
                ]
              },
              {
                x: 0.944,
                z: 0.954,
                rotY: 5.9,
                scale: 0.72,
                cols: [
                  [0.944, 0.954, 0.0108]
                ]
              },
              {
                x: 0.255,
                z: 0.212,
                rotY: 4.8,
                scale: 0.72,
                cols: [
                  [0.255, 0.212, 0.0108]
                ]
              }
            ],
            sticks: [],
            minables: []
          }
        }
      ],
  },
};


// Compute height contribution from a single hill at position (u, v).
// Supports shape types: 'circle' (default), 'rect', 'tri'.
// Uses Lp-norm distance for rounded corners on rect/tri shapes.
// Hills are extended beyond their natural extents by HILL_REACH_MULT
// to create gradual cross-boundary falloff. Inside the original extent,
// the original cosine profile is used; the extended zone tapers gently to 0.

// Get hills for a grid position (clamped to bounds)
const GRID_SIZE = 3;
const GRID_HALF = Math.floor(GRID_SIZE / 2);

function getHillsForRegion(gx, gz) {
  const cgx = Math.max(-GRID_HALF, Math.min(GRID_HALF, gx));
  const cgz = Math.max(-GRID_HALF, Math.min(GRID_HALF, gz));
  // Read from built region if available — this reflects any runtime
  // modifications to hills. Fall back to config for unbuilt regions.
  const reg = regionCache.get(cgx * 1000 + cgz);
  if (reg) return reg.hills;
  const assignment = getRegionAssignment(cgx, cgz);
  const biome = BIOMES[assignment.biome];
  const config = biome.configs[assignment.configIdx];
  return config.terrain.hills || [];
}

// Global height computation: at any UV point within a region, gather hills
// from the region and all 8 neighbors and sum contributions. Hills are
// extended beyond their natural radius via HILL_REACH_MULT so they fade
// out much more gradually across region boundaries.
//
// HILL_REACH_MULT: multiplier on hill extents. 1.0 = original shape.
// Slightly > 1 softens hill edges via the Lp-norm rounded profiles.
// Cross-boundary smoothing is handled by the BLEED_UV system in
// getBlendedHeight(), not by extending hill reach.
const HILL_REACH_MULT = 1.3;

// Extended hill contribution: evaluates the hill with stretched extents
// so it fades out more gradually. Single smooth cosine profile over
// the full extended range. The Lp-norm distance metric gives rounded
// corners for rect and tri shapes.
function hillContributionExt(hill, u, v, offsetX, offsetZ) {
  const hu = hill.x + (offsetX || 0);
  const hv = hill.z + (offsetZ || 0);
  const du = u - hu;
  const dv = v - hv;
  let t; // 0 = edge of extended hill, 1 = center
  if (hill.shape === 'rect') {
    const nx = Math.abs(du) / (hill.wx * HILL_REACH_MULT);
    const nz = Math.abs(dv) / (hill.wz * HILL_REACH_MULT);
    const p = 3.0;
    const nxp = Math.pow(Math.max(nx, 0.0001), p);
    const nzp = Math.pow(Math.max(nz, 0.0001), p);
    const d = Math.pow(nxp + nzp, 1 / p);
    t = Math.max(0, 1 - d);
  } else if (hill.shape === 'tri') {
    const sx = du * (hill.dirX || 1);
    const sz = dv * (hill.dirZ || 1);
    if (sx < 0 || sz < 0) return 0;
    const nx = sx / (hill.wx * HILL_REACH_MULT);
    const nz = sz / (hill.wz * HILL_REACH_MULT);
    const p = 2.5;
    const nxp = Math.pow(Math.max(nx, 0.0001), p);
    const nzp = Math.pow(Math.max(nz, 0.0001), p);
    const d = Math.pow(nxp + nzp, 1 / p);
    t = Math.max(0, 1 - d);
  } else {
    const dist = Math.sqrt(du * du + dv * dv);
    t = Math.max(0, 1 - dist / (hill.radius * HILL_REACH_MULT));
  }
  if (t <= 0) return 0;
  return hill.height * (0.5 + 0.5 * Math.cos(Math.PI * (1 - t)));
}

// Height at a point considering only hills within a single region (with
// its own 3x3 neighbor sampling for natural hill overlap).
function getRegionHeight(regionGx, regionGz, u, v) {
  const hills = getHillsForRegion(regionGx, regionGz);
  let h = 0;
  for (let dz = -1; dz <= 1; dz++) {
    for (let dx = -1; dx <= 1; dx++) {
      const nHills = (dx === 0 && dz === 0) ? hills :
        getHillsForRegion(regionGx + dx, regionGz + dz);
      for (const hill of nHills) {
        h += hillContributionExt(hill, u, v, dx, dz);
      }
    }
  }
  return h;
}

// Cross-boundary height blending.
// After computing the base hill height (which uses extended reach for
// natural overlap), we add a bleed pass: near each region edge, sample
// the neighbor's height at the boundary and fade it into this region
// if the neighbor is taller. This handles the case where a tall hill
// sits right at a boundary and its shape doesn't naturally extend far
// enough into the neighbor.
//
// BLEED_UV: how far into a region the neighbor's boundary height can
// bleed. 0.30 = 30% of region width = 3 world units of gradual fade.
const BLEED_UV = 0.30;

// Preallocated arrays for getBlendedHeight (avoids per-call GC)
const _bleedCardinals = [
  { dx: -1, dz:  0, dist: 0, bU: 0, bV: 0, nU: 0, nV: 0 },
  { dx:  1, dz:  0, dist: 0, bU: 0, bV: 0, nU: 0, nV: 0 },
  { dx:  0, dz: -1, dist: 0, bU: 0, bV: 0, nU: 0, nV: 0 },
  { dx:  0, dz:  1, dist: 0, bU: 0, bV: 0, nU: 0, nV: 0 },
];
const _bleedDiagonals = [
  { dx: -1, dz: -1, dU: 0, dV: 0 },
  { dx:  1, dz: -1, dU: 0, dV: 0 },
  { dx: -1, dz:  1, dU: 0, dV: 0 },
  { dx:  1, dz:  1, dU: 0, dV: 0 },
];
// ── Height Cache ──────────────────────────────────────────────────────────
// Built into getBlendedHeight. Generation-based invalidation: bump _heightGen
// to lazily invalidate all entries. Cache keyed by quantized UV + region.
const _HEIGHT_QUANT = 200; // ~0.05 world-unit resolution (= 0.005 UV at REGION_SIZE=10)
const _heightMap = new Map();
let _heightGen = 0;

function _heightKey(u, v, gx, gz) {
  const qu = Math.round(u * _HEIGHT_QUANT);
  const qv = Math.round(v * _HEIGHT_QUANT);
  return ((gx + 2) * 5 + (gz + 2)) * 160801 + qu * 401 + qv;
}

// Invalidate heights for a region and neighbors (generation bump).
function invalidateRegionHeights() {
  _heightGen++;
  if (_heightMap.size > 20000) _heightMap.clear();
}

// Invalidate all heights (hill toggle, full reset).
function invalidateAllHeights() {
  _heightGen++;
  if (_heightMap.size > 20000) _heightMap.clear();
}

function getBlendedHeight(hills, u, v, regionGx, regionGz) {
  if (window._debugFlatTerrain) return 0; // DEBUG: flat terrain

  // Cache check (only for region-aware calls)
  let cacheKey;
  if (regionGx !== undefined) {
    cacheKey = _heightKey(u, v, regionGx, regionGz);
    const entry = _heightMap.get(cacheKey);
    if (entry && entry.gen === _heightGen) return entry.h;
  }

  // Base height from natural hill contributions (own + neighbors via 3x3)
  let h = 0;
  for (let dz = -1; dz <= 1; dz++) {
    for (let dx = -1; dx <= 1; dx++) {
      const neighborHills = (dx === 0 && dz === 0) ? hills :
        (regionGx !== undefined ? getHillsForRegion(regionGx + dx, regionGz + dz) : hills);
      for (const hill of neighborHills) {
        h += hillContributionExt(hill, u, v, dx, dz);
      }
    }
  }

  if (regionGx === undefined) return h;

  // Bleed pass: for each cardinal direction, check if the neighbor has
  // higher terrain at our shared boundary. If so, smoothly fade that
  // extra height into this region.
  //
  // We sample the neighbor at multiple points along the boundary edge
  // (not just one point) so the bleed captures the neighbor's height
  // profile, not just a single spot.
  // Cardinal bleed (reuse preallocated)
  const cardinals = _bleedCardinals;
  cardinals[0].dist = u;     cardinals[0].bU = 0.0; cardinals[0].bV = v;   cardinals[0].nU = 1.0; cardinals[0].nV = v;
  cardinals[1].dist = 1 - u; cardinals[1].bU = 1.0; cardinals[1].bV = v;   cardinals[1].nU = 0.0; cardinals[1].nV = v;
  cardinals[2].dist = v;     cardinals[2].bU = u;   cardinals[2].bV = 0.0; cardinals[2].nU = u;   cardinals[2].nV = 1.0;
  cardinals[3].dist = 1 - v; cardinals[3].bU = u;   cardinals[3].bV = 1.0; cardinals[3].nU = u;   cardinals[3].nV = 0.0;

  for (const c of cardinals) {
    if (c.dist >= BLEED_UV) continue;
    const ngx = regionGx + c.dx, ngz = regionGz + c.dz;
    if (ngx < -GRID_HALF || ngx > GRID_HALF || ngz < -GRID_HALF || ngz > GRID_HALF) continue;

    // Height at the boundary from the neighbor's perspective
    const neighborBorderH = getRegionHeight(ngx, ngz, c.nU, c.nV);
    // Height at the boundary from our perspective
    const ourBorderH = getRegionHeight(regionGx, regionGz, c.bU, c.bV);
    // Use the max of both views at the boundary â€” this is the "true" seam height
    const seamH = Math.max(neighborBorderH, ourBorderH);

    if (seamH <= h) continue;

    // Fade from boundary inward: 1 at edge, 0 at BLEED_UV distance
    let fade = 1 - c.dist / BLEED_UV;
    fade = fade * fade * (3 - 2 * fade); // smoothstep

    // Lerp toward the seam height
    h = h + (seamH - h) * fade;
  }

  // Diagonal bleed for corners
  // Diagonal bleed (reuse preallocated)
  const diagonals = _bleedDiagonals;
  diagonals[0].dU = u;     diagonals[0].dV = v;
  diagonals[1].dU = 1 - u; diagonals[1].dV = v;
  diagonals[2].dU = u;     diagonals[2].dV = 1 - v;
  diagonals[3].dU = 1 - u; diagonals[3].dV = 1 - v;

  for (const d of diagonals) {
    if (d.dU >= BLEED_UV || d.dV >= BLEED_UV) continue;
    const ngx = regionGx + d.dx, ngz = regionGz + d.dz;
    if (ngx < -GRID_HALF || ngx > GRID_HALF || ngz < -GRID_HALF || ngz > GRID_HALF) continue;

    // Corner point UVs: our corner and neighbor's corresponding corner
    const ourCU = d.dx < 0 ? 0 : 1;
    const ourCV = d.dz < 0 ? 0 : 1;
    const nCU = d.dx < 0 ? 1 : 0;
    const nCV = d.dz < 0 ? 1 : 0;

    const neighborCornerH = getRegionHeight(ngx, ngz, nCU, nCV);
    const ourCornerH = getRegionHeight(regionGx, regionGz, ourCU, ourCV);
    const seamH = Math.max(neighborCornerH, ourCornerH);

    if (seamH <= h) continue;

    let fadeU = 1 - d.dU / BLEED_UV;
    let fadeV = 1 - d.dV / BLEED_UV;
    fadeU = fadeU * fadeU * (3 - 2 * fadeU);
    fadeV = fadeV * fadeV * (3 - 2 * fadeV);
    const fade = fadeU * fadeV;

    h = h + (seamH - h) * fade;
  }

  // Store in cache
  if (regionGx !== undefined) {
    _heightMap.set(cacheKey, { h, gen: _heightGen });
  }
  return h;
}

// --- Wireframe IBO builder (deduplicates edges from triangle indices) ---
function buildWireIBO(triIdx) {
  const edgeSet = new Set();
  const wireIdx = [];
  for (let i = 0; i < triIdx.length; i += 3) {
    const a = triIdx[i], b = triIdx[i+1], c = triIdx[i+2];
    const edges = [[a,b],[b,c],[c,a]];
    for (const [e0, e1] of edges) {
      const key = e0 < e1 ? e0 * 65536 + e1 : e1 * 65536 + e0;
      if (!edgeSet.has(key)) { edgeSet.add(key); wireIdx.push(e0, e1); }
    }
  }
  // Unbind any active VAO so ELEMENT_ARRAY_BUFFER write doesn't corrupt it
  gl.bindVertexArray(null);
  const buf = gl.createBuffer();
  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buf);
  gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(wireIdx), gl.STATIC_DRAW);
  return { ibo: buf, count: wireIdx.length };
}

// --- Adaptive Ground Mesh Builder ---
const S = 5.0;
const REGION_SIZE = S * 2; // 10 world units per region
const BASE_RES = 6;
const FINE_RES = 2;
const EDGE_OVERLAP = 0.15; // 15% overlap into neighbor regions

function buildTerrainMesh(hills, regionGx, regionGz) {
  // Adaptive subdivision: 2 levels only â€” flat (1 quad) or hilly (FINE_RES^2 quads).
  // Threshold chosen so any visible slope gets the finer level.
  function cellSubdivLevel(ci, cj) {
    const u0 = ci / BASE_RES, u1 = (ci + 1) / BASE_RES;
    const v0 = cj / BASE_RES, v1 = (cj + 1) / BASE_RES;
    const h00 = getBlendedHeight(hills, u0, v0, regionGx, regionGz);
    const h10 = getBlendedHeight(hills, u1, v0, regionGx, regionGz);
    const h01 = getBlendedHeight(hills, u0, v1, regionGx, regionGz);
    const h11 = getBlendedHeight(hills, u1, v1, regionGx, regionGz);
    const variance = Math.max(h00, h10, h01, h11) - Math.min(h00, h10, h01, h11);
    return variance < 0.01 ? 1 : FINE_RES;
  }

  // Precompute subdivision levels for all cells
  const subdiv = new Uint8Array(BASE_RES * BASE_RES);
  for (let cj = 0; cj < BASE_RES; cj++) {
    for (let ci = 0; ci < BASE_RES; ci++) {
      subdiv[cj * BASE_RES + ci] = cellSubdivLevel(ci, cj);
    }
  }
  // Propagate: each cell's effective level = max of itself and its 4 neighbors.
  // This ensures shared edges always have matching resolution (no T-junctions).
  const effectiveSub = new Uint8Array(subdiv);
  for (let cj = 0; cj < BASE_RES; cj++) {
    for (let ci = 0; ci < BASE_RES; ci++) {
      let s = subdiv[cj * BASE_RES + ci];
      if (ci > 0) s = Math.max(s, subdiv[cj * BASE_RES + ci - 1]);
      if (ci < BASE_RES - 1) s = Math.max(s, subdiv[cj * BASE_RES + ci + 1]);
      if (cj > 0) s = Math.max(s, subdiv[(cj - 1) * BASE_RES + ci]);
      if (cj < BASE_RES - 1) s = Math.max(s, subdiv[(cj + 1) * BASE_RES + ci]);
      effectiveSub[cj * BASE_RES + ci] = s;
    }
  }

  const verts = [];
  const idx = [];
  const vMap = new Map();
  let vi = 0;

  function addV(u, v) {
    const key = u.toFixed(6) + ',' + v.toFixed(6);
    if (vMap.has(key)) return vMap.get(key);
    const x = -S + u * 2 * S;
    const z = -S + v * 2 * S;
    const y = getBlendedHeight(hills, u, v, regionGx, regionGz);
    verts.push(x, y, z, u, v);
    const i = vi++;
    vMap.set(key, i);
    return i;
  }

  function addQ(u0, v0, u1, v1) {
    const tl = addV(u0, v0), tr = addV(u1, v0);
    const bl = addV(u0, v1), br = addV(u1, v1);
    idx.push(tl, bl, tr, tr, bl, br);
  }

  for (let cj = 0; cj < BASE_RES; cj++) {
    for (let ci = 0; ci < BASE_RES; ci++) {
      const u0 = ci / BASE_RES, u1 = (ci + 1) / BASE_RES;
      const v0 = cj / BASE_RES, v1 = (cj + 1) / BASE_RES;
      const sub = effectiveSub[cj * BASE_RES + ci];
      if (sub > 1) {
        for (let sj = 0; sj < sub; sj++) {
          for (let si = 0; si < sub; si++) {
            addQ(
              u0 + (si / sub) * (u1 - u0), v0 + (sj / sub) * (v1 - v0),
              u0 + ((si+1) / sub) * (u1 - u0), v0 + ((sj+1) / sub) * (v1 - v0)
            );
          }
        }
      } else {
        addQ(u0, v0, u1, v1);
      }
    }
  }

  // Mark end of core mesh indices (before overlap strips)
  const coreIdxEnd = idx.length;

  // Add overlap border strips extending past 0-1 UV range
  // Subdivide for smooth height blending at region boundaries.
  // The V-axis (for left/right borders) or U-axis (for top/bottom) resolution
  // matches the adjacent edge cell's effective subdivision to prevent T-junctions.
  const OV = EDGE_OVERLAP;
  const OV_DEPTH = 1; // subdivision depth into the overlap (narrow direction)
  function addBorderStrip(u0, v0, u1, v1, edgeSub) {
    // edgeSub = subdivision along the edge (matching the base mesh cell)
    // OV_DEPTH = subdivision perpendicular to the edge
    for (let sj = 0; sj < edgeSub; sj++) {
      for (let si = 0; si < OV_DEPTH; si++) {
        addQ(
          u0 + (si / OV_DEPTH) * (u1 - u0), v0 + (sj / edgeSub) * (v1 - v0),
          u0 + ((si+1) / OV_DEPTH) * (u1 - u0), v0 + ((sj+1) / edgeSub) * (v1 - v0)
        );
      }
    }
  }
  // Left border (u: -OV to 0) â€” V-axis matches left edge cells (ci=0)
  for (let cj = 0; cj < BASE_RES; cj++) {
    const v0 = cj / BASE_RES, v1 = (cj + 1) / BASE_RES;
    const edgeSub = effectiveSub[cj * BASE_RES + 0];
    addBorderStrip(-OV, v0, 0, v1, edgeSub);
  }
  // Right border (u: 1 to 1+OV) â€” V-axis matches right edge cells (ci=BASE_RES-1)
  for (let cj = 0; cj < BASE_RES; cj++) {
    const v0 = cj / BASE_RES, v1 = (cj + 1) / BASE_RES;
    const edgeSub = effectiveSub[cj * BASE_RES + (BASE_RES - 1)];
    addBorderStrip(1, v0, 1 + OV, v1, edgeSub);
  }
  // Top border (v: -OV to 0) â€” U-axis matches top edge cells (cj=0)
  for (let ci = 0; ci < BASE_RES; ci++) {
    const u0 = ci / BASE_RES, u1 = (ci + 1) / BASE_RES;
    const edgeSub = effectiveSub[0 * BASE_RES + ci];
    for (let si = 0; si < edgeSub; si++) {
      for (let sj = 0; sj < OV_DEPTH; sj++) {
        addQ(
          u0 + (si / edgeSub) * (u1 - u0), -OV + (sj / OV_DEPTH) * OV,
          u0 + ((si+1) / edgeSub) * (u1 - u0), -OV + ((sj+1) / OV_DEPTH) * OV
        );
      }
    }
  }
  // Bottom border (v: 1 to 1+OV) â€” U-axis matches bottom edge cells (cj=BASE_RES-1)
  for (let ci = 0; ci < BASE_RES; ci++) {
    const u0 = ci / BASE_RES, u1 = (ci + 1) / BASE_RES;
    const edgeSub = effectiveSub[(BASE_RES - 1) * BASE_RES + ci];
    for (let si = 0; si < edgeSub; si++) {
      for (let sj = 0; sj < OV_DEPTH; sj++) {
        addQ(
          u0 + (si / edgeSub) * (u1 - u0), 1 + (sj / OV_DEPTH) * OV,
          u0 + ((si+1) / edgeSub) * (u1 - u0), 1 + ((sj+1) / OV_DEPTH) * OV
        );
      }
    }
  }
  // Four corner overlap quads
  const cTL = Math.max(effectiveSub[0], OV_DEPTH);
  const cTR = Math.max(effectiveSub[BASE_RES - 1], OV_DEPTH);
  const cBL = Math.max(effectiveSub[(BASE_RES - 1) * BASE_RES], OV_DEPTH);
  const cBR = Math.max(effectiveSub[(BASE_RES - 1) * BASE_RES + (BASE_RES - 1)], OV_DEPTH);
  function addCorner(u0, v0, u1, v1, res) {
    for (let sj = 0; sj < res; sj++) {
      for (let si = 0; si < res; si++) {
        addQ(
          u0 + (si / res) * (u1 - u0), v0 + (sj / res) * (v1 - v0),
          u0 + ((si+1) / res) * (u1 - u0), v0 + ((sj+1) / res) * (v1 - v0)
        );
      }
    }
  }
  addCorner(-OV, -OV, 0, 0, cTL);
  addCorner(1, -OV, 1 + OV, 0, cTR);
  addCorner(-OV, 1, 0, 1 + OV, cBL);
  addCorner(1, 1, 1 + OV, 1 + OV, cBR);

  const vbo = gl.createBuffer();
  gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(verts), gl.STATIC_DRAW);
  const idxArr = new Uint16Array(idx);
  const ibo = gl.createBuffer();
  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibo);
  gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, idxArr, gl.STATIC_DRAW);

  // Terrain VAO (WebGL 2.0) — binds ground program attribs
  const vao = gl.createVertexArray();
  gl.bindVertexArray(vao);
  gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
  gl.enableVertexAttribArray(aPos);
  gl.vertexAttribPointer(aPos, 3, gl.FLOAT, false, GROUND_VERT_STRIDE, 0);
  gl.enableVertexAttribArray(aUV);
  gl.vertexAttribPointer(aUV, 2, gl.FLOAT, false, GROUND_VERT_STRIDE, 3 * 4);
  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibo);
  gl.bindVertexArray(null);

  return { vbo, ibo, vao, idxCount: idx.length, coreIdxCount: coreIdxEnd, rawIdx: idxArr, rawCoreIdx: idxArr.subarray(0, coreIdxEnd), wireIbo: null, wireIdxCount: 0 };
}

// Vertex stride: 3 floats pos + 2 floats UV (terrain + billboard meshes)
const GROUND_VERT_STRIDE = 5 * 4;
// Vertex stride: 3 floats pos + 3 floats normal (meshProg meshes: cube, rock, stick, cylinder)
const MESH_VERT_STRIDE = 6 * 4;

// --- Tree Billboard Shader ---
const treeVS = `#version 300 es
  in vec3 aPos;
  in vec2 aUV;
  // Per-instance attributes
  in vec3 iTreePos;
  in float iTreeScale;
  in float iShakeElapsed;
  in float iShakeAmp;
  in float iShakePhase;
  in float iShakeDir;
  in float iShakeHInt;
  in float iShakeVInt;
  in vec3 iColCenter;
  in float iDepthBias;
  uniform mat4 uProj;
  uniform mat4 uView;
  uniform vec2 uTreeSize; // (width, height) in world units — per texture variant
  out vec2 vUV;
  out vec3 vTreeWorldPos;
  out float vPushDarken;
  out float vPushUp;
  out highp float vFlatDepth;
  void main() {
    vec3 camRight = vec3(uView[0][0], uView[1][0], uView[2][0]);
    vec3 camUp = vec3(uView[0][1], uView[1][1], uView[2][1]);
    float w = uTreeSize.x * iTreeScale;
    float h = uTreeSize.y * iTreeScale;
    vec3 worldPos = iTreePos + camRight * aPos.x * w + camUp * aPos.y * h;
    vPushDarken = 0.0;
    vPushUp = 0.0;
    // Shake: bend from base, big slow sway like pushing through
    if (iShakeElapsed > 0.0) {
      float bend = aPos.y * aPos.y;
      float treeVar = fract(iTreePos.x * 3.7 + iTreePos.z * 5.3);
      float attack = min(iShakeElapsed * 10.0, 1.0); // 0→1 over 0.1s

      // Horizontal sway
      float hAmp = 0.07 + iShakeHInt * 0.08;
      float f1 = mix(2.0, 3.2, iShakeHInt) + treeVar * 0.6;
      float f2 = mix(3.0, 4.8, iShakeHInt) + treeVar * 0.6;
      float oscH = sin(iShakeElapsed * f1 + iShakePhase) * 0.65 + sin(iShakeElapsed * f2 + iShakePhase) * 0.35;
      worldPos += camRight * oscH * bend * hAmp * iShakeAmp * attack;

      // Vertical squash
      float vMag;
      if (iShakeDir > 0.0) {
        float sizeFactor = clamp((h - 1.1) / 0.54, 0.0, 1.0);
        float attackEnd = mix(0.18, 0.30, sizeFactor);
        float holdEnd = mix(0.36, 0.33, sizeFactor);
        float vAttack = smoothstep(0.0, attackEnd, iShakeElapsed);
        float vDecay = 1.0 - clamp((iShakeElapsed - holdEnd) / (0.5 - holdEnd), 0.0, 1.0);
        vMag = vAttack * vDecay * iShakeAmp * iShakeVInt;
      } else {
        float vAttack = smoothstep(0.0, 0.2, iShakeElapsed);
        float vDecay = 1.0 - smoothstep(0.2, 1.1, iShakeElapsed);
        vMag = vAttack * vDecay * iShakeAmp * iShakeVInt;
      }
      const float refH = 1.1;
      const float refW = 0.65;
      float hNorm = mix(1.0, refH / max(h, 0.01), 0.6);
      float wNorm = mix(1.0, refW / max(w, 0.01), 0.6);
      float hScale;
      if (iShakeDir > 0.0) {
        hScale = -vMag * 0.17 * hNorm;
      } else {
        hScale = -vMag * 0.25 * hNorm;
      }
      worldPos += camUp * aPos.y * h * hScale;
      if (iShakeDir > 0.0) {
        float pinch = vMag * 0.18 * aPos.y * wNorm;
        float bulge = vMag * 0.07 * (1.0 - aPos.y) * wNorm;
        worldPos -= camRight * aPos.x * w * pinch;
        worldPos += camRight * aPos.x * w * bulge;
        worldPos.y += vMag * 0.12;
        float colorEnv = vMag / max(iShakeVInt, 0.01);
        vPushUp = clamp(colorEnv, 0.0, 1.0);
      } else {
        float wScale = vMag * 0.08 * wNorm;
        worldPos += camRight * aPos.x * w * wScale;
        worldPos.y -= vMag * 0.08;
        float colorEnv = vMag / max(iShakeVInt, 0.01);
        vPushDarken = clamp(colorEnv, 0.0, 1.0);
      }
    }
    vUV = aUV;
    vTreeWorldPos = iTreePos;
    // Compute flat depth in VS (avoids 2x mat4*vec4 per fragment)
    highp vec4 colClip = uProj * uView * vec4(iColCenter, 1.0);
    vFlatDepth = colClip.z / colClip.w * 0.5 + 0.5 + iDepthBias;
    gl_Position = uProj * uView * vec4(worldPos, 1.0);
  }
`;

const treeFS = `#version 300 es
  precision mediump float;
  out vec4 fragColor;
  in vec2 vUV;
  in vec3 vTreeWorldPos;
  in float vPushDarken;
  in float vPushUp;
  in highp float vFlatDepth;
  uniform sampler2D uTreeTex;
  uniform vec3 uTreePlayerPos;
  void main() {
    vec4 c = texture(uTreeTex, vUV);
    if (c.a < 0.5) discard;
    float dx = vTreeWorldPos.x - uTreePlayerPos.x;
    float dz = vTreeWorldPos.z - uTreePlayerPos.z;
    float dist = sqrt(dx * dx + dz * dz);
    float darken = smoothstep(3.0, 12.0, dist);
    c.rgb *= mix(1.0, 0.55, darken);
    c.rgb *= mix(1.0, 0.83, vPushDarken);
    if (vPushUp > 0.0) {
      float lum = dot(c.rgb, vec3(0.299, 0.587, 0.114));
      c.rgb = mix(c.rgb, vec3(lum), vPushUp * 0.35);
    }
    fragColor = c;
    gl_FragDepth = vFlatDepth;
  }
`;

const treeVShader = createShader(gl.VERTEX_SHADER, treeVS);
const treeFShader = createShader(gl.FRAGMENT_SHADER, treeFS);
const treeProg = gl.createProgram();
gl.attachShader(treeProg, treeVShader);
gl.attachShader(treeProg, treeFShader);
gl.linkProgram(treeProg);

const tAPos = gl.getAttribLocation(treeProg, 'aPos');
const tAUV = gl.getAttribLocation(treeProg, 'aUV');
const tITreePos = gl.getAttribLocation(treeProg, 'iTreePos');
const tITreeScale = gl.getAttribLocation(treeProg, 'iTreeScale');
const tIShakeElapsed = gl.getAttribLocation(treeProg, 'iShakeElapsed');
const tIShakeAmp = gl.getAttribLocation(treeProg, 'iShakeAmp');
const tIShakePhase = gl.getAttribLocation(treeProg, 'iShakePhase');
const tIShakeDir = gl.getAttribLocation(treeProg, 'iShakeDir');
const tIShakeHInt = gl.getAttribLocation(treeProg, 'iShakeHInt');
const tIShakeVInt = gl.getAttribLocation(treeProg, 'iShakeVInt');
const tIColCenter = gl.getAttribLocation(treeProg, 'iColCenter');
const tIDepthBias = gl.getAttribLocation(treeProg, 'iDepthBias');
const tUProj = gl.getUniformLocation(treeProg, 'uProj');
const tUView = gl.getUniformLocation(treeProg, 'uView');
const tUTreeSize = gl.getUniformLocation(treeProg, 'uTreeSize');
const tUTreeTex = gl.getUniformLocation(treeProg, 'uTreeTex');
const tUTreePlayerPos = gl.getUniformLocation(treeProg, 'uTreePlayerPos');

// Tree billboard quad: centered horizontally, bottom at y=0
const treeQuadVerts = new Float32Array([
  // x, y, z, u, v
  -0.5, 0, 0,  0, 1,
   0.5, 0, 0,  1, 1,
   0.5, 1, 0,  1, 0,
  -0.5, 1, 0,  0, 0,
]);
const treeQuadIdx = new Uint16Array([0,1,2, 0,2,3]);

const treeVBO = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, treeVBO);
gl.bufferData(gl.ARRAY_BUFFER, treeQuadVerts, gl.STATIC_DRAW);

const treeIBO = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, treeIBO);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, treeQuadIdx, gl.STATIC_DRAW);

// Instance buffer: pos(3)+scale(1)+shakeElapsed(1)+shakeAmp(1)+shakePhase(1)+shakeDir(1)+shakeHInt(1)+shakeVInt(1)+colCenter(3)+depthBias(1) = 14 floats
const TREE_INST_FLOATS = 14;
const TREE_INST_STRIDE = TREE_INST_FLOATS * 4; // 56 bytes
const billboardBatch = new InstanceBatch(TREE_INST_FLOATS, 256);

const treeVAO = gl.createVertexArray();
gl.bindVertexArray(treeVAO);
// Quad geometry (per-vertex)
gl.bindBuffer(gl.ARRAY_BUFFER, treeVBO);
gl.enableVertexAttribArray(tAPos);
gl.vertexAttribPointer(tAPos, 3, gl.FLOAT, false, GROUND_VERT_STRIDE, 0);
gl.enableVertexAttribArray(tAUV);
gl.vertexAttribPointer(tAUV, 2, gl.FLOAT, false, GROUND_VERT_STRIDE, 3 * 4);
// Instance attribs
gl.bindBuffer(gl.ARRAY_BUFFER, billboardBatch.buf);
const _tia = (loc, size, off) => { gl.enableVertexAttribArray(loc); gl.vertexAttribPointer(loc, size, gl.FLOAT, false, TREE_INST_STRIDE, off * 4); gl.vertexAttribDivisor(loc, 1); };
_tia(tITreePos, 3, 0);
_tia(tITreeScale, 1, 3);
_tia(tIShakeElapsed, 1, 4);
_tia(tIShakeAmp, 1, 5);
_tia(tIShakePhase, 1, 6);
_tia(tIShakeDir, 1, 7);
_tia(tIShakeHInt, 1, 8);
_tia(tIShakeVInt, 1, 9);
_tia(tIColCenter, 3, 10);
_tia(tIDepthBias, 1, 13);
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, treeIBO);
gl.bindVertexArray(null);

// --- All embedded image assets (data URIs) ---
const IMAGE_ASSETS = {
  trees: {
    dry: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABzElEQVR4nO2WvUoDQRSFv1XB1SKEKBYSYhQD2gS0EkvL9GnENxAsU/gAKVIKvoDYpfcBLMRCDNhYKCYGSaUhpIhrIWsRZl2TyfzsJojggYVlfu49c+6dOxf+8ctwVJOFYtZfzS2zkoTnDpyWr5Trx0pAOAcCAqAnYUtaOhl2LgjAN4n6Qwsxv5lxuW96Q+OmpKdkg2HnwvGg882MC0Cv6wUEw/vEeh2MFFBBOB+EjIBMCakCUTGfcK33jI1AqXTl9LreZAmIuMtwdLDtv9xNiEDt+gkgyHYZ0nmXdH5CIdjaWQv+p5se0woipZJdsZqxWQzwqQgDQKWy6wMBSd16qQIX1YZTf2ghDKlOLGrE4HdyfuuEnY8qRtoQfGbckacYZbR2/cThcV8JHZTxOjrY9gEeP9pcVBtOoZj1YbhS6qAqxcocuGm1SC70Ty+ch2EaZxWMMrZQzPrrsymgr4aNArrX0PgWPH60Aei8eZAzO71J/2B8ZwdDoFPBtHmx7nB0iWjbNUVqsfb3NnyAbHrpx3j57NLa3lif4yiwLsUyLKZSkffGUqDTfY+zPT6BZGLudwlAfBViE4irQqwk7HTfSSbmeG23I9v4+zkQF1/Jlq84lfYzVQAAAABJRU5ErkJggg==",
    sparse: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABe0lEQVR4nO2VoU7DQBzGv3YTxTAyCKJZllU0QaIrKpB4DKIvUIe8B6jG7AUQ0zzBBGLPsGRiZFkmCFlWDBPAIZZrbuPa6921KWKf613/9/3+//S+Akcd9Z8Vk4DGJKB1eth5G7d3g8xYB6IsvBAgJgH1fDd7bi22SuYq8O2izc7PzjjtO0JI/nmYTCx+Pau1/9byEk6AFedJ1FVep7KzhBNg1KntYD5bFRrxnfJ7qe2gtdjiWzA9KQAbJxOJQnod9Wny9JKt853xY2bAnu9KzQHAkr5xAJL2voQA89kKnu9imEwsEoUUAHjgSgDub67o5nxnzN8SXp1lu5SxFgAPAgCD3uXe+uvyDQAwGk9Ln1t4DVWlYlwpwEW3q12bG8VltPn4NCk3Bzg7PWkWADCfgjGA6RRq+QZIFFIWRjIZ3YLD7lUSUAmg7MEsiFSk/C/gjVgSshx4eHyuN4h0OpRJ6SMcjaeWTtxWBlCHGgeo5Gf0vl5r1zY+gcYBfgEeCJEIXnU+OQAAAABJRU5ErkJggg==",
    bare: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAA8ElEQVR4nO2VMQrCQBBFf8TGRiSIlYWlp0jhMVLkIDmAB7HIMSw8haWFlUgIaVKuhQxoCMnszsAo7K8z+1/+zs4AUVFRv6qyyJw1A8oicxog4jNCQTh1Ceeg/LB3ALDbbgAAx9NltI5Mp74DgDkHoDpfkzcIRv+GjG/3B+dYAMwE+uonQiJjAuaIlQBXPsaqAOs0Da6dSYybtpOUywFWy4UtADCcgs/MEPfAZwo+718FoGm7LwAfY9J/9IDWUhoS6woo2pBRqwJA4hr7NKPKLqBJ+KxrcI1Jqrsg5GrMl5F4EkplDqByBdR8ITJPwBzgBcb6XFbN+90rAAAAAElFTkSuQmCC",
    scraggly: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAtklEQVR4nGNgGAWjYBSMAjwgu8rqf3aV1f+B0s/AwMDAUBVnR5EBVXlGFDogz+h/VZzdf3IcQqnjsRpIjKGkOJiFFAc8ePKKoMUMDAwMbYsOMRJrJtEKkUGUk8Z/BgYGBgUZMRRxmAOX7btBtLkkhQAhQIrFVHWAiJAQ2XqZKLH4w6fvlGin3AECfJwD6wAGBspDgWIHUBoKo2mA4igYdcCoA0YdQCmgSm345t07svUOeAgMuAMA80c5beNYnwAAAAAASUVORK5CYII=",
    fir_cluster_3: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAA2CAYAAACr6+s1AAAI/klEQVR4nO2ZSY9cR3aFv5jelMOrgWQRLZLulgwYkA0vDC/7/6/6D/TSUssaSBZzemMM14tIFlnKqmqqqwwDhu4ikcDLd+PEjRvnnIiE3+P3OI2Lry/lqXLpp0q0eNUKWtE+EbgnA5ZCYh485aJ4knzqKZK0X19K+2JJdz0wdRNYzeG/Pjwq95NUrKgdH37YYlzGUlT20TkfnwHorju01gy7mcV5jdKPX4gnAVatK6zWdNuRw/VACPHROR89tRf/9lK0UnSbkbJxKK3wYyDGyP67zT+c/9EV2709YIxBRDBFRfSR6CMhPq5qj25+AdaXDetnC1KIpJAQhGZd/t8CW57X7N732NIy7CZQCgS6zfi/C+ybP//xXiZfvGqlKDOh+ilQVBYF2MJSFJbq5eredy+/eVghHgTWvmll8987Lr65uDOJQjHtR1aXDQhMQ8DVDshL/FBeicLq1frenz3Y/NoaEHCVu/N5uSwgCeN+QmmFKwzRR7SGkARXWu5a0GpVYa0mbNL9Y9/34MW3L6R9vsCUBgVc/vPdpS8bhy0Mri4IIdLvRuYxYJ2hbE4ntH7dSpgiU++pKsf6dXtn3nsrNu4nnDFYZzGFJqXT2Q3bAeeWKKORFLGFZXFRE8bIsBs4XPcn7yitWJzXhCkw7iaK+m4Id1bs1X++EucMMSaG3Ui/GQHF2Z9u95o2hv37HusMoNBWc3jb4UfP+vniNO9//EGK0tG965gOE+urJckL51+f9vCdwHa/7LGlxU+Bel1hnCaFiPoVjwcfAJj6mXnwWGeRJIQpsP25Q5nb6ecp5B50Bkkw7CfqtsJP4csqhoDSGonC1E00bU30ifSZBp59cyll5Vi0Gbg2GlI6LlVD3dZUlWP1+uymGn4IrJ4vKGqHUlAtC8btiLanMO4EVi1LfD+jrEYS7H85sL5aUi4/sXmKieATwUe0MayeL+h3I0prUkyQEn7OmvkxjFH0mxE/ejCK/dsOVzvOrpZfBkxphXYGVxpsadDOcHjbIfKpFabes7qomQdP96Hnww9bXOVQRtHvJorG0rQNH19Zv24leSHOkTBHkk8oYBo8h196rr59cbt/fw2qfdPKfJixTmOdwRSWcuEwpcVoc4sU99fDjSmUJLkSApISm58ODLsBYw0A9bokidCcVWirWT1viEmomoJiUZz02QkwbQ3LZwts5eg3I1rDsB2RmJi7maat8rI4w7N/OmMeA+3LFUprmrZGaagWBSJQfjZgDEK5KBi7measot9OKEBbRVllYn4YmFYc3neE0QOZz8qmoFpXKPVJnLVW7N52lLVj+9OeGCKCMA+esZtZnteEKeKKXLHxMBGngCssc+9xhUVrRfSJ3ftTvjsB5qdws0tEhKIpCDHRfRjAKIw5+vra4gePLgzVsqSoHMN2xFhDva7otyMxRNA5V1k7JAnjYaJoHPMwIwKusmilWF7e5r0Th9m+aUUrjVIKEaE5b0g+4hpLnBPddmDyCS1grEaSUC4L+u2IUookksGrXI2isthCQxSUgqIpkJiYeo+knH/cDohA86zmb3/5QZ0Ae/Yvz6RelMQ54ueIKw3jfqZaFnm3bUYESCkRU35ZyB9NWzENgTB5tFakJBhn0FohMVKUFomCMoq6rZEkTN2MxIQkQQRCjOy+3yr4lVaOh5k0ZQeqlcIDtjIooxi2E9WyAKXotgNF5VhcNGx+3CIC/XZEG40xGm01zuYq+RCx1hB8QitFUTmij/jRY6zB+wgKylWJC5HdXT32qX/yoUJEkEQu83mNLW3moCQkEd59tyEGOVZRMFZjSoukzHM+RLTSSErH5YWpm5mONmnuPc1FjbaGuZv5jCZvA1NKYQqD1poQEtYZtNUM25HuuqffDJmpXyzxg6dZFyiVOUobRYqJFIUYI/W6JPoEWqG0wpYWBKpVSXNeUy1KXOOIPqGNAskb405gtjC40tKcZ66ae4/vj/cRCmxps6zsRmIUtDnuwM1IikJKEH0gRaHfjLjS5p4zGokJpXK75B2fCKNnOkxEHxEh6+1du3L9uhWtNQqoVyUhRMIYKRYFtjRIFPzkERHe/vXd7Y3TGKkKyzgH3vXx5tkf/v2ljJ3HFQZ37K/oI8Zqgk/4KeDKbJuM1XT7kf33W3Xi0taXTfZh2wlbGqpVbnitFPtNj6vtCUs/FIcPA2Xl8EPADwGlYXHZIElwlSJMgTgnbGkIPt5U6gbY2Z/OxaAYB0+aI8oolFIMuyn3ntM3V0xlXdC+aWX73fbvnrSN06QkNxNKQdj/0iFkW163FZKEuZtv2Z+bb0oyl8jHBg4JW1pc7bCVIfp8/6WNYuo8tviyQ/zFV23uMRHqVUm1dJy/WmOcJvrI+HHiRR7joxbfZNelxaBwpcWrgNKKfjOgjra1XBbEEBl2E81Zzf66uwXgXR8V/ekSb37aU9YFw34ijJFy4dj8sMc4jZ8jRe0Y9xPaKuq2Ikn8VcVU5qJuO1IuC+bec/G6RRBEcqnnIbC8bPCjP7HZ98aRfF1pwCi0NRQLl6XLasIY0E6TgoAIh+vhNrDpMJOi0F4t2b/PfHX9/RbjDEpl41guCrrrgWpdPnig/TymIUuUHwIS8i4MPmUtToKy+dRkS4OtLB9nfAPMOItSsPv5gLGaefCYwuQDhVYkH4+aJgzbiRS/DJpxBlNZlNVUqypXSEGcI7YwJJ8YDhNhiux+PlCvytvARASJQrUqSTHbXhEoK4t1GmU1zVl1M6A9+qyHYv3mTJpViRLJl8ejJ4kQQnYAi8vmeJrP49uj0F99eyUaYPnVWrRSxCTEEHG1Zfl8kR3AFBCgfbnKQu0MyiqMsyy/uv/uATKTF41D0tEihYS2OkuVwP5dz3iYc/+p7M0A+t3wqWK2yJdvfggYbRj3E7Yy+N4TpsDmxz3RJxbnFc4awhhu/Px94afAhx/3uONNY0yJFLI0JRG0VtjKsr/OPd1tRmJIqKP6cPWvV+LnRJoDKWVDlz0VR+mICLA6r+m3Y94QRjF1E/u/7X7zdeZ98vV5PJj0SxL8I/EleZ/sn5Gnjt+B/dZ4kj8gfmvcp6u/x//L+B+xrOwSeKEf6wAAAABJRU5ErkJggg==",
    fir_cluster_5: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAA6CAYAAADP/mu6AAAMiUlEQVR4nO2ZyW9kR3LGf7m+rTYuYo/UWjySYVgewAZswEf//0cfbcxhLMuSZtQku1hVb8vVh6wuqcWm1NUtYGBDcSKKLyO+l7F9EQ9+k9/kN/n/JR98+Sz/Ne3Ldzn0/F+e5+ATi0837w3+4ovrd9LxTsB3dyNCgVTvdPwk9rrLlx+v6D5enw3+bMubL64yMaOkxI/hnYy+kmZV8/DnA34KZ589G/i4n7GNZtxPVLUmhnS2USgX0LQGNwY2z1ZUzxZnXcDZwJtlxbifEULi5sDqujtXBQApZeYpknPicN+jjTrr/NnAY0y065qqM0gtefj+cK4KAFJICFHCBcA0+qzzZwF//q+f5DhH5t6jK81i06K04vrLm7Pc3D5fZ6kUOWXG3cz6gwVEqG7ePlzOAn7/9RYhBO26JoXM/r5nedGwux3OUUPOmegCyigWly37+x4pBQAf//PHbwX+LOC2sXSbhrl39C8HlFbvVBIXmwahBDlndi8OxJAxtWZ52RJdpPnd8hfBn2U1pcz+fsDPAVNrBDDt57MTdH/Xk2Nm3E0IAcvLlnnwQOawHVlc1L+o40ngm88uHr119AGlS6jY2lAtKoSWjPvpLODVoqJZVUglyRmkkQgBxEzVGvwQ6D5a/eytizf9uPxknaWQoAQPf7oXAM3zde6WNTFE5t6V5646lJbMvSNLwf1/fv9Gfa+BvllkYzVCCIQURB/RVtFtapSSBBdQRpNS4tt///ZJfW+sQYvLFj94xiNAgHphySnhBs+zL64YHyb6lyPdRYtQghjiL2EGQCpBu24IPjAfHLbWeB95+P6AMYqcM7a1DLuf9+KjUFl9us5SCppNg9aSz//t9xlg3I6klGnXFYe7nn47IZVkd3sozeMX77qIkIJhO+AHz/Kqxc0BKcrhnDPKaGylEb+g7xHw4BNhjuy+P7D5cMXd1w/FoJK4wSOkYniYyWSCL7c8Dx43vB3fiCEhlSSlzHhw1MuKlBPdpmFx1WKsZNiOSCn58J8+fDLOH4XK8nrBuB1p1zUvv92h6/JIvaywSlIvDdNeYmpNmCO2Lf/3/u0K1OK6g5BJh5lmYTncDwiRCXPAj54UE0IIpBTsXvRP6nnN2uL5KrtjiZp7R3fZYIzi2R+e5TAEDtuJ7/9ry8VHS1LMeBcILiGV4vKj1Vt1vulhIkwepGB3N2AqTYyZ6CMpJmxXAdCua+rOvB3wlDLtpmF53aGtor8fWT9bsr8fSLGwQG0Ud18/MA+O5VWHGz2H+4H7bx6wzQ+Grn5/+eglqptFJkEIiRQSUsA8BepFASuVxI8e21rG/cz8M3T3NeBSS2JM7G973OhRSnD39Uvqzh5rbkZIgZDl2P6uxx5DKceMGz0A60/XWdeaZ394ncPklKmXFVJKllctMWaWFzWbm9LAqkVFTgkpBd1Fw8XN8sl6/hrwHDPDbqLqKtpVTQiZ4CIxJJpVTdUYYojklAq5+uwCNwXWHy4RUtBuSsfLGZKPuOn1Emkagxs87aZmeJhL5ZCC3YsB21qm/YxUElMr9rc9+9uenN8cfSfgv/vHD7PWis3NAj84ht1Es7DUiwolJTEG3BQwViOVRKqSPFWjefhuTwyJDCw/XuVu3ZBSRsTM6pMfJqRXzWbuHdoqpBT027G8QM5oq0AI3BgQQmCq0qh+FvjuxYF2XTPuZ2IutxN8REhBSvkE2NQaU2uqxuBHj6o09cJia824ndC2hM7ygwXKSFYf/IjH5Mw8OKrO4idfPBMS0+BRRhF9xFQaN3pSyujq6eHiVA7XNwum3UyKCW3Kz0IIgouklDnc97TrhnHnQBSD2kim3Uy1sPi5JJLUkmk/Mw+eZmFxP0owIQXNusYNnkxpOM2yYnnZcf/tA0opxv2MUoJmWZHi00XqBDz4VGJ5YZl6h1IGoQQpZoxVpCyZ9p52XTEePIh0Co9xN9NtGrQRCARUhpwSfg6EOXLzDzd5/3JESYnrHfWiQhqJHwIpZdzgkEoSfKTb1OSUUUocR7tfiHFyBgFujoAgplIl6s5iW4upNW4O7O9HtFWYSrP+cHU8mum3I6vrjvFhKjxk8Gij6K5apv3M+N1eOBdRVhNTwvUeqQTKSFLMLC5qxNGT0UfCsbYL+eYYF1DYYNVYlJboSnO461k9W5JCOrlOWc3hvgcpUUoilGQ6OIQoIZBTplkY6sYyH+ZSWn1CVwrbGV58s0MpdTKqjMI2CmLGzwHbGPwUTjestMLUGikF+5cDh292r72BhNLO/eQZDw4/OJplzf77A/vbnnphcaNn7h2LyxYhBDmVztquSuOol/YEftxNXH22QejizPDq5XWZMW1jqJYVptEMDxN+jifQQknadU3OEENkPMwEHzH14w4qAZSS2NYiyFTLCjcFbGdpVhX9/cDVpxtSiOzvBlLKcKw08mhofJhZX7cYW2707qtt8YoEUoaQqWwZFl41KSht3dS6eMYqUkzMQ0AICmPMxTPKPOZBkmNyhdGjjC4M8FhXlVbYxrD9bs/yqqNeVZBzWS1IgXfhFHD7ux5yCRsEuMGhjIJcPBpDwi4qdKWZe4+fIm4MRBdOidxtmsLHG0PKsLhomA4OPz5u/RrAtho/BNplxeG+L67yAoTAWIW2mt1tj240/TcP4rpVubaaaddzO0QBcPW3V1lIQXfZ4gaHmwIiJqQuk46Ugu0fX7wWpx98eZOlEPgpIEUpBvJVvqzK4mlx1RBT5uGrl49vPGeBVJJhO9CsarTV2NaQY8LNkRASUpdS9pSE47oh+li6rZZILZFS4EZPd9m+4VQBW3WWFBN1Zwku4OfA3DuuPlnT3w7sbx/TW3n99x9kJQVIQbWoygIyZ8a9I7hYYjIlcsx06+bJ1UHVWUiZnDN+KnGcE2yer4khcbh7bNwNgXZTk4FqYenvB2xjjsmZuP1qS0xldfEIOMB0mIkuMO5mYkxIJWgW5RaUKjeWc2YePaZ6rOTi88u8uGyZB0cKieATyRc9t396SU4ZISQXn/9AdS/+7jqTM8PDzNw7xp1DWo2bAtoobF0oRr2oMMaw/MkuXg4PE7azVJ3FdiU8TG0wtaFqLaubjnxMFCnLFH47RPE/21m8im+hRElqVVbP4ViPg4+knBECtJGkHw3U7uCoFlXhJ7VBSk41vOoMfi5dNZMRZLqf7FqksZrkE3PvUEqircYNjt1tjx892z8fyFA4S4ilUvxEjFEMLyeq1pyMSymQ/NBsYkivMb2cy94QIUgxkjPkmCDDeHAIIcpE1JhC/NzrFFmaxiCkoF5W9NuJefR4F1FKoNsSb+2yYjwUKvqmeAshIY08bmAF9bout3UEGubC+lL6wds5g5Bgal3qeWOIIRFTQleamDIpZaa9I2c4bF9fV+hpX9YMTFC1hmZds/vLnnZdM+wL85t6x+qmw4+BcTc+Au4nj5aKIARCgFICqcrfpileKG7/kZesQhtFmAMvv9sjj9RBFdqIFKAagzKSPOZH2w9pKgMZmkVhZbu/7DGNYTw4ciyrisuP18z7ubA4KVn9ZD3XrhuQgugKKZoO7tT1YojEORJdRP1oQepDwk2hMNJlhbaaFEtETwd3InkhlJz7aSkT67+5zDnlE7kXQqC0ZDw4ltct48OElPLUJbVRpJTY/fdWQNkMGF3i/pUOXRu0lphGE1wqu8WYsZ1lnj33f7x7I+U7NbZjAXjTM6cbD66MU8lHpCi7vHkoHWzcTsSQUFaitKRqTCFZP3p9eaz/QpSy2a5r/OCZj4ntBkeOmWpVlQ76nl/qTnabVSlJMWZCSMSUyQIQgpgLkZr7MkrZzuJdOC2JKI+RUzryG04JKOVxq9sYdKWILjLvZ4w975PJU6Jv/+PxhvUpl+2/3j7WcPQSsvCa6BP5+MKv+LU2ivaipr8f4YmJ5mzg76ugXdVEX5hevbD024m6s6fpxViFd4ntN3uQgnCYn9R1O0TB8HZb3/cGPvYOJSVVZ+kuGlLMxHDshkowbCdSzscpShHD+R9j3yTvnSnRR5qFpV1X3H+zYz44coJqaRkeJjhuwKSSkEu5+zXkvW9cCBi2E2LHaU2XYuJwOyCNQhvJHCLeRbpNg7KK3a8A/L1ev/tolZWS1K1BqPJJperKjCqEoFpaoouEsdBXZSXbPx+IMT0afs+V9woV25kyR04BpSXtRcM8eNpVjdKSxaYp/EUJ+pcj48OMrswbqfG58l4awhToVg3SSOaDw1Qa22rmyTMPnhdfbYFS56GslKUUqJ9Zrb2t/DqZ8hM5p3W/q/w6/fevIP9ngf8vBcgWH/4Qq/YAAAAASUVORK5CYII=",
    fir_cluster_7: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABQCAYAAAC6aDOxAAASMElEQVR4nO2cSZccx3WFvxhzrKEnECRIybIkU/TGC/3/n+CFV17YPpYpyhzQ6KmqcoiMwYvILgIkQKK7CoB9jLvCwQGiI2+8eMN9Lxo+4iM+4iM+4v8Pnv7Ts/Sh93BMiGMutvi70+QHj9CS7pubo679oSCPupjJnJhSH3PZD4qjEWTPm+Q7T3NSUbcF9qI9ylUrny4/6JU9GkHVuiL4xPaq5/rbDbY2B69ZP1slYxTVs9UHI+loBA2bkWpRUK8LTKGIPh685tR7JhdoT6oj7PBxOBpBcYpoK0kJwhTwUzhoveXfn6XVRYPSgu1lhz1vPogVHYWg0y8v0smnS0JIJB9JwPK0ZvHbk8d/VEp4H4khUTSWorHH2OqDcRSCtpcdqlD0twMJIMHuZiD4x1tRDBFTGqQSRB8Zt+4YW30wjnbF/DBhS40UAm0VUgr89Dg/tPzdabKVwdaGxVnDNHqUUdgnx4mMD8FRCGrOalISjL3POZAQe0t6DGxlEEIy7Rybyx1CChZnDbY6PDI+FAcT1P72JPne4zqHsQrvA1JAiomyKag+XTyYprsftnS3PVJJbG0JPrK77iC9fz99MEFVY9FWYSqD94HudsQNHm0URW1Q9tWsun2LnEZZhVKCGBP9ZkRbRUoJIY+a+L8VDv6JISSEFqQY0VZz8umC5qQmxsj2qkObH3/E6ZcXqVqWnPzh7I0k2Ys2Lc9a/JQIPqC0IMWEUJJp8O893B9M0PZyh9YaBEgt2TzfMQ0Ty4sGgN3VsP+3RWVIKRF+yXmnxPa6oyg1rptICbTVlG2BlAIh328NfBSbHTuH6zzGalJM+NFz+/0WqQTF4sf8pd+MjFvHNPpfXC/6SNFapJaYQhOcp7/tWT9dEP0vG9DFn54c1cIO90HrEmUkUklSjAglaE5qqlWF0j+WHOUnbZIin77Wiurp65338qJl+UlL8BFtFdoqYko0JzV3P2wQ6s0W1H6xTtPg+fTPnx+NpIN0CXvWJCKoQlGtKq7+epM/KCZIicl5pBRUny1TvSxQMhMmjUJ6Sf+aNe+ebzFWE1NCKrm/jv1mxFQWU4N7vn3tfpTO/z4cWOa8jIMsqDmrcP3E9qrj+m+32MoglaS/67GVpl5VpJRDfnczMG4HdGmYhomieUNOk8AUmmZdU9Zmn/tUiwK3c2+M9NXTRQouIJWgv+opjpRUHkTQ7kWPncWxFBOuz041hsTNd1v6uwGlJcuLBmMVymqiD2irkUmw/v2r0cyeNUlbhTSS3XXH7nZkGiaadcXmqkNZTX87cPLlxWs/PiWwtUUI9vs6FAcRdPrbNW7wrJ4uEEpQr0uEhLKxpARFa5nGwO5Fx+K8QUiJkAI/evrNgOtfra9sY2jOGxACpSVKCxDQ3fZZG06JsrH0d8PP9pJSwlhFURnqdYV3x7lmBxF093xHURluv9sQpkhK4PqJYedoTyr84DFzktffjsQpzKdsQAjCTyLSNAb6m56ytdjGkGIixXy9dKEJIeUC9jUJo7aKGCLDdqS/7VmcN4d82h4HEeT7CWkVZVtgy2z+SiuqVUl32xN8BCkoFwVCSWKMuM6hjSKGRLMuf7JizpFuvt3QzpGwqA39ZqSoLZDYXXf4n6QJJ/9wnhYnDSnB2E3EBIRE89nhcu1BBCkjGTcjQuXTB5icZ9iMCCkyQUB/NzL1DiFzbTXuHEVjfiZhtGcNzUlNvarYXvfZInaOorHUqwJiQhuF1K9ue9yM+CmQUkIqgSk0w3bk9DfrQz4POIAge94kkiDERHczUq9LpFEwRy0/RZRRTIPDWgUidzvC6LG1xbtA2RasXnLUmx+2dDcd43YkhcS4HRFCUDaGF1/fkAA/hZxGvISisYzbEVsZUgIzpxqb57vHMzPj0QTp0rD+bMWc+yGcJ8WIUgJlFEVj0UqSgBjBFIZxO+J9pL8bchJoVHbEM4q2IAHBB2LIBFeLAjcGQsikaKt+tpexc/sIFkPE+8jyojlK8f9oglJKvPj6huATp582IKCqNarQpJQYO4f3IVsPMA0T5bICQXa4PieTYfwx2sQYSRHKZUFKs9PejPS3A/W6BCGyKPeTK5YiOdpdd7QnFaY0bC47pnF67Oft8WiCfO+pljnn6K57lFGkmIghEXykWpb4KVIuSoSAelWiraBZlUzDRJgCu9uByWWHay/aFMaIVALXefw4Ua1y2gCwveoxhWJ3O2K0ov58nQAWX6zS8qwhhpx5724Gxi77tqIwtL85QBc/hCBi3lBZSqRWlIsSYzUyBWLImbMpNMNmICEYu4ntZYd3ASEEpjQ0qxJTmP16947dDR5pNLvrHlsZirZAKkFwkdMnTV5j3nmCWXGsKRYWIQXrpwuak4pqWR5sRY8maLrpxPW/PRf1qoSQuHu+zbqNFCx3He75Ruy+uRbeR6rW7nOf5SctCBi2WVjzswUJLbMVJrKsIcAUijBFhs0IQkAKjNsRbX70W/d1X383oJSElBjuRrrbgbvnW+4L5PdO0D3GeVihqHMdtjh7NUFrT2uklgghiCHy4r9ukFKwetJg61fbOfdFpi40YzcxDQE3eGJMxCnuM3RjFW6bLUMIQb8ZqZZlTkaBu8sdQoBSgmJZHPR9BxUsn//5WSprw4uvb/EhUq1KYkiUXz2Ff/4bxZM29bcDKYI2Em013nliyA5YSogucv7VJ+nyX7/fH/V9dnReq1RazeA87qwlzTqR6xxlrZiuIIWINJrgQ1YgBQQliCHltOLAkuMgC9pe7rj+2x0wh+iYSCkXrQCriwZjNUoJysYSfaA5qVmc1YzbEdd7qlVBeot4HFOWXYfNmFtApeH8TxdJSglKEFygaG2WgNP9jYxEnzj94/mjHfVhV0yIuT7SlKuCYTsS/Y96TAj5z0Vr6TYOWxukkUyjp2gLwhToN45x9+tNwad/OMNYRXtakUJkGj27m4F2XeFHz9h7whRRcwpQrSpiiDnKvqa4fVs8mqD1705T3VrasxqhJG7nkFox9Z40JRafL9M05IZf8hFSYvmkZfPDlmnwjNuRsi0ILrzVJMj3//4C21i2Vz1xthBlFN1moGwsSgnCFJBaobREynx4yqiDdOxHExQmn5uF29wP664Hysbsr4ucN6WUIJG7rd11j5Rinwh2dwOI3Fr+/M8/H9277IL45mYU42mD0Zq7H7YUrd2T3axLqmVFtxlJKROmjcRPAddPGKuwtTlojO7xtVhpGLYjwQX8FJFGEqac41TrihgTtjQIlf9++UmLG3O/7L4al0pgK02aPP1Vz+KL1/fMykWBELnmWpw3KKPobwaGu4EYIu1JTbMqSSnnRMZqptHjp9zTP6TkeHQUCyFiCo0pdc5TEvg5f1FaoJRke91R1hYEuMHjuimfslJom/3DNHiadYUtDTff3b3+Z40ekmDqJpSWlIuCceeYXBbeIId7Qa7VpJH7w5jmKv+xeLQFKaOy9Yye5rRGKIEfA0LlvCQrfJrJBYracvvdJn9siHS3PX7KGbMgQgTXTZRNwZN//HnbZnKBclEQY+L2uy13z3e4bqKdc656WaGUJISU9zRMLJ80xBgxRu2v+2PwKIJWv1ml6ALNWY0bPNvLXe5lNZYUE0or2pOa1ScNzL5Gzc6zau0+9FfLfC3GbY5wRVtka3wJ7bNlOnm6JIa4r/Tvs+PuqscWuU1dLYo89CBF7sL2E4LczLSFYfXIWaVHXTFlFGLepBSCorWMW8fYOZp1ye56QFlFf5nH8lzvKRrLNHhiBJTA9x43eqyV6EKxvdyRYu5ovAwp84TZ+rMF486hC43SinHnUFbhBsf2Zm4gJV66Tll2cf1EErD75vZRZvQoC6pXJc26nEdTyA1DkTd4L2bdV/DD1lG2lmEzIiVzzSSQSrG6qJFC7sOwbQxFbVm+7KxF1rBv/nuDEGJOMB3SSMwsfZRtkX2QFKREzuh92LeMlFSUb2hUvhOCdjc9uxd9Pm0hcgdBCmxtCD5m6VPLHK0E9BuXfc92ojmpcEOYRbGUJzl01qjdbiL6+MrQZkr5WpXLAqkF9aokIXJRuhlzBj9/uhDZgoY5crk5WgqRlYfH4NFXTApJmB302DnGbqJssx5TtpYwyxrbl0z7vFapGEeS81x2QQiRUruqmEZP2Vp0aVBacvXt7f5nSZk1ZikFUku2VzmXKpoSSHSbkXEINOuSYeOyhoSguxsojcqBQ0qKRtG9L4Jc71FCIIRg2DlSTFSLIrda5hO3tfnVATNTZLUx+kDSku2LHVLkcZd7pJhyxX47YGrD6tNF7tJ2WfhPIc5tpYEQEnLIk25SgnfZUqUSDHePm3F8FEEpRopVxbh1+NHTntboUvHim1uiC6hC0ywKLr++fuMaF19dpNAHxp2bVcQJQR6aatc17VmTvv2Xb0W9Khl2Dl0Z3G5i6qYsv8L+avff3gmYq/9BY2YLfYzF/BQPvpjnX54nW5j9yQop2F113H23RaSUW88+sLncUdQFF1+9vk08ddPekZNgcZF17fsQ7XaO5Rer5MeAIA+J6lJTLAr6rdv7mnpRsvzN+p0NVT2YoHHnUEbiXc5Qo4+YSucRPBcpF7kzEUPCVK8a6H1tddkFsThvqFYlw2akvWgIIZJi7mslwA1Trtsau9eZ8lUZ0VYjtMwyrI+cPlsciY6f48EElYsCPwRSSBRzeHWdRxtJfVoxdI5mVaGNYnFaE98wTdZvRmLMFnf3/Ra3c9TLEqkEUuXBKWUVu5uesXO5Op8iQoIfJ3aXPTEkxp1j8/wYl+n1eDBBrptgDqd+nGhOSprzirGfICbK2uKG3J9//pdr/BvebAw7h1Ay5z6z7BFjJPqIHz3lnFh+8vuzfd9faYlQkqLJIr4QAikEbsgC3csWehgtP+LBBMUQEfJ+kkOyuerxQ8ia8GakvxuIMeswtjZvHGbSRjF1bl/wqkJn7dknmpOKfjOilOD62w3R50RUW4k2Ctc5bGPRhUJZuc/q3wUeTNB9/8u7gJzFeoD+diD6iDJyryoKIWjWP3+ps/xilRanNUJmIT+FSJin0SBHp6K2LJ4s0HPGnJ1/JPiYa7ato6hNbgbEd+ajHx7m7yOXMop+k1XBcedIIV+lGEGqfAXHnfuZowby/9mOTFNk6j2qyD1910+5ag+RYesYOocxer/22E2kCLuxQxlJdzuwfLogxMjrh/IOx4MsqH22TNncBa6fEELkLqkP6Lnu0VbhXcAUGj8FpJC0z14dQ/HOYxtLtShQNvfx030dJ9h3Rr0LBBcwtZ3LF4Uu9f6AdGnobwZIvFq/HREPIiglOHm2yhufcpbqXcCWhuBCDs/9hLYKoSXMKf9P6yAhBd31gJ8HHoQAIfPwwbjN8mmzLpFS5Cz5bkBqSQyRqZ9oz7PMApnMGNJrhxqOgQcRVK9KXvz1lqKxxDlRbM/r3ItfFBRtPmnvAr6bgES1KJl+4qhXTxp0oXC9RyqZlUadhX9bW6rW0t+OubW9LKgWBdHHuUsh2F0PiPlKFm2eGzrmZOvLOIr7f7nB9zYh9uKri5R8nimMIfe7xu2Y34bN1hBColpZdldDllg3I+WqpJu1n3pVIoTYv2x0/cTNX66PHs7e+/vt8z+epdDPLebW7h+oaCMJPjINU9aHpkh0kXKRrx3kSKmkJInZYYc8RXKfWrwLvHeCvI/7Ed3tVY82khjS/gP1nA8BudY6yYWpLDRFbdi+6FBS4EPczzoKJbO2/Q7w3gkq2wIlJf1mpD2vsz+BXKiSW8gpJRLQnlQMg+N6vjrntUrL+SpfHzFb/iW89wdYw92AlCBIWUMOEaHvay+JqXSeH7IqT3h0h0+JHYKjWNBlFwTd20WRGNNeSOuue5RVSCXxg8fWhqnPskaYwvw45t2E77fFe7cgIUUefdF5EjWGlB/dCfJM9bIgxcj6s+Vc0vzy06l3jffug5SWxJTF+vWnC374zyuEtBRtkRPCufC8+voGyO3pezzEUo+F9/p8b/H5MpVNQXRhbzG2skgtkMDmesDMLw2VFCgriRFSilz9x9UH+XU77/WK5adQHl0ZUoSitnS3PXFKbK56mpMy+6BC40PEjQFt1a++UHyXeK8E+fkXBCTyQ2DI84bdXR4j3r7o97OFQuTNpZRyN/YD4f0SNM0TIYUhTJH+dmCaZwhjTHmqNeQhdFMaYkr7Ou1D4X/Fr9F6aC33PvHhjub/CD4S9Cv4SNCv4CNBH/ER7xT/A9LsJSTSqO4uAAAAAElFTkSuQmCC",
    cactus_saguaro: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAYCAYAAADzoH0MAAABDklEQVR4nN2Tv0oDQRCHfzOzXCskEGu7YCVpkkexFl/LlxAfQ7S0EkEsbIJECIrszljlvL39x6V0qoXZ/eab2V3g/8fy8sxqea4lF+uZhW/D6vq8CEkArYpNwM/e92tVhapOAxBRv3bOgYhgVpaqzkBVEUIA89+2cYsJIKc8NPBfcd4lSsxYrGd2qO6ciwDjAonB8+0rhRAgIui6Dt77KD+cUdYAALb3OwKA083cRCQ6NB5oFjDUNTMQES6ulsbM+Hj/rLeQ0zUzMDNUFS93b1EPVQMz6y0eb54ot6dpML6FSQAzw+FGjga0ogoQEYhI9UM1Z6Cq0V+YBPDe9++gWKSUmK9OkgFsH3Zl0rHxC+dKfQ/BEnmAAAAAAElFTkSuQmCC",
    cactus_barrel: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAqElEQVR4nMWQPQ4BARCFv5ntRLZgqUREISqRVWytEWcQtxPu4BAIjXAGcYLdfSq/q9hC4lWTmfdl3gz8Tesk0WY8VmmgM2l9NdtnI4prAgibVcKogiT2y9PD56/mxqguADMjTVPu9XDeVwGI4prMngvdHXcnz3MABrOe3oDL9mr3YZZlSEIS7o6ZcVidrRDpsr2aJIIgAEASZsZucSzcWlB32i7/0p/qBrOxNoNZKgw2AAAAAElFTkSuQmCC",
    cactus_prickly: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAMCAYAAABSgIzaAAAA7klEQVR4nLWSPU4DMRCF34y3QIkAyeySJuJHgARUsAlXQIQjALfj5wwcggQafhoaSlg4gTWPAsXaDc52eZU9nk/znm1gEdo52+C8M0kVi8EaVRVdvwTfW0UIAU93b8neqO3TfpxSnzg7XeubvPR0zuHoYp8A8H7/IVMHAHB8ecB/4Powp8ifG1WN8NS2qoJkhCP4+VAJAIgISMZMX+NvIYkQAlQVj7ev6ax751tMrXdHm42MSbp3UtDMsFJ0sew7cM5hfP3c6NVZKC89zaxRI4ny6nD+rQJANfkREYGIwMyQZRlIYnLz0v6OdbX9nF+RHFL2krYk9AAAAABJRU5ErkJggg==",
    dead_bush: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAKCAYAAACE2W/HAAAAeElEQVR4nGNgoAVwM5L5jy7mba6IKuZqKI2hyN1YFkUMQxMuCS8zBTgfm+0owNNUHq4AZiOymKep/H+4S9yMZP57mMjBBTxM5P4ji8PYyE5nRLfRUkPi/58/fxj+/0e4jJGRkeH0nTcYanECczUxnP5iItoUamkEALr5LPnzRn3hAAAAAElFTkSuQmCC",
  },
};

// ============================================================
// TREE BILLBOARD GENERATION NOTES
// ============================================================
// Tree cluster billboards are generated programmatically via Python/Pillow.
// Generation script: draw_clusters15.py (or latest version)
//
// CANVAS SIZES:
//   cluster_3: 38x54px   cluster_5: 46x58px   cluster_7: 60x66px
//   Original cluster1/2: 32x48px   cluster3: 32x48px
//
// TREE SHAPE:
//   - Smooth fir/conifer silhouette â€” sqrt taper from wide base to rounded tip
//   - max_half_w = tree_h // 4 (wider base than classic pointy)
//   - Taper uses sqrt(progress) instead of linear for softer crown
//   - Very subtle waviness via (y%5) modulation, NOT hard tier steps
//   - Tip: 1px for top 3% of foliage, then sqrt curve widens smoothly
//   - Foliage drawn as filled scanlines per Y row
//
// TRUNK:
//   - 3px wide (trunk_w=1 means cx-1 to cx+1)
//   - Center pixel: (36,24,12), edge pixels: (28,16,6)
//   - Height: tree_h / 6
//
// COLORS (v24 â€” v21 base + desaturate 45% + green vibrance boost):
//   - Base foliage: (12, 36, 12) â€” deep green
//   - Scattered highlights: hash-driven across whole face, top-biased
//     ~70% of pixels get highlight (hash > 0.30), boost = (hash-0.30)*top_bias*32
//   - Extra bright pops: ~25% of highlighted pixels (hash > 0.75) get extra boost
//   - Branch highlights: ~8% of pixels get +7r,+16g,+4b
//   - Edge shadow: |rel_x| > 0.8, dim (|rel_x|-0.8)*22
//   - Bottom shadow: progress > 0.75, dim (progress-0.75)*12
//   - POST-PROCESS per pixel:
//     1. Desaturate 45% toward luminance (lum = 0.299r + 0.587g + 0.114b)
//     2. Green vibrance boost: push g away from lum scaled by green_dominance*0.6
//        Pull r,b slightly down to keep rich, not pale
//
// HASH FUNCTION (for pixel noise/breakup):
//   Uses integer bit-mixing: multiply by large primes, XOR, shift.
//   v = (x + seed*137) * 374761393
//   v = (v ^ (y * 668265263)) & 0xFFFFFFFF
//   v = ((v ^ (v>>13)) * 1274126177) & 0xFFFFFFFF
//   v = (v ^ (v>>16)) & 0xFFFFFFFF
//   return v / 4294967296.0
//   Different seeds per tree (i*3571) to avoid repeated patterns.
//   Key: hash operates per-pixel (not per-block) for organic look.
//
// CLUSTER LAYOUTS (cx, tree_h, trunk_bot_y, darken):
//   cluster_3 (38x54): triangle â€” 1 back-center, 2 front spread wide
//     (19,35,38,6), (30,36,50,0), (8,37,51,0)
//   cluster_5 (46x58): asymmetric â€” 2 back, 1 mid-right, 1 mid-left, 1 front
//     (14,34,39,7), (32,33,39,7), (36,35,48,3), (6,36,52,3), (22,37,60,0)
//   cluster_7 (72x80): 2 back, 2 mid, 2 front-mid, 1 front
//     (20,33,38,9), (40,32,40,9),
//     (28,35,52,5), (52,34,54,5),
//     (18,36,66,0), (44,35,68,0), (34,38,78,0)
//
// DEPTH CUEING:
//   - Back trees: darken 6-9 (stronger separation from front)
//   - Mid trees: darken 3-5
//   - Front trees: 0
//   - Applied as flat subtraction from r,g,b base
//   - Trunks at different Y positions â€” staggered so no foliage_bot aligns
//     with another tree's trunk_bot (within 2px)
//   - Instanced per texture variant (one draw per variant)
//
// BILLBOARD SIZES IN GAME (TREE_SIZES):
//   cluster_3: [0.65, 1.1]  cluster_5: [0.85, 1.2]  cluster_7: [1.32, 1.64]
//
// To regenerate: run the Python script, copy base64 output into IMAGE_ASSETS.trees
// ============================================================

// ============================================================
// TREE BILLBOARD GENERATION SCRIPT (Python/Pillow)
// ============================================================
// Save as draw_clusters24.py and run with: python draw_clusters24.py
// Requires: pip install Pillow
//
// [Python source: draw_clusters24.py]
// from PIL import Image
// import base64, io, json, math
// def make_cluster(tree_defs, canvas_w, canvas_h, name):
//     img = Image.new('RGBA', (canvas_w, canvas_h), (0, 0, 0, 0))
//     pixels = img.load()
//     def hash_px(x, y, seed=0):
//         v = (x + seed * 137) * 374761393
//         v = (v ^ (y * 668265263)) & 0xFFFFFFFF
//         v = ((v ^ (v >> 13)) * 1274126177) & 0xFFFFFFFF
//         v = (v ^ (v >> 16)) & 0xFFFFFFFF
//         return v / 4294967296.0
//     def draw_tree(cx, tree_h, trunk_bot_y, darken=0, seed=0):
//         trunk_h = max(3, tree_h // 6)
//         trunk_w = 1
//         for y in range(trunk_bot_y - trunk_h, trunk_bot_y):
//             for x in range(cx - trunk_w, cx + trunk_w + 1):
//                 if 0 <= x < canvas_w and 0 <= y < canvas_h:
//                     if x == cx: pixels[x, y] = (28, 16, 7, 255)
//                     else: pixels[x, y] = (20, 10, 3, 255)
//         foliage_h = tree_h - trunk_h
//         foliage_top = trunk_bot_y - tree_h
//         max_half_w = max(5, tree_h // 4)
//         for y in range(foliage_top, trunk_bot_y - trunk_h + 1):
//             if y < 0 or y >= canvas_h: continue
//             progress = (y - foliage_top) / max(1, foliage_h)
//             wave = 0.03 * ((y % 5) / 5.0 - 0.5)
//             shaped = math.sqrt(progress) if progress > 0 else 0
//             half_w = int(max_half_w * (shaped + wave) * 0.82)
//             if progress < 0.03: half_w = 0
//             for x in range(cx - half_w, cx + half_w + 1):
//                 if x < 0 or x >= canvas_w: continue
//                 dx = x - cx
//                 rel_x = dx / max(1, half_w) if half_w > 0 else 0
//                 rel_y = progress
//                 r = 12 - darken; g = 36 - darken; b = 12
//                 n = hash_px(x, y, seed)
//                 top_bias = 1.0 - progress * 0.4
//                 if n > 0.30:
//                     strength = (n - 0.30) * top_bias
//                     boost = int(strength * 32)
//                     r += boost // 2; g += boost; b += boost // 3
//                     if n > 0.75:
//                         extra = int((n - 0.75) * 20)
//                         r += extra // 2; g += extra; b += extra // 3
//                 bn = hash_px(x, y, seed + 8837)
//                 if bn > 0.92: r += 7; g += 16; b += 4
//                 if abs(rel_x) > 0.8:
//                     dim = int((abs(rel_x) - 0.8) * 22)
//                     r -= dim; g -= dim; b -= dim // 2
//                 if progress > 0.75:
//                     dim = int((progress - 0.75) * 12)
//                     r -= dim; g -= dim
//                 n2 = hash_px(x, y, seed + 5501)
//                 v = int((n2 - 0.5) * 5); r += v; g += v
//                 r = max(0,min(255,r)); g = max(0,min(255,g)); b = max(0,min(255,b))
//                 # POST-PROCESS: desaturate then green vibrance
//                 lum = r*0.299 + g*0.587 + b*0.114
//                 desat = 0.45
//                 r = r+(lum-r)*desat; g = g+(lum-g)*desat; b = b+(lum-b)*desat
//                 gd = (g-(r+b)/2)/max(1,g)
//                 if gd > 0:
//                     vib = gd * 0.6
//                     g = g+(g-lum)*vib; r = r-(g-lum)*vib*0.15; b = b-(g-lum)*vib*0.15
//                 pixels[x,y] = (max(0,min(255,int(r))),max(0,min(255,int(g))),max(0,min(255,int(b))),255)
//     for i, (cx, tree_h, trunk_bot_y, darken) in enumerate(sorted(tree_defs, key=lambda t: t[2])):
//         draw_tree(cx, tree_h, trunk_bot_y, darken, seed=i * 3571)
//     buf = io.BytesIO()
//     img.save(buf, format='PNG')
//     b64 = base64.b64encode(buf.getvalue()).decode()
//     img.save(f'{name}.png')
//     return f"data:image/png;base64,{b64}"
// c3 = make_cluster([
//     (19,35,38,6),(8,37,51,0),(30,36,50,0),
// ], 38, 54, 'fir_cluster_3')
// c5 = make_cluster([
//     (14,34,39,7),(32,33,39,7),(6,36,52,3),(36,35,48,3),(22,37,60,0),
// ], 46, 58, 'fir_cluster_5')
// c7 = make_cluster([
//     (20,33,38,9),(40,32,40,9),
//     (28,35,52,5),(52,34,54,5),
//     (18,36,66,0),(44,35,68,0),(34,38,78,0),
// ], 72, 80, 'fir_cluster_7')
// with open('cluster_b64.json', 'w') as f:
//     json.dump({'fir_cluster_3': c3, 'fir_cluster_5': c5, 'fir_cluster_7': c7}, f)
// print("Done!")
// [end Python source]
// ============================================================

// Load ALL tree textures from all biomes into a global map
const allTreeVariantNames = [];
for (const bKey in BIOMES) {
  for (const v of BIOMES[bKey].treeVariants) {
    if (!allTreeVariantNames.includes(v)) allTreeVariantNames.push(v);
  }
}
const treeTextures = {};
let treesLoaded = 0;
const treesToLoad = allTreeVariantNames.length;

// Upscale helper: nearest-neighbor to nearest power-of-two size
function upscaleImage(img, factor) {
  const c = document.createElement('canvas');
  c.width = img.width * factor;
  c.height = img.height * factor;
  const ctx = c.getContext('2d');
  ctx.imageSmoothingEnabled = false;
  ctx.drawImage(img, 0, 0, c.width, c.height);
  return c;
}

function isPOT(n) { return (n & (n - 1)) === 0; }

allTreeVariantNames.forEach(v => {
  const img = new Image();
  img.onload = () => {
    const upscaled = upscaleImage(img, 4);
    const tex = gl.createTexture();
    gl.bindTexture(gl.TEXTURE_2D, tex);
    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, upscaled);
    gl.generateMipmap(gl.TEXTURE_2D);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST_MIPMAP_LINEAR);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
    treeTextures[v] = tex;
    treesLoaded++;
  };
  img.src = IMAGE_ASSETS.trees[v];
});

const STICK_PASSTHROUGH_RADIUS = 0.17; // stick collider radius – covers worst-case rotation of shortened mesh
const STICK_COL_OFFSET_Z = 0;          // mesh centered on anchor, no offset needed

// Per-variant tree properties: [billboard_width, billboard_height, collider_radius, collider_offset_dx, collider_offset_dz]
// Collider offsets project trunk base center-of-mass to ground plane along camera forward direction
const TREE_VARIANTS = {
  dry:           { size: [0.35, 0.7],   colR: 0.055, colOff: [0, 0] },
  sparse:        { size: [0.35, 0.7],   colR: 0.055, colOff: [0, 0] },
  bare:          { size: [0.35, 0.7],   colR: 0.055, colOff: [0, 0] },
  scraggly:      { size: [0.35, 0.7],   colR: 0.055, colOff: [0, 0] },
  fir_cluster_3: { size: [0.65, 1.1],   colR: 0.28,  colOff: [-0.24, -0.22] },
  fir_cluster_5: { size: [0.85, 1.2],   colR: 0.33,  colOff: [-0.22, -0.23],
                   colGroups: [
                     { colR: 0.33, colOff: [-0.22, -0.23] },
                     // { colR: 0.33, colOff: [-0.31, -0.32] }, // upper collider disabled
                   ] },
  fir_cluster_7: { size: [1.32, 1.64],   colR: 0.40,  colOff: [-0.48, -0.36],
                   colGroups: [
                     { colR: 0.40, colOff: [-0.48, -0.36] },
                     { colR: 0.40, colOff: [-0.82, -0.78] },
                   ] },
  cactus_saguaro: { size: [0.30, 0.55],  colR: 0.05,  colOff: [0, 0] },
  cactus_barrel:  { size: [0.22, 0.22], colR: 0.06,  colOff: [0, 0] },
  cactus_prickly: { size: [0.28, 0.24], colR: 0.07,  colOff: [0, 0] },
  dead_bush:      { size: [0.28, 0.20], colR: 0.04,  colOff: [0, 0] },
};
// Short variant aliases used in baked configs
const VARIANT_EXPAND = { c3: 'fir_cluster_3', c5: 'fir_cluster_5', c7: 'fir_cluster_7', sg: 'cactus_saguaro', br: 'cactus_barrel', pp: 'cactus_prickly', db: 'dead_bush' };
function expandVariant(v) { return VARIANT_EXPAND[v] || v; }
const ROCK_COLLISION_RADIUS_BASE = 0.15;

// --- Base world scales for items ---
// Config scale values are multipliers around 1.0; final render scale = BASE * config.scale
const STICK_BASE_SCALE = 0.5;    // world-space size of a scale:1.0 stick
const ROCK_BASE_HEIGHT = 0.175;  // world-space height of a scale:1.0 rock


// --- Static Rock Configuration (terrain decoration, scattered, infrequent) ---
// (loaded from active biome config)

// --- Static Minable Material Configuration ---
// (loaded from active biome config)

// --- Rock/Crystal Shader (3D lit cubes, instanced) ---
const meshVS = `#version 300 es
  in vec3 aPos;
  in vec3 aNormal;
  // Per-instance: model matrix as 4 columns
  in vec4 iModelC0;
  in vec4 iModelC1;
  in vec4 iModelC2;
  in vec4 iModelC3;
  // Per-instance material
  in vec3 iColor;
  in float iEmissive;
  in float iMaterialType;
  in float iShininess;
  in float iFlatDepth;
  uniform mat4 uProj;
  uniform mat4 uView;
  out vec3 vNormal;
  out vec3 vWorldPos;
  out vec3 vColor;
  out float vEmissive;
  out float vMaterialType;
  out float vShininess;
  out highp float vFlatDepth;
  void main() {
    mat4 model = mat4(iModelC0, iModelC1, iModelC2, iModelC3);
    vec4 world = model * vec4(aPos, 1.0);
    vWorldPos = world.xyz;
    vNormal = mat3(model) * aNormal;
    vColor = iColor;
    vEmissive = iEmissive;
    vMaterialType = iMaterialType;
    vShininess = iShininess;
    vFlatDepth = iFlatDepth;
    gl_Position = uProj * uView * world;
  }
`;

const meshFS = `#version 300 es
  precision mediump float;
  out vec4 fragColor;
  in vec3 vNormal;
  in vec3 vWorldPos;
  in vec3 vColor;
  in float vEmissive;
  in float vMaterialType;
  in float vShininess;
  in highp float vFlatDepth;
  uniform vec3 uPlayerWorldPos;
  uniform vec3 uCamPos;
  void main() {
    vec3 n = normalize(vNormal);
    vec3 lightDir = normalize(vec3(0.4, 0.8, 0.3));
    float diff = max(dot(n, lightDir), 0.0);
    vec3 fillDir = normalize(vec3(-0.3, 0.4, -0.5));
    float fill = max(dot(n, fillDir), 0.0);
    float ambient = 0.3;
    vec3 col = vColor;
    // materialType: 0=default, 1=rock
    if (vMaterialType > 0.5 && vMaterialType < 1.5) {
      float upFace = max(dot(n, vec3(0.0, 1.0, 0.0)), 0.0);
      float sideFace = abs(dot(n, vec3(1.0, 0.0, 0.0)));
      col += vec3(0.08, 0.07, 0.05) * upFace;
      col += vec3(0.03, 0.02, 0.0) * sideFace;
      float faceVar = fract(abs(vWorldPos.x * 3.7 + vWorldPos.z * 5.3)) * 0.06 - 0.03;
      col += vec3(faceVar, faceVar * 0.8, faceVar * 0.6);
      ambient = 0.35;
    }
    vec3 lit = col * (ambient + diff * 0.7 + fill * 0.25);
    lit += vColor * vEmissive;
    if (vShininess > 0.0) {
      vec3 viewDir = normalize(uCamPos - vWorldPos);
      vec3 halfDir = normalize(lightDir + viewDir);
      float spec = pow(max(dot(n, halfDir), 0.0), 32.0);
      lit += vec3(0.4, 0.55, 0.9) * spec * vShininess;
    }
    float rdx = vWorldPos.x - uPlayerWorldPos.x;
    float rdz = vWorldPos.z - uPlayerWorldPos.z;
    float rdist = sqrt(rdx * rdx + rdz * rdz);
    float rshadow = smoothstep(3.0, 12.0, rdist);
    lit *= mix(1.0, 0.55, rshadow);
    fragColor = vec4(lit, 1.0);
    if (vFlatDepth > 0.0) {
      gl_FragDepth = vFlatDepth;
    } else {
      gl_FragDepth = gl_FragCoord.z;
    }
  }
`;

const meshVShader = createShader(gl.VERTEX_SHADER, meshVS);
const meshFShader = createShader(gl.FRAGMENT_SHADER, meshFS);
const meshProg = gl.createProgram();
gl.attachShader(meshProg, meshVShader);
gl.attachShader(meshProg, meshFShader);
gl.linkProgram(meshProg);

const mAPos = gl.getAttribLocation(meshProg, 'aPos');
const mANormal = gl.getAttribLocation(meshProg, 'aNormal');
const mIModelC0 = gl.getAttribLocation(meshProg, 'iModelC0');
const mIModelC1 = gl.getAttribLocation(meshProg, 'iModelC1');
const mIModelC2 = gl.getAttribLocation(meshProg, 'iModelC2');
const mIModelC3 = gl.getAttribLocation(meshProg, 'iModelC3');
const mIColor = gl.getAttribLocation(meshProg, 'iColor');
const mIEmissive = gl.getAttribLocation(meshProg, 'iEmissive');
const mIMaterialType = gl.getAttribLocation(meshProg, 'iMaterialType');
const mIShininess = gl.getAttribLocation(meshProg, 'iShininess');
const mIFlatDepth = gl.getAttribLocation(meshProg, 'iFlatDepth');
const mUProj = gl.getUniformLocation(meshProg, 'uProj');
const mUView = gl.getUniformLocation(meshProg, 'uView');
const mUPlayerWorldPos = gl.getUniformLocation(meshProg, 'uPlayerWorldPos');
const mUCamPos = gl.getUniformLocation(meshProg, 'uCamPos');

// meshBatch: shared instance buffer for all meshProg objects (rocks, sticks, minables, player)
// Per-instance: model(16) + color(3) + emissive(1) + materialType(1) + shininess(1) + flatDepth(1) = 23 floats
const MESH_INST_FLOATS = 23;
const MESH_INST_STRIDE = MESH_INST_FLOATS * 4;
const meshBatch = new InstanceBatch(MESH_INST_FLOATS, 256);

// Helper: attach instance attribs to a VAO that uses meshProg
function setupMeshInstAttribs() {
  gl.bindBuffer(gl.ARRAY_BUFFER, meshBatch.buf);
  const S = MESH_INST_STRIDE;
  const ia = (loc, sz, off) => { if(loc<0) return; gl.enableVertexAttribArray(loc); gl.vertexAttribPointer(loc, sz, gl.FLOAT, false, S, off*4); gl.vertexAttribDivisor(loc, 1); };
  ia(mIModelC0, 4, 0);
  ia(mIModelC1, 4, 4);
  ia(mIModelC2, 4, 8);
  ia(mIModelC3, 4, 12);
  ia(mIColor, 3, 16);
  ia(mIEmissive, 1, 19);
  ia(mIMaterialType, 1, 20);
  ia(mIShininess, 1, 21);
  ia(mIFlatDepth, 1, 22);
}

// Write a 4x4 model matrix (rotY * rotZ * scale + translate) into dest at offset.
// Column-major layout, 16 floats. Used by both solid and wireframe packing.
function writeModelMatrix(dest, off, tx, ty, tz, rotY, rotZ, sx, sy, sz) {
  const cy = Math.cos(rotY), sny = Math.sin(rotY);
  const cz = Math.cos(rotZ), snz = Math.sin(rotZ);
  const m00 = cy * cz,    m01 = cy * snz,    m02 = -sny;
  const m10 = -snz,        m11 = cz,           m12 = 0;
  const m20 = sny * cz,   m21 = sny * snz,   m22 = cy;
  dest[off]    = m00*sx; dest[off+1]  = m10*sx; dest[off+2]  = m20*sx; dest[off+3]  = 0;
  dest[off+4]  = m01*sy; dest[off+5]  = m11*sy; dest[off+6]  = m21*sy; dest[off+7]  = 0;
  dest[off+8]  = m02*sz; dest[off+9]  = m12*sz; dest[off+10] = m22*sz; dest[off+11] = 0;
  dest[off+12] = tx;     dest[off+13] = ty;     dest[off+14] = tz;     dest[off+15] = 1;
}

// Helper: pack one instance into meshBatch at given index.
// Caller must ensure meshBatch capacity before packing loops.
function packMeshInst(idx, tx, ty, tz, rotY, rotZ, sx, sy, sz, cr, cg, cb, emissive, materialType, shininess, flatDepth) {
  if (sy === undefined) { sy = sx; sz = sx; }
  const d = meshBatch.data;
  const off = idx * MESH_INST_FLOATS;
  writeModelMatrix(d, off, tx, ty, tz, rotY, rotZ, sx, sy, sz);
  d[off + 16] = cr;
  d[off + 17] = cg;
  d[off + 18] = cb;
  d[off + 19] = emissive;
  d[off + 20] = materialType;
  d[off + 21] = shininess;
  d[off + 22] = flatDepth;
}

// Unit cube geometry: vertices with normals (centered at origin, size 1)
const cubeVerts = new Float32Array([
  // front
  -0.5,-0.5, 0.5,  0, 0, 1,   0.5,-0.5, 0.5,  0, 0, 1,
   0.5, 0.5, 0.5,  0, 0, 1,  -0.5, 0.5, 0.5,  0, 0, 1,
  // back
   0.5,-0.5,-0.5,  0, 0,-1,  -0.5,-0.5,-0.5,  0, 0,-1,
  -0.5, 0.5,-0.5,  0, 0,-1,   0.5, 0.5,-0.5,  0, 0,-1,
  // top
  -0.5, 0.5, 0.5,  0, 1, 0,   0.5, 0.5, 0.5,  0, 1, 0,
   0.5, 0.5,-0.5,  0, 1, 0,  -0.5, 0.5,-0.5,  0, 1, 0,
  // bottom
  -0.5,-0.5,-0.5,  0,-1, 0,   0.5,-0.5,-0.5,  0,-1, 0,
   0.5,-0.5, 0.5,  0,-1, 0,  -0.5,-0.5, 0.5,  0,-1, 0,
  // right
   0.5,-0.5, 0.5,  1, 0, 0,   0.5,-0.5,-0.5,  1, 0, 0,
   0.5, 0.5,-0.5,  1, 0, 0,   0.5, 0.5, 0.5,  1, 0, 0,
  // left
  -0.5,-0.5,-0.5, -1, 0, 0,  -0.5,-0.5, 0.5, -1, 0, 0,
  -0.5, 0.5, 0.5, -1, 0, 0,  -0.5, 0.5,-0.5, -1, 0, 0,
]);
const cubeIdx = new Uint16Array([
  0,1,2,0,2,3, 4,5,6,4,6,7, 8,9,10,8,10,11,
  12,13,14,12,14,15, 16,17,18,16,18,19, 20,21,22,20,22,23
]);

const cubeVBO = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, cubeVBO);
gl.bufferData(gl.ARRAY_BUFFER, cubeVerts, gl.STATIC_DRAW);

const cubeIBO = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, cubeIBO);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, cubeIdx, gl.STATIC_DRAW);

// --- VAO helper (WebGL 2.0) ---
function makeMeshVAO(vbo, ibo) {
  const vao = gl.createVertexArray();
  gl.bindVertexArray(vao);
  gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
  gl.enableVertexAttribArray(mAPos);
  gl.vertexAttribPointer(mAPos, 3, gl.FLOAT, false, MESH_VERT_STRIDE, 0);
  gl.enableVertexAttribArray(mANormal);
  gl.vertexAttribPointer(mANormal, 3, gl.FLOAT, false, MESH_VERT_STRIDE, 3 * 4);
  setupMeshInstAttribs();
  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibo);
  gl.bindVertexArray(null);
  return vao;
}

const cubeVAO = makeMeshVAO(cubeVBO, cubeIBO);

// --- Low-poly rock mesh (single variant, instanced) ---
// Each rock is a deformed icosphere-like shape, unique silhouette
function buildRockMesh(deformSeed) {
  let s = deformSeed;
  function srand() { s = (s * 16807) % 2147483647; return (s - 1) / 2147483646; }

  // Single squat boulder variant: 5-sided bottom ring, 5-sided mid bulge, 2 blunt top verts
  const params = { rBot: 0.44, rMid: 0.38, yMid: 0.00, yTop: 0.30, midRot: Math.PI/5, topOff: [[-0.10, 0.08],[ 0.12,-0.10]], jitter: 0.18 };

  const baseVerts = [];
  const tris = [];

  // Bottom ring
  for (let i = 0; i < 5; i++) {
    const a = (i / 5) * Math.PI * 2;
    baseVerts.push([Math.cos(a) * params.rBot, -0.5, Math.sin(a) * params.rBot]);
  }
  // Mid bulge ring (rotated)
  for (let i = 0; i < 5; i++) {
    const a = (i / 5) * Math.PI * 2 + params.midRot;
    baseVerts.push([Math.cos(a) * params.rMid, params.yMid, Math.sin(a) * params.rMid]);
  }
  // Blunt top (2 verts)
  baseVerts.push([params.topOff[0][0], params.yTop, params.topOff[0][1]]);
  baseVerts.push([params.topOff[1][0], params.yTop - 0.02, params.topOff[1][1]]);

  // Base to mid (10 tris)
  for (let i = 0; i < 5; i++) {
    tris.push([i, (i+1)%5, 5+i], [(i+1)%5, 5+(i+1)%5, 5+i]);
  }
  // Mid to top (7 tris)
  tris.push([5,6,10], [6,7,10], [7,10,11]);
  tris.push([7,8,11], [8,9,11], [9,5,11]);
  tris.push([5,10,11]);

  // Deform
  const j = params.jitter;
  const verts = baseVerts.map(v => [
    v[0] + (srand()-0.5) * j,
    v[1] + (srand()-0.5) * j * 0.5,
    v[2] + (srand()-0.5) * j,
  ]);
  for (let i = 0; i < 5; i++) verts[i][1] = -0.5;

  // Build vertex + normal arrays (flat shading: unique verts per triangle)
  // Ensure consistent winding (outward normals) for back-face culling
  const vertData = [];
  const idxData = [];
  let vi = 0;
  // Compute mesh center axis (XZ centroid, for radial outward test)
  let mcx = 0, mcz = 0;
  for (const v of verts) { mcx += v[0]; mcz += v[2]; }
  mcx /= verts.length; mcz /= verts.length;
  for (const tri of tris) {
    const a = verts[tri[0]], b = verts[tri[1]], c = verts[tri[2]];
    // Face normal via cross product
    const ux = b[0]-a[0], uy = b[1]-a[1], uz = b[2]-a[2];
    const vx = c[0]-a[0], vy = c[1]-a[1], vz = c[2]-a[2];
    let nx = uy*vz - uz*vy, ny = uz*vx - ux*vz, nz = ux*vy - uy*vx;
    const nl = Math.sqrt(nx*nx+ny*ny+nz*nz) || 1;
    nx /= nl; ny /= nl; nz /= nl;
    // Outward direction: radial from axis + upward bias for top faces
    const fcx = (a[0]+b[0]+c[0])/3 - mcx;
    const fcy = (a[1]+b[1]+c[1])/3;
    const fcz = (a[2]+b[2]+c[2])/3 - mcz;
    // Blend radial XZ with vertical Y for top-leaning faces
    const outX = fcx, outY = fcy > 0 ? fcy * 0.5 : 0, outZ = fcz;
    if (nx*outX + ny*outY + nz*outZ < 0) {
      // Flip winding
      nx = -nx; ny = -ny; nz = -nz;
      vertData.push(a[0],a[1],a[2], nx,ny,nz);
      vertData.push(c[0],c[1],c[2], nx,ny,nz);
      vertData.push(b[0],b[1],b[2], nx,ny,nz);
    } else {
      vertData.push(a[0],a[1],a[2], nx,ny,nz);
      vertData.push(b[0],b[1],b[2], nx,ny,nz);
      vertData.push(c[0],c[1],c[2], nx,ny,nz);
    }
    idxData.push(vi, vi+1, vi+2);
    vi += 3;
  }

  return {
    verts: new Float32Array(vertData),
    idx: new Uint16Array(idxData),
    triCount: idxData.length,
  };
}

const ROCK_MESH_COUNT = 1;
const rockMeshes = [];
{
  const mesh = buildRockMesh(7919);
  const vbo = gl.createBuffer();
  gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
  gl.bufferData(gl.ARRAY_BUFFER, mesh.verts, gl.STATIC_DRAW);
  const ibo = gl.createBuffer();
  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibo);
  gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, mesh.idx, gl.STATIC_DRAW);
  rockMeshes.push({ vbo, ibo, vao: makeMeshVAO(vbo, ibo), triCount: mesh.triCount, rawIdx: mesh.idx, wireIbo: null, wireIdxCount: 0 });
}

// --- Forked Stick Mesh (flat 2D tris on ground plane) ---
function buildStickMesh() {
  const verts = []; // pos(3) + normal(3)
  const idx = [];
  const n = [0, 1, 0]; // all normals point up

  function addQuad(x0,z0, x1,z1, hw) {
    // Flat quad along line from (x0,z0) to (x1,z1) with half-width hw
    const dx = x1-x0, dz = z1-z0;
    const len = Math.sqrt(dx*dx+dz*dz) || 1;
    const px = -dz/len * hw, pz = dx/len * hw;
    const b = verts.length / 6;
    verts.push(x0+px, 0, z0+pz, ...n);
    verts.push(x0-px, 0, z0-pz, ...n);
    verts.push(x1-px, 0, z1-pz, ...n);
    verts.push(x1+px, 0, z1+pz, ...n);
    idx.push(b,b+1,b+2); idx.push(b,b+2,b+3);
  }

  const W = 0.055;
  // Mesh centered on origin so collider circle covers all rotations.
  // X center: (-0.28+0.30)/2 = 0.01, Z center: (-0.06+0.13)/2 = 0.035
  const cx = 0.01, cz = 0.035;
  addQuad(-0.28-cx, 0.0-cz,  0.08-cx, 0.02-cz,  W);       // main branch
  addQuad( 0.06-cx, 0.02-cz, 0.30-cx, 0.13-cz,  W*0.7);   // fork A
  addQuad( 0.06-cx, 0.02-cz, 0.17-cx,-0.06-cz,  W*0.7);   // fork B

  return {
    verts: new Float32Array(verts),
    idx: new Uint16Array(idx),
    triCount: idx.length,
  };
}

const stickMeshData = buildStickMesh();
const stickVBO = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, stickVBO);
gl.bufferData(gl.ARRAY_BUFFER, stickMeshData.verts, gl.STATIC_DRAW);
const stickIBO = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, stickIBO);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, stickMeshData.idx, gl.STATIC_DRAW);
const stickTriCount = stickMeshData.triCount;
const stickVAO = makeMeshVAO(stickVBO, stickIBO);

// --- Glow Billboard Shader (additive blended quad around minable materials) ---
const glowVS = `#version 300 es
  in vec3 aPos;
  in vec3 iGlowPos;    // per-instance
  in float iGlowSize;  // per-instance
  in vec3 iGlowColor;  // per-instance
  in float iGlowAlpha; // per-instance
  uniform mat4 uProj;
  uniform mat4 uView;
  out vec2 vOffset;
  out vec3 vGlowColor;
  out float vGlowAlpha;
  void main() {
    vec3 camRight = vec3(uView[0][0], uView[1][0], uView[2][0]);
    vec3 camUp = vec3(uView[0][1], uView[1][1], uView[2][1]);
    vec3 worldPos = iGlowPos + camRight * aPos.x * iGlowSize + camUp * aPos.y * iGlowSize;
    vOffset = aPos.xy;
    vGlowColor = iGlowColor;
    vGlowAlpha = iGlowAlpha;
    gl_Position = uProj * uView * vec4(worldPos, 1.0);
  }
`;

const glowFS = `#version 300 es
  precision mediump float;
  out vec4 fragColor;
  in vec2 vOffset;
  in vec3 vGlowColor;
  in float vGlowAlpha;
  void main() {
    float d = length(vOffset);
    float glow = 1.0 - smoothstep(0.0, 1.0, d);
    glow = pow(glow, 1.5); // softer than quadratic, less hot center
    glow = min(glow, 0.7); // cap peak intensity to prevent white blowout
    fragColor = vec4(vGlowColor, glow * vGlowAlpha);
  }
`;

const glowVShader = createShader(gl.VERTEX_SHADER, glowVS);
const glowFShader = createShader(gl.FRAGMENT_SHADER, glowFS);
const glowProg = gl.createProgram();
gl.attachShader(glowProg, glowVShader);
gl.attachShader(glowProg, glowFShader);
gl.linkProgram(glowProg);

const gAPos = gl.getAttribLocation(glowProg, 'aPos');
const gIGlowPos = gl.getAttribLocation(glowProg, 'iGlowPos');
const gIGlowSize = gl.getAttribLocation(glowProg, 'iGlowSize');
const gIGlowColor = gl.getAttribLocation(glowProg, 'iGlowColor');
const gIGlowAlpha = gl.getAttribLocation(glowProg, 'iGlowAlpha');
const gUProj = gl.getUniformLocation(glowProg, 'uProj');
const gUView = gl.getUniformLocation(glowProg, 'uView');

// Glow quad: centered, unit size
const glowQuadVerts = new Float32Array([
  -1, -1, 0,
   1, -1, 0,
   1,  1, 0,
  -1,  1, 0,
]);
const glowQuadIdx = new Uint16Array([0,1,2, 0,2,3]);

const glowVBO = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, glowVBO);
gl.bufferData(gl.ARRAY_BUFFER, glowQuadVerts, gl.STATIC_DRAW);

const glowIBO = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, glowIBO);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, glowQuadIdx, gl.STATIC_DRAW);

// Instance buffer: pos(3) + size(1) + color(3) + alpha(1) = 8 floats per instance
const GLOW_INST_FLOATS = 8;
const GLOW_INST_STRIDE = GLOW_INST_FLOATS * 4; // 32 bytes
const MAX_GLOWS = 256;
const glowInstBuf = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, glowInstBuf);
gl.bufferData(gl.ARRAY_BUFFER, MAX_GLOWS * GLOW_INST_STRIDE, gl.DYNAMIC_DRAW);
const glowInstData = new Float32Array(MAX_GLOWS * GLOW_INST_FLOATS);

const glowVAO = gl.createVertexArray();
gl.bindVertexArray(glowVAO);
// Quad geometry (per-vertex)
gl.bindBuffer(gl.ARRAY_BUFFER, glowVBO);
gl.enableVertexAttribArray(gAPos);
gl.vertexAttribPointer(gAPos, 3, gl.FLOAT, false, 3 * 4, 0);
// Instance attribs
gl.bindBuffer(gl.ARRAY_BUFFER, glowInstBuf);
gl.enableVertexAttribArray(gIGlowPos);
gl.vertexAttribPointer(gIGlowPos, 3, gl.FLOAT, false, GLOW_INST_STRIDE, 0);
gl.vertexAttribDivisor(gIGlowPos, 1);
gl.enableVertexAttribArray(gIGlowSize);
gl.vertexAttribPointer(gIGlowSize, 1, gl.FLOAT, false, GLOW_INST_STRIDE, 12);
gl.vertexAttribDivisor(gIGlowSize, 1);
gl.enableVertexAttribArray(gIGlowColor);
gl.vertexAttribPointer(gIGlowColor, 3, gl.FLOAT, false, GLOW_INST_STRIDE, 16);
gl.vertexAttribDivisor(gIGlowColor, 1);
gl.enableVertexAttribArray(gIGlowAlpha);
gl.vertexAttribPointer(gIGlowAlpha, 1, gl.FLOAT, false, GLOW_INST_STRIDE, 28);
gl.vertexAttribDivisor(gIGlowAlpha, 1);
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, glowIBO);
gl.bindVertexArray(null);

// ═══════════════════════════════════════════════════════════════════════════
// CREATURE SHADER
// Textured instanced quad with model matrix transform (Y-rotation for facing).
// Alpha-tested texture, flat depth, distance fog.
// Per-instance: model matrix (16) + flatDepth (1) = 17 floats.
// ═══════════════════════════════════════════════════════════════════════════
const creatureVS = `#version 300 es
  in vec3 aPos;
  in vec2 aUV;
  in vec4 iModelC0;
  in vec4 iModelC1;
  in vec4 iModelC2;
  in vec4 iModelC3;
  in float iFlatDepth;
  in float iFrame;    // atlas column index (pose: 0=standing, 1=sitting, etc.)
  in float iFlipU;    // 1.0 = flip horizontally, 0.0 = normal
  in float iAtlasRow; // atlas row index (color variant: 0, 1, 2, ...)
  in float iTiltZ;    // screen-space tilt in radians
  uniform mat4 uProj;
  uniform mat4 uView;
  uniform float uAtlasCols; // number of columns in atlas (poses)
  uniform float uAtlasRows; // number of rows in atlas (variants)
  out vec2 vUV;
  out vec3 vWorldPos;
  out highp float vFlatDepth;
  void main() {
    mat4 model = mat4(iModelC0, iModelC1, iModelC2, iModelC3);
    vec4 world = model * vec4(aPos, 1.0);
    vWorldPos = world.xyz;
    // Remap UV into atlas cell (column = pose, row = variant)
    float cellW = 1.0 / uAtlasCols;
    float cellH = 1.0 / uAtlasRows;
    float u = aUV.x;
    if (iFlipU > 0.5) u = 1.0 - u;
    vUV = vec2(iFrame * cellW + u * cellW, iAtlasRow * cellH + aUV.y * cellH);
    vFlatDepth = iFlatDepth;
    vec4 clip = uProj * uView * world;
    // Apply screen-space tilt: rotate clip XY around the instance center
    if (abs(iTiltZ) > 0.001) {
      // Get clip-space center of this instance (project the model origin)
      vec4 center = uProj * uView * model * vec4(0.0, 0.0, 0.0, 1.0);
      vec2 offset = clip.xy / clip.w - center.xy / center.w;
      float ct = cos(iTiltZ), st = sin(iTiltZ);
      vec2 rotated = vec2(offset.x * ct - offset.y * st, offset.x * st + offset.y * ct);
      clip.xy = (center.xy / center.w + rotated) * clip.w;
    }
    gl_Position = clip;
  }
`;
const creatureFS = `#version 300 es
  precision mediump float;
  in vec2 vUV;
  in vec3 vWorldPos;
  in highp float vFlatDepth;
  out vec4 fragColor;
  uniform sampler2D uTex;
  uniform vec3 uPlayerWorldPos;
  void main() {
    vec4 c = texture(uTex, vUV);
    if (c.a < 0.5) discard;
    float rdx = vWorldPos.x - uPlayerWorldPos.x;
    float rdz = vWorldPos.z - uPlayerWorldPos.z;
    float rdist = sqrt(rdx * rdx + rdz * rdz);
    float rshadow = smoothstep(3.0, 12.0, rdist);
    c.rgb *= mix(1.0, 0.55, rshadow);
    gl_FragDepth = vFlatDepth;
    fragColor = c;
  }
`;
const creatureProg = gl.createProgram();
{
  const vs = gl.createShader(gl.VERTEX_SHADER);
  gl.shaderSource(vs, creatureVS); gl.compileShader(vs);
  const fs = gl.createShader(gl.FRAGMENT_SHADER);
  gl.shaderSource(fs, creatureFS); gl.compileShader(fs);
  gl.attachShader(creatureProg, vs);
  gl.attachShader(creatureProg, fs);
  gl.linkProgram(creatureProg);
}
const crAPos = gl.getAttribLocation(creatureProg, 'aPos');
const crAUV = gl.getAttribLocation(creatureProg, 'aUV');
const crIMC0 = gl.getAttribLocation(creatureProg, 'iModelC0');
const crIMC1 = gl.getAttribLocation(creatureProg, 'iModelC1');
const crIMC2 = gl.getAttribLocation(creatureProg, 'iModelC2');
const crIMC3 = gl.getAttribLocation(creatureProg, 'iModelC3');
const crIDepth = gl.getAttribLocation(creatureProg, 'iFlatDepth');
const crIFrame = gl.getAttribLocation(creatureProg, 'iFrame');
const crIFlipU = gl.getAttribLocation(creatureProg, 'iFlipU');
const crIAtlasRow = gl.getAttribLocation(creatureProg, 'iAtlasRow');
const crITiltZ = gl.getAttribLocation(creatureProg, 'iTiltZ');
const crUProj = gl.getUniformLocation(creatureProg, 'uProj');
const crUView = gl.getUniformLocation(creatureProg, 'uView');
const crUTex = gl.getUniformLocation(creatureProg, 'uTex');
const crUPlayerPos = gl.getUniformLocation(creatureProg, 'uPlayerWorldPos');
const crUAtlasCols = gl.getUniformLocation(creatureProg, 'uAtlasCols');
const crUAtlasRows = gl.getUniformLocation(creatureProg, 'uAtlasRows');

// Per-instance: model matrix (16) + flatDepth (1) + frame (1) + flipU (1) = 19 floats
const CR_INST_FLOATS = 21;
const CR_INST_STRIDE = CR_INST_FLOATS * 4;
const creatureBatch = new InstanceBatch(CR_INST_FLOATS, 32);

function packCreatureInst(idx, tx, ty, tz, rotY, rotZ, sx, sy, sz, flatDepth, frame, flipU, atlasRow, tiltZ) {
  const d = creatureBatch.data;
  const off = idx * CR_INST_FLOATS;
  writeModelMatrix(d, off, tx, ty, tz, rotY, rotZ, sx, sy, sz);
  d[off + 16] = flatDepth;
  d[off + 17] = frame;
  d[off + 18] = flipU;
  d[off + 19] = atlasRow || 0;
  d[off + 20] = tiltZ || 0;
}

// Creature quad geometry: centered XY plane, pos(3) + uv(2), 5 floats/vert
// X: -0.5 to 0.5 (width), Y: -0.5 to 0.5 (height), Z: 0
// UV: (0,1) at bottom-left, (1,0) at top-right
const creatureQuadVerts = new Float32Array([
  // x,    y,    z,   u, v
  -0.5, -0.5,  0,   0, 1,  // bottom-left
   0.5, -0.5,  0,   1, 1,  // bottom-right
   0.5,  0.5,  0,   1, 0,  // top-right
  -0.5,  0.5,  0,   0, 0,  // top-left
]);
const creatureQuadIdx = new Uint16Array([0, 1, 2, 0, 2, 3]);
const CREATURE_VERT_STRIDE = 5 * 4; // 20 bytes

const creatureQuadVBO = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, creatureQuadVBO);
gl.bufferData(gl.ARRAY_BUFFER, creatureQuadVerts, gl.STATIC_DRAW);
const creatureQuadIBO = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, creatureQuadIBO);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, creatureQuadIdx, gl.STATIC_DRAW);

// VAO
const creatureVAO = gl.createVertexArray();
gl.bindVertexArray(creatureVAO);
gl.bindBuffer(gl.ARRAY_BUFFER, creatureQuadVBO);
gl.enableVertexAttribArray(crAPos);
gl.vertexAttribPointer(crAPos, 3, gl.FLOAT, false, CREATURE_VERT_STRIDE, 0);
gl.enableVertexAttribArray(crAUV);
gl.vertexAttribPointer(crAUV, 2, gl.FLOAT, false, CREATURE_VERT_STRIDE, 3 * 4);
// Instance attribs
gl.bindBuffer(gl.ARRAY_BUFFER, creatureBatch.buf);
const _cia = (loc, size, off) => {
  gl.enableVertexAttribArray(loc);
  gl.vertexAttribPointer(loc, size, gl.FLOAT, false, CR_INST_STRIDE, off * 4);
  gl.vertexAttribDivisor(loc, 1);
};
_cia(crIMC0, 4, 0);
_cia(crIMC1, 4, 4);
_cia(crIMC2, 4, 8);
_cia(crIMC3, 4, 12);
_cia(crIDepth, 1, 16);
_cia(crIFrame, 1, 17);
_cia(crIFlipU, 1, 18);
_cia(crIAtlasRow, 1, 19);
_cia(crITiltZ, 1, 20);
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, creatureQuadIBO);
gl.bindVertexArray(null);

// --- Creature texture loading ---
const creatureTextures = {};
function loadCreatureTexture(id, dataUrl) {
  const tex = gl.createTexture();
  const img = new Image();
  img.onload = () => {
    gl.bindTexture(gl.TEXTURE_2D, tex);
    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, img);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
  };
  img.src = dataUrl;
  creatureTextures[id] = tex;
}

// Rabbit texture: 128x96 atlas (4 pose columns × 3 color rows, each 32x32)
// Cols: standing, sitting, hop_up, landing  |  Rows: cream, brown, grey
loadCreatureTexture('rabbit', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABgCAYAAADVenpJAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAACHDwAAjA8AAP1SAACBQAAAfXkAAOmLAAA85QAAGcxzPIV3AAAKL2lDQ1BJQ0MgUHJvZmlsZQAASMedlndUVNcWh8+9d3qhzTDSGXqTLjCA9C4gHQRRGGYGGMoAwwxNbIioQEQREQFFkKCAAaOhSKyIYiEoqGAPSBBQYjCKqKhkRtZKfHl57+Xl98e939pn73P32XuftS4AJE8fLi8FlgIgmSfgB3o401eFR9Cx/QAGeIABpgAwWempvkHuwUAkLzcXerrICfyL3gwBSPy+ZejpT6eD/0/SrFS+AADIX8TmbE46S8T5Ik7KFKSK7TMipsYkihlGiZkvSlDEcmKOW+Sln30W2VHM7GQeW8TinFPZyWwx94h4e4aQI2LER8QFGVxOpohvi1gzSZjMFfFbcWwyh5kOAIoktgs4rHgRm4iYxA8OdBHxcgBwpLgvOOYLFnCyBOJDuaSkZvO5cfECui5Lj25qbc2ge3IykzgCgaE/k5XI5LPpLinJqUxeNgCLZ/4sGXFt6aIiW5paW1oamhmZflGo/7r4NyXu7SK9CvjcM4jW94ftr/xS6gBgzIpqs+sPW8x+ADq2AiB3/w+b5iEAJEV9a7/xxXlo4nmJFwhSbYyNMzMzjbgclpG4oL/rfzr8DX3xPSPxdr+Xh+7KiWUKkwR0cd1YKUkpQj49PZXJ4tAN/zzE/zjwr/NYGsiJ5fA5PFFEqGjKuLw4Ubt5bK6Am8Kjc3n/qYn/MOxPWpxrkSj1nwA1yghI3aAC5Oc+gKIQARJ5UNz13/vmgw8F4psXpjqxOPefBf37rnCJ+JHOjfsc5xIYTGcJ+RmLa+JrCdCAACQBFcgDFaABdIEhMANWwBY4AjewAviBYBAO1gIWiAfJgA8yQS7YDApAEdgF9oJKUAPqQSNoASdABzgNLoDL4Dq4Ce6AB2AEjIPnYAa8AfMQBGEhMkSB5CFVSAsygMwgBmQPuUE+UCAUDkVDcRAPEkK50BaoCCqFKqFaqBH6FjoFXYCuQgPQPWgUmoJ+hd7DCEyCqbAyrA0bwwzYCfaGg+E1cBycBufA+fBOuAKug4/B7fAF+Dp8Bx6Bn8OzCECICA1RQwwRBuKC+CERSCzCRzYghUg5Uoe0IF1IL3ILGUGmkXcoDIqCoqMMUbYoT1QIioVKQ21AFaMqUUdR7age1C3UKGoG9QlNRiuhDdA2aC/0KnQcOhNdgC5HN6Db0JfQd9Dj6DcYDIaG0cFYYTwx4ZgEzDpMMeYAphVzHjOAGcPMYrFYeawB1g7rh2ViBdgC7H7sMew57CB2HPsWR8Sp4sxw7rgIHA+XhyvHNeHO4gZxE7h5vBReC2+D98Oz8dn4Enw9vgt/Az+OnydIE3QIdoRgQgJhM6GC0EK4RHhIeEUkEtWJ1sQAIpe4iVhBPE68QhwlviPJkPRJLqRIkpC0k3SEdJ50j/SKTCZrkx3JEWQBeSe5kXyR/Jj8VoIiYSThJcGW2ChRJdEuMSjxQhIvqSXpJLlWMkeyXPKk5A3JaSm8lLaUixRTaoNUldQpqWGpWWmKtKm0n3SydLF0k/RV6UkZrIy2jJsMWyZf5rDMRZkxCkLRoLhQWJQtlHrKJco4FUPVoXpRE6hF1G+o/dQZWRnZZbKhslmyVbJnZEdoCE2b5kVLopXQTtCGaO+XKC9xWsJZsmNJy5LBJXNyinKOchy5QrlWuTty7+Xp8m7yifK75TvkHymgFPQVAhQyFQ4qXFKYVqQq2iqyFAsVTyjeV4KV9JUCldYpHVbqU5pVVlH2UE5V3q98UXlahabiqJKgUqZyVmVKlaJqr8pVLVM9p/qMLkt3oifRK+g99Bk1JTVPNaFarVq/2ry6jnqIep56q/ojDYIGQyNWo0yjW2NGU1XTVzNXs1nzvhZei6EVr7VPq1drTltHO0x7m3aH9qSOnI6XTo5Os85DXbKug26abp3ubT2MHkMvUe+A3k19WN9CP16/Sv+GAWxgacA1OGAwsBS91Hopb2nd0mFDkqGTYYZhs+GoEc3IxyjPqMPohbGmcYTxbuNe408mFiZJJvUmD0xlTFeY5pl2mf5qpm/GMqsyu21ONnc332jeaf5ymcEyzrKDy+5aUCx8LbZZdFt8tLSy5Fu2WE5ZaVpFW1VbDTOoDH9GMeOKNdra2Xqj9WnrdzaWNgKbEza/2BraJto22U4u11nOWV6/fMxO3Y5pV2s3Yk+3j7Y/ZD/ioObAdKhzeOKo4ch2bHCccNJzSnA65vTC2cSZ79zmPOdi47Le5bwr4urhWuja7ybjFuJW6fbYXd09zr3ZfcbDwmOdx3lPtKe3527PYS9lL5ZXo9fMCqsV61f0eJO8g7wrvZ/46Pvwfbp8Yd8Vvnt8H67UWslb2eEH/Lz89vg98tfxT/P/PgAT4B9QFfA00DQwN7A3iBIUFdQU9CbYObgk+EGIbogwpDtUMjQytDF0Lsw1rDRsZJXxqvWrrocrhHPDOyOwEaERDRGzq91W7109HmkRWRA5tEZnTdaaq2sV1iatPRMlGcWMOhmNjg6Lbor+wPRj1jFnY7xiqmNmWC6sfaznbEd2GXuKY8cp5UzE2sWWxk7G2cXtiZuKd4gvj5/munAruS8TPBNqEuYS/RKPJC4khSW1JuOSo5NP8WR4ibyeFJWUrJSBVIPUgtSRNJu0vWkzfG9+QzqUvia9U0AV/Uz1CXWFW4WjGfYZVRlvM0MzT2ZJZ/Gy+rL1s3dkT+S453y9DrWOta47Vy13c+7oeqf1tRugDTEbujdqbMzfOL7JY9PRzYTNiZt/yDPJK817vSVsS1e+cv6m/LGtHlubCyQK+AXD22y31WxHbedu799hvmP/jk+F7MJrRSZF5UUfilnF174y/ariq4WdsTv7SyxLDu7C7OLtGtrtsPtoqXRpTunYHt897WX0ssKy13uj9l4tX1Zes4+wT7hvpMKnonO/5v5d+z9UxlfeqXKuaq1Wqt5RPXeAfWDwoOPBlhrlmqKa94e4h+7WetS212nXlR/GHM44/LQ+tL73a8bXjQ0KDUUNH4/wjowcDTza02jV2Nik1FTSDDcLm6eORR67+Y3rN50thi21rbTWouPguPD4s2+jvx064X2i+yTjZMt3Wt9Vt1HaCtuh9uz2mY74jpHO8M6BUytOdXfZdrV9b/T9kdNqp6vOyJ4pOUs4m3924VzOudnzqeenL8RdGOuO6n5wcdXF2z0BPf2XvC9duex++WKvU++5K3ZXTl+1uXrqGuNax3XL6+19Fn1tP1j80NZv2d9+w+pG503rm10DywfODjoMXrjleuvyba/b1++svDMwFDJ0dzhyeOQu++7kvaR7L+9n3J9/sOkh+mHhI6lH5Y+VHtf9qPdj64jlyJlR19G+J0FPHoyxxp7/lP7Th/H8p+Sn5ROqE42TZpOnp9ynbj5b/Wz8eerz+emCn6V/rn6h++K7Xxx/6ZtZNTP+kv9y4dfiV/Kvjrxe9rp71n/28ZvkN/NzhW/l3x59x3jX+z7s/cR85gfsh4qPeh+7Pnl/eriQvLDwG/eE8/s3BCkeAAAACXBIWXMAAAsSAAALEgHS3X78AAADbmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4NCjx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iPjxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+PHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9InV1aWQ6ZmFmNWJkZDUtYmEzZC0xMWRhLWFkMzEtZDMzZDc1MTgyZjFiIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iPjxkYzpjcmVhdG9yPjxyZGY6U2VxIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+PHJkZjpsaT5LYWl0bHluIENhbGxvdzwvcmRmOmxpPjwvcmRmOlNlcT4NCgkJCTwvZGM6Y3JlYXRvcj48L3JkZjpEZXNjcmlwdGlvbj48cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0idXVpZDpmYWY1YmRkNS1iYTNkLTExZGEtYWQzMS1kMzNkNzUxODJmMWIiIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj48ZXhpZjpEYXRlVGltZU9yaWdpbmFsPjIwMjYtMDItMjNUMTQ6Mzk6NTcuMDE1PC9leGlmOkRhdGVUaW1lT3JpZ2luYWw+PC9yZGY6RGVzY3JpcHRpb24+PHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9InV1aWQ6ZmFmNWJkZDUtYmEzZC0xMWRhLWFkMzEtZDMzZDc1MTgyZjFiIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iPjx4bXA6Q3JlYXRlRGF0ZT4yMDI2LTAyLTIzVDE0OjM5OjU3LjAxNTwveG1wOkNyZWF0ZURhdGU+PC9yZGY6RGVzY3JpcHRpb24+PC9yZGY6UkRGPjwveDp4bXBtZXRhPg0KPD94cGFja2V0IGVuZD0ndyc/Pvt+t+QAAAAhdEVYdENyZWF0aW9uIFRpbWUAMjAyNjowMjoyMyAxNDozOTo1NwTXhNkAAAZTSURBVHhe7Zo9TyRHEIZrzpKlkwOiCy8hxMhAjoiIT74EWQRYaAMjggv4IYQnCBA6AmQR+QdcZF3mAGNhS05IHBJdYFmyZNbBbe/11HRvd1dX9cdOP9JIs7N0vVUzb1f3AN2fv5xDY7w8wxcYmKJDGqyVWr9qJAzQqAgxA7x4/wFevP8A0jNR0wGLjqh+7YgZIDWaCXrnCci95ETpV2+Ax93t7nF3u4P0D34pqN4AJh53t/ElcVIteTao+hIG6ACge9zdhsfdbXJioehdwNIJRPVrRcIARWExQ2PGUhnAth9AJmhdQEPSAB2+kIME+4EsS55GlL6kAQBmDyDBQ+gx6wT65973idFf0ZwPRICF+uIGaJRNJ/THoIHTDEguEbn0fXQVRei3DsBLJ/RgfQnW9zEAXkN8jgGvX72B16/e4MsxYE0pfRx70WGlVH0fA5TIwmIz4nwQAVBiBY9ZtAcICkQgqFVpcOXl0ufSsVGEfm0dQPqmlEDwLI7BZADpBII3KjO4cnLpl1o/Fz19kwFKRPKBlIK08YzoBsiSgAepciq1flFq6QBjIMvSoBtAWjxLgRpN36DfOsDIqcEAseuy0fkVofK3HVFgA/gExAnYDi44Y3GA67QdqcC6QfrYADaCAxug7rJjNIGomRPSg6Tia4AxYLvh1AdCHSeFcQL6GmAw0INSCgdi/grjjasAr/vva4DceBXTMLKwE5kMgAcYBwbAFQcMsUIOX/C40PFVYTJAY0Qs+n8AErdvb3rr5dbxnujs0fWUlromrb0MtA4wcsQMsHq3Dqt363D79maKuwInSgcM3Qd/bgwRM0BqdBOo8xQog0sb3UasfvUGWDlf61bO1zrQTNDwp3oDmHjYuJ+fU2dGKKmWPBtUfXYDbB3vdVvHe93Dxj08bNyTEwtF7wKtE/jDboDS0PcGkgaslaUygG0/oJ83E/Rh/0WQzq22I1frcopfznz84Y8pfNKcAkC3erfe2xdI5KCMlaNeiNAX7wBqL5CSlfO1bqbZAdoUpkYtPbmWIJe+uAEaZSOyBJichnG1phhy6fvoKkrRbx2AEfUKjK+ngqLv7AAhrlrEd7/tAQDAj9/cADDNAN/c/v7vS5j8/i189cW/cPH1TwAB+r4aYPhrpA61flMsGxT9ajuAqcjc2DZaFCixKGOsHSA0UCi+M8AER24ufQ6NRZSiX1UHoDi8NlLXOOgA0uIu59vgysulz6VjozT9KjqA9E0pgdQzXzE3QK4EXKTKqdT6pamiA4wByjs8B709gOQMoBbHlZNLn0vHhktfIZWHTb91gJFTgwGiZkSu1sqFyt924J8PJfg10FcUx/Edh8FxQvHV9dWhxpMeh/GN4+wAXI6j7rJjNGuE63774uwA1CRwHAUlni2WCw4tSowSwHUocD1OAyjwQF9wPEocHIOCr65Ny3d8aeB6cB3OJaAEUrXDZcS1pAw6QGNcVNEBGnKwd4Cjk8vemnN2ejhoO5zoekpLXZPWXgaWrgPohsBmbAwR6wD7BxMAALi+ugAQnI0///psCpqODSn92lmaDqAMh8+lOTq5nOoH/l6aWP3qDbCz+dTtbD51kPjBLwvVG8CEazmQYP9gAvsHk/mMxN9LQ9VnN8DZ6WF3dnrYXV9dwPXVBTmxUPQuYOoE0vq1wm6A0jCZofGZpTKAbT+gn7cu0If9NVDn6ORymup1UAe/Gu4fTHr7AokclLFy1AsR+uIdQO0FUrKz+dTpmqn1dWJf02Jx6YsboFE2IkuAyWkYV2uKIZe+j66iFP3WARhRr8D4eioo+s4OEOKqRXz/1z8AAPDu5XMAhhkQmhdVP0RHxTSNKVW/yg5gKrAEbBstCpRYlDFWA1CCLeLdy+dz98VAzSlUv9T6qdj0rQYoEc4HUircxnMx2ANIi/uufRiuvFz6XDo2StOvogNI35QSSD3zFXMD5ErARaqcSq1fmio6wBigvMNz0NsDSM4AanFcObn0uXRsuPQVUnnY9FsHGDk1GCBqRuRqrVyo/G0H/vlQgl8DfUVxHN9xGBwnFF9dXx1qPOlxGN84zg7A5TjqLjtGEww3onS47rcvzg5ATQLHUVDi2WL5EqKJtULGlgSuQ4HrcXaAmJmLxXJByV9BrT83vvffaYAS8C2mMcS1pAyWgMa4+B+ng2kfjjusZgAAAABJRU5ErkJggg==');

// --- Debug shaders and geometry (lazily initialized on first toggle) ---

// ═══════════════════════════════════════════════════════════════════════════
// PROGRESS BAR RENDERER
// Pure screen-space bar drawn below the player. Fixed pixel dimensions,
// no projection distortion. Positioned by projecting player world pos to
// screen, then offsetting in pixels.
// ═══════════════════════════════════════════════════════════════════════════
let _progressBar = null; // { progress: 0-1 } or null when inactive

const _pbVS = `#version 300 es
  uniform vec4 uRect;     // x, y, halfW, halfH in NDC
  in vec2 aPos;           // unit quad: -1..1
  out vec2 vUV;
  void main() {
    vUV = aPos;
    vec2 ndc = uRect.xy + aPos * uRect.zw;
    gl_Position = vec4(ndc, 0.0, 1.0);
  }
`;
const _pbFS = `#version 300 es
  precision mediump float;
  uniform float uProgress;
  uniform float uAspect;
  uniform vec2 uBarPx;    // bar width, height in pixels
  uniform vec2 uBorderPx; // black px, white px
  uniform float uCornerR;
  uniform float uAlpha;
  uniform float uTime;
  uniform float uDuration;
  in vec2 vUV;
  out vec4 fragColor;
  void main() {
    vec2 p = abs(vUV);

    float cornerR = uCornerR;

    // Outer shape
    vec2 sz0 = vec2(1.0 - cornerR / uAspect, 1.0 - cornerR);
    vec2 d0 = max(p - sz0, 0.0);
    d0.x *= uAspect;
    float outerDist = length(d0) - cornerR;
    if (outerDist > 0.0) discard;

    // Black border inset (in UV space, converted from pixels)
    float blackInsetY = uBorderPx.x / (uBarPx.y * 0.5);
    float blackInsetX = uBorderPx.x / (uBarPx.x * 0.5);
    float cr1 = max(cornerR - blackInsetY, 0.02);
    vec2 sz1 = vec2(1.0 - blackInsetX - cr1 / uAspect, 1.0 - blackInsetY - cr1);
    vec2 d1 = max(p - max(sz1, 0.0), 0.0);
    d1.x *= uAspect;
    float whiteDist = length(d1) - cr1;

    // Medium border inset
    float totalInsetY = (uBorderPx.x + uBorderPx.y) / (uBarPx.y * 0.5);
    float totalInsetX = (uBorderPx.x + uBorderPx.y) / (uBarPx.x * 0.5);
    float cr2 = max(cornerR - totalInsetY, 0.01);
    vec2 sz2 = vec2(1.0 - totalInsetX - cr2 / uAspect, 1.0 - totalInsetY - cr2);
    vec2 d2 = max(p - max(sz2, 0.0), 0.0);
    d2.x *= uAspect;
    float innerDist = length(d2) - cr2;

    float whiteMask = smoothstep(0.005, -0.005, whiteDist);
    float innerMask = smoothstep(0.005, -0.005, innerDist);

    // Fill progress — slanted leading edge matching stripe angle
    // Stripe diagonal: (-vUV.x * uAspect * 3.0 + vUV.y)
    // Normalize so the slant spans the bar: at vUV.y=-1 to +1 the edge shifts by 2.0/(uAspect*3.0) in x
    float slantShift = 2.0 / (uAspect * 3.0); // how far the slant extends in x-space
    // Expand progress range so the angled edge fully clears the right side at 100%
    float fillEdge = -1.0 - slantShift + uProgress * (2.0 + slantShift * 3.0);
    float slantX = fillEdge + vUV.y / (uAspect * 3.0);
    float isFill = step(slantX, vUV.x);

    // White highlight on leading edge — smooth glow along the slant
    float edgeDist = vUV.x - slantX; // positive = inside fill, negative = outside
    float edgeLine = smoothstep(0.36, 0.0, abs(edgeDist)) * step(-0.01, edgeDist + 0.18);

    // Colors
    vec3 bgCol = vec3(0.10, 0.17, 0.10);
    vec3 fillCol = vec3(0.2, 1.0, 0.3);

    // Stripe speed derived from duration — stripes move at same rate as fill edge
    // Fill travels (2.0 + slantShift*3.0) in x over uDuration seconds
    // The diagonal axis multiplies x by uAspect*3.0, so scale speed to compensate
    float stripeSpeed = (2.0 + slantShift * 3.0) * uAspect * 3.0 / uDuration * 1.2;
    float stripeFreq = uAspect * 0.38;
    float stripe = sin((-vUV.x * uAspect * 3.0 + vUV.y - 1.15 + uTime * stripeSpeed) * stripeFreq);
    stripe = step(0.0, stripe);
    fillCol = mix(fillCol, fillCol * 0.65, stripe * 0.6);

    float fillMask = 1.0 - isFill; // 1 where filled, 0 where empty
    vec3 barCol = mix(bgCol, fillCol, fillMask);
    barCol = mix(barCol, vec3(1.0), edgeLine * 0.6 * fillMask);

    vec3 col = vec3(0.0);
    col = mix(col, vec3(0.13, 0.65, 0.195), whiteMask);
    col = mix(col, barCol, innerMask);

    float alpha = mix(0.2, 1.0, whiteMask) * uAlpha;
    fragColor = vec4(col, alpha);
  }
`;
const _pbProg = gl.createProgram();
{
  const vs = createShader(gl.VERTEX_SHADER, _pbVS);
  const fs = createShader(gl.FRAGMENT_SHADER, _pbFS);
  gl.attachShader(_pbProg, vs); gl.attachShader(_pbProg, fs);
  gl.linkProgram(_pbProg);
}
const _pbURect = gl.getUniformLocation(_pbProg, 'uRect');
const _pbUProgress = gl.getUniformLocation(_pbProg, 'uProgress');
const _pbUAspect = gl.getUniformLocation(_pbProg, 'uAspect');
const _pbUBarPx = gl.getUniformLocation(_pbProg, 'uBarPx');
const _pbUBorderPx = gl.getUniformLocation(_pbProg, 'uBorderPx');
const _pbUCornerR = gl.getUniformLocation(_pbProg, 'uCornerR');
const _pbUAlpha = gl.getUniformLocation(_pbProg, 'uAlpha');
const _pbUTime = gl.getUniformLocation(_pbProg, 'uTime');
const _pbUDuration = gl.getUniformLocation(_pbProg, 'uDuration');

// Unit quad
const _pbVBO = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, _pbVBO);
gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,-1, 1,-1, 1,1, -1,1]), gl.STATIC_DRAW);
const _pbIBO = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, _pbIBO);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array([0,1,2, 0,2,3]), gl.STATIC_DRAW);
const _pbVAO = gl.createVertexArray();
gl.bindVertexArray(_pbVAO);
gl.bindBuffer(gl.ARRAY_BUFFER, _pbVBO);
const _pbAPos = gl.getAttribLocation(_pbProg, 'aPos');
gl.enableVertexAttribArray(_pbAPos);
gl.vertexAttribPointer(_pbAPos, 2, gl.FLOAT, false, 0, 0);
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, _pbIBO);
gl.bindVertexArray(null);

// Fixed pixel border sizes
const PB_BLACK_PX = 1;
const PB_WHITE_PX = 1;
const PB_GAP_PX = 22; // gap below player screen position

function drawProgressBar(glCtx, proj, view, wx, wy, wz, progress, duration) {
  if (duration === undefined) duration = 2.5; // default similar to current feel
  // Project player feet to screen NDC
  const vx = view[0]*wx + view[4]*wy + view[8]*wz + view[12];
  const vy = view[1]*wx + view[5]*wy + view[9]*wz + view[13];
  const vz = view[2]*wx + view[6]*wy + view[10]*wz + view[14];
  const vw = view[3]*wx + view[7]*wy + view[11]*wz + view[15];
  const cx = proj[0]*vx + proj[4]*vy + proj[8]*vz + proj[12]*vw;
  const cy = proj[1]*vx + proj[5]*vy + proj[9]*vz + proj[13]*vw;
  const cw = proj[3]*vx + proj[7]*vy + proj[11]*vz + proj[15]*vw;
  if (cw <= 0) return;
  const ndcX = cx / cw;
  const ndcY = cy / cw;

  // World-space width: project an offset point to get zoom-consistent size
  const barWorldWidth = 0.82;
  const ox = wx + barWorldWidth * 0.5;
  const ovx = view[0]*ox + view[4]*wy + view[8]*wz + view[12];
  const ovy = view[1]*ox + view[5]*wy + view[9]*wz + view[13];
  const ovz = view[2]*ox + view[6]*wy + view[10]*wz + view[14];
  const ovw = view[3]*ox + view[7]*wy + view[11]*wz + view[15];
  const ocx = proj[0]*ovx + proj[4]*ovy + proj[8]*ovz + proj[12]*ovw;
  const ocw = proj[3]*ovx + proj[7]*ovy + proj[11]*ovz + proj[15]*ovw;
  let halfW = Math.abs(ocx / ocw - ndcX);

  // Height from aspect ratio
  const aspect = 4.0;
  let halfH = halfW / aspect * (canvas.width / canvas.height);

  // Enforce minimum bar size in pixels (minHeightPx is half-height)
  const minHeightPx = 10;
  const minHalfH = minHeightPx / canvas.height;
  if (halfH < minHalfH) {
    halfH = minHalfH;
    halfW = halfH * aspect * (canvas.height / canvas.width);
  }

  // Bar pixel dimensions for shader
  const barWidthPx = halfW * canvas.width;
  const barHeightPx = halfH * canvas.height;

  // Gap below player — world-space, with minimum pixel gap
  const gapWorldY = 0.28;
  const gy = wy - gapWorldY;
  const gvx = view[0]*wx + view[4]*gy + view[8]*wz + view[12];
  const gvy = view[1]*wx + view[5]*gy + view[9]*wz + view[13];
  const gvz = view[2]*wx + view[6]*gy + view[10]*wz + view[14];
  const gvw = view[3]*wx + view[7]*gy + view[11]*wz + view[15];
  const gcy = proj[1]*gvx + proj[5]*gvy + proj[9]*gvz + proj[13]*gvw;
  const gcw = proj[3]*gvx + proj[7]*gvy + proj[11]*gvz + proj[15]*gvw;
  let barNdcY = gcy / gcw;
  // Enforce minimum gap of 16px below player screen position
  const minGapNdc = 28 / canvas.height;
  if (ndcY - barNdcY < minGapNdc) {
    barNdcY = ndcY - minGapNdc;
  }

  // Scale borders — outer (black) scales linearly, inner (white) uses sqrt to stay thin, min 1px
  const minBarHeightPx = 10; // matches minHeightPx
  const borderScale = Math.max(1.0, barHeightPx / minBarHeightPx);
  const blackPx = Math.max(1.0, PB_BLACK_PX * Math.sqrt(borderScale));
  const whitePx = Math.max(1.0, PB_WHITE_PX * Math.sqrt(borderScale));

  // Corner radius - fixed proportion, not scaled
  const cornerR = 0.95;

  // Fade bar when zoomed out 3+ steps from default
  const cam = CameraController;
  const zoomOut = cam._zoomIdx - cam._zoomDefaultIdx; // positive = zoomed out
  const barAlpha = zoomOut >= 1 ? 0.4 : 1.0;

  glCtx.useProgram(_pbProg);
  glCtx.uniform4f(_pbURect, ndcX, barNdcY, halfW, halfH);
  glCtx.uniform1f(_pbUProgress, Math.max(0, Math.min(1, progress)));
  glCtx.uniform1f(_pbUAspect, aspect);
  glCtx.uniform2f(_pbUBarPx, barWidthPx, barHeightPx);
  glCtx.uniform2f(_pbUBorderPx, blackPx, whitePx);
  glCtx.uniform1f(_pbUCornerR, cornerR);
  glCtx.uniform1f(_pbUAlpha, barAlpha);
  glCtx.uniform1f(_pbUTime, _renderTime);
  glCtx.uniform1f(_pbUDuration, duration);
  glCtx.enable(glCtx.BLEND);
  glCtx.blendFunc(glCtx.SRC_ALPHA, glCtx.ONE_MINUS_SRC_ALPHA);
  glCtx.disable(glCtx.DEPTH_TEST);
  glCtx.bindVertexArray(_pbVAO);
  glCtx.drawElements(glCtx.TRIANGLES, 6, glCtx.UNSIGNED_SHORT, 0);
  glCtx.bindVertexArray(null);
  glCtx.disable(glCtx.BLEND);
}
// Instanced circle shader: per-instance center, radius, color
const dbgCircleVS_Src = `#version 300 es
  layout(location=0) in vec3 aPos;
  layout(location=1) in vec4 iCenterRadius;
  layout(location=2) in vec3 iColor;
  uniform mat4 uProj;
  uniform mat4 uView;
  out vec3 vColor;
  void main() {
    vec3 worldPos = iCenterRadius.xyz + vec3(aPos.x * iCenterRadius.w, 0.0, aPos.z * iCenterRadius.w);
    gl_Position = uProj * uView * vec4(worldPos, 1.0);
    vColor = iColor;
  }
`;
const dbgCircleFS_Src = `#version 300 es
  precision mediump float;
  in vec3 vColor;
  out vec4 fragColor;
  void main() {
    fragColor = vec4(vColor, 1.0);
  }
`;
// Batched line shader: vertex color per-line-point
const lineVSSource = `#version 300 es
  layout(location=0) in vec3 aPos;
  layout(location=1) in vec3 aColor;
  uniform mat4 uProj;
  uniform mat4 uView;
  out vec3 vColor;
  void main() {
    gl_Position = uProj * uView * vec4(aPos, 1.0);
    vColor = aColor;
  }
`;
const lineFSSource = `#version 300 es
  precision mediump float;
  in vec3 vColor;
  out vec4 fragColor;
  void main() {
    fragColor = vec4(vColor, 1.0);
  }
`;
const DBG_RING_SEGS = 12;
const DBG_DOTTED_SEGS = 6;
const DBG_CIRCLE_FLOATS = 7; // centerXYZ(3) + radius(1) + colorRGB(3)
const _dbgSolidBatch = new InstanceBatch(DBG_CIRCLE_FLOATS, 64);
const _dbgDottedBatch = new InstanceBatch(DBG_CIRCLE_FLOATS, 16);
// Debug line buffer: 6 floats per vertex (pos3 + color3), non-instanced.
// Uses InstanceBatch for growable buffer management (floats=6, capacity=vertices).
const _dbgLineBatch = new InstanceBatch(6, 256);

let _dbg = null;
function _ensureDbg() {
  if (_dbg) return _dbg;

  // --- Instanced circle program ---
  const dvs = createShader(gl.VERTEX_SHADER, dbgCircleVS_Src);
  const dfs = createShader(gl.FRAGMENT_SHADER, dbgCircleFS_Src);
  const dp = gl.createProgram();
  gl.attachShader(dp, dvs); gl.attachShader(dp, dfs); gl.linkProgram(dp);
  // Attrib locations fixed by layout qualifiers: aPos=0, iCenterRadius=1, iColor=2

  // --- Batched line program ---
  const lvs = createShader(gl.VERTEX_SHADER, lineVSSource);
  const lfs = createShader(gl.FRAGMENT_SHADER, lineFSSource);
  const lp = gl.createProgram();
  gl.attachShader(lp, lvs); gl.attachShader(lp, lfs); gl.linkProgram(lp);

  // --- Ring geometry (unit circle on XZ plane) ---
  const ringVerts = new Float32Array(DBG_RING_SEGS * 3);
  for (let i = 0; i < DBG_RING_SEGS; i++) {
    const a = (i / DBG_RING_SEGS) * Math.PI * 2;
    ringVerts[i * 3] = Math.cos(a); ringVerts[i * 3 + 1] = 0; ringVerts[i * 3 + 2] = Math.sin(a);
  }
  const ringVBO = gl.createBuffer();
  gl.bindBuffer(gl.ARRAY_BUFFER, ringVBO);
  gl.bufferData(gl.ARRAY_BUFFER, ringVerts, gl.STATIC_DRAW);

  // Dotted ring geometry
  const dottedVerts = new Float32Array(DBG_DOTTED_SEGS * 2 * 3);
  for (let i = 0; i < DBG_DOTTED_SEGS; i++) {
    const a0 = ((i * 2) / DBG_RING_SEGS) * Math.PI * 2;
    const a1 = ((i * 2 + 1) / DBG_RING_SEGS) * Math.PI * 2;
    dottedVerts[i * 6] = Math.cos(a0); dottedVerts[i * 6 + 1] = 0; dottedVerts[i * 6 + 2] = Math.sin(a0);
    dottedVerts[i * 6 + 3] = Math.cos(a1); dottedVerts[i * 6 + 4] = 0; dottedVerts[i * 6 + 5] = Math.sin(a1);
  }
  const dottedVBO = gl.createBuffer();
  gl.bindBuffer(gl.ARRAY_BUFFER, dottedVBO);
  gl.bufferData(gl.ARRAY_BUFFER, dottedVerts, gl.STATIC_DRAW);

  // Separate instance buffers for solid and dotted (avoids repack)
  // (using pre-created InstanceBatch objects)

  // Helper: build instanced circle VAO with given geometry VBO and instance buffer
  function makeCircleVAO(geomVBO, instBuf) {
    const vao = gl.createVertexArray();
    gl.bindVertexArray(vao);
    gl.bindBuffer(gl.ARRAY_BUFFER, geomVBO);
    gl.enableVertexAttribArray(0); // aPos
    gl.vertexAttribPointer(0, 3, gl.FLOAT, false, 0, 0);
    const circStride = DBG_CIRCLE_FLOATS * 4;
    gl.bindBuffer(gl.ARRAY_BUFFER, instBuf);
    gl.enableVertexAttribArray(1); // iCenterRadius
    gl.vertexAttribPointer(1, 4, gl.FLOAT, false, circStride, 0);
    gl.vertexAttribDivisor(1, 1);
    gl.enableVertexAttribArray(2); // iColor
    gl.vertexAttribPointer(2, 3, gl.FLOAT, false, circStride, 4 * 4);
    gl.vertexAttribDivisor(2, 1);
    gl.bindVertexArray(null);
    return vao;
  }

  const ringVAO = makeCircleVAO(ringVBO, _dbgSolidBatch.buf);
  const dottedVAO = makeCircleVAO(dottedVBO, _dbgDottedBatch.buf);

  // Batched line VAO (uses _dbgLineBatch.buf, 6 floats/vert: pos3 + color3)
  const dbgLineStride = _dbgLineBatch.floats * 4;
  const lineVAO = gl.createVertexArray();
  gl.bindVertexArray(lineVAO);
  gl.bindBuffer(gl.ARRAY_BUFFER, _dbgLineBatch.buf);
  gl.enableVertexAttribArray(0); // aPos
  gl.vertexAttribPointer(0, 3, gl.FLOAT, false, dbgLineStride, 0);
  gl.enableVertexAttribArray(1); // aColor
  gl.vertexAttribPointer(1, 3, gl.FLOAT, false, dbgLineStride, 3 * 4);
  gl.bindVertexArray(null);

  _dbg = {
    dbgProg: dp,
    dbgUProj: gl.getUniformLocation(dp, 'uProj'),
    dbgUView: gl.getUniformLocation(dp, 'uView'),
    dbgRingVAO: ringVAO, dbgDottedVAO: dottedVAO,
    lineProg: lp,
    lineUProj: gl.getUniformLocation(lp, 'uProj'),
    lineUView: gl.getUniformLocation(lp, 'uView'),
    lineVAO,
  };
  return _dbg;
}

// ============================================================
// Bitmap Font Text Renderer
// 5x7 pixel font, ASCII 32-126. Renders textured quads in GL.
// Usage:
//   textBegin(proj, view)           â€” call once per frame before drawing text
//   textWorld(str, x, y, z, opts)   â€” draw string at world position (billboarded)
//   textScreen(str, ndcX, ndcY, opts) â€” draw string at screen NDC position
//   textEnd()                       â€” flush and draw all queued text
// opts: { scale, r, g, b, a, shadow }
// ============================================================

// --- 5x7 pixel font data (each char = 5 columns, 7 rows, stored as 5 bytes per char) ---
const FONT_FIRST = 32, FONT_LAST = 126, FONT_W = 5, FONT_H = 7;
const FONT_DATA = (function() {
  // Each character: 5 columns, each column is 7 bits (bit 0 = top row)
  const raw = {
    32:[0,0,0,0,0],33:[0,0,95,0,0],34:[0,7,0,7,0],35:[20,127,20,127,20],
    36:[36,42,127,42,18],37:[35,19,8,100,98],38:[54,73,86,32,80],39:[0,0,7,0,0],
    40:[0,28,34,65,0],41:[0,65,34,28,0],42:[42,28,127,28,42],43:[8,8,62,8,8],
    44:[0,128,96,0,0],45:[8,8,8,8,8],46:[0,96,96,0,0],47:[32,16,8,4,2],
    48:[62,81,73,69,62],49:[0,66,127,64,0],50:[98,81,73,73,70],51:[34,65,73,73,54],
    52:[24,20,18,127,16],53:[39,69,69,69,57],54:[60,74,73,73,48],55:[1,1,113,9,7],
    56:[54,73,73,73,54],57:[6,73,73,41,30],58:[0,54,54,0,0],59:[0,128,118,0,0],
    60:[8,20,34,65,0],61:[20,20,20,20,20],62:[0,65,34,20,8],63:[2,1,89,9,6],
    64:[62,65,93,89,78],65:[126,9,9,9,126],66:[127,73,73,73,54],67:[62,65,65,65,34],
    68:[127,65,65,65,62],69:[127,73,73,73,65],70:[127,9,9,9,1],71:[62,65,73,73,58],
    72:[127,8,8,8,127],73:[0,65,127,65,0],74:[32,64,65,63,1],75:[127,8,20,34,65],
    76:[127,64,64,64,64],77:[127,2,4,2,127],78:[127,2,4,8,127],79:[62,65,65,65,62],
    80:[127,9,9,9,6],81:[62,65,81,33,94],82:[127,9,25,41,70],83:[38,73,73,73,50],
    84:[1,1,127,1,1],85:[63,64,64,64,63],86:[31,32,64,32,31],87:[63,64,48,64,63],
    88:[99,20,8,20,99],89:[7,8,112,8,7],90:[97,81,73,69,67],91:[0,127,65,65,0],
    92:[2,4,8,16,32],93:[0,65,65,127,0],94:[4,2,1,2,4],95:[64,64,64,64,64],
    96:[0,1,2,0,0],97:[32,84,84,84,120],98:[127,68,68,68,56],99:[56,68,68,68,40],
    100:[56,68,68,68,127],101:[56,84,84,84,24],102:[8,126,9,9,2],103:[24,164,164,164,124],
    104:[127,4,4,4,120],105:[0,68,125,64,0],106:[32,64,64,61,0],107:[127,16,40,68,0],
    108:[0,65,127,64,0],109:[124,4,120,4,120],110:[124,4,4,4,120],111:[56,68,68,68,56],
    112:[252,36,36,36,24],113:[24,36,36,36,252],114:[124,8,4,4,8],115:[72,84,84,84,36],
    116:[4,63,68,68,32],117:[60,64,64,64,124],118:[28,32,64,32,28],119:[60,64,48,64,60],
    120:[68,40,16,40,68],121:[28,160,160,160,124],122:[68,100,84,76,68],123:[0,8,54,65,0],
    124:[0,0,119,0,0],125:[0,65,54,8,0],126:[8,4,8,16,8],
  };
  // Build atlas: 96 chars in a 16x6 grid, each cell = 6x8 px (5x7 + 1px padding)
  const CELL_W = 6, CELL_H = 8, COLS = 16, ROWS = 6;
  const W = COLS * CELL_W, H = ROWS * CELL_H;
  const atlas = new Uint8Array(W * H * 4); // RGBA
  for (let code = FONT_FIRST; code <= FONT_LAST; code++) {
    const cols = raw[code];
    if (!cols) continue;
    const idx = code - FONT_FIRST;
    const cellX = (idx % COLS) * CELL_W;
    const cellY = Math.floor(idx / COLS) * CELL_H;
    for (let col = 0; col < 5; col++) {
      for (let row = 0; row < 7; row++) {
        if (cols[col] & (1 << row)) {
          const px = cellX + col;
          const py = cellY + row;
          const off = (py * W + px) * 4;
          atlas[off] = atlas[off+1] = atlas[off+2] = atlas[off+3] = 255;
        }
      }
    }
  }
  return { atlas, W, H, CELL_W, CELL_H, COLS, ROWS };
})();

// Upload font atlas texture
const fontTex = gl.createTexture();
gl.bindTexture(gl.TEXTURE_2D, fontTex);
gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, FONT_DATA.W, FONT_DATA.H, 0, gl.RGBA, gl.UNSIGNED_BYTE, FONT_DATA.atlas);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);

// Text shader
const textVS = `#version 300 es
  in vec2 aPos;
  in vec2 aUV;
  in vec4 aColor;
  out vec2 vUV;
  out vec4 vColor;
  void main() {
    vUV = aUV;
    vColor = aColor;
    gl_Position = vec4(aPos, 0.0, 1.0);
  }
`;
const textFS = `#version 300 es
  precision mediump float;
  out vec4 fragColor;
  in vec2 vUV;
  in vec4 vColor;
  uniform sampler2D uFont;
  void main() {
    float a = texture(uFont, vUV).a;
    if (a < 0.5) discard;
    fragColor = vec4(vColor.rgb, vColor.a * a);
  }
`;
const textProg = (function() {
  const vs = gl.createShader(gl.VERTEX_SHADER);
  gl.shaderSource(vs, textVS); gl.compileShader(vs);
  const fs = gl.createShader(gl.FRAGMENT_SHADER);
  gl.shaderSource(fs, textFS); gl.compileShader(fs);
  const p = gl.createProgram();
  gl.attachShader(p, vs); gl.attachShader(p, fs); gl.linkProgram(p);
  return p;
})();
const txtAPos = gl.getAttribLocation(textProg, 'aPos');
const txtAUV = gl.getAttribLocation(textProg, 'aUV');
const txtAColor = gl.getAttribLocation(textProg, 'aColor');
const txtUFont = gl.getUniformLocation(textProg, 'uFont');

// Dynamic VBO for text quads (pos2 + uv2 + color4 = 8 floats per vert, 4 verts per char)
const TXT_MAX_CHARS = 512;
const txtVerts = new Float32Array(TXT_MAX_CHARS * 4 * 8);
const txtIdx = new Uint16Array(TXT_MAX_CHARS * 6);
for (let i = 0; i < TXT_MAX_CHARS; i++) {
  const b = i * 4;
  txtIdx[i*6] = b; txtIdx[i*6+1] = b+1; txtIdx[i*6+2] = b+2;
  txtIdx[i*6+3] = b; txtIdx[i*6+4] = b+2; txtIdx[i*6+5] = b+3;
}
const txtVBO = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, txtVBO);
gl.bufferData(gl.ARRAY_BUFFER, txtVerts.byteLength, gl.DYNAMIC_DRAW);
const txtIBO = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, txtIBO);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, txtIdx, gl.STATIC_DRAW);

const txtVAO = gl.createVertexArray();
gl.bindVertexArray(txtVAO);
gl.bindBuffer(gl.ARRAY_BUFFER, txtVBO);
gl.enableVertexAttribArray(txtAPos);
gl.vertexAttribPointer(txtAPos, 2, gl.FLOAT, false, 8 * 4, 0);
gl.enableVertexAttribArray(txtAUV);
gl.vertexAttribPointer(txtAUV, 2, gl.FLOAT, false, 8 * 4, 2 * 4);
gl.enableVertexAttribArray(txtAColor);
gl.vertexAttribPointer(txtAColor, 4, gl.FLOAT, false, 8 * 4, 4 * 4);
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, txtIBO);
gl.bindVertexArray(null);

let _txtCharCount = 0;
let _txtProj = null, _txtView = null;

// Begin text batch for this frame
function textBegin(proj, view) {
  _txtCharCount = 0;
  _txtProj = proj;
  _txtView = view;
}

// Project world pos to NDC (writes to preallocated _ndcResult)
const _ndcResult = [0, 0];
function _worldToNDC(wx, wy, wz) {
  const v = _txtView, p = _txtProj;
  const vx = v[0]*wx + v[4]*wy + v[8]*wz + v[12];
  const vy = v[1]*wx + v[5]*wy + v[9]*wz + v[13];
  const vz = v[2]*wx + v[6]*wy + v[10]*wz + v[14];
  const vw = v[3]*wx + v[7]*wy + v[11]*wz + v[15];
  const cx = p[0]*vx + p[4]*vy + p[8]*vz + p[12]*vw;
  const cy = p[1]*vx + p[5]*vy + p[9]*vz + p[13]*vw;
  const cw = p[3]*vx + p[7]*vy + p[11]*vz + p[15]*vw;
  if (cw === 0) return false;
  _ndcResult[0] = cx / cw;
  _ndcResult[1] = cy / cw;
  return true;
}

// Add a single glyph quad in NDC space
function _addGlyph(code, ndcX, ndcY, glyphW, glyphH, r, g, b, a) {
  if (_txtCharCount >= TXT_MAX_CHARS) return;
  const idx = code - FONT_FIRST;
  if (idx < 0 || idx > FONT_LAST - FONT_FIRST) return;
  const col = idx % FONT_DATA.COLS;
  const row = Math.floor(idx / FONT_DATA.COLS);
  const u0 = (col * FONT_DATA.CELL_W) / FONT_DATA.W;
  const v0 = (row * FONT_DATA.CELL_H) / FONT_DATA.H;
  const u1 = (col * FONT_DATA.CELL_W + FONT_W) / FONT_DATA.W;
  const v1 = (row * FONT_DATA.CELL_H + FONT_H) / FONT_DATA.H;

  const off = _txtCharCount * 4 * 8;
  // Bottom-left, bottom-right, top-right, top-left
  const x0 = ndcX, x1 = ndcX + glyphW, y0 = ndcY, y1 = ndcY + glyphH;
  // v0=top of glyph in texture, v1=bottom â€” flip Y since NDC Y is up
  txtVerts[off]    = x0; txtVerts[off+1]  = y0; txtVerts[off+2]  = u0; txtVerts[off+3]  = v1; txtVerts[off+4]  = r; txtVerts[off+5]  = g; txtVerts[off+6]  = b; txtVerts[off+7]  = a;
  txtVerts[off+8]  = x1; txtVerts[off+9]  = y0; txtVerts[off+10] = u1; txtVerts[off+11] = v1; txtVerts[off+12] = r; txtVerts[off+13] = g; txtVerts[off+14] = b; txtVerts[off+15] = a;
  txtVerts[off+16] = x1; txtVerts[off+17] = y1; txtVerts[off+18] = u1; txtVerts[off+19] = v0; txtVerts[off+20] = r; txtVerts[off+21] = g; txtVerts[off+22] = b; txtVerts[off+23] = a;
  txtVerts[off+24] = x0; txtVerts[off+25] = y1; txtVerts[off+26] = u0; txtVerts[off+27] = v0; txtVerts[off+28] = r; txtVerts[off+29] = g; txtVerts[off+30] = b; txtVerts[off+31] = a;
  _txtCharCount++;
}

// Draw text at a world position (billboarded â€” always faces camera)
// opts: { scale, r, g, b, a, shadow, center }
function textWorld(str, wx, wy, wz, opts) {
  if (!_worldToNDC(wx, wy, wz)) return;
  textScreen(str, _ndcResult[0], _ndcResult[1], opts || {});
}

// Draw text at NDC position (-1 to 1)
// opts: { scale, r, g, b, a, shadow, center }
function textScreen(str, ndcX, ndcY, opts) {
  const o = opts || {};
  const pixH = (o.scale || 10) * 2 / canvas.height; // glyph height in NDC
  const pixW = pixH * (FONT_W / FONT_H) * (canvas.height / canvas.width); // aspect-corrected width
  const spacing = pixW * 1.2; // 1 pixel gap between chars
  const r = o.r !== undefined ? o.r : 1;
  const g = o.g !== undefined ? o.g : 1;
  const b = o.b !== undefined ? o.b : 1;
  const a = o.a !== undefined ? o.a : 1;

  // Center text horizontally if requested (default true)
  const center = o.center !== undefined ? o.center : true;
  let startX = ndcX;
  if (center) startX -= (str.length * spacing) * 0.5;

  // Shadow pass (1px offset down-right)
  if (o.shadow !== false) {
    const sd = pixH * 0.15;
    for (let i = 0; i < str.length; i++) {
      const code = str.charCodeAt(i);
      if (code === 32) continue;
      _addGlyph(code, startX + i * spacing + sd, ndcY - sd, pixW, pixH, 0, 0, 0, a * 0.6);
    }
  }

  // Main pass
  for (let i = 0; i < str.length; i++) {
    const code = str.charCodeAt(i);
    if (code === 32) continue;
    _addGlyph(code, startX + i * spacing, ndcY, pixW, pixH, r, g, b, a);
  }
}

// Flush all queued text quads
function textEnd() {
  if (_txtCharCount === 0) return;
  gl.useProgram(textProg);
  gl.enable(gl.BLEND);
  gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);
  gl.disable(gl.DEPTH_TEST);

  gl.bindVertexArray(txtVAO);
  gl.bindBuffer(gl.ARRAY_BUFFER, txtVBO);
  gl.bufferSubData(gl.ARRAY_BUFFER, 0, txtVerts.subarray(0, _txtCharCount * 4 * 8));

  gl.activeTexture(gl.TEXTURE0);
  gl.bindTexture(gl.TEXTURE_2D, fontTex);
  gl.uniform1i(txtUFont, 0);

  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, txtIBO);
  gl.drawElements(gl.TRIANGLES, _txtCharCount * 6, gl.UNSIGNED_SHORT, 0);

  gl.bindVertexArray(null);
  gl.enable(gl.DEPTH_TEST);
  gl.disable(gl.BLEND);
  _txtCharCount = 0;
}

// Model matrix: TRS with per-axis scale
// Compute NDC depth [0,1] for a world position given proj and view matrices
// Used for flat depth override on trees and player (prevents Z-fighting)
function computeFlatDepth(projMat, viewMat, wx, wy, wz) {
  // viewMat * worldPos
  const vx = viewMat[0]*wx + viewMat[4]*wy + viewMat[8]*wz + viewMat[12];
  const vy = viewMat[1]*wx + viewMat[5]*wy + viewMat[9]*wz + viewMat[13];
  const vz = viewMat[2]*wx + viewMat[6]*wy + viewMat[10]*wz + viewMat[14];
  const vw = viewMat[3]*wx + viewMat[7]*wy + viewMat[11]*wz + viewMat[15];
  // projMat * viewPos
  const cz = projMat[2]*vx + projMat[6]*vy + projMat[10]*vz + projMat[14]*vw;
  const cw = projMat[3]*vx + projMat[7]*vy + projMat[11]*vz + projMat[15]*vw;
  return (cz / cw) * 0.5 + 0.5;
}

// Precompute rock world data â€” now per-region

// Per-region biome and config assignment â€” every region explicitly defined
const regionBiomeMap = new Map(); // gx*1000+gz -> { biome, configIdx }
// Row gz=-1 (top)
regionBiomeMap.set(-1 * 1000 + -1, { biome: 'rock', configIdx: 2 });
regionBiomeMap.set( 0 * 1000 + -1, { biome: 'forest', configIdx: 5 });
regionBiomeMap.set( 1 * 1000 + -1, { biome: 'desert', configIdx: 1 });
// Row gz=0 (middle)
regionBiomeMap.set(-1 * 1000 +  0, { biome: 'forest', configIdx: 1 });
regionBiomeMap.set( 0 * 1000 +  0, { biome: 'forest', configIdx: 3 });
regionBiomeMap.set( 1 * 1000 +  0, { biome: 'desert', configIdx: 4 });
// Row gz=1 (bottom)
regionBiomeMap.set(-1 * 1000 +  1, { biome: 'desert', configIdx: 1 });
regionBiomeMap.set( 0 * 1000 +  1, { biome: 'forest', configIdx: 4 });
regionBiomeMap.set( 1 * 1000 +  1, { biome: 'forest', configIdx: 4 });

function getRegionAssignment(gx, gz) {
  const key = gx * 1000 + gz;
  return regionBiomeMap.get(key) || null;
}


// Build all world data for a region at grid position (gx, gz)
function buildRegion(gx, gz) {
  const assignment = getRegionAssignment(gx, gz);
  const biome = BIOMES[assignment.biome];
  const configIdx = assignment.configIdx;
  const config = biome.configs[configIdx];
  const hills = config.terrain.hills || [];
  const ox = gx * REGION_SIZE; // world offset x
  const oz = gz * REGION_SIZE; // world offset z

  // Terrain mesh
  const terrain = buildTerrainMesh(hills, gx, gz);

  // Tree data — load from config into mutable working objects.
  // Config data is the source of truth and must never be mutated;
  // border nudge / edge attraction / spawn clearing all modify these copies.
  let trees = config.items.trees.map(t => ({
    x: t.x, z: t.z, v: t.v,
    cols: t.cols.map(c => [c[0], c[1], c[2]]),
  }));
  // Compute per-edge border margins: non-zero only where neighbor is a different biome.
  // borderMargin is a biome-level property (UV units). Objects near these edges are
  // filtered out to prevent visual overlap into a different biome's region.
  const biomeName = assignment.biome;
  const baseMargin = biome.borderMargin || 0.03;
  const nLeftA  = getRegionAssignment(gx - 1, gz);
  const nRightA = getRegionAssignment(gx + 1, gz);
  const nTopA   = getRegionAssignment(gx, gz - 1);
  const nBotA   = getRegionAssignment(gx, gz + 1);
  const nLeft  = nLeftA  ? nLeftA.biome  : null;
  const nRight = nRightA ? nRightA.biome : null;
  const nTop   = nTopA   ? nTopA.biome   : null;
  const nBot   = nBotA   ? nBotA.biome   : null;
  // null neighbor = world edge. Only zero margin at top-left (-X) and
  // top-right (-Z) world edges (they face away from camera, nothing beyond).
  // Bottom-left (+Z) and bottom-right (+X) edges keep normal margins.
  const isTopLeftEdge  = (gx === -GRID_HALF);  // left side is -X world edge
  const isTopRightEdge = (gz === -GRID_HALF);   // top side is -Z world edge
  const borderLeft  = nLeft  === biomeName || (nLeft  === null && isTopLeftEdge)  ? 0 : baseMargin;
  const borderRight = nRight === biomeName ? 0 : baseMargin;
  const borderTop   = nTop   === biomeName || (nTop   === null && isTopRightEdge) ? 0 : baseMargin;
  const borderBot   = nBot   === biomeName ? 0 : baseMargin;
  const hasBorder = borderLeft > 0 || borderRight > 0 || borderTop > 0 || borderBot > 0;
  const isForest = biomeName === 'forest';

  // Filter trees at border margins: if a tree's collider is >=55% inside
  // the margin, nudge it inward to fit. Otherwise remove it.
  // For multi-collider trees (fir clusters), the nudge is the worst-case
  // Ensure every tree has cols; regenerate after position changes
  function refreshCols(t) {
    t.cols = getCollidersUV(t.x, t.z, t.v);
    return t.cols;
  }

  // Border nudge: push trees inward or remove if too far out
  {
    const nudgeThreshold = 0.55;
    trees = trees.filter(t => {
      const cols = t.cols;
      let worstL = 0, worstR = 0, worstT = 0, worstB = 0;
      let minMaxOverlap = Infinity;
      for (const [cx, cz, r] of cols) {
        minMaxOverlap = Math.min(minMaxOverlap, r * (1 - nudgeThreshold));
        const overL = borderLeft  - (cx - r);
        const overR = (cx + r) - (1 - borderRight);
        const overT = borderTop  - (cz - r);
        const overB = (cz + r) - (1 - borderBot);
        if (overL > 0) worstL = Math.max(worstL, overL);
        if (overR > 0) worstR = Math.max(worstR, overR);
        if (overT > 0) worstT = Math.max(worstT, overT);
        if (overB > 0) worstB = Math.max(worstB, overB);
      }
      if (worstL > minMaxOverlap || worstR > minMaxOverlap ||
          worstT > minMaxOverlap || worstB > minMaxOverlap) return false;
      const nudgeX = worstL - worstR;
      const nudgeZ = worstT - worstB;
      if (nudgeX !== 0 || nudgeZ !== 0) {
        t.x += nudgeX;
        t.z += nudgeZ;
        const nudgedCols = refreshCols(t);
        let ok = true;
        for (const [cx, cz, r] of nudgedCols) {
          if (cx - r < borderLeft  || cx + r > 1 - borderRight ||
              cz - r < borderTop   || cz + r > 1 - borderBot) {
            ok = false; break;
          }
        }
        if (!ok) {
          t.x -= nudgeX;
          t.z -= nudgeZ;
          refreshCols(t);
          return false;
        }
      }
      return true;
    });
  }
  // Forest edge attraction
  if (isForest && hasBorder) {
    const attractDist = 0.08;

    function treeExtent(t) {
      const cols = t.cols;
      if (!cols.length) return null;
      let minX = Infinity, maxX = -Infinity, minZ = Infinity, maxZ = -Infinity;
      for (const [cx, cz, r] of cols) {
        minX = Math.min(minX, cx - r);
        maxX = Math.max(maxX, cx + r);
        minZ = Math.min(minZ, cz - r);
        maxZ = Math.max(maxZ, cz + r);
      }
      return { minX, maxX, minZ, maxZ };
    }

    function wouldCollide(t, dx, dz, tIdx) {
      const movedCols = getCollidersUV(t.x + dx, t.z + dz, t.v);
      for (let j = 0; j < trees.length; j++) {
        if (j === tIdx) continue;
        if (collidersOverlap(movedCols, trees[j].cols)) return true;
      }
      return false;
    }

    const edgeCandidates = [];
    for (let i = 0; i < trees.length; i++) {
      const ext = treeExtent(trees[i]);
      if (!ext) continue;
      let bestDist = Infinity, bestAxis = null, bestShift = 0;
      if (borderLeft > 0) {
        const d = ext.minX - borderLeft;
        if (d > 0 && d < attractDist && d < bestDist) { bestDist = d; bestAxis = 'x'; bestShift = -d; }
      }
      if (borderRight > 0) {
        const d = (1 - borderRight) - ext.maxX;
        if (d > 0 && d < attractDist && d < bestDist) { bestDist = d; bestAxis = 'x'; bestShift = d; }
      }
      if (borderTop > 0) {
        const d = ext.minZ - borderTop;
        if (d > 0 && d < attractDist && d < bestDist) { bestDist = d; bestAxis = 'z'; bestShift = -d; }
      }
      if (borderBot > 0) {
        const d = (1 - borderBot) - ext.maxZ;
        if (d > 0 && d < attractDist && d < bestDist) { bestDist = d; bestAxis = 'z'; bestShift = d; }
      }
      if (bestAxis) edgeCandidates.push({ idx: i, dist: bestDist, axis: bestAxis, shift: bestShift });
    }

    edgeCandidates.sort((a, b) => a.dist - b.dist);
    for (const c of edgeCandidates) {
      const t = trees[c.idx];
      const dx = c.axis === 'x' ? c.shift : 0;
      const dz = c.axis === 'z' ? c.shift : 0;
      if (wouldCollide(t, dx, dz, c.idx)) continue;
      const ext = treeExtent(t);
      if (!ext) continue;
      const newMinX = ext.minX + dx, newMaxX = ext.maxX + dx;
      const newMinZ = ext.minZ + dz, newMaxZ = ext.maxZ + dz;
      if (newMinX < borderLeft || newMaxX > 1 - borderRight ||
          newMinZ < borderTop  || newMaxZ > 1 - borderBot) continue;
      t.x += dx;
      t.z += dz;
      refreshCols(t);
    }
  }
  // Clear spawn area
  if (gx === 0 && gz === 0) {
    const spawnU = 0.46, spawnV = 0.46, spawnClearBase = 0.09;
    trees = trees.filter(t => {
      const cols = t.cols;
      for (const [cx, cz, r] of cols) {
        const du = cx - spawnU, dv = cz - spawnV;
        if (Math.sqrt(du * du + dv * dv) - r <= spawnClearBase) return false;
      }
      return true;
    });
  }
  const treePositions = trees.map((t, i) => {
    const wx = -S + t.x * 2 * S + ox;
    const wz = -S + t.z * 2 * S + oz;
    const wy = getBlendedHeight(hills, t.x, t.z, gx, gz);
    const variant = expandVariant(t.v);
    const tv = TREE_VARIANTS[variant] || TREE_VARIANTS.dry;
    // x,y,z = primary collider center (the "real" position of this tree for game logic)
    // billX,billY,billZ = billboard anchor (visual rendering only)
    const colX = wx + tv.colOff[0];
    const colZ = wz + tv.colOff[1];
    const colY = getBlendedHeight(hills, (colX - ox + S) / (2*S), (colZ - oz + S) / (2*S), gx, gz);
    const pos = {
      x: colX, y: colY, z: colZ,         // game position = collider center
      colX: colX, colZ: colZ, colR: tv.colR, // collider (matches x,z)
      billX: wx, billY: wy, billZ: wz,   // billboard visual anchor
      // Pre-baked instance data (14 floats): avoids per-frame packing for static trees
      _inst: new Float32Array([wx, wy, wz, 1.0, 0, 0, 0, 0, 1.0, 1.0, colX, colY, colZ, 0]),
    };
    // Multi-collider support: if colGroups defined, store extra colliders
    if (tv.colGroups) {
      pos.extraCols = tv.colGroups.slice(1).map(cg => ({
        colX: wx + cg.colOff[0], colZ: wz + cg.colOff[1], colR: cg.colR
      }));
    }
    return pos;
  });

  // Rock data - filter by collider vs region bounds [0,1]
  const filteredRocks = config.items.rocks.filter(r => {
    return collidersInBounds(r.cols);
  });
  const rocks = filteredRocks.map((r, i) => {
    const wx = -S + r.x * 2 * S + ox;
    const wz = -S + r.z * 2 * S + oz;
    const wy = getBlendedHeight(hills, r.x, r.z, gx, gz);
    const rockH = ROCK_BASE_HEIGHT * r.scale;
    return { x: wx, y: wy, z: wz, visY: wy + rockH * 0.5, colX: wx, colZ: wz, colR: r.cols[0][2] * REGION_SIZE, rotY: r.rotY, scale: rockH, h: rockH };
  });

  // Stick data - filter by collider vs region bounds [0,1]
  const filteredSticks = (config.items.sticks || []).filter(st => {
    return collidersInBounds(st.cols);
  });
  const sticks = filteredSticks.map(st => {
    const wx = -S + st.x * 2 * S + ox;
    const wz = -S + st.z * 2 * S + oz;
    const wy = getBlendedHeight(hills, st.x, st.z, gx, gz);
    // x,y,z = collider center (game position)
    // visX,visY,visZ = visual mesh position (tiny Y lift to prevent z-fighting)
    // Collider centered on anchor (mesh is centered on origin)
    const colR = st.cols[0][2] * REGION_SIZE;
    return { x: wx, y: wy, z: wz, visX: wx, visY: wy, visZ: wz, colX: wx, colZ: wz, colR: colR, rotY: st.rotY, scale: STICK_BASE_SCALE * st.scale, flip: st.flip || 0 };
  });

  // Minable data
  const minables = config.items.minables.map(cluster => {
    const baseWx = -S + cluster.x * 2 * S + ox;
    const baseWz = -S + cluster.z * 2 * S + oz;
    const mat = cluster.material;
    return {
      material: mat,
      cubes: cluster.cubes.map(c => {
        const wx = baseWx + c.dx * 2 * S;
        const wz = baseWz + c.dz * 2 * S;
        const sy = c.sy * 0.7;
        const cubeU = cluster.x + c.dx;
        const cubeV = cluster.z + c.dz;
        const cubeWy = getBlendedHeight(hills, cubeU, cubeV, gx, gz);
        return {
          x: wx, y: cubeWy + sy * 0.5, z: wz,
          rotY: c.rotY, rotZ: c.rotZ,
          sx: c.sx * 0.7, sy: sy, sz: c.sz * 0.7,
          glowSize: Math.max(c.sx, c.sy, c.sz) * 0.7 * 1.8,
          health: 1.0, mined: false,
        };
      }),
      // Convert baked UV colliders to world space
      colliders: cluster.colliders.map(col => {
        const wx = baseWx + col.dx * 2 * S;
        const wz = baseWz + col.dz * 2 * S;
        const wr = col.r * 2 * S;
        const wy = getBlendedHeight(hills, cluster.x + col.dx, cluster.z + col.dz, gx, gz);
        return { x: wx, z: wz, radius: wr, colX: wx, colZ: wz, colR: wr, colY: wy };
      }),
    };
  });

  // === Bake mineral mask per region on CPU ===
  // JS hash matching GLSL: hash(vec2 p) { p=fract(p*vec2(123.34,456.21)); p+=dot(p,p+45.32); return fract(p.x*p.y); }
  function fract(v) { return ((v % 1) + 1) % 1; }
  function jsHash(px, py) {
    let x = fract(px * 123.34), y = fract(py * 456.21);
    const d = x * (x + 45.32) + y * (y + 45.32);
    x = fract(x + d); y = fract(y + d);
    return fract(x * y);
  }

  function bakeMineralMask(glCtx, maskData, MASK_RES) {
    const tex = glCtx.createTexture();
    glCtx.bindTexture(glCtx.TEXTURE_2D, tex);
    glCtx.texImage2D(glCtx.TEXTURE_2D, 0, glCtx.LUMINANCE, MASK_RES, MASK_RES, 0, glCtx.LUMINANCE, glCtx.UNSIGNED_BYTE, maskData);
    glCtx.texParameteri(glCtx.TEXTURE_2D, glCtx.TEXTURE_MIN_FILTER, glCtx.NEAREST);
    glCtx.texParameteri(glCtx.TEXTURE_2D, glCtx.TEXTURE_MAG_FILTER, glCtx.NEAREST);
    glCtx.texParameteri(glCtx.TEXTURE_2D, glCtx.TEXTURE_WRAP_S, glCtx.CLAMP_TO_EDGE);
    glCtx.texParameteri(glCtx.TEXTURE_2D, glCtx.TEXTURE_WRAP_T, glCtx.CLAMP_TO_EDGE);
    return tex;
  }

  // Bake mineral mask texture from collider circles
  // 64x64 texture, each pixel stores the mask value (0-255)
  const MASK_RES = 128;
  const maskData = new Uint8Array(MASK_RES * MASK_RES);
  // Collect all circles for this region (in region-local UV 0-1 space)
  const blueCircles = [];
  for (const cluster of minables) {
    const mat = MINABLE_MATERIALS[cluster.material];
    if (!mat.crystalGroundOverlay) continue;
    for (const col of cluster.colliders) {
      const mult = col.radius < 0.08 ? 3.0 : col.radius < 0.15 ? 2.2 : 1.5;
      const u = (col.x - ox + S) / (2 * S);
      const v = (col.z - oz + S) / (2 * S);
      const rUV = (col.radius * mult) / (2 * S);
      blueCircles.push({ u, v, r: rUV });

      // Scatter small satellite squares around edges on all sides
      // Seeded from collider position for determinism
      let seed = (col.x * 127.1 + col.z * 311.7) * 43758.5453;
      const nextRand = () => { seed = (seed * 16807 + 0.5) % 2147483647; return (seed & 0xffff) / 0xffff; };
      const numSatellites = 5 + Math.floor(nextRand() * 4); // 5-8 per collider
      for (let s = 0; s < numSatellites; s++) {
        // Random angle around the square
        const angle = nextRand() * Math.PI * 2;
        // Distance: just outside the edge, 1.1-2.2x radius
        const distMult = 1.1 + nextRand() * 1.1;
        const dist = rUV * distMult;
        const su = u + Math.cos(angle) * dist;
        const sv = v + Math.sin(angle) * dist;
        // Size: smaller further away (30%-15% of parent radius)
        const sizeFrac = 0.30 - (distMult - 1.1) * 0.14;
        const sr = rUV * Math.max(sizeFrac, 0.10);
        blueCircles.push({ u: su, v: sv, r: sr });
      }
    }
  }
  // Paint mask by iterating each circle's bounding box (much faster than
  // testing every pixel against every circle). Since the test is an axis-aligned
  // square (max(|du|,|dv|) < r), the bounding box in pixels is exact.
  for (const c of blueCircles) {
    const pxMin = Math.max(0, Math.floor((c.u - c.r) * MASK_RES));
    const pxMax = Math.min(MASK_RES - 1, Math.floor((c.u + c.r) * MASK_RES));
    const pyMin = Math.max(0, Math.floor((c.v - c.r) * MASK_RES));
    const pyMax = Math.min(MASK_RES - 1, Math.floor((c.v + c.r) * MASK_RES));
    for (let py = pyMin; py <= pyMax; py++) {
      for (let px = pxMin; px <= pxMax; px++) {
        const u = (px + 0.5) / MASK_RES;
        const v = (py + 0.5) / MASK_RES;
        const d = Math.max(Math.abs(u - c.u), Math.abs(v - c.v));
        if (d < c.r) maskData[py * MASK_RES + px] = 255;
      }
    }
  }
  // Hole punch pass: only process pixels that were set
  for (let py = 0; py < MASK_RES; py++) {
    for (let px = 0; px < MASK_RES; px++) {
      if (maskData[py * MASK_RES + px] === 0) continue;
      const u = (px + 0.5) / MASK_RES;
      const v = (py + 0.5) / MASK_RES;
      const wx = ox + (-S + u * 2 * S);
      const wz = oz + (-S + v * 2 * S);
      const sf = 0.42 * 12.0;
      const hx = Math.floor(wx * sf), hz = Math.floor(wz * sf);
      const hr = jsHash(hx + 33.3, hz + 33.3);
      const nL = jsHash(hx - 1 + 33.3, hz + 33.3) >= 0.68 ? 1 : 0;
      const nR = jsHash(hx + 1 + 33.3, hz + 33.3) >= 0.68 ? 1 : 0;
      const nU = jsHash(hx + 33.3, hz - 1 + 33.3) >= 0.68 ? 1 : 0;
      const nD = jsHash(hx + 33.3, hz + 1 + 33.3) >= 0.68 ? 1 : 0;
      if (nL + nR + nU + nD === 0) {
        const j = jsHash(hx + 88.8, hz + 88.8);
        const jx = j >= 0.5 ? 1 : 0, jz = j >= 0.7 ? 1 : 0;
        const hrBlend = hr * 0.7 + jsHash(hx + jx + 33.3, hz + jz + 33.3) * 0.3;
        if (hrBlend >= 0.68) maskData[py * MASK_RES + px] = 0;
      }
    }
  }
  const mineralMaskTex = bakeMineralMask(gl, maskData, MASK_RES);

  // Build small mineral overlay mesh: one terrain-hugging quad per cluster
  // Each cluster's colliders define a bounding box; we subdivide it into a
  // small grid so it follows terrain height. Much cheaper than full terrain.
  let mineralMesh = null;
  if (blueCircles.length > 0) {
    const mVerts = [];
    const mIdx = [];
    let mVi = 0;
    const SUB = 4; // subdivisions per cluster quad

    for (const cluster of minables) {
      // Find bounding box of this cluster's collider circles in UV space
      let uMin = 1, uMax = 0, vMin = 1, vMax = 0;
      for (const col of cluster.colliders) {
        const mult = col.radius < 0.08 ? 3.0 : col.radius < 0.15 ? 2.2 : 1.5;
        const cu = (col.x - ox + S) / (2 * S);
        const cv = (col.z - oz + S) / (2 * S);
        const cr = (col.radius * mult) / (2 * S);
        uMin = Math.min(uMin, cu - cr);
        uMax = Math.max(uMax, cu + cr);
        vMin = Math.min(vMin, cv - cr);
        vMax = Math.max(vMax, cv + cr);
      }
      // Clamp to valid range with padding for satellite squares (scatter up to 2.2x radius out)
      const maxScatter = 0.05; // generous padding for satellites
      uMin = Math.max(-0.02, uMin - maxScatter);
      uMax = Math.min(1.02, uMax + maxScatter);
      vMin = Math.max(-0.02, vMin - maxScatter);
      vMax = Math.min(1.02, vMax + maxScatter);

      // Build subdivided quad grid
      const baseVi = mVi;
      for (let sj = 0; sj <= SUB; sj++) {
        for (let si = 0; si <= SUB; si++) {
          const u = uMin + (si / SUB) * (uMax - uMin);
          const v = vMin + (sj / SUB) * (vMax - vMin);
          const lx = -S + u * 2 * S;
          const lz = -S + v * 2 * S;
          const ly = getBlendedHeight(hills, u, v, gx, gz) + 0.005;
          mVerts.push(lx, ly, lz, u, v);
          mVi++;
        }
      }
      for (let sj = 0; sj < SUB; sj++) {
        for (let si = 0; si < SUB; si++) {
          const tl = baseVi + sj * (SUB + 1) + si;
          const tr = tl + 1;
          const bl = tl + (SUB + 1);
          const br = bl + 1;
          mIdx.push(tl, bl, tr, tr, bl, br);
        }
      }
    }

    if (mIdx.length > 0) {
      const mVbo = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, mVbo);
      gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(mVerts), gl.STATIC_DRAW);
      const mIbo = gl.createBuffer();
      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, mIbo);
      gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(mIdx), gl.STATIC_DRAW);
      const mVao = gl.createVertexArray();
      gl.bindVertexArray(mVao);
      gl.bindBuffer(gl.ARRAY_BUFFER, mVbo);
      gl.enableVertexAttribArray(aPos);
      gl.vertexAttribPointer(aPos, 3, gl.FLOAT, false, GROUND_VERT_STRIDE, 0);
      gl.enableVertexAttribArray(aUV);
      gl.vertexAttribPointer(aUV, 2, gl.FLOAT, false, GROUND_VERT_STRIDE, 3 * 4);
      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, mIbo);
      gl.bindVertexArray(null);
      mineralMesh = { vbo: mVbo, ibo: mIbo, vao: mVao, idxCount: mIdx.length };
    }
  }

  return {
    gx, gz, ox, oz, configIdx, hills, biomeName: assignment.biome,
    terrain, treeVarIdx: trees.map(t => expandVariant(t.v)), treePositions, rocks, sticks, minables, mineralMaskTex, mineralMesh
  };
}

// ═══════════════════════════════════════════════════════════════════════════
// REGION MANAGER
// Centralizes region cache, biome/config assignment, and lifecycle events.
// Any system that needs to react to region creation or destruction (creatures,
// ambient audio, particles, etc.) registers callbacks here.
//
// Key operations:
//   get(gx,gz)          — build on demand, fires onLoad for new regions
//   setAssignment(...)   — change biome/config, full evict+rebuild cycle
//   rebuild(gx,gz)       — evict region + neighbors, fresh load
//   rebuildAll()          — full world reset
//   remeshAll()           — rebuild terrain mesh + re-snap Y positions only
//                           (keeps items, creatures, colliders — for debug hill toggle)
// ═══════════════════════════════════════════════════════════════════════════
const regionCache = new Map();

const RegionManager = {
  _onLoad: [],   // callbacks: (region) => void
  _onUnload: [], // callbacks: (region) => void

  // --- Events ---
  onLoad(fn) { this._onLoad.push(fn); },
  onUnload(fn) { this._onUnload.push(fn); },

  // --- Assignment ---
  getAssignment(gx, gz) {
    return regionBiomeMap.get(gx * 1000 + gz) || null;
  },

  // Change biome and/or config for a region. Handles the full evict→rebuild
  // cycle including neighbors (for cross-boundary blending), height cache,
  // sort invalidation.
  setAssignment(gx, gz, biome, configIdx) {
    regionBiomeMap.set(gx * 1000 + gz, { biome, configIdx });
    this._evictWithNeighbors(gx, gz);
    invalidateRegionHeights();
    _activeRegionsSorted = false;
  },

  // --- Cache ---
  get(gx, gz) {
    const key = gx * 1000 + gz;
    if (!regionCache.has(key)) {
      const reg = buildRegion(gx, gz);
      regionCache.set(key, reg);
      for (const fn of this._onLoad) fn(reg);
    }
    return regionCache.get(key);
  },

  // --- Lifecycle ---

  // Full evict+rebuild for a region and its neighbors.
  rebuild(gx, gz) {
    this._evictWithNeighbors(gx, gz);
    invalidateRegionHeights();
    _activeRegionsSorted = false;
  },

  // Full world reset — evict everything.
  rebuildAll() {
    this._evictAll();
    invalidateAllHeights();
    _activeRegionsSorted = false;
  },

  // Debug-only: rebuild terrain mesh and re-snap all Y positions without
  // evicting regions. Keeps items, creatures, and collider layout intact.
  // Used by hill toggle so the world looks flat/hilly but nothing moves.
  remeshAll() {
    invalidateAllHeights();
    for (const reg of regionCache.values()) {
      this._remeshRegion(reg);
    }
    _activeRegionsSorted = false;
  },

  // --- Internal ---

  _evict(gx, gz) {
    const key = gx * 1000 + gz;
    const reg = regionCache.get(key);
    if (reg) {
      for (const fn of this._onUnload) fn(reg);
      regionCache.delete(key);
    }
  },

  _evictWithNeighbors(gx, gz) {
    for (let dz = -1; dz <= 1; dz++) {
      for (let dx = -1; dx <= 1; dx++) {
        this._evict(gx + dx, gz + dz);
      }
    }
  },

  _evictAll() {
    for (const reg of regionCache.values()) {
      for (const fn of this._onUnload) fn(reg);
    }
    regionCache.clear();
  },

  // Re-snap all height-dependent data on a cached region without changing
  // item layout. Rebuilds terrain mesh, updates Y on trees/rocks/sticks/
  // minables, rebuilds mineral overlay mesh, and clears cached colliders.
  _remeshRegion(reg) {
    const { gx, gz, ox, oz, hills } = reg;

    // Rebuild terrain mesh (VBO/IBO/VAO)
    // TODO: could reuse existing GL buffers instead of creating new ones
    reg.terrain = buildTerrainMesh(hills, gx, gz);

    // Re-snap tree Y positions and update pre-baked instance data
    for (const tp of reg.treePositions) {
      const billU = (tp.billX - ox + S) / (2 * S);
      const billV = (tp.billZ - oz + S) / (2 * S);
      tp.billY = getBlendedHeight(hills, billU, billV, gx, gz);
      const colU = (tp.colX - ox + S) / (2 * S);
      const colV = (tp.colZ - oz + S) / (2 * S);
      tp.y = getBlendedHeight(hills, colU, colV, gx, gz);
      tp.colY = tp.y;
      // Update pre-baked instance data Y values
      tp._inst[1] = tp.billY;  // billboard Y
      tp._inst[11] = tp.y;     // collider Y
    }

    // Re-snap rock Y positions
    for (const r of reg.rocks) {
      const ru = (r.x - ox + S) / (2 * S);
      const rv = (r.z - oz + S) / (2 * S);
      const wy = getBlendedHeight(hills, ru, rv, gx, gz);
      r.y = wy;
      r.visY = wy + r.h * 0.5;
    }

    // Re-snap stick Y positions
    for (const st of reg.sticks) {
      const su = (st.visX - ox + S) / (2 * S);
      const sv = (st.visZ - oz + S) / (2 * S);
      const wy = getBlendedHeight(hills, su, sv, gx, gz);
      st.y = wy;
      st.visY = wy;
    }

    // Re-snap minable cube and collider Y positions
    for (const cluster of reg.minables) {
      for (const c of cluster.cubes) {
        const cu = (c.x - ox + S) / (2 * S);
        const cv = (c.z - oz + S) / (2 * S);
        const wy = getBlendedHeight(hills, cu, cv, gx, gz);
        c.y = wy + c.sy * 0.5;
      }
      for (const col of cluster.colliders) {
        const cu = (col.x - ox + S) / (2 * S);
        const cv = (col.z - oz + S) / (2 * S);
        col.colY = getBlendedHeight(hills, cu, cv, gx, gz);
      }
    }

    // Rebuild mineral overlay mesh (height-dependent grid)
    if (reg.mineralMesh) {
      const mVerts = [];
      const mIdx = [];
      let mVi = 0;
      const SUB = 4;
      for (const cluster of reg.minables) {
        let uMin = 1, uMax = 0, vMin = 1, vMax = 0;
        for (const col of cluster.colliders) {
          const mult = col.colR / (2 * S) < 0.008 ? 3.0 : col.colR / (2 * S) < 0.015 ? 2.2 : 1.5;
          const cu = (col.x - ox + S) / (2 * S);
          const cv = (col.z - oz + S) / (2 * S);
          const cr = (col.colR * mult) / (2 * S);
          uMin = Math.min(uMin, cu - cr);
          uMax = Math.max(uMax, cu + cr);
          vMin = Math.min(vMin, cv - cr);
          vMax = Math.max(vMax, cv + cr);
        }
        const maxScatter = 0.05;
        uMin = Math.max(-0.02, uMin - maxScatter);
        uMax = Math.min(1.02, uMax + maxScatter);
        vMin = Math.max(-0.02, vMin - maxScatter);
        vMax = Math.min(1.02, vMax + maxScatter);
        const baseVi = mVi;
        for (let sj = 0; sj <= SUB; sj++) {
          for (let si = 0; si <= SUB; si++) {
            const u = uMin + (si / SUB) * (uMax - uMin);
            const v = vMin + (sj / SUB) * (vMax - vMin);
            const lx = -S + u * 2 * S;
            const lz = -S + v * 2 * S;
            const ly = getBlendedHeight(hills, u, v, gx, gz) + 0.005;
            mVerts.push(lx, ly, lz, u, v);
            mVi++;
          }
        }
        for (let sj = 0; sj < SUB; sj++) {
          for (let si = 0; si < SUB; si++) {
            const tl = baseVi + sj * (SUB + 1) + si;
            const tr = tl + 1;
            const bl = tl + (SUB + 1);
            const br = bl + 1;
            mIdx.push(tl, bl, tr, tr, bl, br);
          }
        }
      }
      if (mIdx.length > 0) {
        gl.bindBuffer(gl.ARRAY_BUFFER, reg.mineralMesh.vbo);
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(mVerts), gl.STATIC_DRAW);
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, reg.mineralMesh.ibo);
        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(mIdx), gl.STATIC_DRAW);
        reg.mineralMesh.idxCount = mIdx.length;
      }
    }

    // Clear cached colliders so they get rebuilt with new Y values
    reg.allColliders = null;
  },
};

// Preallocated buffers for getActiveRegions (avoids per-frame GC pressure)
const _creatureGroups = {}; // reused per-frame for creature render grouping
const _frustumMat = new Float32Array(16);
const _frustumPlanes = [new Float32Array(4), new Float32Array(4), new Float32Array(4), new Float32Array(4)];
const _activeRegions = [];
let _activeRegionsSorted = false; // reset when region set changes

// Returns array of regions visible in the current camera view
function getActiveRegions(playerX, playerZ, proj, view) {
  // Build combined proj*view matrix for frustum testing
  const m = _frustumMat;
  for (let r = 0; r < 4; r++) {
    for (let c = 0; c < 4; c++) {
      m[r * 4 + c] = proj[c] * view[r * 4] + proj[4 + c] * view[r * 4 + 1] + proj[8 + c] * view[r * 4 + 2] + proj[12 + c] * view[r * 4 + 3];
    }
  }
  // Extract frustum planes (left, right, bottom, top) into preallocated arrays
  // For ortho, we only need these 4 (near/far are huge)
  const p0 = _frustumPlanes[0], p1 = _frustumPlanes[1], p2 = _frustumPlanes[2], p3 = _frustumPlanes[3];
  p0[0]=m[3]+m[0]; p0[1]=m[7]+m[4]; p0[2]=m[11]+m[8];  p0[3]=m[15]+m[12]; // left
  p1[0]=m[3]-m[0]; p1[1]=m[7]-m[4]; p1[2]=m[11]-m[8];  p1[3]=m[15]-m[12]; // right
  p2[0]=m[3]+m[1]; p2[1]=m[7]+m[5]; p2[2]=m[11]+m[9];  p2[3]=m[15]+m[13]; // bottom
  p3[0]=m[3]-m[1]; p3[1]=m[7]-m[5]; p3[2]=m[11]-m[9];  p3[3]=m[15]-m[13]; // top
  // Normalize planes
  for (let i = 0; i < 4; i++) {
    const p = _frustumPlanes[i];
    const len = Math.sqrt(p[0]*p[0] + p[1]*p[1] + p[2]*p[2]);
    if (len > 0) { p[0]/=len; p[1]/=len; p[2]/=len; p[3]/=len; }
  }

  _activeRegions.length = 0;
  const hs = S; // half-size of region
  let setHash = 0; // quick fingerprint of which regions are visible
  for (let gz = -GRID_HALF; gz <= GRID_HALF; gz++) {
    for (let gx = -GRID_HALF; gx <= GRID_HALF; gx++) {
      const cx = gx * REGION_SIZE;
      const cz = gz * REGION_SIZE;
      // Test region AABB against frustum (use generous Y range)
      let visible = true;
      for (let i = 0; i < 4; i++) {
        const p = _frustumPlanes[i];
        // Find the corner most in the direction of the plane normal
        const px = p[0] > 0 ? cx + hs : cx - hs;
        const py = p[1] > 0 ? 2.0 : 0;  // generous height range
        const pz = p[2] > 0 ? cz + hs : cz - hs;
        if (p[0]*px + p[1]*py + p[2]*pz + p[3] < -0.5) {
          visible = false;
          break;
        }
      }
      if (visible) {
        _activeRegions.push(RegionManager.get(gx, gz));
        setHash = setHash * 31 + (gx * 1000 + gz) | 0;
      }
    }
  }
  // Only re-sort when region set changes (new regions enter/leave frustum)
  if (setHash !== _activeRegions._prevHash) {
    _activeRegions._prevHash = setHash;
    _activeRegionsSorted = false;
  }
  return _activeRegions;
}

// ── Height Cache ──────────────────────────────────────────────────────────
// Caches getBlendedHeight results keyed by quantized (u, v, gx, gz).
// Every height query in the codebase flows through getBlendedHeight,
// so this single cache covers all callers (buildRegion, remesh, player
// height snap, creature ticks, debug overlays, etc.)
// Invalidated via generation counter — bump to lazily discard all entries.
// Quantization: ~0.05 UV units (20 quanta per UV unit).
function getWorldHeight(wx, wz) {
  const gx = Math.round(wx / REGION_SIZE);
  const gz = Math.round(wz / REGION_SIZE);
  const cgx = Math.max(-GRID_HALF, Math.min(GRID_HALF, gx));
  const cgz = Math.max(-GRID_HALF, Math.min(GRID_HALF, gz));
  const u = (wx - cgx * REGION_SIZE + S) / (2 * S);
  const v = (wz - cgz * REGION_SIZE + S) / (2 * S);
  const reg = regionCache.get(cgx * 1000 + cgz);
  return getBlendedHeight(reg.hills, u, v, cgx, cgz);
}

// ═══════════════════════════════════════════════════════════════════════════
// CHARACTER CONTROLLER
// Owns: player position, input (keyboard/gamepad/touch), movement, collision
// ═══════════════════════════════════════════════════════════════════════════
const CharacterController = {
  // --- Constants ---
  RADIUS:    0.15,
  HEIGHT:    0.5,
  SPEED:     4.0,   // world units per second
  STEP_DT:   1/120, // fixed physics step (~8.33ms)
  MAX_STEPS: 8,     // max sub-steps per frame (spiral-of-death cap)
  GAMEPAD_DEADZONE: 0.15,

  // --- Player state ---
  x: -0.4,
  z: -0.4,
  y: 0,          // computed from terrain each frame
  renderX: -0.4, renderY: 0, renderZ: -0.4, // interpolated position for rendering
  mx: 0, mz: 0, // current frame movement direction (normalized)
  isMoving: false,
  speedMult: 1.0, // modified by forest tree slowdown
  _dtAccum: 0,

  // --- Player collider (same structure as all other colliders) ---
  // NOTE: colR must match RADIUS above
  collider: { type: 'player', colX: -0.4, colZ: -0.4, colR: 0.15, src: null }, // src set after init

  // --- Input state (private) ---
  _keys: {},
  _gamepad: { lx: 0, lz: 0 },
  _touch: { active: false, screenX: 0, screenY: 0, _startX: 0, _startY: 0, _holdTimer: 0 },
  _mouse: { active: false, screenX: 0, screenY: 0, _startX: 0, _startY: 0, _holdTimer: 0 },
  _prevView: null,
  _prevProj: null,
  _nearbyRegions: [],

  // --- Input: keyboard ---
  onKeyDown(e) { CharacterController._keys[e.code] = true; },
  onKeyUp(e)   { CharacterController._keys[e.code] = false; },

  // --- Input: gamepad ---
  pollGamepad() {
    const gp = CharacterController._gamepad;
    const DZ = CharacterController.GAMEPAD_DEADZONE;
    try {
      const gamepads = navigator.getGamepads();
      for (const pad of gamepads) {
        if (!pad) continue;
        let lx = pad.axes[0] || 0, ly = pad.axes[1] || 0;
        if (Math.abs(lx) < DZ) lx = 0;
        if (Math.abs(ly) < DZ) ly = 0;
        gp.lx = lx; gp.lz = ly;
        return;
      }
    } catch(e) {}
    gp.lx = 0; gp.lz = 0;
  },

  // --- Input: touch-to-move ---
  onTouchMoveStart(x, y) {
    const t = CharacterController._touch;
    t.screenX = x; t.screenY = y;
    t.active = false;
    t._startX = x; t._startY = y;
    clearTimeout(t._holdTimer);
    t._holdTimer = setTimeout(() => {
      if (!t.active) t.active = true;
    }, 150);
  },
  onTouchMoveUpdate(x, y) {
    const t = CharacterController._touch;
    t.screenX = x; t.screenY = y;
    if (!t.active) {
      const ddx = x - t._startX, ddy = y - t._startY;
      if (ddx * ddx + ddy * ddy > 100) t.active = true;
    }
  },
  onTouchMoveCancel() {
    const t = CharacterController._touch;
    clearTimeout(t._holdTimer);
    t.active = false;
  },

  // --- Input: mouse-to-move (left-click hold, same logic as touch) ---
  onMouseMoveStart(x, y) {
    const m = CharacterController._mouse;
    m.screenX = x; m.screenY = y;
    m.active = false;
    m._startX = x; m._startY = y;
    clearTimeout(m._holdTimer);
    m._holdTimer = setTimeout(() => {
      if (!m.active) m.active = true;
    }, 150);
  },
  onMouseMoveUpdate(x, y) {
    const m = CharacterController._mouse;
    if (!m.active && m._holdTimer) {
      const ddx = x - m._startX, ddy = y - m._startY;
      if (ddx * ddx + ddy * ddy > 100) m.active = true;
    }
    if (m.active || m._holdTimer) {
      m.screenX = x; m.screenY = y;
    }
  },
  onMouseMoveCancel() {
    const m = CharacterController._mouse;
    clearTimeout(m._holdTimer);
    m._holdTimer = 0;
    m.active = false;
  },

  // --- Compute movement direction from all input sources ---
  computeMovement() {
    const cc = CharacterController;
    const keys = cc._keys, gp = cc._gamepad, touch = cc._touch;
    let mx = 0, mz = 0;

    // Keyboard (isometric: W=up-left, S=down-right, A=down-left, D=up-right)
    if (keys['KeyW']) { mx -= 1; mz -= 1; }
    if (keys['KeyS']) { mx += 1; mz += 1; }
    if (keys['KeyA']) { mx -= 1; mz += 1; }
    if (keys['KeyD']) { mx += 1; mz -= 1; }
    if (mx !== 0 || mz !== 0) {
      const len = Math.sqrt(mx * mx + mz * mz);
      mx /= len; mz /= len;
    }

    // Gamepad (rotate 45° to match isometric view)
    if (gp.lx !== 0 || gp.lz !== 0) {
      mx += gp.lx + gp.lz;
      mz += -gp.lx + gp.lz;
      const cLen = Math.sqrt(mx * mx + mz * mz);
      if (cLen > 1) { mx /= cLen; mz /= cLen; }
    }

    // Pointer-to-move (shared by touch and mouse — project player to screen, compute direction)
    const pointer = touch.active ? touch : (cc._mouse.active ? cc._mouse : null);
    if (pointer) {
      const pv = cc._prevView, pp = cc._prevProj;
      if (pv && pp) {
        const pwx = cc.x, pwy = cc.y, pwz = cc.z;
        const ex = pv[0]*pwx + pv[4]*pwy + pv[8]*pwz + pv[12];
        const ey = pv[1]*pwx + pv[5]*pwy + pv[9]*pwz + pv[13];
        const ez = pv[2]*pwx + pv[6]*pwy + pv[10]*pwz + pv[14];
        const ew = pv[3]*pwx + pv[7]*pwy + pv[11]*pwz + pv[15];
        const cx2 = pp[0]*ex + pp[4]*ey + pp[8]*ez + pp[12]*ew;
        const cy2 = pp[1]*ex + pp[5]*ey + pp[9]*ez + pp[13]*ew;
        const cw  = pp[3]*ex + pp[7]*ey + pp[11]*ez + pp[15]*ew;
        const ndcX = cx2 / cw, ndcY = cy2 / cw;
        const playerScreenX = (ndcX * 0.5 + 0.5) * window.innerWidth;
        const playerScreenY = (1 - (ndcY * 0.5 + 0.5)) * window.innerHeight;
        let sdx = pointer.screenX - playerScreenX;
        let sdy = pointer.screenY - playerScreenY;
        const sLen = Math.sqrt(sdx * sdx + sdy * sdy);
        if (sLen > 5) {
          sdx /= sLen; sdy /= sLen;
          mx += sdx + sdy;
          mz += -sdx + sdy;
          const tLen = Math.sqrt(mx * mx + mz * mz);
          if (tLen > 1) { mx /= tLen; mz /= tLen; }
        }
      }
    }

    cc.mx = mx; cc.mz = mz;
    cc.isMoving = (mx !== 0 || mz !== 0);
  },

  // --- Per-frame update: input → sub-steps → collision → terrain snap ---
  update(dt, time) {
    const cc = CharacterController;
    cc.pollGamepad();
    cc.computeMovement();

    // Fixed sub-step loop
    cc._dtAccum += dt;
    const steps = Math.min(Math.floor(cc._dtAccum / cc.STEP_DT), cc.MAX_STEPS);
    cc._dtAccum -= steps * cc.STEP_DT;
    if (cc._dtAccum > cc.STEP_DT * 2) cc._dtAccum = cc.STEP_DT * 2;

    // Gather nearby regions
    const pgx = Math.round(cc.x / REGION_SIZE);
    const pgz = Math.round(cc.z / REGION_SIZE);
    const nearby = cc._nearbyRegions;
    nearby.length = 0;
    for (let dz = -1; dz <= 1; dz++) {
      for (let dx = -1; dx <= 1; dx++) {
        const gx = pgx + dx, gz = pgz + dz;
        if (gx < -GRID_HALF || gx > GRID_HALF || gz < -GRID_HALF || gz > GRID_HALF) continue;
        nearby.push(RegionManager.get(gx, gz));
      }
    }

    // Pre-step: prepare overlap tracking (only when physics actually runs)
    if (steps > 0) {
      for (const reg of nearby) {
        if (!reg.allColliders) continue;
        for (const col of reg.allColliders) {
          if (col.src && col.src._overlapping) {
            col.src._wasOverlapping = true;
            col.src._overlapping = false;
          }
        }
      }
    }

    // Save pre-step position for render interpolation
    const prevX = cc.x, prevZ = cc.z;

    // Sub-steps: move + collide
    for (let step = 0; step < steps; step++) {
      if (cc.isMoving) {
        const sm = cc.speedMult || 1.0;
        cc.x += cc.mx * cc.SPEED * sm * cc.STEP_DT;
        cc.z += cc.mz * cc.SPEED * sm * cc.STEP_DT;
      }
      cc.resolveCollisions(nearby);
    }

    // Snap to terrain
    cc.y = getWorldHeight(cc.x, cc.z);

    // Render interpolation: blend between previous and current physics
    // position using leftover accumulator time for sub-pixel smooth movement.
    // Physics (cc.x/z) stays at the true stepped position for collision;
    // renderX/Y/Z is only used for drawing.
    const alpha = cc._dtAccum / cc.STEP_DT;
    cc.renderX = prevX + (cc.x - prevX) * alpha;
    cc.renderZ = prevZ + (cc.z - prevZ) * alpha;
    cc.renderY = cc.y;

    // Sync player collider
    cc.collider.colX = cc.x;
    cc.collider.colZ = cc.z;

    // Post-step: fire collide events
    if (steps > 0) {
      for (const reg of nearby) {
        if (!reg.allColliders) continue;
        for (const col of reg.allColliders) {
          if (!col.src) continue;
          if (col.src._wasOverlapping && !col.src._overlapping) {
            // Left the collider this frame
            col.src._collideActive = false;
            onCollideEnd(cc.collider, col);
          } else if (col.src._collideActive && col.src._overlapping) {
            // Still overlapping — per-frame overlap callback
            onColliding(cc.collider, col);
          }
          col.src._wasOverlapping = false;
        }
      }
    }

    // Region change check
    if (pgx !== cc._lastRegX || pgz !== cc._lastRegZ) {
      cc._lastRegX = pgx; cc._lastRegZ = pgz;
      populateDropdowns();
    }
  },

  // --- Collision resolution ---
  resolveCollisions(regions) {
    const cc = CharacterController;
    cc.speedMult = 1.0;
    for (const reg of regions) {
      if (!reg.allColliders) buildRegionColliders(reg);
      for (const col of reg.allColliders) {
        const ct = COLLIDER_TYPES[col.type];
        if (!ct) continue;
        const minDist = cc.RADIUS + col.colR;
        const dx = cc.x - col.colX, dz = cc.z - col.colZ;
        const distSq = dx * dx + dz * dz;
        if (distSq < minDist * minDist && distSq > 0.000001) {
          if (ct.blocksPlayer) {
            const dist = Math.sqrt(distSq);
            const push = (minDist - dist) / dist;
            cc.x += dx * push;
            cc.z += dz * push;
          } else if (ct.slowsPlayer && col.src) {
            cc.speedMult = Math.min(cc.speedMult, ct.slowsPlayer);
            if (!col.src._collideActive) {
              col.src._collideActive = true;
              getShake(col.src).wasMoving = cc.isMoving;
              if (cc.isMoving) {
                onCollideStart(cc.collider, col);
              }
            }
            col.src._overlapping = true;
          }
        }
      }
    }
    const worldHalf = (GRID_HALF + 0.5) * REGION_SIZE;
    cc.x = Math.max(-worldHalf + cc.RADIUS, Math.min(worldHalf - cc.RADIUS, cc.x));
    cc.z = Math.max(-worldHalf + cc.RADIUS, Math.min(worldHalf - cc.RADIUS, cc.z));
  },

  // Store matrices for touch-to-move projection (called after camera builds them)
  storeMatrices(view, proj) {
    const cc = CharacterController;
    if (!cc._prevView) cc._prevView = new Float32Array(16);
    if (!cc._prevProj) cc._prevProj = new Float32Array(16);
    cc._prevView.set(view);
    cc._prevProj.set(proj);
  },
};

// Register keyboard listeners
CharacterController.collider.src = CharacterController;
window.addEventListener('keydown', CharacterController.onKeyDown);
window.addEventListener('keyup', CharacterController.onKeyUp);

// ═══════════════════════════════════════════════════════════════════════════
// CAMERA CONTROLLER
// Owns: camera target, zoom, rotation, pan, deadzone, matrices
// ═══════════════════════════════════════════════════════════════════════════
const CameraController = {
  // --- Constants ---
  DEADZONE_MAX:  1.20,   // camera deadzone at default zoom
  DEADZONE_MIN:  0.35,   // camera deadzone at max zoom-in
  ISO_DIST:     20,     // virtual distance for ortho direction

  // Deadzone shrinks as we zoom in
  get DEADZONE() {
    const cam = CameraController;
    if (!cam._zoomTable) return cam.DEADZONE_MAX;
    const zoomIn = Math.max(0, cam._zoomDefaultIdx - cam._zoomIdx);
    const maxSteps = cam._zoomDefaultIdx;
    if (maxSteps <= 0) return cam.DEADZONE_MAX;
    const t = zoomIn / maxSteps;
    return cam.DEADZONE_MAX + (cam.DEADZONE_MIN - cam.DEADZONE_MAX) * t;
  },
  ROT_Y:        Math.PI / 4,
  ROT_X:        Math.atan(1 / Math.sqrt(2)), // ~35.26° isometric elevation

  // --- Camera state ---
  target: [-0.4, 0, -0.4], // look-at point (XZ plane)
  dist:   8,                // ortho half-size (zoom level)

  // --- Zoom table ---
  _zoomTable: null,
  _zoomDefaultIdx: 0,
  _zoomIdx: 0,

  // --- Pan state ---
  _isPanning:      false,  // right-click drag active
  _lastMouse:      [0, 0],
  _cameraPanned:   false,  // pan happened, not yet resolved
  _camUncapped:    false,  // returning from pan (uncapped speed)
  _panReturnSpeed: 0,

  // --- Deadzone state ---
  _camSettled:  false,
  _camCenterX:  0,
  _camCenterZ:  0,

  // --- Preallocated matrix helpers ---
  _eyeVec: new Float32Array(3),
  _upVec:  new Float32Array([0, 1, 0]),
  _result: { proj: null, view: null }, // reused return object

  // --- Build zoom table on init ---
  init() {
    const table = [8];
    let d = 8;
    while (d > 2.01) { d -= d * 0.13; table.unshift(Math.max(2, d)); }
    d = 8;
    while (d < 19.9) { d += d * 0.195; table.push(Math.min(20, d)); }
    CameraController._zoomTable = table;
    CameraController._zoomDefaultIdx = table.indexOf(8);
    CameraController._zoomIdx = CameraController._zoomDefaultIdx;
  },

  // --- Input events ---
  onPanStart(clientX, clientY) {
    const cam = CameraController;
    cam._isPanning = true;
    cam._lastMouse[0] = clientX;
    cam._lastMouse[1] = clientY;
  },

  onPanEnd() {
    CameraController._isPanning = false;
  },

  onPanMove(clientX, clientY) {
    const cam = CameraController;
    if (!cam._isPanning) return;
    const dx = clientX - cam._lastMouse[0];
    const dy = clientY - cam._lastMouse[1];
    cam._lastMouse[0] = clientX;
    cam._lastMouse[1] = clientY;

    const panSpeed = 0.02 * (cam.dist / 8);
    const sinY = Math.sin(cam.ROT_Y);
    const cosY = Math.cos(cam.ROT_Y);
    cam.target[0] -= (cosY * dx + sinY * dy) * panSpeed;
    cam.target[2] -= (-sinY * dx + cosY * dy) * panSpeed;

    cam._cameraPanned = true;
    cam._camUncapped = false;
    cam._panReturnSpeed = 0;
  },

  onZoomWheel(deltaY) {
    const cam = CameraController;
    if (deltaY > 0 && cam._zoomIdx < cam._zoomTable.length - 1) cam._zoomIdx++;
    else if (deltaY < 0 && cam._zoomIdx > 0) cam._zoomIdx--;
    cam.dist = cam._zoomTable[cam._zoomIdx];
  },

  onZoomPinch(ratio, startDist) {
    const cam = CameraController;
    const newDist = Math.max(2, Math.min(20, startDist * ratio));
    cam.dist = newDist;
    // Snap _zoomIdx to nearest table entry so display stays in sync
    const t = cam._zoomTable;
    let bestIdx = 0, bestDiff = Math.abs(t[0] - newDist);
    for (let i = 1; i < t.length; i++) {
      const diff = Math.abs(t[i] - newDist);
      if (diff < bestDiff) { bestDiff = diff; bestIdx = i; }
    }
    cam._zoomIdx = bestIdx;
  },

  // --- Per-frame update: deadzone, pan return → target position ---
  update(dt, playerX, playerY, playerZ, isMoving) {
    const cam = CameraController;
    const cc = CharacterController;

    // --- Pan return on first movement after pan ---
    if (cam._cameraPanned && isMoving) {
      let playerOnScreen = false;
      const pv = cc._prevView, pp = cc._prevProj;
      if (pv && pp) {
        const ex = pv[0]*playerX + pv[4]*playerY + pv[8]*playerZ + pv[12];
        const ey = pv[1]*playerX + pv[5]*playerY + pv[9]*playerZ + pv[13];
        const ez = pv[2]*playerX + pv[6]*playerY + pv[10]*playerZ + pv[14];
        const ew = pv[3]*playerX + pv[7]*playerY + pv[11]*playerZ + pv[15];
        const cx2 = pp[0]*ex + pp[4]*ey + pp[8]*ez + pp[12]*ew;
        const cy2 = pp[1]*ex + pp[5]*ey + pp[9]*ez + pp[13]*ew;
        const cw  = pp[3]*ex + pp[7]*ey + pp[11]*ez + pp[15]*ew;
        if (cw !== 0) {
          const ndcX = cx2 / cw, ndcY = cy2 / cw;
          playerOnScreen = Math.abs(ndcX) < 1.0 && Math.abs(ndcY) < 1.0;
        }
      }
      cam._cameraPanned = false;
      cam._camSettled = false;
      if (playerOnScreen) {
        cam._camUncapped = true;
      } else {
        cam.target[0] = playerX;
        cam.target[2] = playerZ;
      }
    }

    // --- Wake from settled when player nears edge or deadzone shrinks ---
    if (cam._camSettled) {
      const sdx = playerX - cam.target[0];
      const sdz = playerZ - cam.target[2];
      const distSq = sdx * sdx + sdz * sdz;
      const wakeR = cam.DEADZONE - cc.RADIUS;
      if (distSq > wakeR * wakeR) cam._camSettled = false;
    }

    // --- Deadzone follow ---
    if (!cam._cameraPanned && !cam._camSettled) {
      let offX = playerX - cam.target[0];
      let offZ = playerZ - cam.target[2];
      let offDist = Math.sqrt(offX * offX + offZ * offZ);
      const outsideDeadzone = offDist > cam.DEADZONE;

      if (isMoving) {
        if (outsideDeadzone) {
          const overshoot = offDist - cam.DEADZONE;
          if (cam._camUncapped) {
            // Pan return: speed modulated by movement direction
            const offNx = offX / offDist, offNz = offZ / offDist;
            const dot = cc.mx * offNx + cc.mz * offNz;
            const t = dot * 0.5 + 0.5;
            const zoomInSteps = Math.max(0, cam._zoomDefaultIdx - cam._zoomIdx);
            const zoomScale = 1 - zoomInSteps * (0.15 / 8);
            const speed = (4 + t * 7) * zoomScale;
            cam._panReturnSpeed = speed;
            const move = overshoot * (1 - Math.exp(-speed * dt));
            cam.target[0] += offNx * move;
            cam.target[2] += offNz * move;
          } else {
            // Normal: capped to player speed
            const move = Math.min(overshoot * (1 - Math.exp(-15 * dt)), cc.SPEED * dt);
            cam.target[0] += (offX / offDist) * move;
            cam.target[2] += (offZ / offDist) * move;
          }
        }
        if (!outsideDeadzone) {
          cam._camSettled = true;
          cam._camUncapped = false;
          cam._panReturnSpeed = 0;
        }
      } else {
        // Player stopped — follow back
        if (outsideDeadzone) {
          const overshoot = offDist - cam.DEADZONE;
          if (cam._camUncapped) {
            const speed = cam._panReturnSpeed || 8;
            const move = overshoot * (1 - Math.exp(-speed * dt));
            cam.target[0] += (offX / offDist) * move;
            cam.target[2] += (offZ / offDist) * move;
          } else {
            const move = Math.min(overshoot * (1 - Math.exp(-15 * dt)), cc.SPEED * dt);
            cam.target[0] += (offX / offDist) * move;
            cam.target[2] += (offZ / offDist) * move;
          }
        }
        // Settle toward player
        offX = playerX - cam.target[0];
        offZ = playerZ - cam.target[2];
        offDist = Math.sqrt(offX * offX + offZ * offZ);
        const targetDist = cam.DEADZONE - cc.RADIUS;
        const gap = offDist - targetDist;
        if (gap > 0.002) {
          const move = gap < 0.06
            ? Math.min(gap, 0.48 * dt)
            : gap * (1 - Math.exp(-8 * dt));
          cam.target[0] += (offX / offDist) * move;
          cam.target[2] += (offZ / offDist) * move;
        } else {
          cam._camSettled = true;
          cam._camUncapped = false;
          cam._panReturnSpeed = 0;
        }
      }
    }

    // Debug center
    if (!cam._cameraPanned && !cam._camSettled) {
      cam._camCenterX = cam.target[0];
      cam._camCenterZ = cam.target[2];
    }
  },

  // --- Build projection and view matrices ---
  buildMatrices(canvasWidth, canvasHeight) {
    const cam = CameraController;
    const cc = CharacterController;
    const aspect = canvasWidth / canvasHeight;
    const proj = ortho(-cam.dist * aspect, cam.dist * aspect, -cam.dist, cam.dist, -50, 50);

    // --- View matrix ---
    let vizTargetX = cam.target[0], vizTargetZ = cam.target[2];

    const eye = cam._eyeVec;
    eye[0] = vizTargetX + cam.ISO_DIST * Math.cos(cam.ROT_X) * Math.sin(cam.ROT_Y);
    eye[1] = cam.target[1] + cam.ISO_DIST * Math.sin(cam.ROT_X);
    eye[2] = vizTargetZ + cam.ISO_DIST * Math.cos(cam.ROT_X) * Math.cos(cam.ROT_Y);
    const savedX = cam.target[0], savedZ = cam.target[2];
    cam.target[0] = vizTargetX; cam.target[2] = vizTargetZ;
    const view = lookAt(eye, cam.target, cam._upVec);
    cam.target[0] = savedX; cam.target[2] = savedZ;

    // --- Pixel snap (eliminates sub-pixel jitter) ---
    const worldPerPixelX = (2 * cam.dist * aspect) / canvasWidth;
    const worldPerPixelY = (2 * cam.dist) / canvasHeight;
    view[12] = Math.round(view[12] / worldPerPixelX) * worldPerPixelX;
    view[13] = Math.round(view[13] / worldPerPixelY) * worldPerPixelY;

    cam._result.proj = proj;
    cam._result.view = view;
    return cam._result; // reuses static buffers; callers must not store across frames
  },
};

// Initialize zoom table
CameraController.init();

// --- Camera input listeners ---
canvas.addEventListener('contextmenu', e => e.preventDefault());
canvas.addEventListener('mousedown', e => {
  if (e.button === 2) CameraController.onPanStart(e.clientX, e.clientY);
  if (e.button === 0) CharacterController.onMouseMoveStart(e.clientX, e.clientY);
});
window.addEventListener('mouseup', e => {
  if (e.button === 2) CameraController.onPanEnd();
  if (e.button === 0) CharacterController.onMouseMoveCancel();
});
window.addEventListener('mousemove', e => {
  CameraController.onPanMove(e.clientX, e.clientY);
  CharacterController.onMouseMoveUpdate(e.clientX, e.clientY);
});
canvas.addEventListener('wheel', e => {
  e.preventDefault();
  CameraController.onZoomWheel(e.deltaY);
}, { passive: false });

// --- Touch input listeners (pinch zoom + pan + single-touch move) ---
let _touchStartDist = 0, _touchStartCamDist = 0, _touchIsPinching = false;
let _pinchEndTime = 0; // timestamp when pinch ended, used for cooldown
let _pinchMidX = 0, _pinchMidY = 0; // midpoint of two fingers for panning
let _pinchPrevDist = 0; // previous finger distance for per-frame zoom delta
let _pinchPanActive = false; // whether pan has been confirmed for this gesture
let _pinchMidAccumX = 0, _pinchMidAccumY = 0; // accumulated midpoint drift
let _pinchSpreadAccum = 0; // accumulated finger spread change
const PINCH_COOLDOWN = 300; // ms to ignore single-touch after pinch ends
const PINCH_PAN_THRESHOLD = 15; // px midpoint must drift before panning kicks in
const PINCH_PAN_RATIO = 0.8; // midpoint drift must exceed spread change by this ratio
canvas.addEventListener('touchstart', e => {
  if (e.touches.length === 2) {
    e.preventDefault();
    _touchIsPinching = true;
    CharacterController.onTouchMoveCancel();
    const dx = e.touches[0].clientX - e.touches[1].clientX;
    const dy = e.touches[0].clientY - e.touches[1].clientY;
    _touchStartDist = Math.sqrt(dx * dx + dy * dy);
    _touchStartCamDist = CameraController.dist;
    _pinchMidX = (e.touches[0].clientX + e.touches[1].clientX) * 0.5;
    _pinchMidY = (e.touches[0].clientY + e.touches[1].clientY) * 0.5;
    _pinchPrevDist = _touchStartDist;
    _pinchPanActive = false;
    _pinchMidAccumX = 0;
    _pinchMidAccumY = 0;
    _pinchSpreadAccum = 0;
  } else if (e.touches.length === 1 && !_touchIsPinching) {
    if (performance.now() - _pinchEndTime < PINCH_COOLDOWN) return;
    CharacterController.onTouchMoveStart(e.touches[0].clientX, e.touches[0].clientY);
  }
}, { passive: false });
canvas.addEventListener('touchmove', e => {
  if (e.touches.length === 2) {
    e.preventDefault();
    _touchIsPinching = true;
    CharacterController.onTouchMoveCancel();
    const dx = e.touches[0].clientX - e.touches[1].clientX;
    const dy = e.touches[0].clientY - e.touches[1].clientY;
    const dist = Math.sqrt(dx * dx + dy * dy);
    CameraController.onZoomPinch(_touchStartDist / dist, _touchStartCamDist);
    // Two-finger pan: only activate when midpoint drift clearly exceeds zoom spread change
    const midX = (e.touches[0].clientX + e.touches[1].clientX) * 0.5;
    const midY = (e.touches[0].clientY + e.touches[1].clientY) * 0.5;
    const panDx = midX - _pinchMidX;
    const panDy = midY - _pinchMidY;
    const spreadDelta = Math.abs(dist - _pinchPrevDist);
    _pinchMidX = midX;
    _pinchMidY = midY;
    _pinchPrevDist = dist;
    if (!_pinchPanActive) {
      _pinchMidAccumX += panDx;
      _pinchMidAccumY += panDy;
      _pinchSpreadAccum += spreadDelta;
      const midDrift = Math.sqrt(_pinchMidAccumX * _pinchMidAccumX + _pinchMidAccumY * _pinchMidAccumY);
      // Pan activates only if midpoint drifted far enough AND dominates over zoom spread
      if (midDrift > PINCH_PAN_THRESHOLD && midDrift > _pinchSpreadAccum * PINCH_PAN_RATIO) {
        _pinchPanActive = true;
      }
    }
    if (_pinchPanActive && (Math.abs(panDx) > 0.5 || Math.abs(panDy) > 0.5)) {
      const cam = CameraController;
      const panSpeed = 0.02 * (cam.dist / 8);
      const sinY = Math.sin(cam.ROT_Y);
      const cosY = Math.cos(cam.ROT_Y);
      cam.target[0] -= (cosY * panDx + sinY * panDy) * panSpeed;
      cam.target[2] -= (-sinY * panDx + cosY * panDy) * panSpeed;
      cam._cameraPanned = true;
      cam._camUncapped = false;
      cam._panReturnSpeed = 0;
    }
  } else if (e.touches.length === 1 && !_touchIsPinching) {
    if (performance.now() - _pinchEndTime < PINCH_COOLDOWN) return;
    e.preventDefault();
    CharacterController.onTouchMoveUpdate(e.touches[0].clientX, e.touches[0].clientY);
  }
}, { passive: false });
canvas.addEventListener('touchend', e => {
  if (_touchIsPinching) {
    CharacterController.onTouchMoveCancel();
    if (e.touches.length < 2) {
      _touchIsPinching = false;
      _pinchEndTime = performance.now();
    }
  } else {
    if (e.touches.length === 0) CharacterController.onTouchMoveCancel();
  }
});
canvas.addEventListener('touchcancel', () => {
  CharacterController.onTouchMoveCancel();
  if (_touchIsPinching) _pinchEndTime = performance.now();
  _touchIsPinching = false;
});

// Generate cylinder mesh (reuses meshProg shader)
const CYL_SEGS = 12;
const cylVerts = [];
const cylIdx = [];

// Shared vertices: bottom ring [0..11], top ring [12..23], top center [24], bottom center [25]
for (let i = 0; i < CYL_SEGS; i++) {
  const a = (i / CYL_SEGS) * Math.PI * 2;
  const c = Math.cos(a), s = Math.sin(a);
  // Bottom ring vertex (side normal for lighting)
  cylVerts.push(c * 0.5, -0.5, s * 0.5,  c, 0, s);
}
for (let i = 0; i < CYL_SEGS; i++) {
  const a = (i / CYL_SEGS) * Math.PI * 2;
  const c = Math.cos(a), s = Math.sin(a);
  // Top ring vertex (side normal for lighting)
  cylVerts.push(c * 0.5, 0.5, s * 0.5,  c, 0, s);
}
// Cap centers
const topCenter = CYL_SEGS * 2;
cylVerts.push(0, 0.5, 0,  0, 1, 0);
const botCenter = topCenter + 1;
cylVerts.push(0, -0.5, 0,  0, -1, 0);
// Cap rim verts with cap normals (separate from side verts for correct lighting)
const topCapBase = botCenter + 1;
for (let i = 0; i < CYL_SEGS; i++) {
  const a = (i / CYL_SEGS) * Math.PI * 2;
  cylVerts.push(Math.cos(a) * 0.5, 0.5, Math.sin(a) * 0.5,  0, 1, 0);
}
const botCapBase = topCapBase + CYL_SEGS;
for (let i = 0; i < CYL_SEGS; i++) {
  const a = (i / CYL_SEGS) * Math.PI * 2;
  cylVerts.push(Math.cos(a) * 0.5, -0.5, Math.sin(a) * 0.5,  0, -1, 0);
}

// Side faces: two triangles per segment using shared ring verts
for (let i = 0; i < CYL_SEGS; i++) {
  const b0 = i, b1 = (i + 1) % CYL_SEGS;
  const t0 = i + CYL_SEGS, t1 = b1 + CYL_SEGS;
  // CCW from outside: bottom-left, top-right, bottom-right
  cylIdx.push(b0, t1, b1);
  // CCW from outside: bottom-left, top-left, top-right
  cylIdx.push(b0, t0, t1);
}
// Top cap (CCW from above)
for (let i = 0; i < CYL_SEGS; i++) {
  cylIdx.push(topCenter, topCapBase + ((i + 1) % CYL_SEGS), topCapBase + i);
}
// Bottom cap (CCW from below)
for (let i = 0; i < CYL_SEGS; i++) {
  cylIdx.push(botCenter, botCapBase + i, botCapBase + ((i + 1) % CYL_SEGS));
}

const cylVertData = new Float32Array(cylVerts);
const cylIdxData = new Uint16Array(cylIdx);
const cylIdxCount = cylIdx.length;

const cylVBO = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, cylVBO);
gl.bufferData(gl.ARRAY_BUFFER, cylVertData, gl.STATIC_DRAW);

const cylIBO = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, cylIBO);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, cylIdxData, gl.STATIC_DRAW);
const cylVAO = makeMeshVAO(cylVBO, cylIBO);

// (Player state, input, gamepad, touch-to-move now in CharacterController above)

// ═══════════════════════════════════════════════════════════════════════════
// ISOMETRIC SCREEN PROJECTION HELPERS
// Camera is fixed at rotY=PI/4. These project world-space XZ vectors
// onto screen-horizontal (camRight) and screen-vertical (camUp ground component).
// ═══════════════════════════════════════════════════════════════════════════
const ISO_COS = 0.7071; // cos(PI/4)
const ISO_SIN = 0.7071; // sin(PI/4)
// camRight in world XZ: (cos, 0, -sin) = (0.7071, 0, -0.7071)
// camUp ground component in world XZ: (-sin, 0, -cos) = (-0.7071, 0, -0.7071)
function screenH(dx, dz) { return dx * ISO_COS + dz * -ISO_SIN; }
function screenV(dx, dz) { return dx * -ISO_SIN + dz * -ISO_COS; }

// ═══════════════════════════════════════════════════════════════════════════
// TREE SHAKE STATE
// Groups all per-tree animation state into a single object.
// Created on first collision, reused across subsequent collisions.
// ═══════════════════════════════════════════════════════════════════════════
function getShake(src) {
  if (!src._shake) {
    src._shake = {
      active: false,    // currently animating
      start: 0,         // _renderTime when shake began
      end: 0,           // _renderTime when player left (0 = still overlapping)
      dir: 0,           // vertical: +1 from below, -1 from above, 0 suppressed
      phase: 0,         // horizontal oscillation start phase
      hInt: 1.0,        // horizontal intensity 0-1
      vInt: 1.0,        // vertical intensity 0-1
      wasMoving: false,  // was player moving last frame (for stop/start detection)
    };
  }
  return src._shake;
}

// --- Collision interaction table ---
// ═══════════════════════════════════════════════════════════════════════════
// COLLIDER SYSTEM
// A collider is a uniform circle: { type, colX, colZ, colR, src }
//   type  — key into COLLIDER_TYPES (defines behavior & debug viz)
//   colX  — world-space X of circle center
//   colZ  — world-space Z of circle center
//   colR  — circle radius
//   src   — reference to owning game object (tree data, rock data, player, etc.)
// All collision checks, proximity tests, and debug rings use this shape.
// ═══════════════════════════════════════════════════════════════════════════

// RULE: "collision with a tree" always means the tree's collider circle (colX, colZ, colR),
// never the billboard anchor or billboard bounding box. The collider represents the visible
// trunk/canopy mass and is the only geometry used for proximity checks, spawn clearance,
// overlap testing, and player blocking.
// Each object type has: blocksPlayer (pushes player out), debug viz style.
// Future: add blocksNPC, blocksProjectile, etc.
const COLLIDER_TYPES = {
  player:      { blocksPlayer: false, debugColor: [0.3, 1.0, 0.1],  debugStyle: 'solid'  },
  tree:        { blocksPlayer: true,  debugColor: [1.0, 0.15, 0.1],  debugStyle: 'solid'  },
  tree_forest: { blocksPlayer: false, slowsPlayer: 0.60, debugColor: [0.1, 0.7, 0.2], debugStyle: 'solid' },
  rock:        { blocksPlayer: true,  debugColor: [1.0, 0.85, 0.1],  debugStyle: 'solid'  },
  minable:     { blocksPlayer: true,  debugColor: [0.7, 0.15, 0.9],  debugStyle: 'solid'  },
  stick:       { blocksPlayer: false, debugColor: [0.2, 0.85, 0.85], debugStyle: 'dotted' },
  creature:    { blocksPlayer: false, debugColor: [1.0, 0.6, 0.9],  debugStyle: 'solid'  },
};

// Build unified collider list per region (called once at region init, no per-frame alloc)
function buildRegionColliders(reg) {
  const colliders = [];
  for (let i = 0; i < reg.treePositions.length; i++) {
    const t = reg.treePositions[i];
    const varName = reg.treeVarIdx[i];
    const isForest = typeof varName === 'string' && varName.startsWith('fir_');
    const colType = isForest ? 'tree_forest' : 'tree';
    colliders.push({ type: colType, colX: t.colX, colZ: t.colZ, colR: t.colR, colY: t.y, src: t });
    if (t.extraCols) {
      for (const ec of t.extraCols) {
        colliders.push({ type: colType, colX: ec.colX, colZ: ec.colZ, colR: ec.colR, colY: t.y, src: t });
      }
    }
  }
  for (const r of reg.rocks) {
    colliders.push({ type: 'rock', colX: r.colX, colZ: r.colZ, colR: r.colR, colY: r.y, src: r });
  }
  for (const cluster of reg.minables) {
    for (const col of cluster.colliders) {
      colliders.push({ type: 'minable', colX: col.colX, colZ: col.colZ, colR: col.colR, colY: col.colY, src: col, cluster: cluster });
    }
  }
  for (const st of reg.sticks) {
    colliders.push({ type: 'stick', colX: st.colX, colZ: st.colZ, colR: st.colR, colY: st.y, src: st });
  }
  reg.allColliders = colliders;
}

// ═══════════════════════════════════════════════════════════════════════════
// COLLISION QUERY
// Shared spatial query for any system that needs "what's near this point?"
// Works for player, creatures, NPC AI — any actor at a world position.
// Currently brute-force over nearby regions; grid partition can slot in later
// without changing the API.
// ═══════════════════════════════════════════════════════════════════════════
const CollisionQuery = {
  // Returns all colliders within `radius` of world position (wx, wz).
  // filter: optional collider type string or array of strings.
  // Returns array of { collider, distSq } sorted by distance (nearest first).
  // Reuses internal array — do not hold references across frames.
  _results: [],

  queryNearby(wx, wz, radius, filter) {
    const results = this._results;
    results.length = 0;
    const pgx = Math.round(wx / REGION_SIZE);
    const pgz = Math.round(wz / REGION_SIZE);
    const rSq = radius * radius;
    // Check 3x3 regions around query position
    for (let dz = -1; dz <= 1; dz++) {
      for (let dx = -1; dx <= 1; dx++) {
        const gx = pgx + dx, gz = pgz + dz;
        if (gx < -GRID_HALF || gx > GRID_HALF || gz < -GRID_HALF || gz > GRID_HALF) continue;
        const reg = regionCache.get(gx * 1000 + gz);
        if (!reg) continue;
        if (!reg.allColliders) buildRegionColliders(reg);
        for (const col of reg.allColliders) {
          if (filter) {
            if (typeof filter === 'string') { if (col.type !== filter) continue; }
            else { if (!filter.includes(col.type)) continue; }
          }
          const ddx = wx - col.colX, ddz = wz - col.colZ;
          const distSq = ddx * ddx + ddz * ddz;
          const reach = radius + col.colR;
          if (distSq < reach * reach) {
            results.push({ collider: col, distSq });
          }
        }
      }
    }
    // Sort nearest first
    if (results.length > 1) {
      results.sort((a, b) => a.distSq - b.distSq);
    }
    return results;
  },
};

// ═══════════════════════════════════════════════════════════════════════════
// INTERACTABLE REGISTRY & INTERACTION SYSTEM
// Objects register as interactable with a type and handler. Any actor (player
// or NPC) can query nearby interactables and trigger interactions.
//
// Interactable types are distinct from collider types — a tree blocks
// movement but isn't interactable. A crystal cluster blocks movement AND
// is interactable. Future: an NPC might be interactable but not blocking.
//
// Registration happens during RegionManager.onLoad. Interactables are
// automatically cleaned up on onUnload.
// ═══════════════════════════════════════════════════════════════════════════

// Registry: each region key maps to an array of interactables
const _interactablesByRegion = new Map();

const InteractionSystem = {
  // Interactable: { type, wx, wz, radius, data, onInteract(actor, interactable, dt) }
  //   type     — string identifier for filtering ('minable', 'npc', 'pickup', etc.)
  //   wx, wz   — world position
  //   radius   — interaction range (how close actor must be)
  //   data     — arbitrary payload (cluster ref, NPC ref, etc.)
  //   onInteract — called each tick while actor is in range

  // Register an interactable for a region
  register(gx, gz, interactable) {
    const key = gx * 1000 + gz;
    let list = _interactablesByRegion.get(key);
    if (!list) { list = []; _interactablesByRegion.set(key, list); }
    list.push(interactable);
  },

  // Remove all interactables for a region
  clearRegion(gx, gz) {
    _interactablesByRegion.delete(gx * 1000 + gz);
  },

  // Query interactables near a world position.
  // filter: optional type string or array of strings.
  // Returns array of { interactable, distSq } sorted nearest first.
  _queryResults: [],

  queryNearby(wx, wz, radius, filter) {
    const results = this._queryResults;
    results.length = 0;
    const pgx = Math.round(wx / REGION_SIZE);
    const pgz = Math.round(wz / REGION_SIZE);
    for (let dz = -1; dz <= 1; dz++) {
      for (let dx = -1; dx <= 1; dx++) {
        const gx = pgx + dx, gz = pgz + dz;
        if (gx < -GRID_HALF || gx > GRID_HALF || gz < -GRID_HALF || gz > GRID_HALF) continue;
        const list = _interactablesByRegion.get(gx * 1000 + gz);
        if (!list) continue;
        for (const ia of list) {
          if (filter) {
            if (typeof filter === 'string') { if (ia.type !== filter) continue; }
            else { if (!filter.includes(ia.type)) continue; }
          }
          const ddx = wx - ia.wx, ddz = wz - ia.wz;
          const distSq = ddx * ddx + ddz * ddz;
          const reach = radius + ia.radius;
          if (distSq < reach * reach) {
            results.push({ interactable: ia, distSq });
          }
        }
      }
    }
    if (results.length > 1) {
      results.sort((a, b) => a.distSq - b.distSq);
    }
    return results;
  },

  // Tick: called each frame for an actor. Fires onInteract for all
  // interactables the actor is within range of. Drives progress bar
  // for the nearest interactable that has showProgress: true and
  // a getProgress() method returning 0-1.
  tickActor(wx, wz, radius, actor, dt, filter) {
    const nearby = this.queryNearby(wx, wz, radius, filter);
    let progressShown = false;
    for (const entry of nearby) {
      const ia = entry.interactable;
      ia.onInteract(actor, ia, dt);
      if (!progressShown && ia.showProgress && ia.getProgress) {
        _progressBar = { progress: ia.getProgress(), duration: ia.getDuration ? ia.getDuration() : undefined };
        progressShown = true;
      }
    }
    if (!progressShown) _progressBar = null;
  },
};

// ═══════════════════════════════════════════════════════════════════════════
// MINING INTERACTION
// Player auto-mines when standing near minable clusters. Each cluster
// has a mine timer; when it fills, one mineral is collected.
// ═══════════════════════════════════════════════════════════════════════════
const MINE_INTERVAL = 2.5; // seconds per mineral
let _mineralsMined = 0;

// Register minable clusters as interactable on region load
RegionManager.onLoad((reg) => {
  for (const cluster of reg.minables) {
    // Interaction center = average of collider positions
    let cx = 0, cz = 0;
    for (const col of cluster.colliders) { cx += col.colX; cz += col.colZ; }
    cx /= cluster.colliders.length;
    cz /= cluster.colliders.length;
    // Interaction radius = covers all colliders + a small approach margin
    let maxR = 0;
    for (const col of cluster.colliders) {
      const d = Math.sqrt((col.colX - cx) * (col.colX - cx) + (col.colZ - cz) * (col.colZ - cz)) + col.colR;
      if (d > maxR) maxR = d;
    }
    // Per-cluster mining state
    cluster._mineTimer = 0;

    InteractionSystem.register(reg.gx, reg.gz, {
      type: 'minable',
      wx: cx, wz: cz,
      radius: maxR + 0.3, // approach margin
      data: cluster,
      showProgress: true,
      getProgress() { return cluster._mineTimer / MINE_INTERVAL; },
      getDuration() { return MINE_INTERVAL; },
      onInteract(actor, ia, dt) {
        const cl = ia.data;
        cl._mineTimer += dt;
        if (cl._mineTimer >= MINE_INTERVAL) {
          cl._mineTimer -= MINE_INTERVAL;
          _mineralsMined++;
        }
      },
    });
  }
});

// Clear interactables on region unload
RegionManager.onUnload((reg) => {
  InteractionSystem.clearRegion(reg.gx, reg.gz);
});

// --- Collision event callbacks ---
// Fired when two colliders begin/end overlapping.
// colA and colB are collider objects: { type, colX, colZ, colR, src }
// Currently fired by CharacterController for player vs non-blocking items.
// Future: item-vs-item, NPC-vs-item, etc.

// Trees with active "from below" squish tracked via sh._pushed flag on each
// tree's shake state. _pushedTreeCount tracks how many are active for sort bias.
let _pushedTreeCount = 0;

function onCollideStart(colA, colB) {
  if (colB.type === 'tree_forest') {
    const cc = CharacterController;
    // Only animate if player is moving (caller checks too, but defensive)
    if (!cc.isMoving) return;
    const src = colB.src;
    const sh = getShake(src);
    if (!sh.active) sh.start = _renderTime;
    sh.active = true;
    sh.end = 0;

    // Collision direction: colA → colB
    const dx = colB.colX - colA.colX;
    const dz = colB.colZ - colA.colZ;

    // Horizontal phase: lean away from impact side
    const dotH = screenH(dx, dz);
    const basePhaseH = dotH >= 0 ? Math.PI * 0.5 : -Math.PI * 0.5;
    sh.phase = basePhaseH + (Math.random() - 0.5) * 0.8;

    // Vertical direction
    const dotV = screenV(dx, dz);
    sh.dir = dotV >= 0 ? 1.0 : -1.0;

    // Track "from below" pushes for sort bias
    if (sh.dir > 0 && !sh._pushed) {
      sh._pushed = true;
      _pushedTreeCount++;
    }

    // Horizontal intensity from movement direction
    sh.hInt = Math.max(0.15, Math.abs(screenH(cc.mx, cc.mz)));

    // Vertical intensity from movement direction
    sh.vInt = Math.max(0.10, Math.abs(screenV(cc.mx, cc.mz)));
  }
}

function onColliding(colA, colB) {
  if (colB.type === 'tree_forest') {
    const cc = CharacterController;
    const sh = getShake(colB.src);
    if (sh.wasMoving && !cc.isMoving) {
      // Player stopped moving on tree — begin settle
      sh.wasMoving = false;
      if (sh.active && !sh.end) {
        sh.end = _renderTime;
      }
    } else if (!sh.wasMoving && cc.isMoving) {
      // Player started moving again while still on tree — restart horizontal only
      sh.wasMoving = true;
      sh.start = _renderTime;
      sh.active = true;
      sh.end = 0;
      sh.dir = 0; // suppress vertical
      sh.vInt = 0;
      // Recompute horizontal phase and intensity from current movement
      const dx = colB.colX - colA.colX;
      const dz = colB.colZ - colA.colZ;
      const dotH = screenH(dx, dz);
      const basePhase = dotH >= 0 ? Math.PI * 0.5 : -Math.PI * 0.5;
      sh.phase = basePhase + (Math.random() - 0.5) * 0.8;
      sh.hInt = Math.max(0.15, Math.abs(screenH(cc.mx, cc.mz)));
    }
  }
}

function onCollideEnd(colA, colB) {
  if (colB.type === 'tree_forest') {
    const sh = getShake(colB.src);
    sh.end = _renderTime;
    sh.wasMoving = false;
    // active stays true — draw code handles the settle-back
  }
}

// (resolveCollisions now in CharacterController.resolveCollisions)

// ═══════════════════════════════════════════════════════════════════════════
// CREATURE CONTROLLER
// Manages ambient creatures (rabbits, deer, etc.) with per-type behaviors.
// Each creature has a state machine driven by its type's tick function.
// AI ticks at a reduced rate (per-type); visual interpolation runs every frame.
// ═══════════════════════════════════════════════════════════════════════════

// --- Creature type registry ---
// Each type defines species behavior, rendering config, and tick rate.
// Behavior is fully defined by onSpawn/onTick/onFrame callbacks.
const CreatureTypes = {};

function registerCreatureType(def) {
  CreatureTypes[def.id] = def;
}

// --- Creature instance factory ---
function createCreature(typeId, wx, wz, regionGx, regionGz) {
  const type = CreatureTypes[typeId];
  if (!type) throw new Error('Unknown creature type: ' + typeId);
  const c = {
    type,
    // World position (ground truth)
    x: wx, z: wz,
    y: 0, // snapped to terrain each tick
    // Visual offset (for hop/bounce animation — not applied to collider)
    visualYOffset: 0,
    // Direction facing (radians, 0 = +X world axis)
    facing: Math.random() * Math.PI * 2,
    // State machine
    state: 'idle',
    stateTime: 0,
    // Home region
    regionGx, regionGz,
    // Freeform per-behavior state
    custom: {},
    // Collider (updated each tick)
    collider: {
      type: type.colliderType || 'creature',
      colX: wx, colZ: wz, colR: type.colR || 0.1,
      colY: 0, src: null,
    },
    // AI tick tracking
    _tickAccum: Math.random() * (1 / (type.tickRate || 4)), // stagger initial ticks
    // Active flag (for despawn)
    alive: true,
  };
  c.collider.src = c;
  c.y = getWorldHeight(wx, wz);
  c.collider.colY = c.y;
  if (type.onSpawn) type.onSpawn(c);
  return c;
}

// --- Creature Controller (system) ---
const CreatureController = {
  creatures: [],

  spawn(typeId, wx, wz, regionGx, regionGz) {
    const c = createCreature(typeId, wx, wz, regionGx, regionGz);
    this.creatures.push(c);
    return c;
  },

  despawn(creature) {
    creature.alive = false;
  },

  // Called once per frame from main loop
  _tickCtx: {
    dt: 0, playerX: 0, playerZ: 0, playerY: 0, playerDist: 0,
    getHeight: null, getRegionColliders: null,
  },
  update(dt) {
    const cc = CharacterController;
    const creatures = this.creatures;
    // Remove dead creatures (swap-and-pop to avoid splice shifting)
    let len = creatures.length;
    for (let i = len - 1; i >= 0; i--) {
      if (!creatures[i].alive) {
        creatures[i] = creatures[--len];
      }
    }
    creatures.length = len;
    const ctx = this._tickCtx;
    ctx.getHeight = getWorldHeight;
    ctx.getRegionColliders = _getCreatureRegionColliders;
    ctx.playerX = cc.x; ctx.playerZ = cc.z; ctx.playerY = cc.y;
    for (let i = 0; i < creatures.length; i++) {
      const c = creatures[i];
      const type = c.type;
      // AI tick at type-specific rate
      const tickInterval = 1 / (type.tickRate || 4);
      c._tickAccum += dt;
      if (c._tickAccum >= tickInterval) {
        c._tickAccum -= tickInterval;
        ctx.dt = tickInterval;
        ctx.playerDist = Math.sqrt((c.x - cc.x) * (c.x - cc.x) + (c.z - cc.z) * (c.z - cc.z));
        if (type.onTick) type.onTick(c, ctx);
        // Snap to terrain
        c.y = getWorldHeight(c.x, c.z);
        c.collider.colX = c.x;
        c.collider.colZ = c.z;
        c.collider.colY = c.y;
      }
      // Visual interpolation every frame
      c.stateTime += dt;
      if (type.onFrame) type.onFrame(c, dt);
    }
  },

};

// Helper: get colliders for a creature's region (for avoidance/pathfinding)
function _getCreatureRegionColliders(gx, gz) {
  const key = gx * 1000 + gz;
  const reg = regionCache.get(key);
  if (reg) {
    if (!reg.allColliders) buildRegionColliders(reg);
    return reg.allColliders;
  }
  return [];
}

// ═══════════════════════════════════════════════════════════════════════════
// ═══════════════════════════════════════════════════════════════════════════
// MOVEMENT PATTERNS
// Define *how* a creature moves from A to B. AI decides the destination;
// the pattern handles easing, speed curves, vertical bounce, and timing.
// Usage: MovementPatterns.start(creature, patternName, targetX, targetZ)
//        MovementPatterns.update(creature, dt) → true when done
// ═══════════════════════════════════════════════════════════════════════════
const _movementPatterns = {};

function registerMovementPattern(def) {
  _movementPatterns[def.id] = def;
}

const MovementPatterns = {
  start(c, patternId, tx, tz) {
    const pat = _movementPatterns[patternId];
    if (!pat) throw new Error('Unknown movement pattern: ' + patternId);
    c._move = {
      pat,
      startX: c.x, startZ: c.z,
      targetX: tx, targetZ: tz,
      t: 0,           // overall progress 0→1
      phase: 0,       // sub-phase for pattern use (e.g. hop cycle)
      done: false,
      custom: {},      // pattern-specific state
    };
    if (pat.onStart) pat.onStart(c, c._move);
  },

  // Returns true when movement is complete
  update(c, dt) {
    const m = c._move;
    if (!m || m.done) return true;
    m.pat.onUpdate(c, m, dt);
    return m.done;
  },

  // Per-frame visual interpolation (called every frame, not just AI ticks)
  frame(c, dt) {
    const m = c._move;
    if (!m || m.done) {
      // Decay any leftover visual offset
      c.visualYOffset *= 0.85;
      if (Math.abs(c.visualYOffset) < 0.001) c.visualYOffset = 0;
      return;
    }
    if (m.pat.onFrame) m.pat.onFrame(c, m, dt);
  },

  isActive(c) {
    return c._move && !c._move.done;
  },
};

// --- HOP pattern ---
// Moves in a series of discrete hops with sinusoidal vertical bounce and
// ease-in-out XZ speed per hop. Each hop covers an equal fraction of the
// total distance.
registerMovementPattern({
  id: 'hop',
  onStart(c, m) {
    const dx = m.targetX - m.startX;
    const dz = m.targetZ - m.startZ;
    const totalDist = Math.sqrt(dx * dx + dz * dz);
    m.custom.numHops = Math.max(1, Math.min(8, Math.round(totalDist / 0.6)));
    m.custom.hopIndex = 0;
    m.custom.hopPhase = 0;
    m.custom.hopDuration = 0.55;
    m.custom.totalDist = totalDist;
    m.status = 'jumping'; // initial status
  },
  onUpdate(c, m, dt) {
    // onUpdate only checks completion — onFrame handles all animation
    if (m.done) return;
    const h = m.custom;
    if (h.hopIndex >= h.numHops) {
      c.x = m.targetX;
      c.z = m.targetZ;
      c.visualYOffset = 0;
      m.status = 'grounded';
      m.done = true;
    }
  },
  onFrame(c, m, dt) {
    const h = m.custom;
    if (h.hopIndex >= h.numHops) return;
    h.hopPhase += dt / h.hopDuration;
    if (h.hopPhase >= 1.0) {
      h.hopPhase -= 1.0;
      h.hopIndex++;
      if (h.hopIndex >= h.numHops) {
        c.x = m.targetX;
        c.z = m.targetZ;
        c.visualYOffset = 0;
        m.status = 'grounded';
        m.done = true;
        return;
      }
    }
    m.status = h.hopPhase < 0.5 ? 'jumping' : 'falling';
    const eased = h.hopPhase * h.hopPhase * (3 - 2 * h.hopPhase);
    const hopFrac = (h.hopIndex + eased) / h.numHops;
    c.x = m.startX + (m.targetX - m.startX) * hopFrac;
    c.z = m.startZ + (m.targetZ - m.startZ) * hopFrac;
    c.visualYOffset = Math.sin(h.hopPhase * Math.PI) * 0.5;
  },
});

// CREATURE TYPE: RABBIT
// Small forest creature. Hops in a random direction, pauses, repeats.
// Textured quad, Y-rotated to show facing direction.
// ═══════════════════════════════════════════════════════════════════════════
registerCreatureType({
  id: 'rabbit',
  tickRate: 6, // AI ticks per second
  colR: 0.08,
  colliderType: 'creature', // non-blocking
  // Rendering: vertical flat quad, Y-rotated to show facing
  textureId: 'rabbit',
  atlasCols: 4, // poses: standing, sitting, hop_up, landing
  atlasRows: 3, // color variants
  meshSize: [0.18, 0.18, 1.0], // width, height (Z unused for quad but must be nonzero)

  onSpawn(c) {
    c.custom = {
      idleDuration: 0,
      displayRotY: 3 * Math.PI / 4,
      variant: Math.floor(Math.random() * 3),
      flipU: 0,
      scale: 1.0 + Math.random() * 0.35,
      movePattern: 'hop',
      poseFrame: 0, // 0=standing, 1=sitting, 2=hop_up, 3=landing
    };
    // Start with a hop in the facing direction
    const dist = 1.5 + Math.random() * 3.0;
    const ox = c.regionGx * REGION_SIZE, oz = c.regionGz * REGION_SIZE;
    const margin = 0.3;
    const tx = Math.max(ox - S + margin, Math.min(ox + S - margin, c.x + Math.cos(c.facing) * dist));
    const tz = Math.max(oz - S + margin, Math.min(oz + S - margin, c.z + Math.sin(c.facing) * dist));
    MovementPatterns.start(c, 'hop', tx, tz);
    c.state = 'moving';
    c.stateTime = 0;
  },

  onTick(c, ctx) {
    const cu = c.custom;
    switch (c.state) {
      // Moving → normal pause when done
      case 'moving': {
        const done = MovementPatterns.update(c, ctx.dt);
        // Update pose from movement status
        const status = c._move && c._move.status;
        if (status === 'jumping') cu.poseFrame = 2;
        else if (status === 'falling') cu.poseFrame = 3;
        else cu.poseFrame = 0;
        if (done) {
          cu.poseFrame = 0; // standing
          c.state = 'idle';
          c.stateTime = 0;
          cu.idleDuration = 2.0 + Math.random() * 5.0;
        }
        break;
      }

      // Normal pause → always turn after
      case 'idle':
        if (c.stateTime >= cu.idleDuration) {
          c.state = 'turning';
          c.stateTime = 0;
          cu.turnFrom = c.facing;
          cu.turnTo = Math.random() * Math.PI * 2;
          cu.turnDuration = 0.2 + Math.random() * 0.2;
        }
        break;

      // Turn → small pause
      case 'turning': {
        const t = Math.min(1, c.stateTime / cu.turnDuration);
        let delta = cu.turnTo - cu.turnFrom;
        while (delta > Math.PI) delta -= Math.PI * 2;
        while (delta < -Math.PI) delta += Math.PI * 2;
        c.facing = cu.turnFrom + delta * t;
        if (t >= 1) {
          c.facing = cu.turnTo;
          c.state = 'post_turn';
          c.stateTime = 0;
          cu.postTurnPause = cu._fromSitting ? (0.05 + Math.random() * 0.1) : (0.3 + Math.random() * 0.4);
          cu._fromSitting = false;
        }
        break;
      }

      // Small pause after turn → move or sit
      case 'post_turn':
        if (c.stateTime >= cu.postTurnPause) {
          if (Math.random() < 0.35) {
            // Don't move → sit, pause, then turn again
            cu.poseFrame = 1; // sitting
            c.state = 'sitting';
            c.stateTime = 0;
            cu.sitDuration = 3.0 + Math.random() * 6.0;
          } else {
            // Move → standing, brief pause, then hop
            cu.poseFrame = 0; // standing
            c.state = 'pre_move';
            c.stateTime = 0;
            cu.preMovePause = 0.2 + Math.random() * 0.3;
          }
        }
        break;

      // Sitting → turn again (which leads back to post_turn → decide again)
      case 'sitting':
        if (c.stateTime >= cu.sitDuration) {
          cu.poseFrame = 0; // standing
          c.state = 'turning';
          c.stateTime = 0;
          cu.turnFrom = c.facing;
          cu.turnTo = Math.random() * Math.PI * 2;
          cu.turnDuration = 0.15 + Math.random() * 0.15;
          cu._fromSitting = true;
        }
        break;

      // Brief standing pause before initiating movement
      case 'pre_move':
        if (c.stateTime >= cu.preMovePause) {
          const dist = 1.5 + Math.random() * 3.0;
          const ox = c.regionGx * REGION_SIZE, oz = c.regionGz * REGION_SIZE;
          const margin = 0.3;
          const tx = Math.max(ox - S + margin, Math.min(ox + S - margin, c.x + Math.cos(c.facing) * dist));
          const tz = Math.max(oz - S + margin, Math.min(oz + S - margin, c.z + Math.sin(c.facing) * dist));
          MovementPatterns.start(c, cu.movePattern, tx, tz);
          c.state = 'moving';
          c.stateTime = 0;
        }
        break;
    }
  },

  onFrame(c, dt) {
    MovementPatterns.frame(c, dt);
    const cu = c.custom;

    // Compute screen-space direction from world facing
    const dx = Math.cos(c.facing);
    const dz = Math.sin(c.facing);
    const sh = screenH(dx, dz);
    const sv = screenV(dx, dz);
    const len = Math.sqrt(sh * sh + sv * sv);
    const shNorm = len > 0.001 ? sh / len : 0;

    // visualForward: +1 = image faces screen-right, -1 = faces screen-left
    // This is the single source of truth for "which way the sprite looks"
    if (len > 0.001) {
      cu.visualForward = shNorm > 0 ? 1 : -1;
    }
    // flipU mirrors the texture when facing screen-right (sprite drawn facing left)
    cu.flipU = cu.visualForward > 0 ? 1 : 0;

    // Update pose from movement status at frame rate
    if (c.state === 'moving' && c._move) {
      const status = c._move.status;
      if (status === 'jumping') cu.poseFrame = 2;
      else if (status === 'falling') cu.poseFrame = 3;
      else cu.poseFrame = 0;
      // Tilt billboard in screen space: lean back jumping, forward landing
      const baseTilt = status === 'jumping' ? 0.35 : status === 'falling' ? -0.35 : 0;
      const targetTilt = baseTilt * cu.visualForward;
      cu.tiltZ = cu.tiltZ || 0;
      cu.tiltZ += (targetTilt - cu.tiltZ) * Math.min(1, 10 * dt);
    } else {
      cu.tiltZ = (cu.tiltZ || 0) * (1 - Math.min(1, 10 * dt));
      if (Math.abs(cu.tiltZ) < 0.001) cu.tiltZ = 0;
    }

    // Y rotation: quad faces toward camera with slight angle based on facing
    const CENTER_ROT = 3 * Math.PI / 4;
    const MAX_OFFSET = 35 * Math.PI / 180;
    const svNorm = len > 0.001 ? sv / len : 0;
    const rotSign = svNorm < 0 ? -1 : 1;
    const vertScale = Math.abs(svNorm);
    let targetRotY = CENTER_ROT - shNorm * MAX_OFFSET * rotSign * vertScale;
    if (targetRotY < Math.PI / 2) targetRotY = Math.PI / 2;
    if (targetRotY > Math.PI) targetRotY = Math.PI;
    const diff = targetRotY - cu.displayRotY;
    cu.displayRotY += diff * Math.min(1, 12.0 * dt);
    if (cu.displayRotY < Math.PI / 2) cu.displayRotY = Math.PI / 2;
    if (cu.displayRotY > Math.PI) cu.displayRotY = Math.PI;
  },
});

// ═══════════════════════════════════════════════════════════════════════════
// REGION LIFECYCLE HOOKS
// Creature spawn/despawn tied to region load/unload events.
// ═══════════════════════════════════════════════════════════════════════════
RegionManager.onLoad((reg) => {
  // Spawn creatures appropriate to this biome
  if (reg.biomeName === 'forest') {
    const count = 2 + Math.floor(Math.random() * 4); // 2-5 rabbits
    for (let i = 0; i < count; i++) {
      const rx = (Math.random() - 0.5) * REGION_SIZE * 0.7;
      const rz = (Math.random() - 0.5) * REGION_SIZE * 0.7;
      CreatureController.spawn('rabbit', reg.gx * REGION_SIZE + rx, reg.gz * REGION_SIZE + rz, reg.gx, reg.gz);
    }
  }
});

RegionManager.onUnload((reg) => {
  // Despawn all creatures that belong to this region
  const creatures = CreatureController.creatures;
  for (let i = 0; i < creatures.length; i++) {
    const c = creatures[i];
    if (c.alive && c.regionGx === reg.gx && c.regionGz === reg.gz) {
      c.alive = false;
    }
  }
});

// --- Matrix helpers ---
const _orthoMat = new Float32Array(16);
function ortho(left, right, bottom, top, near, far) {
  const lr = 1 / (left - right);
  const bt = 1 / (bottom - top);
  const nf = 1 / (near - far);
  _orthoMat[0] = -2*lr; _orthoMat[1] = 0; _orthoMat[2] = 0; _orthoMat[3] = 0;
  _orthoMat[4] = 0; _orthoMat[5] = -2*bt; _orthoMat[6] = 0; _orthoMat[7] = 0;
  _orthoMat[8] = 0; _orthoMat[9] = 0; _orthoMat[10] = 2*nf; _orthoMat[11] = 0;
  _orthoMat[12] = (left+right)*lr; _orthoMat[13] = (top+bottom)*bt; _orthoMat[14] = (far+near)*nf; _orthoMat[15] = 1;
  return _orthoMat;
}

const _viewMat = new Float32Array(16);
function lookAt(eye, center, up) {
  // Forward (z axis)
  let zx = eye[0]-center[0], zy = eye[1]-center[1], zz = eye[2]-center[2];
  let l = Math.sqrt(zx*zx+zy*zy+zz*zz);
  zx /= l; zy /= l; zz /= l;
  // Right (x axis) = up cross z
  let xx = up[1]*zz-up[2]*zy, xy = up[2]*zx-up[0]*zz, xz = up[0]*zy-up[1]*zx;
  l = Math.sqrt(xx*xx+xy*xy+xz*xz);
  xx /= l; xy /= l; xz /= l;
  // True up (y axis) = z cross x
  const yx = zy*xz-zz*xy, yy = zz*xx-zx*xz, yz = zx*xy-zy*xx;
  _viewMat[0] = xx; _viewMat[1] = yx; _viewMat[2] = zx; _viewMat[3] = 0;
  _viewMat[4] = xy; _viewMat[5] = yy; _viewMat[6] = zy; _viewMat[7] = 0;
  _viewMat[8] = xz; _viewMat[9] = yz; _viewMat[10] = zz; _viewMat[11] = 0;
  _viewMat[12] = -(xx*eye[0]+xy*eye[1]+xz*eye[2]);
  _viewMat[13] = -(yx*eye[0]+yy*eye[1]+yz*eye[2]);
  _viewMat[14] = -(zx*eye[0]+zy*eye[1]+zz*eye[2]);
  _viewMat[15] = 1;
  return _viewMat;
}

// (Camera state and input handlers now in CameraController above)

// --- Fullscreen toggle ---
const fsBtn = document.getElementById('fsBtn');
const fsIcon = document.getElementById('fsIcon');

const expandSVG = '<polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/>';
const shrinkSVG = '<polyline points="4 14 4 20 10 20"/><polyline points="20 10 20 4 14 4"/><line x1="14" y1="10" x2="20" y2="4"/><line x1="4" y1="20" x2="10" y2="14"/>';

fsBtn.addEventListener('click', () => {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen();
  } else {
    document.exitFullscreen();
  }
});

document.addEventListener('fullscreenchange', () => {
  fsIcon.innerHTML = document.fullscreenElement ? shrinkSVG : expandSVG;
});

// --- Stats toggle ---
const statsWrap = document.getElementById('statsWrap');
const statsPanel = document.getElementById('stats');
const statsToggle = document.getElementById('statsToggle');
const statsArrow = document.getElementById('statsArrow');
let statsOpen = true;

// FPS cap
let fpsCap = 0; // 0 = uncapped
let lastFrameTime = 0;
const fpsCapBtn = document.getElementById('fpsCapBtn');

function updateFpsCapBtn() {
  if (fpsCap > 0) {
    fpsCapBtn.innerHTML = '60';
    fpsCapBtn.style.background = 'linear-gradient(180deg, #1a1a3a 0%, #0a0a1f 100%)';
    fpsCapBtn.title = 'FPS cap: 60';
  } else {
    fpsCapBtn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.7)" stroke-width="2.5" stroke-linecap="round"><line x1="5" y1="19" x2="19" y2="5"/></svg>';
    fpsCapBtn.style.background = 'linear-gradient(180deg, #2a2a30 0%, #0a0a0f 100%)';
    fpsCapBtn.title = 'FPS cap: off';
  }
}

fpsCapBtn.addEventListener('click', () => {
  fpsCap = fpsCap > 0 ? 0 : 60;
  updateFpsCapBtn();
});
updateFpsCapBtn();

statsToggle.addEventListener('click', () => {
  statsOpen = !statsOpen;
  const fsBtn = document.getElementById('fsBtn');
  const colBtn = document.getElementById('colBtn');
  const wireBtn = document.getElementById('wireBtn');
  const hillBtn = document.getElementById('hillBtn');
  const biomeHud = document.getElementById('biomeHud');
  if (statsOpen) {
    statsPanel.style.display = '';
    fsBtn.style.display = '';
    colBtn.style.display = '';
    wireBtn.style.display = '';
    hillBtn.style.display = '';
    biomeHud.style.display = '';
    fpsCapBtn.style.display = '';
    statsArrow.innerHTML = '<polyline points="15 18 9 12 15 6"/>';
    statsToggle.title = 'Hide UI';
  } else {
    statsPanel.style.display = 'none';
    fsBtn.style.display = 'none';
    colBtn.style.display = 'none';
    wireBtn.style.display = 'none';
    hillBtn.style.display = 'none';
    biomeHud.style.display = 'none';
    fpsCapBtn.style.display = 'none';
    statsArrow.innerHTML = '<polyline points="9 18 15 12 9 6"/>';
    statsToggle.title = 'Show UI';
  }
});

// ═══════════════════════════════════════════════════════════════════════════
// DEBUG VISUALIZATION
// Centralized debug rendering. Toggle with colBtn. Two hook points:
//   drawItems()    — collider rings, player ring, deadzone, labels (post-sort)
//   drawOverlays() — region edges, border margins, future paths (end of frame)
// Add future viz with: DebugVis.addOverlay((gl, proj, view, regions) => { ... })
// ═══════════════════════════════════════════════════════════════════════════
const DebugVis = {
  active: false,
  showDeadzone: false,

  // --- Wireframe rendering (instanced per mesh type) ---
  _wire: null,
  _wireBatch: null,     // InstanceBatch(16) for model matrices
  _wireBillBatch: null,  // InstanceBatch(5) for billboard transforms

  _ensureWire() {
    if (this._wire) return this._wire;

    // Instanced wire shader for model-matrix types
    const prog = gl.createProgram();
    const vs = createShader(gl.VERTEX_SHADER, `#version 300 es
      layout(location=0) in vec3 aPos;
      layout(location=1) in mat4 iModel;
      uniform mat4 uProj, uView;
      void main() {
        gl_Position = uProj * uView * iModel * vec4(aPos, 1.0);
      }
    `);
    const fs = createShader(gl.FRAGMENT_SHADER, `#version 300 es
      precision mediump float;
      out vec4 fragColor;
      uniform vec3 uColor;
      void main() { fragColor = vec4(uColor, 1.0); }
    `);
    gl.attachShader(prog, vs); gl.attachShader(prog, fs); gl.linkProgram(prog);
    const aPos = 0;
    const iModel = 1; // mat4 occupies locations 1,2,3,4

    // Billboard wire shader
    const billProg = gl.createProgram();
    const bvs = createShader(gl.VERTEX_SHADER, `#version 300 es
      layout(location=0) in vec3 aPos;
      layout(location=1) in vec3 iBillPos;
      layout(location=2) in vec2 iBillSize;
      uniform mat4 uProj, uView;
      void main() {
        vec3 cr = vec3(uView[0][0], uView[1][0], uView[2][0]);
        vec3 cu = vec3(uView[0][1], uView[1][1], uView[2][1]);
        vec3 wp = iBillPos + cr * aPos.x * iBillSize.x + cu * aPos.y * iBillSize.y;
        gl_Position = uProj * uView * vec4(wp, 1.0);
      }
    `);
    const bfs = createShader(gl.FRAGMENT_SHADER, `#version 300 es
      precision mediump float;
      out vec4 fragColor;
      uniform vec3 uColor;
      void main() { fragColor = vec4(uColor, 1.0); }
    `);
    gl.attachShader(billProg, bvs); gl.attachShader(billProg, bfs); gl.linkProgram(billProg);
    const bAPos = 0, bIBillPos = 1, bIBillSize = 2;

    // Instance buffers (start small, grow dynamically)
    this._wireBatch = new InstanceBatch(16, 64);
    this._wireBillBatch = new InstanceBatch(5, 64);

    // Helper: create instanced wire VAO for model-matrix types
    function makeWireVAO(vbo, wireIbo, stride) {
      const vao = gl.createVertexArray();
      gl.bindVertexArray(vao);
      gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
      gl.enableVertexAttribArray(aPos);
      gl.vertexAttribPointer(aPos, 3, gl.FLOAT, false, stride, 0);
      const wmStride = DebugVis._wireBatch.floats * 4; // mat4 = 16 floats = 64 bytes
      gl.bindBuffer(gl.ARRAY_BUFFER, DebugVis._wireBatch.buf);
      for (let c = 0; c < 4; c++) {
        const loc = iModel + c;
        gl.enableVertexAttribArray(loc);
        gl.vertexAttribPointer(loc, 4, gl.FLOAT, false, wmStride, c * 16);
        gl.vertexAttribDivisor(loc, 1);
      }
      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, wireIbo);
      gl.bindVertexArray(null);
      return vao;
    }

    // Helper: create instanced wire VAO for billboard types
    function makeBillWireVAO(vbo, wireIbo, stride) {
      const vao = gl.createVertexArray();
      gl.bindVertexArray(vao);
      gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
      gl.enableVertexAttribArray(bAPos);
      gl.vertexAttribPointer(bAPos, 3, gl.FLOAT, false, stride, 0);
      const wbStride = DebugVis._wireBillBatch.floats * 4;
      gl.bindBuffer(gl.ARRAY_BUFFER, DebugVis._wireBillBatch.buf);
      gl.enableVertexAttribArray(bIBillPos);
      gl.vertexAttribPointer(bIBillPos, 3, gl.FLOAT, false, wbStride, 0);
      gl.vertexAttribDivisor(bIBillPos, 1);
      gl.enableVertexAttribArray(bIBillSize);
      gl.vertexAttribPointer(bIBillSize, 2, gl.FLOAT, false, wbStride, 3 * 4);
      gl.vertexAttribDivisor(bIBillSize, 1);
      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, wireIbo);
      gl.bindVertexArray(null);
      return vao;
    }

    const w = {
      prog, aPos, iModel,
      uProj: gl.getUniformLocation(prog, 'uProj'),
      uView: gl.getUniformLocation(prog, 'uView'),
      uColor: gl.getUniformLocation(prog, 'uColor'),
      billProg,
      bUProj: gl.getUniformLocation(billProg, 'uProj'),
      bUView: gl.getUniformLocation(billProg, 'uView'),
      bUColor: gl.getUniformLocation(billProg, 'uColor'),
    };

    // Build wire IBOs + instanced VAOs
    const treeWire = buildWireIBO(treeQuadIdx);
    w.treeVAO = makeBillWireVAO(treeVBO, treeWire.ibo, GROUND_VERT_STRIDE);
    w.treeCount = treeWire.count;

    const cubeWire = buildWireIBO(cubeIdx);
    w.cubeVAO = makeWireVAO(cubeVBO, cubeWire.ibo, MESH_VERT_STRIDE);
    w.cubeCount = cubeWire.count;

    const stickWire = buildWireIBO(stickMeshData.idx);
    w.stickVAO = makeWireVAO(stickVBO, stickWire.ibo, MESH_VERT_STRIDE);
    w.stickCount = stickWire.count;

    const cylWire = buildWireIBO(cylIdxData);
    w.cylVAO = makeWireVAO(cylVBO, cylWire.ibo, MESH_VERT_STRIDE);
    w.cylCount = cylWire.count;

    const rm = rockMeshes[0];
    const rockWire = buildWireIBO(rm.rawIdx);
    rm.wireIbo = rockWire.ibo; rm.wireIdxCount = rockWire.count;
    w.rockVAO = makeWireVAO(rm.vbo, rockWire.ibo, MESH_VERT_STRIDE);
    w.rockCount = rockWire.count;

    this._wire = w;
    return w;
  },

  // Draw wireframe over ground terrain
  drawWireground(gl, proj, view, activeRegions) {
    const w = this._ensureWire();
    gl.useProgram(w.prog);
    gl.uniformMatrix4fv(w.uProj, false, proj);
    gl.uniformMatrix4fv(w.uView, false, view);
    gl.uniform3f(w.uColor, 0.0, 0.9, 0.7);
    for (const reg of activeRegions) {
      // Lazy-build terrain wire IBO + VAO (with instanced attribs)
      if (!reg.terrain.wireIbo) {
        const wire = buildWireIBO(reg.terrain.rawCoreIdx);
        reg.terrain.wireIbo = wire.ibo;
        reg.terrain.wireIdxCount = wire.count;
        const vao = gl.createVertexArray();
        gl.bindVertexArray(vao);
        gl.bindBuffer(gl.ARRAY_BUFFER, reg.terrain.vbo);
        gl.enableVertexAttribArray(w.aPos);
        gl.vertexAttribPointer(w.aPos, 3, gl.FLOAT, false, GROUND_VERT_STRIDE, 0);
        // Bind instance buffer for iModel (even though we use 1 instance)
        const wmStride = DebugVis._wireBatch.floats * 4;
        gl.bindBuffer(gl.ARRAY_BUFFER, DebugVis._wireBatch.buf);
        for (let c = 0; c < 4; c++) {
          const loc = w.iModel + c;
          gl.enableVertexAttribArray(loc);
          gl.vertexAttribPointer(loc, 4, gl.FLOAT, false, wmStride, c * 16);
          gl.vertexAttribDivisor(loc, 1);
        }
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, wire.ibo);
        gl.bindVertexArray(null);
        reg.terrain.wireVAO = vao;
      }
      // Build translation matrix for this region
      const mat = this._wireBatch.data;
      mat[0] = 1; mat[1] = 0; mat[2] = 0; mat[3] = 0;
      mat[4] = 0; mat[5] = 1; mat[6] = 0; mat[7] = 0;
      mat[8] = 0; mat[9] = 0; mat[10] = 1; mat[11] = 0;
      mat[12] = reg.ox; mat[13] = 0.02; mat[14] = reg.oz; mat[15] = 1;
      this._wireBatch.upload(1);
      gl.bindVertexArray(reg.terrain.wireVAO);
      gl.drawElementsInstanced(gl.LINES, reg.terrain.wireIdxCount, gl.UNSIGNED_SHORT, 0, 1);
    }
    gl.bindVertexArray(null);
  },

  // --- Batched instanced wireframe drawing ---
  // Callers pack matrices via packWireMatrix, then call drawWireBatch to upload + draw.
  drawWireBatch(gl, proj, view, type, count) {
    const w = this._ensureWire();
    let vao, idxCount;
    if (type === 'rock') { vao = w.rockVAO; idxCount = w.rockCount; }
    else if (type === 'stick') { vao = w.stickVAO; idxCount = w.stickCount; }
    else if (type === 'minable') { vao = w.cubeVAO; idxCount = w.cubeCount; }
    else if (type === 'player') { vao = w.cylVAO; idxCount = w.cylCount; }
    else return;

    if (count === 0) return;

    gl.useProgram(w.prog);
    gl.uniformMatrix4fv(w.uProj, false, proj);
    gl.uniformMatrix4fv(w.uView, false, view);
    gl.uniform3f(w.uColor, 0.0, 0.9, 0.7);
    this._wireBatch.upload(count);
    gl.bindVertexArray(vao);
    gl.drawElementsInstanced(gl.LINES, idxCount, gl.UNSIGNED_SHORT, 0, count);
    gl.bindVertexArray(null);
  },

  // Pack one model matrix into wire instance buffer at index
  packWireMatrix(idx, tx, ty, tz, rotY, rotZ, sx, sy, sz) {
    if (sy === undefined) { sy = sx; sz = sx; }
    this._wireBatch.ensure(idx + 1);
    writeModelMatrix(this._wireBatch.data, idx * this._wireBatch.floats, tx, ty, tz, rotY, rotZ, sx, sy, sz);
  },

  drawWireBillboardBatch(gl, proj, view, count) {
    const w = this._ensureWire();
    if (count === 0) return;

    gl.useProgram(w.billProg);
    gl.uniformMatrix4fv(w.bUProj, false, proj);
    gl.uniformMatrix4fv(w.bUView, false, view);
    gl.uniform3f(w.bUColor, 0.0, 0.9, 0.7);
    this._wireBillBatch.upload(count);
    gl.bindVertexArray(w.treeVAO);
    gl.drawElementsInstanced(gl.LINES, w.treeCount, gl.UNSIGNED_SHORT, 0, count);
    gl.bindVertexArray(null);
  },

  packWireBillboard(idx, bx, by, bz, sx, sy) {
    this._wireBillBatch.ensure(idx + 1);
    const off = idx * this._wireBillBatch.floats;
    const d = this._wireBillBatch.data;
    d[off] = bx;
    d[off+1] = by;
    d[off+2] = bz;
    d[off+3] = sx;
    d[off+4] = sy;
  },

  // --- Overlay registry (region edges, future paths, spawn zones, etc.) ---
  _overlays: [],
  addOverlay(fn) { this._overlays.push(fn); },

  // --- Per-item collider rings + player + deadzone + labels (instanced) ---
  drawItems(gl, proj, view, activeRegions, cc, cam) {
    if (!this.active) return;
    const d = _ensureDbg();
    gl.disable(gl.DEPTH_TEST);

    // Pre-count to ensure buffer capacity in one shot
    const creatures = CreatureController.creatures;
    let totalSolid = 2 + creatures.length, totalDotted = 0; // +2 for player + deadzone, +creatures
    for (const reg of activeRegions) {
      if (!reg.allColliders) buildRegionColliders(reg);
      for (const col of reg.allColliders) {
        const ct = COLLIDER_TYPES[col.type];
        if (!ct) continue;
        if (ct.debugStyle === 'dotted') totalDotted++; else totalSolid++;
      }
    }
    _dbgSolidBatch.ensure(totalSolid);
    _dbgDottedBatch.ensure(totalDotted);

    // Pack circles into separate solid/dotted instance buffers
    let solidCount = 0, dottedCount = 0;
    const sd = _dbgSolidBatch.data, dd = _dbgDottedBatch.data;

    for (const reg of activeRegions) {
      for (const col of reg.allColliders) {
        const ct = COLLIDER_TYPES[col.type];
        if (!ct) continue;
        const isDotted = ct.debugStyle === 'dotted';
        const buf = isDotted ? dd : sd;
        const idx = isDotted ? dottedCount++ : solidCount++;
        const off = idx * DBG_CIRCLE_FLOATS;
        buf[off] = col.colX; buf[off+1] = col.colY; buf[off+2] = col.colZ;
        buf[off+3] = col.colR;
        buf[off+4] = ct.debugColor[0]; buf[off+5] = ct.debugColor[1]; buf[off+6] = ct.debugColor[2];
      }
    }

    // Creature colliders (dynamic, not in region collider lists)
    for (const c of creatures) {
      if (!c.alive) continue;
      const ct = COLLIDER_TYPES[c.collider.type];
      if (!ct) continue;
      const off = solidCount * DBG_CIRCLE_FLOATS;
      sd[off] = c.collider.colX; sd[off+1] = c.collider.colY; sd[off+2] = c.collider.colZ;
      sd[off+3] = c.collider.colR;
      sd[off+4] = ct.debugColor[0]; sd[off+5] = ct.debugColor[1]; sd[off+6] = ct.debugColor[2];
      solidCount++;
    }

    // Player collider
    {
      const pct = COLLIDER_TYPES[cc.collider.type];
      const off = solidCount * DBG_CIRCLE_FLOATS;
      // Use interpolated render position so the ring doesn't stutter
      // from fixed-timestep frames with 0 vs 1 vs 2 sub-steps.
      // Physics collider (cc.collider.colX/Z) stays at true stepped position.
      sd[off] = cc.renderX; sd[off+1] = cc.renderY; sd[off+2] = cc.renderZ;
      sd[off+3] = cc.collider.colR;
      sd[off+4] = pct.debugColor[0]; sd[off+5] = pct.debugColor[1]; sd[off+6] = pct.debugColor[2];
      solidCount++;
    }

    // Camera deadzone ring
    if (this.showDeadzone) {
      const dzX = cam._camCenterX, dzZ = cam._camCenterZ;
      if (dzX !== undefined) {
        const settled = cam._camSettled;
        const off = solidCount * DBG_CIRCLE_FLOATS;
        sd[off] = dzX; sd[off+1] = 0; sd[off+2] = dzZ;
        sd[off+3] = cam.DEADZONE;
        sd[off+4] = settled ? 0.15 : 0.9;
        sd[off+5] = settled ? 0.15 : 0.9;
        sd[off+6] = settled ? 0.18 : 1.0;
        solidCount++;
      }
    }

    // Draw
    gl.useProgram(d.dbgProg);
    gl.uniformMatrix4fv(d.dbgUProj, false, proj);
    gl.uniformMatrix4fv(d.dbgUView, false, view);

    if (solidCount > 0) {
      _dbgSolidBatch.upload(solidCount);
      gl.bindVertexArray(d.dbgRingVAO);
      gl.drawArraysInstanced(gl.LINE_LOOP, 0, DBG_RING_SEGS, solidCount);
    }
    if (dottedCount > 0) {
      _dbgDottedBatch.upload(dottedCount);
      gl.bindVertexArray(d.dbgDottedVAO);
      gl.drawArraysInstanced(gl.LINES, 0, DBG_DOTTED_SEGS * 2, dottedCount);
    }

    gl.bindVertexArray(null);
    gl.enable(gl.DEPTH_TEST);

    // Region coordinate labels
    textBegin(proj, view);
    for (const reg of activeRegions) {
      const wcx = reg.gx * REGION_SIZE;
      const wcz = reg.gz * REGION_SIZE;
      if (reg._labelY === undefined) reg._labelY = getWorldHeight(wcx, wcz) + 0.1;
      textWorld('[' + reg.gx + ',' + reg.gz + ']', wcx, reg._labelY, wcz, { scale: 12, r: 1, g: 1, b: 1, a: 0.9 });
    }
    textEnd();
  },

  // --- Post-pass overlays (region edges, border margins — batched lines) ---
  drawOverlays(gl, proj, view, activeRegions) {
    if (!this.active) return;
    const d = _ensureDbg();
    gl.disable(gl.DEPTH_TEST);
    const LIFT = 0.08;
    const EDGE_SEGS = 8; // subdivisions per edge for terrain following
    let lc = 0; // line vert count

    // Pre-count: each rect = 4 edges × EDGE_SEGS segments × 2 verts = 4*EDGE_SEGS*2
    // 2 rects per region (boundary + margin) = 2 * 4 * EDGE_SEGS * 2
    _dbgLineBatch.ensure(activeRegions.length * 2 * 4 * EDGE_SEGS * 2);
    const ld = _dbgLineBatch.data;

    function pushLine(x0, y0, z0, x1, y1, z1, r, g, b) {
      const off = lc * 6;
      ld[off] = x0; ld[off + 1] = y0; ld[off + 2] = z0;
      ld[off + 3] = r; ld[off + 4] = g; ld[off + 5] = b;
      ld[off + 6] = x1; ld[off + 7] = y1; ld[off + 8] = z1;
      ld[off + 9] = r; ld[off + 10] = g; ld[off + 11] = b;
      lc += 2;
    }
    // Subdivided edge: walks from (u0,v0) to (u1,v1) in EDGE_SEGS steps,
    // sampling terrain height at each point
    function pushEdgeTerrain(u0, v0, u1, v1, ox, oz, r, g, b) {
      for (let i = 0; i < EDGE_SEGS; i++) {
        const t0 = i / EDGE_SEGS, t1 = (i + 1) / EDGE_SEGS;
        const eu0 = u0 + (u1 - u0) * t0, ev0 = v0 + (v1 - v0) * t0;
        const eu1 = u0 + (u1 - u0) * t1, ev1 = v0 + (v1 - v0) * t1;
        const wx0 = -S + eu0 * 2 * S + ox, wz0 = -S + ev0 * 2 * S + oz;
        const wx1 = -S + eu1 * 2 * S + ox, wz1 = -S + ev1 * 2 * S + oz;
        pushLine(wx0, getWorldHeight(wx0, wz0) + LIFT, wz0,
                 wx1, getWorldHeight(wx1, wz1) + LIFT, wz1, r, g, b);
      }
    }
    function pushRectTerrain(u0, v0, u1, v1, ox, oz, r, g, b) {
      pushEdgeTerrain(u0, v0, u1, v0, ox, oz, r, g, b);
      pushEdgeTerrain(u1, v0, u1, v1, ox, oz, r, g, b);
      pushEdgeTerrain(u1, v1, u0, v1, ox, oz, r, g, b);
      pushEdgeTerrain(u0, v1, u0, v0, ox, oz, r, g, b);
    }

    for (const reg of activeRegions) {
      const ox = reg.gx * REGION_SIZE;
      const oz = reg.gz * REGION_SIZE;

      // Red: region boundary
      pushRectTerrain(0, 0, 1, 1, ox, oz, 1.0, 0.2, 0.2);

      // Yellow: border margin
      const bName = reg.biomeName;
      const regBiome = BIOMES[bName];
      const baseM = regBiome.borderMargin || 0.03;
      const nLA = getRegionAssignment(reg.gx - 1, reg.gz);
      const nRA = getRegionAssignment(reg.gx + 1, reg.gz);
      const nTA = getRegionAssignment(reg.gx, reg.gz - 1);
      const nBA = getRegionAssignment(reg.gx, reg.gz + 1);
      const isTopLeftEdge  = (reg.gx === -GRID_HALF);
      const isTopRightEdge = (reg.gz === -GRID_HALF);
      const nL = nLA && nLA.biome === bName ? 0 : (!nLA && isTopLeftEdge)  ? 0 : baseM;
      const nR = nRA && nRA.biome === bName ? 0 : baseM;
      const nT = nTA && nTA.biome === bName ? 0 : (!nTA && isTopRightEdge) ? 0 : baseM;
      const nB = nBA && nBA.biome === bName ? 0 : baseM;
      pushEdgeTerrain(nL, nT, 1 - nR, nT, ox, oz, 1.0, 1.0, 0.0);
      pushEdgeTerrain(1 - nR, nT, 1 - nR, 1 - nB, ox, oz, 1.0, 1.0, 0.0);
      pushEdgeTerrain(1 - nR, 1 - nB, nL, 1 - nB, ox, oz, 1.0, 1.0, 0.0);
      pushEdgeTerrain(nL, 1 - nB, nL, nT, ox, oz, 1.0, 1.0, 0.0);
    }

    if (lc > 0) {
      gl.useProgram(d.lineProg);
      gl.uniformMatrix4fv(d.lineUProj, false, proj);
      gl.uniformMatrix4fv(d.lineUView, false, view);
      _dbgLineBatch.upload(lc);
      gl.bindVertexArray(d.lineVAO);
      gl.drawArrays(gl.LINES, 0, lc);
      gl.bindVertexArray(null);
    }

    // Run registered overlays (future: paths, spawn zones, etc.)
    for (const fn of this._overlays) fn(gl, proj, view, activeRegions);

    gl.enable(gl.DEPTH_TEST);
  }
};

// Pre-compile debug shaders at startup to avoid freeze on first toggle
_ensureDbg();
DebugVis._ensureWire();

const colBtn = document.getElementById('colBtn');
colBtn.addEventListener('click', () => {
  DebugVis.active = !DebugVis.active;
  colBtn.classList.toggle('active', DebugVis.active);
});

const hillBtn = document.getElementById('hillBtn');
hillBtn.addEventListener('click', () => {
  window._debugFlatTerrain = !window._debugFlatTerrain;
  hillBtn.classList.toggle('active', window._debugFlatTerrain);
  RegionManager.remeshAll();
});

const wireBtn = document.getElementById('wireBtn');
// Wireframe modes: 0=off, 1=ground, 2=objects, 3=both
window._wireMode = 0;
const _wireTitles = ['Wireframe: off', 'Wireframe: ground', 'Wireframe: objects', 'Wireframe: both'];
wireBtn.addEventListener('click', () => {
  window._wireMode = (window._wireMode + 1) % 4;
  wireBtn.classList.toggle('active', window._wireMode > 0);
  wireBtn.title = _wireTitles[window._wireMode];
});

// --- Biome HUD: custom config dropdown ---
const regionCoordsEl = document.getElementById('regionCoords');
const biomeDropdown = document.getElementById('biomeDropdown');
const biomeSelected = document.getElementById('biomeSelected');
const biomeOptions = document.getElementById('biomeOptions');
const configDropdown = document.getElementById('configDropdown');
const configSelected = document.getElementById('configSelected');
const configOptions = document.getElementById('configOptions');

const biomeNames = Object.keys(BIOMES); // ['rock', 'forest', 'desert']

function populateBiomeDropdown(currentBiome) {
  biomeSelected.textContent = currentBiome.charAt(0).toUpperCase() + currentBiome.slice(1);
  biomeOptions.innerHTML = '';
  for (const bKey of biomeNames) {
    const opt = document.createElement('div');
    opt.className = 'biome-opt' + (bKey === currentBiome ? ' active' : '');
    opt.textContent = bKey.charAt(0).toUpperCase() + bKey.slice(1);
    opt.dataset.biome = bKey;
    opt.addEventListener('click', (e) => {
      e.stopPropagation();
      const newBiome = opt.dataset.biome;
      const pgx = Math.round(CharacterController.x / REGION_SIZE);
      const pgz = Math.round(CharacterController.z / REGION_SIZE);
      RegionManager.setAssignment(pgx, pgz, newBiome, 0);
      biomeOptions.classList.remove('open');
      populateDropdowns();
    });
    biomeOptions.appendChild(opt);
  }
}

function populateConfigDropdown(currentBiome, currentConfigIdx) {
  configSelected.textContent = (currentConfigIdx + 1);
  configOptions.innerHTML = '';
  const configs = BIOMES[currentBiome].configs;
  for (let i = 0; i < configs.length; i++) {
    const opt = document.createElement('div');
    opt.className = 'cfg-opt' + (i === currentConfigIdx ? ' active' : '');
    opt.textContent = i + 1;
    opt.dataset.idx = i;
    opt.addEventListener('click', (e) => {
      e.stopPropagation();
      const idx = parseInt(opt.dataset.idx);
      const pgx = Math.round(CharacterController.x / REGION_SIZE);
      const pgz = Math.round(CharacterController.z / REGION_SIZE);
      const curAssignment = getRegionAssignment(pgx, pgz);
      RegionManager.setAssignment(pgx, pgz, curAssignment.biome, idx);
      configOptions.classList.remove('open');
      populateDropdowns();
    });
    configOptions.appendChild(opt);
  }
}

function populateDropdowns() {
  const pgx = Math.round(CharacterController.x / REGION_SIZE);
  const pgz = Math.round(CharacterController.z / REGION_SIZE);
  const assignment = getRegionAssignment(pgx, pgz);
  populateBiomeDropdown(assignment.biome);
  populateConfigDropdown(assignment.biome, assignment.configIdx);
  regionCoordsEl.textContent = pgx + ', ' + pgz;
}
populateDropdowns();

biomeDropdown.addEventListener('click', (e) => {
  e.stopPropagation();
  configOptions.classList.remove('open');
  biomeOptions.classList.toggle('open');
});
configDropdown.addEventListener('click', (e) => {
  e.stopPropagation();
  biomeOptions.classList.remove('open');
  configOptions.classList.toggle('open');
});
document.addEventListener('click', () => {
  configOptions.classList.remove('open');
  biomeOptions.classList.remove('open');
});

gl.enable(gl.DEPTH_TEST);

const _fpsRing = new Float32Array(3);
let _fpsRingIdx = 0;
let _fpsRingLen = 0;
let frameCount = 0;
let lastFpsTime = performance.now();
let drawCalls = 0;
let items = 0;
let tris = 0;
let frameMs = 0;
let frameMsMin = Infinity;
let frameMsMax = 0;
const statsEl = document.getElementById('stats');
let statsText = '';

// Tracked draw call
function draw(mode, count, type, offset) {
  gl.drawElements(mode, count, type, offset);
  drawCalls++;
  if (mode === gl.TRIANGLES) tris += count / 3;
}

function biomeGroundTex(name) {
  return name === 'forest' ? grassGroundTex : name === 'desert' ? desertGroundTex : rockGroundTex;
}

const _biomePriority = { desert: 0, rock: 1, forest: 2 };
function _biomePriorityCmp(a, b) { return (_biomePriority[a.biomeName] || 0) - (_biomePriority[b.biomeName] || 0); }

// Per-item frustum cull: skip items outside camera view (uses planes from getActiveRegions)
// margin accounts for billboard/mesh radius so partially visible items still draw
function isVisible(wx, wy, wz, margin) {
  for (let i = 0; i < 4; i++) {
    const p = _frustumPlanes[i];
    if (p[0] * wx + p[1] * wy + p[2] * wz + p[3] < -margin) return false;
  }
  return true;
}

// Debug draw helpers — preallocated buffer for edge lines
let _renderTime = 0;
let _loaderDone = false;
const _visSticks = new Array(256);
const _treesByVar = {};
function render(rafTime) {
  if (fpsCap > 0) {
    const minInterval = 1000 / fpsCap;
    if (rafTime - lastFrameTime < minInterval * 0.75) {
      requestAnimationFrame(render);
      return;
    }
    // Advance lastFrameTime by interval (not to rafTime) so timing stays
    // aligned to the target cadence. Clamp to prevent spiral if we fall behind.
    lastFrameTime += minInterval;
    if (rafTime - lastFrameTime > minInterval) lastFrameTime = rafTime;
  }
  const frameStart = performance.now();
  drawCalls = 0;
  tris = 0;
  items = 0;
  frameCount++;
  const now = frameStart;
  if (now - lastFpsTime >= 1000) {
    const elapsed = now - lastFpsTime;
    const rawFps = frameCount * 1000 / elapsed;
    _fpsRing[_fpsRingIdx] = rawFps;
    _fpsRingIdx = (_fpsRingIdx + 1) % 3;
    if (_fpsRingLen < 3) _fpsRingLen++;
    let fpsSum = 0;
    for (let fi = 0; fi < _fpsRingLen; fi++) fpsSum += _fpsRing[fi];
    const fps = Math.ceil(fpsSum / _fpsRingLen);
    statsText = `${fps} FPS | ${frameMs.toFixed(1)}ms (${frameMsMin.toFixed(1)}-${frameMsMax.toFixed(1)})`;
    // drawCalls/tris filled from previous frame
    frameCount = 0;
    // Advance by 1000ms (not reset to now) to keep windows aligned
    lastFpsTime += 1000;
    // Clamp if we fell way behind (e.g. tab was backgrounded)
    if (now - lastFpsTime > 1000) lastFpsTime = now;
    frameMsMin = Infinity;
    frameMsMax = 0;
  }
  gl.clearColor(0.03, 0.03, 0.05, 1);
  gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

  // --- Delta time ---
  const dt = Math.min((now - (render.lastTime || now)) / 1000, 0.05); // cap at 50ms
  render.lastTime = now;
  _renderTime = now / 1000; // seconds, for shake effects

  // --- Update controllers ---
  const cc = CharacterController;
  const cam = CameraController;

  cc.update(dt, _renderTime);
  CreatureController.update(dt);

  // Tick interactions for the player (auto-mine, future: pickup, NPC dialogue)
  InteractionSystem.tickActor(cc.x, cc.z, 0.3, cc, dt, 'minable');

  cam.update(dt, cc.x, cc.y, cc.z, cc.isMoving);
  const { proj, view } = cam.buildMatrices(canvas.width, canvas.height);
  cc.storeMatrices(view, proj);

  // Get visible regions via frustum culling
  const activeRegions = getActiveRegions(cc.x, cc.z, proj, view);

  // --- Draw ground for all active regions (opaque, no alpha blend) ---
  // Priority draw order: desert (lowest) â†’ rock â†’ forest (highest).
  // Higher-priority regions draw last so their overlap strips naturally
  // overwrite lower-priority cores, creating the interlocking edge effect
  // with the preferred biome always winning at boundaries.
  gl.useProgram(prog);
  gl.disable(gl.DEPTH_TEST);
  gl.uniformMatrix4fv(uProj, false, proj);
  gl.uniformMatrix4fv(uView, false, view);
  gl.uniform3f(uPlayerPos, cc.x, cc.y, cc.z);

  gl.uniform1f(uMineralOnly, 0.0);

  // Sort active regions by biome draw priority every frame.
  // Do NOT cache this sort — when RegionManager evicts and rebuilds regions
  // mid-frame (lifecycle callbacks), a stale sort order can draw a low-priority
  // biome after a high-priority one, causing black flicker at overlap edges.
  // Sorting 9 items is negligible cost.
  activeRegions.sort(_biomePriorityCmp);

  for (const reg of activeRegions) {
    const localTex = biomeGroundTex(reg.biomeName);
    gl.bindVertexArray(reg.terrain.vao);
    gl.uniform3f(uWorldOffset, reg.ox, 0, reg.oz);
    gl.activeTexture(gl.TEXTURE1);
    gl.bindTexture(gl.TEXTURE_2D, localTex);
    gl.uniform1i(uLocalTex, 1);
    draw(gl.TRIANGLES, reg.terrain.idxCount, gl.UNSIGNED_SHORT, 0);
  }

  // Wireframe overlay (ground)
  if (window._wireMode & 1) {
    DebugVis.drawWireground(gl, proj, view, activeRegions);
    // Re-bind ground program for mineral pass
    gl.useProgram(prog);
    gl.uniformMatrix4fv(uProj, false, proj);
    gl.uniformMatrix4fv(uView, false, view);
    gl.uniform3f(uPlayerPos, cc.x, cc.y, cc.z);
  }

  // Pass 2: Mineral ground overlay (uses discard, no blend needed)
  gl.uniform1f(uMineralOnly, 1.0);
  gl.activeTexture(gl.TEXTURE0);
  gl.uniform1i(uMineralMask, 0);
  gl.activeTexture(gl.TEXTURE2);
  gl.bindTexture(gl.TEXTURE_2D, mineralColorTex);
  gl.uniform1i(uMineralColorTex, 2);
  for (const reg of activeRegions) {
    if (!reg.mineralMesh) continue;
    gl.activeTexture(gl.TEXTURE0);
    gl.bindTexture(gl.TEXTURE_2D, reg.mineralMaskTex);
    gl.bindVertexArray(reg.mineralMesh.vao);
    gl.uniform3f(uWorldOffset, reg.ox, 0, reg.oz);
    draw(gl.TRIANGLES, reg.mineralMesh.idxCount, gl.UNSIGNED_SHORT, 0);
  }

  // --- Sticks (rendered in ground pass, no depth test — painted onto terrain) ---
  // Sticks are flat XZ quads at ground level. Rendering them with depth test
  // causes them to appear to float in isometric view because they're discrete
  // objects at a single height sample. Drawing them here (depth off) paints
  // them directly onto the terrain surface like decals.
  gl.useProgram(meshProg);
  gl.uniformMatrix4fv(mUProj, false, proj);
  gl.uniformMatrix4fv(mUView, false, view);
  gl.uniform3f(mUPlayerWorldPos, cc.x, cc.y, cc.z);
  gl.uniform3f(mUCamPos, CameraController._eyeVec[0], CameraController._eyeVec[1], CameraController._eyeVec[2]);
  gl.disable(gl.CULL_FACE);
  let stickCount = 0;
  for (const reg of activeRegions) {
    for (const st of reg.sticks) {
      if (!isVisible(st.visX, st.visY, st.visZ, 0.5)) continue;
      if (stickCount >= _visSticks.length) _visSticks.length = stickCount * 2;
      _visSticks[stickCount++] = st;
    }
  }
  if (stickCount > 0) {
    // Shadow pass
    for (let i = 0; i < stickCount; i++) {
      const st = _visSticks[i];
      const shScale = st.scale * 1.05;
      const shSz = st.flip ? -shScale : shScale;
      packMeshInst(i, st.visX + 0.01, st.visY - 0.003, st.visZ + 0.01, st.rotY, 0.0, shScale, shScale, shSz, 0.06, 0.04, 0.02, 0.0, 0.0, 0.0, 0.0);
    }
    meshBatch.upload(stickCount);
    gl.bindVertexArray(stickVAO);
    gl.drawElementsInstanced(gl.TRIANGLES, stickTriCount, gl.UNSIGNED_SHORT, 0, stickCount);
    drawCalls++; tris += stickCount * (stickTriCount / 3); items += stickCount;
    // Fill pass
    for (let i = 0; i < stickCount; i++) {
      const st = _visSticks[i];
      const sz = st.flip ? -st.scale : st.scale;
      packMeshInst(i, st.visX, st.visY, st.visZ, st.rotY, 0.0, st.scale, st.scale, sz, 0.52, 0.30, 0.10, 0.30, 0.0, 0.0, 0.0);
    }
    meshBatch.upload(stickCount);
    gl.drawElementsInstanced(gl.TRIANGLES, stickTriCount, gl.UNSIGNED_SHORT, 0, stickCount);
    drawCalls++; tris += stickCount * (stickTriCount / 3);
    for (let i = 0; i < stickCount; i++) _visSticks[i] = null;
  }

  gl.enable(gl.DEPTH_TEST);
  gl.depthMask(true);

  // --- Batched object pass (depth-tested, no sort needed) ---

  // Precompute minable wave pulse (needed for glow pass too)
  const time = now * 0.001;
  for (const reg of activeRegions) {
    for (const cluster of reg.minables) {
      const cubes = cluster.cubes;
      const n = cubes.length;
      if (!cluster._sortedIdx) {
        cluster._sortedIdx = Array.from({length: n}, (_, i) => i);
        cluster._sortedIdx.sort((a, b) => cubes[a].x - cubes[b].x);
        cluster._rank = new Float32Array(n);
        for (let r = 0; r < n; r++) cluster._rank[cluster._sortedIdx[r]] = r;
      }
      const wave = (time * 0.4) % 2.0;
      const pos = wave <= 1.0 ? wave : 2.0 - wave;
      for (let ci = 0; ci < n; ci++) {
        const c = cubes[ci];
        if (c.mined) continue;
        const rank = cluster._rank[ci] / (n - 1 || 1);
        c._waveProx = 1.0 - Math.min(1.0, Math.abs(rank - pos) * 3.0);
      }
    }
  }

  // Pre-set shared meshProg uniforms
  gl.useProgram(meshProg);
  gl.uniform3f(mUPlayerWorldPos, cc.x, cc.y, cc.z);
  gl.uniform3f(mUCamPos, CameraController._eyeVec[0], CameraController._eyeVec[1], CameraController._eyeVec[2]);

  // Pre-ensure meshBatch capacity (upper bound: all objects across active regions + 1 player)
  {
    let maxInst = 1; // player
    for (const reg of activeRegions) {
      maxInst += reg.rocks.length + reg.sticks.length;
      for (const cluster of reg.minables) maxInst += cluster.cubes.length;
    }
    meshBatch.ensure(maxInst);
  }


  // --- Rocks (instanced, single mesh) ---
  gl.enable(gl.CULL_FACE);
  gl.cullFace(gl.BACK);
  gl.uniformMatrix4fv(mUProj, false, proj);
  gl.uniformMatrix4fv(mUView, false, view);
  {
    const rm = rockMeshes[0];
    let ic = 0;
    for (const reg of activeRegions) {
      for (const r of reg.rocks) {
        if (!isVisible(r.x, r.visY, r.z, 1.0)) continue;
        packMeshInst(ic++, r.x, r.visY, r.z, r.rotY, 0.0, r.h, r.h, r.h, 0.28, 0.26, 0.24, 0.0, 1.0, 0.0, 0.0);
      }
    }
    if (ic > 0) {
      meshBatch.upload(ic);
      gl.bindVertexArray(rm.vao);
      gl.drawElementsInstanced(gl.TRIANGLES, rm.triCount, gl.UNSIGNED_SHORT, 0, ic);
      drawCalls++; tris += ic * (rm.triCount / 3); items += ic;
    }
    if (window._wireMode & 2) {
      let wi = 0;
      for (const reg of activeRegions) for (const r of reg.rocks) {
        if (!isVisible(r.x, r.visY, r.z, 1.0)) continue;
        DebugVis.packWireMatrix(wi++, r.x, r.visY, r.z, r.rotY, 0.0, r.h);
      }
      DebugVis.drawWireBatch(gl, proj, view, 'rock', wi);
      gl.useProgram(meshProg);
    }
  }

  // --- Minables (instanced, one draw per material) ---
  gl.disable(gl.POLYGON_OFFSET_FILL);
  gl.enable(gl.CULL_FACE);
  gl.cullFace(gl.BACK);
  for (const matName of _minableMatNames) {
    const mat = MINABLE_MATERIALS[matName];
    let ic = 0;
    for (const reg of activeRegions) {
      for (const cluster of reg.minables) {
        if (cluster.material !== matName) continue;
        for (const c of cluster.cubes) {
          if (c.mined) continue;
          if (!isVisible(c.x, c.y, c.z, 0.5)) continue;
          const waveProx = c._waveProx || 0;
          packMeshInst(ic++, c.x, c.y, c.z, c.rotY, c.rotZ, c.sx, c.sy, c.sz,
            mat.color[0], mat.color[1], mat.color[2],
            mat.emissiveBase + mat.emissiveWave * waveProx,
            0.0, mat.shininess * waveProx, 0.0);
        }
      }
    }
    if (ic > 0) {
      meshBatch.upload(ic);
      gl.bindVertexArray(cubeVAO);
      gl.drawElementsInstanced(gl.TRIANGLES, 36, gl.UNSIGNED_SHORT, 0, ic);
      drawCalls++; tris += ic * 12; items += ic;
    }
  }
  if (window._wireMode & 2) {
    let wi = 0;
    for (const reg of activeRegions) for (const cluster of reg.minables) for (const c of cluster.cubes) {
      if (c.mined) continue;
      if (!isVisible(c.x, c.y, c.z, 0.5)) continue;
      DebugVis.packWireMatrix(wi++, c.x, c.y, c.z, c.rotY, c.rotZ, c.sx, c.sy, c.sz);
    }
    DebugVis.drawWireBatch(gl, proj, view, 'minable', wi);
  }

  // --- Trees (instanced per texture variant, hard alpha cutoff via discard) ---
  if (treesLoaded === treesToLoad) {
    gl.disable(gl.CULL_FACE);
    gl.useProgram(treeProg);
    gl.bindVertexArray(treeVAO);
    gl.uniformMatrix4fv(tUProj, false, proj);
    gl.uniformMatrix4fv(tUView, false, view);
    gl.activeTexture(gl.TEXTURE0);
    gl.uniform1i(tUTreeTex, 0);
    gl.uniform3f(tUTreePlayerPos, cc.x, cc.y, cc.z);
    // Collect trees per texture variant, then issue one instanced draw per variant
    const tbv = _treesByVar;
    for (const k in tbv) tbv[k].count = 0;
    for (const reg of activeRegions) {
      for (let i = 0; i < reg.treePositions.length; i++) {
        const t = reg.treePositions[i];
        if (!isVisible(t.billX, t.billY, t.billZ, 1.5)) continue;
        const vi = reg.treeVarIdx[i];
        if (!tbv[vi]) tbv[vi] = { count: 0, trees: [] };
        const b = tbv[vi];
        if (b.count >= b.trees.length) b.trees.push(null);
        t._treeVarIdx = vi;
        b.trees[b.count++] = t;
      }
    }
    gl.bindBuffer(gl.ARRAY_BUFFER, billboardBatch.buf);
    for (const vi in tbv) {
      const b = tbv[vi];
      if (b.count === 0) continue;
      gl.bindTexture(gl.TEXTURE_2D, treeTextures[vi]);
      const tv = TREE_VARIANTS[vi] || TREE_VARIANTS.dry;
      gl.uniform2f(tUTreeSize, tv.size[0], tv.size[1]);
      // Fill instance buffer
      billboardBatch.ensure(b.count);
      const treeInstData = billboardBatch.data;
      let ic = 0;
      for (let ti = 0; ti < b.count; ti++) {
        const t = b.trees[ti];
        const off = ic * TREE_INST_FLOATS;
        // Bulk copy pre-baked static data (14 floats via memcpy)
        treeInstData.set(t._inst, off);
        // Overwrite animation slots only for shaking trees
        const sh = t._shake;
        if (sh && sh.active) {
          const shakeElapsed = _renderTime - sh.start;
          let shakeAmp = 1.0;
          if (sh.end) {
            const settle = _renderTime - sh.end;
            if (settle < 0.5) { shakeAmp = 1.0 - settle / 0.5; }
            else {
              sh.active = false; sh.end = 0; shakeAmp = 0.0;
              if (sh._pushed) { sh._pushed = false; _pushedTreeCount--; }
            }
          }
          treeInstData[off + 4] = shakeElapsed;
          treeInstData[off + 5] = shakeAmp;
          treeInstData[off + 6] = sh.phase;
          treeInstData[off + 7] = sh.dir;
          treeInstData[off + 8] = sh.hInt;
          treeInstData[off + 9] = sh.vInt;
          treeInstData[off + 13] = shakeAmp * 0.002;
        }
        ic++;
      }
      if (ic > 0) {
        billboardBatch.upload(ic);
        gl.drawElementsInstanced(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0, ic);
        drawCalls++;
        tris += ic * 2; items += ic;
      }
    }
    if (window._wireMode & 2) {
      let wi = 0;
      for (const vi in tbv) {
        const b = tbv[vi];
        const sz = (TREE_VARIANTS[vi] || TREE_VARIANTS.dry).size;
        for (let ti = 0; ti < b.count; ti++) {
          const t = b.trees[ti];
          DebugVis.packWireBillboard(wi++, t.billX, t.billY, t.billZ, sz[0], sz[1]);
        }
      }
      DebugVis.drawWireBillboardBatch(gl, proj, view, wi);
    }
    // Clear stale tree refs to allow GC of evicted regions
    for (const k in tbv) {
      const b = tbv[k];
      for (let i = 0; i < b.count; i++) b.trees[i] = null;
    }
  }

  // --- Creature rendering (instanced via mesh or billboard shader) ---
  {
    const creatures = CreatureController.creatures;
    if (creatures.length > 0) {
      // Group all visible creatures by type for batched drawing (reuse object, reset counts)
      for (const gk in _creatureGroups) _creatureGroups[gk].count = 0;
      for (let i = 0; i < creatures.length; i++) {
        const c = creatures[i];
        if (!c.alive) continue;
        if (!isVisible(c.x, c.y + c.visualYOffset, c.z, 0.5)) continue;
        const gk = c.type.id;
        if (!_creatureGroups[gk]) _creatureGroups[gk] = { type: c.type, creatures: [], count: 0 };
        const g = _creatureGroups[gk];
        if (g.count >= g.creatures.length) g.creatures.push(null);
        g.creatures[g.count++] = c;
      }
      for (const gk in _creatureGroups) {
        const g = _creatureGroups[gk];
        if (g.count === 0) continue;
        const type = g.type;
        // Textured creature rendering (mesh, quad, etc.)
        creatureBatch.ensure(g.count);
        for (let i = 0; i < g.count; i++) {
          const c = g.creatures[i];
          const sz = type.meshSize;
          const sc = c.custom.scale || 1;
          packCreatureInst(i,
            c.x, c.y + sz[1] * sc * 0.5 + c.visualYOffset, c.z,
            c.custom.displayRotY || 0, 0,
            sz[0] * sc, sz[1] * sc, sz[2],
            computeFlatDepth(proj, view, c.x, c.y, c.z),
            c.custom.poseFrame || 0, c.custom.flipU || 0, c.custom.variant || 0, c.custom.tiltZ || 0
          );
        }
        gl.useProgram(creatureProg);
        gl.uniformMatrix4fv(crUProj, false, proj);
        gl.uniformMatrix4fv(crUView, false, view);
        gl.uniform3f(crUPlayerPos, cc.x, cc.y, cc.z);
        gl.uniform1f(crUAtlasCols, type.atlasCols || type.atlasFrames || 1);
        gl.uniform1f(crUAtlasRows, type.atlasRows || 1);
        gl.activeTexture(gl.TEXTURE0);
        gl.uniform1i(crUTex, 0);
        const tex = creatureTextures[type.textureId || type.id];
        if (tex) gl.bindTexture(gl.TEXTURE_2D, tex);
        creatureBatch.upload(g.count);
        gl.bindVertexArray(creatureVAO);
        gl.drawElementsInstanced(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0, g.count);
        drawCalls++; tris += g.count * 2; items += g.count;
        gl.bindVertexArray(null);
        for (let i = 0; i < g.count; i++) g.creatures[i] = null;
      }
    }
  }

  // --- Player (single instance) ---
  gl.useProgram(meshProg);
  gl.uniformMatrix4fv(mUProj, false, proj);
  gl.uniformMatrix4fv(mUView, false, view);
  gl.enable(gl.CULL_FACE);
  gl.cullFace(gl.BACK);
  packMeshInst(0,
    cc.renderX, cc.renderY + CharacterController.HEIGHT * 0.5, cc.renderZ, 0, 0,
    CharacterController.RADIUS * 2, CharacterController.HEIGHT, CharacterController.RADIUS * 2,
    0.7, 0.85, 0.3, 0.05, 0.0, 0.0, computeFlatDepth(proj, view, cc.renderX, cc.renderY, cc.renderZ));
  meshBatch.upload(1);
  gl.bindVertexArray(cylVAO);
  gl.drawElementsInstanced(gl.TRIANGLES, cylIdxCount, gl.UNSIGNED_SHORT, 0, 1);
  drawCalls++; tris += cylIdxCount / 3; items += 1;
  if (window._wireMode & 2) {
    DebugVis.packWireMatrix(0,
      cc.renderX, cc.renderY + CharacterController.HEIGHT * 0.5, cc.renderZ, 0, 0,
      CharacterController.RADIUS * 2, CharacterController.HEIGHT, CharacterController.RADIUS * 2
    );
    DebugVis.drawWireBatch(gl, proj, view, 'player', 1);
  }

  gl.bindVertexArray(null);
  gl.disable(gl.CULL_FACE);

  // --- Progress bar (world-space, at player's feet) ---
  if (_progressBar) {
    drawProgressBar(gl, proj, view, cc.renderX, cc.renderY, cc.renderZ, _progressBar.progress, _progressBar.duration);
  }

  // --- DEBUG: Draw collider outlines when toggled (on top of everything) ---
  DebugVis.drawItems(gl, proj, view, activeRegions, cc, cam);

  // --- Draw glow billboards (instanced) ---
  gl.useProgram(glowProg);
  gl.enable(gl.BLEND);
  gl.blendFunc(gl.SRC_ALPHA, gl.ONE); // additive blending
  gl.depthMask(false); // don't write depth

  gl.bindVertexArray(glowVAO);

  gl.uniformMatrix4fv(gUProj, false, proj);
  gl.uniformMatrix4fv(gUView, false, view);

  let glowCount = 0;
  for (const reg of activeRegions) {
    for (const cluster of reg.minables) {
      const mat = MINABLE_MATERIALS[cluster.material];
      if (!mat.glow || !mat.glow.enabled) continue;
      const gc = mat.glow.color;
      for (const c of cluster.cubes) {
        if (c.mined) continue;
        if (!isVisible(c.x, c.y, c.z, 0.5)) continue;
        const gdx = c.x - cc.x;
        const gdz = c.z - cc.z;
        const gDist = Math.sqrt(gdx * gdx + gdz * gdz);
        if (gDist > 14.0) continue;
        const distFade = 1.0 - Math.max(0, Math.min(1, (gDist - 8.0) / 6.0));
        const pulse = (0.06 + 0.10 * (c._waveProx || 0)) * distFade;
        if (glowCount < MAX_GLOWS) {
          const off = glowCount * GLOW_INST_FLOATS;
          glowInstData[off]     = c.x;
          glowInstData[off + 1] = c.y;
          glowInstData[off + 2] = c.z;
          glowInstData[off + 3] = c.glowSize * 1.3;
          glowInstData[off + 4] = gc[0];
          glowInstData[off + 5] = gc[1];
          glowInstData[off + 6] = gc[2];
          glowInstData[off + 7] = pulse;
          glowCount++;
        }
      }
    }
  }

  if (glowCount > 0) {
    gl.bindBuffer(gl.ARRAY_BUFFER, glowInstBuf);
    gl.bufferSubData(gl.ARRAY_BUFFER, 0, glowInstData, 0, glowCount * GLOW_INST_FLOATS);
    gl.bindVertexArray(glowVAO);
    gl.drawElementsInstanced(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0, glowCount);
    drawCalls++;
    tris += glowCount * 2; items += glowCount;
  }

  gl.bindVertexArray(null);
  gl.depthMask(true);
  gl.disable(gl.BLEND);

  // --- DEBUG: Region boundaries & border margins ---
  DebugVis.drawOverlays(gl, proj, view, activeRegions);

  // --- Update stats ---
  frameMs = performance.now() - frameStart;
  frameMsMin = Math.min(frameMsMin, frameMs);
  frameMsMax = Math.max(frameMsMax, frameMs);
  const zoomDisplay = CameraController._zoomDefaultIdx - CameraController._zoomIdx;
  if (statsOpen) {
    let memStr = '';
    if (performance.memory) {
      const mb = (performance.memory.usedJSHeapSize / (1024 * 1024)).toFixed(0);
      memStr = ` | ${mb}MB`;
    }
    const mineralStr = _mineralsMined > 0 ? `\nMinerals: ${_mineralsMined}` : '';
    statsEl.textContent = statsText + `\n${tris.toLocaleString()} Tris | ${drawCalls} Draws (${items})${memStr}\nZoom ${zoomDisplay > 0 ? '+' : ''}${zoomDisplay} | ${GAME_VERSION}${mineralStr}`;
  }

  // Dismiss loader: pause â†’ fade crystal/dots â†’ fade black overlay
  if (!_loaderDone) {
    _loaderDone = true;
    const loader = document.getElementById('loader');
    if (loader) {
      const loaderCanvas = document.getElementById('loaderCanvas');
      // Step 1: Wait 500ms
      setTimeout(() => {
        // Step 2: Fade out crystal and dots (200ms)
        if (loaderCanvas) {
          loaderCanvas.style.transition = 'opacity 0.2s ease';
          loaderCanvas.style.opacity = '0';
        }
        // Step 3: After crystal fades, fade the black background (500ms)
        setTimeout(() => {
          loader.style.transition = 'opacity 0.5s ease';
          loader.style.opacity = '0';
          loader.addEventListener('transitionend', () => loader.remove());
        }, 250);
      }, 500);
    }
  }

  requestAnimationFrame(render);
}
// Initialize camera state so deadzone logic works before first movement
CameraController._camCenterX = CameraController.target[0];
CameraController._camCenterZ = CameraController.target[2];
CameraController._camSettled = true;
CharacterController._lastRegX = -999;
CharacterController._lastRegZ = -999;
render();
</script>


</body></html>